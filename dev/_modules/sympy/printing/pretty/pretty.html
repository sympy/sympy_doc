

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>sympy.printing.pretty.pretty &mdash; SymPy 0.7.3 documentation</title>
    
    <link rel="stylesheet" href="../../../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="http://live.sympy.org/static/live-core.css" type="text/css" />
    <link rel="stylesheet" href="http://live.sympy.org/static/live-autocomplete.css" type="text/css" />
    <link rel="stylesheet" href="http://live.sympy.org/static/live-sphinx.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../../',
        VERSION:     '0.7.3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://c328740.ssl.cf1.rackcdn.com/mathjax/latest/MathJax.js?config=TeX-AMS_HTML-full"></script>
    <script type="text/javascript" src="http://live.sympy.org/static/utilities.js"></script>
    <script type="text/javascript" src="http://live.sympy.org/static/external/classy.js"></script>
    <script type="text/javascript" src="http://live.sympy.org/static/live-core.js"></script>
    <script type="text/javascript" src="http://live.sympy.org/static/live-autocomplete.js"></script>
    <script type="text/javascript" src="http://live.sympy.org/static/live-sphinx.js"></script>
    <script type="text/javascript" src="../../../../_static/sidebar.js"></script>
    <link rel="shortcut icon" href="../../../../_static/SymPy-Favicon.ico"/>
    <link rel="top" title="SymPy 0.7.3 documentation" href="../../../../index.html" />
    <link rel="up" title="sympy" href="../../../sympy.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../../../../np-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../../index.html">SymPy 0.7.3 documentation</a> &raquo;</li>
          <li><a href="../../../index.html" >Module code</a> &raquo;</li>
          <li><a href="../../../sympy.html" accesskey="U">sympy</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for sympy.printing.pretty.pretty</h1><div class="highlight"><pre>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span><span class="p">,</span> <span class="n">division</span>

<span class="kn">from</span> <span class="nn">sympy.core</span> <span class="kn">import</span> <span class="n">S</span><span class="p">,</span> <span class="n">C</span>
<span class="kn">from</span> <span class="nn">sympy.core.function</span> <span class="kn">import</span> <span class="n">_coeff_isneg</span>
<span class="kn">from</span> <span class="nn">sympy.utilities</span> <span class="kn">import</span> <span class="n">group</span>
<span class="kn">from</span> <span class="nn">sympy.utilities.iterables</span> <span class="kn">import</span> <span class="n">has_variety</span>
<span class="kn">from</span> <span class="nn">sympy.core.sympify</span> <span class="kn">import</span> <span class="n">SympifyError</span>
<span class="kn">from</span> <span class="nn">sympy.core.compatibility</span> <span class="kn">import</span> <span class="n">u</span><span class="p">,</span> <span class="nb">xrange</span>

<span class="kn">from</span> <span class="nn">sympy.printing.printer</span> <span class="kn">import</span> <span class="n">Printer</span>
<span class="kn">from</span> <span class="nn">sympy.printing.str</span> <span class="kn">import</span> <span class="n">sstr</span>
<span class="kn">from</span> <span class="nn">sympy.printing.conventions</span> <span class="kn">import</span> <span class="n">requires_partial</span>

<span class="kn">from</span> <span class="nn">.stringpict</span> <span class="kn">import</span> <span class="n">prettyForm</span><span class="p">,</span> <span class="n">stringPict</span>
<span class="kn">from</span> <span class="nn">.pretty_symbology</span> <span class="kn">import</span> <span class="n">xstr</span><span class="p">,</span> <span class="n">hobj</span><span class="p">,</span> <span class="n">vobj</span><span class="p">,</span> <span class="n">xobj</span><span class="p">,</span> <span class="n">xsym</span><span class="p">,</span> <span class="n">pretty_symbol</span><span class="p">,</span> \
    <span class="n">pretty_atom</span><span class="p">,</span> <span class="n">pretty_use_unicode</span><span class="p">,</span> <span class="n">pretty_try_use_unicode</span><span class="p">,</span> <span class="n">greek_unicode</span><span class="p">,</span> <span class="n">U</span><span class="p">,</span> \
    <span class="n">annotated</span>

<span class="kn">from</span> <span class="nn">sympy.utilities</span> <span class="kn">import</span> <span class="n">default_sort_key</span>

<span class="c"># rename for usage from outside</span>
<span class="n">pprint_use_unicode</span> <span class="o">=</span> <span class="n">pretty_use_unicode</span>
<span class="n">pprint_try_use_unicode</span> <span class="o">=</span> <span class="n">pretty_try_use_unicode</span>


<div class="viewcode-block" id="PrettyPrinter"><a class="viewcode-back" href="../../../../modules/printing.html#sympy.printing.pretty.pretty.PrettyPrinter">[docs]</a><span class="k">class</span> <span class="nc">PrettyPrinter</span><span class="p">(</span><span class="n">Printer</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Printer, which converts an expression into 2D ASCII-art figure.&quot;&quot;&quot;</span>
    <span class="n">printmethod</span> <span class="o">=</span> <span class="s">&quot;_pretty&quot;</span>

    <span class="n">_default_settings</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">&quot;order&quot;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
        <span class="s">&quot;full_prec&quot;</span><span class="p">:</span> <span class="s">&quot;auto&quot;</span><span class="p">,</span>
        <span class="s">&quot;use_unicode&quot;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
        <span class="s">&quot;wrap_line&quot;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
        <span class="s">&quot;num_columns&quot;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">settings</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">Printer</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">settings</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">emptyPrinter</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">prettyForm</span><span class="p">(</span><span class="n">xstr</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_use_unicode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_settings</span><span class="p">[</span><span class="s">&#39;use_unicode&#39;</span><span class="p">]:</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pretty_use_unicode</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">doprint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_settings</span><span class="p">)</span>

    <span class="c"># empty op so _print(stringPict) returns the same</span>
    <span class="k">def</span> <span class="nf">_print_stringPict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">e</span>

    <span class="k">def</span> <span class="nf">_print_basestring</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">prettyForm</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_print_atan2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="n">pform</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_print_seq</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">)</span><span class="o">.</span><span class="n">parens</span><span class="p">())</span>
        <span class="n">pform</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">pform</span><span class="o">.</span><span class="n">left</span><span class="p">(</span><span class="s">&#39;atan2&#39;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">pform</span>

    <span class="k">def</span> <span class="nf">_print_Symbol</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="n">symb</span> <span class="o">=</span> <span class="n">pretty_symbol</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">prettyForm</span><span class="p">(</span><span class="n">symb</span><span class="p">)</span>
    <span class="n">_print_RandomSymbol</span> <span class="o">=</span> <span class="n">_print_Symbol</span>

    <span class="k">def</span> <span class="nf">_print_Float</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="c"># we will use StrPrinter&#39;s Float printer, but we need to handle the</span>
        <span class="c"># full_prec ourselves, according to the self._print_level</span>
        <span class="n">full_prec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_settings</span><span class="p">[</span><span class="s">&quot;full_prec&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">full_prec</span> <span class="o">==</span> <span class="s">&quot;auto&quot;</span><span class="p">:</span>
            <span class="n">full_prec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print_level</span> <span class="o">==</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">prettyForm</span><span class="p">(</span><span class="n">sstr</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">full_prec</span><span class="o">=</span><span class="n">full_prec</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_print_Atom</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c"># print atoms like Exp1 or Pi</span>
            <span class="k">return</span> <span class="n">prettyForm</span><span class="p">(</span><span class="n">pretty_atom</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">emptyPrinter</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="c"># Infinity inherits from Number, so we have to override _print_XXX order</span>
    <span class="n">_print_Infinity</span> <span class="o">=</span> <span class="n">_print_Atom</span>
    <span class="n">_print_NegativeInfinity</span> <span class="o">=</span> <span class="n">_print_Atom</span>
    <span class="n">_print_EmptySet</span> <span class="o">=</span> <span class="n">_print_Atom</span>
    <span class="n">_print_Naturals</span> <span class="o">=</span> <span class="n">_print_Atom</span>
    <span class="n">_print_Integers</span> <span class="o">=</span> <span class="n">_print_Atom</span>
    <span class="n">_print_Reals</span> <span class="o">=</span> <span class="n">_print_Atom</span>

    <span class="k">def</span> <span class="nf">_print_subfactorial</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">pform</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="c"># Add parentheses if needed</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">((</span><span class="n">x</span><span class="o">.</span><span class="n">is_Integer</span> <span class="ow">and</span> <span class="n">x</span><span class="o">.</span><span class="n">is_nonnegative</span><span class="p">)</span> <span class="ow">or</span> <span class="n">x</span><span class="o">.</span><span class="n">is_Symbol</span><span class="p">):</span>
            <span class="n">pform</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">pform</span><span class="o">.</span><span class="n">parens</span><span class="p">())</span>
        <span class="n">pform</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">pform</span><span class="o">.</span><span class="n">left</span><span class="p">(</span><span class="s">&#39;!&#39;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">pform</span>

    <span class="k">def</span> <span class="nf">_print_factorial</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">pform</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="c"># Add parentheses if needed</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">((</span><span class="n">x</span><span class="o">.</span><span class="n">is_Integer</span> <span class="ow">and</span> <span class="n">x</span><span class="o">.</span><span class="n">is_nonnegative</span><span class="p">)</span> <span class="ow">or</span> <span class="n">x</span><span class="o">.</span><span class="n">is_Symbol</span><span class="p">):</span>
            <span class="n">pform</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">pform</span><span class="o">.</span><span class="n">parens</span><span class="p">())</span>
        <span class="n">pform</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">pform</span><span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="s">&#39;!&#39;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">pform</span>

    <span class="k">def</span> <span class="nf">_print_factorial2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">pform</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="c"># Add parentheses if needed</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">((</span><span class="n">x</span><span class="o">.</span><span class="n">is_Integer</span> <span class="ow">and</span> <span class="n">x</span><span class="o">.</span><span class="n">is_nonnegative</span><span class="p">)</span> <span class="ow">or</span> <span class="n">x</span><span class="o">.</span><span class="n">is_Symbol</span><span class="p">):</span>
            <span class="n">pform</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">pform</span><span class="o">.</span><span class="n">parens</span><span class="p">())</span>
        <span class="n">pform</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">pform</span><span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="s">&#39;!!&#39;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">pform</span>

    <span class="k">def</span> <span class="nf">_print_binomial</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="n">n</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">args</span>

        <span class="n">n_pform</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="n">k_pform</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>

        <span class="n">bar</span> <span class="o">=</span> <span class="s">&#39; &#39;</span><span class="o">*</span><span class="nb">max</span><span class="p">(</span><span class="n">n_pform</span><span class="o">.</span><span class="n">width</span><span class="p">(),</span> <span class="n">k_pform</span><span class="o">.</span><span class="n">width</span><span class="p">())</span>

        <span class="n">pform</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">k_pform</span><span class="o">.</span><span class="n">above</span><span class="p">(</span><span class="n">bar</span><span class="p">))</span>
        <span class="n">pform</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">pform</span><span class="o">.</span><span class="n">above</span><span class="p">(</span><span class="n">n_pform</span><span class="p">))</span>
        <span class="n">pform</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">pform</span><span class="o">.</span><span class="n">parens</span><span class="p">(</span><span class="s">&#39;(&#39;</span><span class="p">,</span> <span class="s">&#39;)&#39;</span><span class="p">))</span>

        <span class="n">pform</span><span class="o">.</span><span class="n">baseline</span> <span class="o">=</span> <span class="p">(</span><span class="n">pform</span><span class="o">.</span><span class="n">baseline</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span>

        <span class="k">return</span> <span class="n">pform</span>

    <span class="k">def</span> <span class="nf">_print_Relational</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="n">op</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="s">&#39; &#39;</span> <span class="o">+</span> <span class="n">xsym</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">rel_op</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39; &#39;</span><span class="p">)</span>

        <span class="n">l</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">lhs</span><span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">rhs</span><span class="p">)</span>
        <span class="n">pform</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">stringPict</span><span class="o">.</span><span class="n">next</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">op</span><span class="p">,</span> <span class="n">r</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">pform</span>

    <span class="k">def</span> <span class="nf">_print_Not</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_unicode</span><span class="p">:</span>
            <span class="n">arg</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">pform</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">arg</span><span class="o">.</span><span class="n">is_Boolean</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">arg</span><span class="o">.</span><span class="n">is_Not</span><span class="p">:</span>
                <span class="n">pform</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">pform</span><span class="o">.</span><span class="n">parens</span><span class="p">())</span>

            <span class="k">return</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">pform</span><span class="o">.</span><span class="n">left</span><span class="p">(</span><span class="n">u</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\u00ac</span><span class="s"> &quot;</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print_Function</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__print_Boolean</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">char</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">args</span>
        <span class="k">if</span> <span class="n">sort</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">default_sort_key</span><span class="p">)</span>
        <span class="n">arg</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">pform</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">arg</span><span class="o">.</span><span class="n">is_Boolean</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">arg</span><span class="o">.</span><span class="n">is_Not</span><span class="p">:</span>
            <span class="n">pform</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">pform</span><span class="o">.</span><span class="n">parens</span><span class="p">())</span>

        <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="n">pform_arg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">arg</span><span class="o">.</span><span class="n">is_Boolean</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">arg</span><span class="o">.</span><span class="n">is_Not</span><span class="p">:</span>
                <span class="n">pform_arg</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">pform_arg</span><span class="o">.</span><span class="n">parens</span><span class="p">())</span>

            <span class="n">pform</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">pform</span><span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="n">u</span><span class="p">(</span><span class="s">&#39; </span><span class="si">%s</span><span class="s"> &#39;</span><span class="p">)</span> <span class="o">%</span> <span class="n">char</span><span class="p">))</span>
            <span class="n">pform</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">pform</span><span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="n">pform_arg</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">pform</span>

    <span class="k">def</span> <span class="nf">_print_And</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_unicode</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__print_Boolean</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">u</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\u2227</span><span class="s">&quot;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print_Function</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_print_Or</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_unicode</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__print_Boolean</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">u</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\u2228</span><span class="s">&quot;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print_Function</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_print_Xor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_unicode</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__print_Boolean</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">u</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\u22bb</span><span class="s">&quot;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print_Function</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_print_Nand</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_unicode</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__print_Boolean</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">u</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\u22bc</span><span class="s">&quot;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print_Function</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_print_Nor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_unicode</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__print_Boolean</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">u</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\u22bd</span><span class="s">&quot;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print_Function</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_print_Implies</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_unicode</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__print_Boolean</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">u</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\u2192</span><span class="s">&quot;</span><span class="p">),</span> <span class="n">sort</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print_Function</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_print_Equivalent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_unicode</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__print_Boolean</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">u</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\u2261</span><span class="s">&quot;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print_Function</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_print_conjugate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="n">pform</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">prettyForm</span><span class="p">(</span> <span class="o">*</span><span class="n">pform</span><span class="o">.</span><span class="n">above</span><span class="p">(</span> <span class="n">hobj</span><span class="p">(</span><span class="s">&#39;_&#39;</span><span class="p">,</span> <span class="n">pform</span><span class="o">.</span><span class="n">width</span><span class="p">()))</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_print_Abs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="n">pform</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">pform</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">pform</span><span class="o">.</span><span class="n">parens</span><span class="p">(</span><span class="s">&#39;|&#39;</span><span class="p">,</span> <span class="s">&#39;|&#39;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">pform</span>
    <span class="n">_print_Determinant</span> <span class="o">=</span> <span class="n">_print_Abs</span>

    <span class="k">def</span> <span class="nf">_print_floor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_unicode</span><span class="p">:</span>
            <span class="n">pform</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">pform</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">pform</span><span class="o">.</span><span class="n">parens</span><span class="p">(</span><span class="s">&#39;lfloor&#39;</span><span class="p">,</span> <span class="s">&#39;rfloor&#39;</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">pform</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print_Function</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_print_ceiling</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_unicode</span><span class="p">:</span>
            <span class="n">pform</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">pform</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">pform</span><span class="o">.</span><span class="n">parens</span><span class="p">(</span><span class="s">&#39;lceil&#39;</span><span class="p">,</span> <span class="s">&#39;rceil&#39;</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">pform</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print_Function</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_print_Derivative</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deriv</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">requires_partial</span><span class="p">(</span><span class="n">deriv</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_unicode</span><span class="p">:</span>
            <span class="n">deriv_symbol</span> <span class="o">=</span> <span class="n">U</span><span class="p">(</span><span class="s">&#39;PARTIAL DIFFERENTIAL&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">deriv_symbol</span> <span class="o">=</span> <span class="s">r&#39;d&#39;</span>
        <span class="n">syms</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">deriv</span><span class="o">.</span><span class="n">variables</span><span class="p">))</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="k">for</span> <span class="n">sym</span><span class="p">,</span> <span class="n">num</span> <span class="ow">in</span> <span class="n">group</span><span class="p">(</span><span class="n">syms</span><span class="p">,</span> <span class="n">multiple</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
            <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">sym</span><span class="p">)</span>
            <span class="n">ds</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">s</span><span class="o">.</span><span class="n">left</span><span class="p">(</span><span class="n">deriv_symbol</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">num</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">ds</span> <span class="o">=</span> <span class="n">ds</span><span class="o">**</span><span class="n">prettyForm</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">num</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">ds</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">x</span><span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">))</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">x</span><span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="n">ds</span><span class="p">))</span>

        <span class="n">f</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span>
            <span class="n">binding</span><span class="o">=</span><span class="n">prettyForm</span><span class="o">.</span><span class="n">FUNC</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">deriv</span><span class="o">.</span><span class="n">expr</span><span class="p">)</span><span class="o">.</span><span class="n">parens</span><span class="p">())</span>

        <span class="n">pform</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="n">deriv_symbol</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">syms</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">pform</span> <span class="o">=</span> <span class="n">pform</span><span class="o">**</span><span class="n">prettyForm</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">syms</span><span class="p">)))</span>

        <span class="n">pform</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">pform</span><span class="o">.</span><span class="n">below</span><span class="p">(</span><span class="n">stringPict</span><span class="o">.</span><span class="n">LINE</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>
        <span class="n">pform</span><span class="o">.</span><span class="n">baseline</span> <span class="o">=</span> <span class="n">pform</span><span class="o">.</span><span class="n">baseline</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">pform</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">stringPict</span><span class="o">.</span><span class="n">next</span><span class="p">(</span><span class="n">pform</span><span class="p">,</span> <span class="n">f</span><span class="p">))</span>
        <span class="n">pform</span><span class="o">.</span><span class="n">binding</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="o">.</span><span class="n">MUL</span>

        <span class="k">return</span> <span class="n">pform</span>

    <span class="k">def</span> <span class="nf">_print_Cycle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dc</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">sympy.combinatorics.permutations</span> <span class="kn">import</span> <span class="n">Permutation</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print_tuple</span><span class="p">(</span><span class="n">Permutation</span><span class="p">(</span><span class="n">dc</span><span class="o">.</span><span class="n">as_list</span><span class="p">())</span><span class="o">.</span><span class="n">cyclic_form</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_print_PDF</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pdf</span><span class="p">):</span>
        <span class="n">lim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">pdf</span><span class="o">.</span><span class="n">pdf</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">lim</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">lim</span><span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="s">&#39;, &#39;</span><span class="p">))</span>
        <span class="n">lim</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">lim</span><span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">pdf</span><span class="o">.</span><span class="n">domain</span><span class="p">[</span><span class="mi">0</span><span class="p">])))</span>
        <span class="n">lim</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">lim</span><span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="s">&#39;, &#39;</span><span class="p">))</span>
        <span class="n">lim</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">lim</span><span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">pdf</span><span class="o">.</span><span class="n">domain</span><span class="p">[</span><span class="mi">1</span><span class="p">])))</span>
        <span class="n">lim</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">lim</span><span class="o">.</span><span class="n">parens</span><span class="p">())</span>

        <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">pdf</span><span class="o">.</span><span class="n">pdf</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">f</span><span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="s">&#39;, &#39;</span><span class="p">))</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">f</span><span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="n">lim</span><span class="p">))</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">f</span><span class="o">.</span><span class="n">parens</span><span class="p">())</span>

        <span class="n">pform</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="s">&#39;PDF&#39;</span><span class="p">)</span>
        <span class="n">pform</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">pform</span><span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">pform</span>

    <span class="k">def</span> <span class="nf">_print_Integral</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">integral</span><span class="p">):</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">integral</span><span class="o">.</span><span class="n">function</span>

        <span class="c"># Add parentheses if arg involves addition of terms and</span>
        <span class="c"># create a pretty form for the argument</span>
        <span class="n">prettyF</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="c"># XXX generalize parens</span>
        <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">is_Add</span><span class="p">:</span>
            <span class="n">prettyF</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">prettyF</span><span class="o">.</span><span class="n">parens</span><span class="p">())</span>

        <span class="c"># dx dy dz ...</span>
        <span class="n">arg</span> <span class="o">=</span> <span class="n">prettyF</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">integral</span><span class="o">.</span><span class="n">limits</span><span class="p">:</span>
            <span class="n">prettyArg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="c"># XXX qparens (parens if needs-parens)</span>
            <span class="k">if</span> <span class="n">prettyArg</span><span class="o">.</span><span class="n">width</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">prettyArg</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">prettyArg</span><span class="o">.</span><span class="n">parens</span><span class="p">())</span>

            <span class="n">arg</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">arg</span><span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="s">&#39; d&#39;</span><span class="p">,</span> <span class="n">prettyArg</span><span class="p">))</span>

        <span class="c"># \int \int \int ...</span>
        <span class="n">firstterm</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">s</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">for</span> <span class="n">lim</span> <span class="ow">in</span> <span class="n">integral</span><span class="o">.</span><span class="n">limits</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">lim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="c"># Create bar based on the height of the argument</span>
            <span class="n">h</span> <span class="o">=</span> <span class="n">arg</span><span class="o">.</span><span class="n">height</span><span class="p">()</span>
            <span class="n">H</span> <span class="o">=</span> <span class="n">h</span> <span class="o">+</span> <span class="mi">2</span>

            <span class="c"># XXX hack!</span>
            <span class="n">ascii_mode</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_unicode</span>
            <span class="k">if</span> <span class="n">ascii_mode</span><span class="p">:</span>
                <span class="n">H</span> <span class="o">+=</span> <span class="mi">2</span>

            <span class="n">vint</span> <span class="o">=</span> <span class="n">vobj</span><span class="p">(</span><span class="s">&#39;int&#39;</span><span class="p">,</span> <span class="n">H</span><span class="p">)</span>

            <span class="c"># Construct the pretty form with the integral sign and the argument</span>
            <span class="n">pform</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="n">vint</span><span class="p">)</span>
            <span class="c">#pform.baseline = pform.height()//2  # vcenter</span>
            <span class="n">pform</span><span class="o">.</span><span class="n">baseline</span> <span class="o">=</span> <span class="n">arg</span><span class="o">.</span><span class="n">baseline</span> <span class="o">+</span> <span class="p">(</span>
                <span class="n">H</span> <span class="o">-</span> <span class="n">h</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span>    <span class="c"># covering the whole argument</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lim</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="c"># Create pretty forms for endpoints, if definite integral.</span>
                <span class="c"># Do not print empty endpoints.</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lim</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">prettyA</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span>
                    <span class="n">prettyB</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">lim</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lim</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="n">prettyA</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">lim</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="n">prettyB</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">lim</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

                <span class="k">if</span> <span class="n">ascii_mode</span><span class="p">:</span>  <span class="c"># XXX hack</span>
                    <span class="c"># Add spacing so that endpoint can more easily be</span>
                    <span class="c"># identified with the correct integral sign</span>
                    <span class="n">spc</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span> <span class="o">-</span> <span class="n">prettyB</span><span class="o">.</span><span class="n">width</span><span class="p">())</span>
                    <span class="n">prettyB</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">prettyB</span><span class="o">.</span><span class="n">left</span><span class="p">(</span><span class="s">&#39; &#39;</span> <span class="o">*</span> <span class="n">spc</span><span class="p">))</span>

                    <span class="n">spc</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span> <span class="o">-</span> <span class="n">prettyA</span><span class="o">.</span><span class="n">width</span><span class="p">())</span>
                    <span class="n">prettyA</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">prettyA</span><span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="s">&#39; &#39;</span> <span class="o">*</span> <span class="n">spc</span><span class="p">))</span>

                <span class="n">pform</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">pform</span><span class="o">.</span><span class="n">above</span><span class="p">(</span><span class="n">prettyB</span><span class="p">))</span>
                <span class="n">pform</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">pform</span><span class="o">.</span><span class="n">below</span><span class="p">(</span><span class="n">prettyA</span><span class="p">))</span>

                <span class="c">#if ascii_mode:  # XXX hack</span>
                <span class="c">#    # too much vspace beetween \int and argument</span>
                <span class="c">#    # but I left it as is</span>
                <span class="c">#    pform = prettyForm(*pform.right(&#39; &#39;))</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">ascii_mode</span><span class="p">:</span>  <span class="c"># XXX hack</span>
                <span class="n">pform</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">pform</span><span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">firstterm</span><span class="p">:</span>
                <span class="n">s</span> <span class="o">=</span> <span class="n">pform</span>   <span class="c"># first term</span>
                <span class="n">firstterm</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">s</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">s</span><span class="o">.</span><span class="n">left</span><span class="p">(</span><span class="n">pform</span><span class="p">))</span>

        <span class="n">pform</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">arg</span><span class="o">.</span><span class="n">left</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
        <span class="n">pform</span><span class="o">.</span><span class="n">binding</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="o">.</span><span class="n">MUL</span>
        <span class="k">return</span> <span class="n">pform</span>

    <span class="k">def</span> <span class="nf">_print_Product</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>
        <span class="n">func</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">term</span>
        <span class="n">pretty_func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>

        <span class="n">horizontal_chr</span> <span class="o">=</span> <span class="n">xobj</span><span class="p">(</span><span class="s">&#39;_&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">corner_chr</span> <span class="o">=</span> <span class="n">xobj</span><span class="p">(</span><span class="s">&#39;_&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">vertical_chr</span> <span class="o">=</span> <span class="n">xobj</span><span class="p">(</span><span class="s">&#39;|&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_unicode</span><span class="p">:</span>
            <span class="c"># use unicode corners</span>
            <span class="n">horizontal_chr</span> <span class="o">=</span> <span class="n">xobj</span><span class="p">(</span><span class="s">&#39;-&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">corner_chr</span> <span class="o">=</span> <span class="n">u</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\u252c</span><span class="s">&#39;</span><span class="p">)</span>

        <span class="n">func_height</span> <span class="o">=</span> <span class="n">pretty_func</span><span class="o">.</span><span class="n">height</span><span class="p">()</span>

        <span class="n">first</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">max_upper</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">sign_height</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">for</span> <span class="n">lim</span> <span class="ow">in</span> <span class="n">expr</span><span class="o">.</span><span class="n">limits</span><span class="p">:</span>
            <span class="n">width</span> <span class="o">=</span> <span class="p">(</span><span class="n">func_height</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="mi">5</span> <span class="o">//</span> <span class="mi">3</span> <span class="o">-</span> <span class="mi">2</span>
            <span class="n">sign_lines</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">sign_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">corner_chr</span> <span class="o">+</span> <span class="p">(</span><span class="n">horizontal_chr</span><span class="o">*</span><span class="n">width</span><span class="p">)</span> <span class="o">+</span> <span class="n">corner_chr</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">func_height</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">sign_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vertical_chr</span> <span class="o">+</span> <span class="p">(</span><span class="s">&#39; &#39;</span><span class="o">*</span><span class="n">width</span><span class="p">)</span> <span class="o">+</span> <span class="n">vertical_chr</span><span class="p">)</span>

            <span class="n">pretty_sign</span> <span class="o">=</span> <span class="n">stringPict</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span>
            <span class="n">pretty_sign</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">pretty_sign</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="o">*</span><span class="n">sign_lines</span><span class="p">))</span>

            <span class="n">pretty_upper</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">lim</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">pretty_lower</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">C</span><span class="o">.</span><span class="n">Equality</span><span class="p">(</span><span class="n">lim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">lim</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

            <span class="n">max_upper</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_upper</span><span class="p">,</span> <span class="n">pretty_upper</span><span class="o">.</span><span class="n">height</span><span class="p">())</span>

            <span class="k">if</span> <span class="n">first</span><span class="p">:</span>
                <span class="n">sign_height</span> <span class="o">=</span> <span class="n">pretty_sign</span><span class="o">.</span><span class="n">height</span><span class="p">()</span>

            <span class="n">pretty_sign</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">pretty_sign</span><span class="o">.</span><span class="n">above</span><span class="p">(</span><span class="n">pretty_upper</span><span class="p">))</span>
            <span class="n">pretty_sign</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">pretty_sign</span><span class="o">.</span><span class="n">below</span><span class="p">(</span><span class="n">pretty_lower</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">first</span><span class="p">:</span>
                <span class="n">pretty_func</span><span class="o">.</span><span class="n">baseline</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">first</span> <span class="o">=</span> <span class="bp">False</span>

            <span class="n">height</span> <span class="o">=</span> <span class="n">pretty_sign</span><span class="o">.</span><span class="n">height</span><span class="p">()</span>
            <span class="n">padding</span> <span class="o">=</span> <span class="n">stringPict</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span>
            <span class="n">padding</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">padding</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="s">&#39; &#39;</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">height</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)))</span>
            <span class="n">pretty_sign</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">pretty_sign</span><span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="n">padding</span><span class="p">))</span>

            <span class="n">pretty_func</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">pretty_sign</span><span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="n">pretty_func</span><span class="p">))</span>

        <span class="c">#pretty_func.baseline = 0</span>

        <span class="n">pretty_func</span><span class="o">.</span><span class="n">baseline</span> <span class="o">=</span> <span class="n">max_upper</span> <span class="o">+</span> <span class="n">sign_height</span><span class="o">//</span><span class="mi">2</span>
        <span class="n">pretty_func</span><span class="o">.</span><span class="n">binding</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="o">.</span><span class="n">MUL</span>
        <span class="k">return</span> <span class="n">pretty_func</span>

    <span class="k">def</span> <span class="nf">_print_Sum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>
        <span class="n">ascii_mode</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_unicode</span>

        <span class="k">def</span> <span class="nf">asum</span><span class="p">(</span><span class="n">hrequired</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">,</span> <span class="n">use_ascii</span><span class="p">):</span>
            <span class="k">def</span> <span class="nf">adjust</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">wid</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s">&#39;&lt;^&gt;&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">wid</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">wid</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">s</span>
                <span class="n">need</span> <span class="o">=</span> <span class="n">wid</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">how</span> <span class="o">==</span> <span class="s">&#39;&lt;^&gt;&#39;</span> <span class="ow">or</span> <span class="n">how</span> <span class="o">==</span> <span class="s">&quot;&lt;&quot;</span> <span class="ow">or</span> <span class="n">how</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="s">&#39;&lt;^&gt;&#39;</span><span class="p">):</span>
                    <span class="k">return</span> <span class="n">s</span> <span class="o">+</span> <span class="s">&#39; &#39;</span><span class="o">*</span><span class="n">need</span>
                <span class="n">half</span> <span class="o">=</span> <span class="n">need</span><span class="o">//</span><span class="mi">2</span>
                <span class="n">lead</span> <span class="o">=</span> <span class="s">&#39; &#39;</span><span class="o">*</span><span class="n">half</span>
                <span class="k">if</span> <span class="n">how</span> <span class="o">==</span> <span class="s">&quot;&gt;&quot;</span><span class="p">:</span>
                    <span class="k">return</span> <span class="s">&quot; &quot;</span><span class="o">*</span><span class="n">need</span> <span class="o">+</span> <span class="n">s</span>
                <span class="k">return</span> <span class="n">lead</span> <span class="o">+</span> <span class="n">s</span> <span class="o">+</span> <span class="s">&#39; &#39;</span><span class="o">*</span><span class="p">(</span><span class="n">need</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">lead</span><span class="p">))</span>

            <span class="n">h</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">hrequired</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">h</span><span class="o">//</span><span class="mi">2</span>
            <span class="n">w</span> <span class="o">=</span> <span class="n">d</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">more</span> <span class="o">=</span> <span class="n">hrequired</span> <span class="o">%</span> <span class="mi">2</span>

            <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="n">use_ascii</span><span class="p">:</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;_&quot;</span><span class="o">*</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39; &#39;</span><span class="p">)</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;\</span><span class="si">%s</span><span class="s">`&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s">&#39; &#39;</span><span class="o">*</span><span class="p">(</span><span class="n">w</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)))</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
                    <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="se">\\</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s">&#39; &#39;</span><span class="o">*</span><span class="n">i</span><span class="p">,</span> <span class="s">&#39; &#39;</span><span class="o">*</span><span class="p">(</span><span class="n">w</span> <span class="o">-</span> <span class="n">i</span><span class="p">)))</span>
                <span class="k">if</span> <span class="n">more</span><span class="p">:</span>
                    <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">)</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s">&#39; &#39;</span><span class="o">*</span><span class="p">(</span><span class="n">d</span><span class="p">),</span> <span class="s">&#39; &#39;</span><span class="o">*</span><span class="p">(</span><span class="n">w</span> <span class="o">-</span> <span class="n">d</span><span class="p">)))</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">d</span><span class="p">)):</span>
                    <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">/</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s">&#39; &#39;</span><span class="o">*</span><span class="n">i</span><span class="p">,</span> <span class="s">&#39; &#39;</span><span class="o">*</span><span class="p">(</span><span class="n">w</span> <span class="o">-</span> <span class="n">i</span><span class="p">)))</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;/&quot;</span> <span class="o">+</span> <span class="s">&quot;_&quot;</span><span class="o">*</span><span class="p">(</span><span class="n">w</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;,&#39;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">d</span><span class="p">,</span> <span class="n">h</span> <span class="o">+</span> <span class="n">more</span><span class="p">,</span> <span class="n">lines</span><span class="p">,</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">w</span> <span class="o">=</span> <span class="n">w</span> <span class="o">+</span> <span class="n">more</span>
                <span class="n">d</span> <span class="o">=</span> <span class="n">d</span> <span class="o">+</span> <span class="n">more</span>
                <span class="n">vsum</span> <span class="o">=</span> <span class="n">vobj</span><span class="p">(</span><span class="s">&#39;sum&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;_&quot;</span><span class="o">*</span><span class="p">(</span><span class="n">w</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
                    <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s%s%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s">&#39; &#39;</span><span class="o">*</span><span class="n">i</span><span class="p">,</span> <span class="n">vsum</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="s">&#39; &#39;</span><span class="o">*</span><span class="p">(</span><span class="n">w</span> <span class="o">-</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)))</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">d</span><span class="p">)):</span>
                    <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s%s%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s">&#39; &#39;</span><span class="o">*</span><span class="n">i</span><span class="p">,</span> <span class="n">vsum</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="s">&#39; &#39;</span><span class="o">*</span><span class="p">(</span><span class="n">w</span> <span class="o">-</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)))</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vsum</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">w</span><span class="p">))</span>
                <span class="k">return</span> <span class="n">d</span><span class="p">,</span> <span class="n">h</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">more</span><span class="p">,</span> <span class="n">lines</span><span class="p">,</span> <span class="n">more</span>

        <span class="n">f</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">function</span>

        <span class="n">prettyF</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">is_Add</span><span class="p">:</span>  <span class="c"># add parens</span>
            <span class="n">prettyF</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">prettyF</span><span class="o">.</span><span class="n">parens</span><span class="p">())</span>

        <span class="n">H</span> <span class="o">=</span> <span class="n">prettyF</span><span class="o">.</span><span class="n">height</span><span class="p">()</span> <span class="o">+</span> <span class="mi">2</span>

        <span class="c"># \sum \sum \sum ...</span>
        <span class="n">first</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">max_upper</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">sign_height</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">for</span> <span class="n">lim</span> <span class="ow">in</span> <span class="n">expr</span><span class="o">.</span><span class="n">limits</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lim</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">prettyUpper</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">lim</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                <span class="n">prettyLower</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">C</span><span class="o">.</span><span class="n">Equality</span><span class="p">(</span><span class="n">lim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">lim</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">lim</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">prettyUpper</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span>
                <span class="n">prettyLower</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">C</span><span class="o">.</span><span class="n">Equality</span><span class="p">(</span><span class="n">lim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">lim</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">lim</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">prettyUpper</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span>
                <span class="n">prettyLower</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">lim</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

            <span class="n">max_upper</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_upper</span><span class="p">,</span> <span class="n">prettyUpper</span><span class="o">.</span><span class="n">height</span><span class="p">())</span>

            <span class="c"># Create sum sign based on the height of the argument</span>
            <span class="n">d</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">slines</span><span class="p">,</span> <span class="n">adjustment</span> <span class="o">=</span> <span class="n">asum</span><span class="p">(</span>
                <span class="n">H</span><span class="p">,</span> <span class="n">prettyLower</span><span class="o">.</span><span class="n">width</span><span class="p">(),</span> <span class="n">prettyUpper</span><span class="o">.</span><span class="n">width</span><span class="p">(),</span> <span class="n">ascii_mode</span><span class="p">)</span>
            <span class="n">prettySign</span> <span class="o">=</span> <span class="n">stringPict</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span>
            <span class="n">prettySign</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">prettySign</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="o">*</span><span class="n">slines</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">first</span><span class="p">:</span>
                <span class="n">sign_height</span> <span class="o">=</span> <span class="n">prettySign</span><span class="o">.</span><span class="n">height</span><span class="p">()</span>

            <span class="n">prettySign</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">prettySign</span><span class="o">.</span><span class="n">above</span><span class="p">(</span><span class="n">prettyUpper</span><span class="p">))</span>
            <span class="n">prettySign</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">prettySign</span><span class="o">.</span><span class="n">below</span><span class="p">(</span><span class="n">prettyLower</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">first</span><span class="p">:</span>
                <span class="c"># change F baseline so it centers on the sign</span>
                <span class="n">prettyF</span><span class="o">.</span><span class="n">baseline</span> <span class="o">-=</span> <span class="n">d</span> <span class="o">-</span> <span class="p">(</span><span class="n">prettyF</span><span class="o">.</span><span class="n">height</span><span class="p">()</span><span class="o">//</span><span class="mi">2</span> <span class="o">-</span>
                                         <span class="n">prettyF</span><span class="o">.</span><span class="n">baseline</span><span class="p">)</span> <span class="o">-</span> <span class="n">adjustment</span>
                <span class="n">first</span> <span class="o">=</span> <span class="bp">False</span>

            <span class="c"># put padding to the right</span>
            <span class="n">pad</span> <span class="o">=</span> <span class="n">stringPict</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span>
            <span class="n">pad</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">pad</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="s">&#39; &#39;</span><span class="p">]</span><span class="o">*</span><span class="n">h</span><span class="p">))</span>
            <span class="n">prettySign</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">prettySign</span><span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="n">pad</span><span class="p">))</span>
            <span class="c"># put the present prettyF to the right</span>
            <span class="n">prettyF</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">prettySign</span><span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="n">prettyF</span><span class="p">))</span>

        <span class="n">prettyF</span><span class="o">.</span><span class="n">baseline</span> <span class="o">=</span> <span class="n">max_upper</span> <span class="o">+</span> <span class="n">sign_height</span><span class="o">//</span><span class="mi">2</span>
        <span class="n">prettyF</span><span class="o">.</span><span class="n">binding</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="o">.</span><span class="n">MUL</span>
        <span class="k">return</span> <span class="n">prettyF</span>

    <span class="k">def</span> <span class="nf">_print_Limit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">l</span><span class="p">):</span>
        <span class="c"># XXX we do not print dir ...</span>
        <span class="n">e</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">z0</span><span class="p">,</span> <span class="nb">dir</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">args</span>

        <span class="n">E</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="n">Lim</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="s">&#39;lim&#39;</span><span class="p">)</span>

        <span class="n">LimArg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
        <span class="n">LimArg</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">LimArg</span><span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="s">&#39;-&gt;&#39;</span><span class="p">))</span>
        <span class="n">LimArg</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">LimArg</span><span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">z0</span><span class="p">)))</span>

        <span class="n">Lim</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">Lim</span><span class="o">.</span><span class="n">below</span><span class="p">(</span><span class="n">LimArg</span><span class="p">))</span>
        <span class="n">Lim</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">Lim</span><span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="n">E</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">Lim</span>

    <span class="k">def</span> <span class="nf">_print_matrix_contents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method factors out what is essentially grid printing.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">M</span> <span class="o">=</span> <span class="n">e</span>   <span class="c"># matrix</span>
        <span class="n">Ms</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c"># i,j -&gt; pretty(M[i,j])</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">M</span><span class="o">.</span><span class="n">rows</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">M</span><span class="o">.</span><span class="n">cols</span><span class="p">):</span>
                <span class="n">Ms</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">M</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span>

        <span class="c"># h- and v- spacers</span>
        <span class="n">hsep</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="n">vsep</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="c"># max width for columns</span>
        <span class="n">maxw</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">M</span><span class="o">.</span><span class="n">cols</span>

        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">M</span><span class="o">.</span><span class="n">cols</span><span class="p">):</span>
            <span class="n">maxw</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="n">Ms</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">width</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">M</span><span class="o">.</span><span class="n">rows</span><span class="p">)]</span> <span class="ow">or</span> <span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="c"># drawing result</span>
        <span class="n">D</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">M</span><span class="o">.</span><span class="n">rows</span><span class="p">):</span>

            <span class="n">D_row</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">M</span><span class="o">.</span><span class="n">cols</span><span class="p">):</span>
                <span class="n">s</span> <span class="o">=</span> <span class="n">Ms</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>

                <span class="c"># reshape s to maxw</span>
                <span class="c"># XXX this should be generalized, and go to stringPict.reshape ?</span>
                <span class="k">assert</span> <span class="n">s</span><span class="o">.</span><span class="n">width</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="n">maxw</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>

                <span class="c"># hcenter it, +0.5 to the right                        2</span>
                <span class="c"># ( it&#39;s better to align formula starts for say 0 and r )</span>
                <span class="c"># XXX this is not good in all cases -- maybe introduce vbaseline?</span>
                <span class="n">wdelta</span> <span class="o">=</span> <span class="n">maxw</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">s</span><span class="o">.</span><span class="n">width</span><span class="p">()</span>
                <span class="n">wleft</span> <span class="o">=</span> <span class="n">wdelta</span> <span class="o">//</span> <span class="mi">2</span>
                <span class="n">wright</span> <span class="o">=</span> <span class="n">wdelta</span> <span class="o">-</span> <span class="n">wleft</span>

                <span class="n">s</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">s</span><span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="o">*</span><span class="n">wright</span><span class="p">))</span>
                <span class="n">s</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">s</span><span class="o">.</span><span class="n">left</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="o">*</span><span class="n">wleft</span><span class="p">))</span>

                <span class="c"># we don&#39;t need vcenter cells -- this is automatically done in</span>
                <span class="c"># a pretty way because when their baselines are taking into</span>
                <span class="c"># account in .right()</span>

                <span class="k">if</span> <span class="n">D_row</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">D_row</span> <span class="o">=</span> <span class="n">s</span>   <span class="c"># first box in a row</span>
                    <span class="k">continue</span>

                <span class="n">D_row</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">D_row</span><span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="o">*</span><span class="n">hsep</span><span class="p">))</span>  <span class="c"># h-spacer</span>
                <span class="n">D_row</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">D_row</span><span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">D</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">D</span> <span class="o">=</span> <span class="n">D_row</span>       <span class="c"># first row in a picture</span>
                <span class="k">continue</span>

            <span class="c"># v-spacer</span>
            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">vsep</span><span class="p">):</span>
                <span class="n">D</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">D</span><span class="o">.</span><span class="n">below</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">))</span>

            <span class="n">D</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">D</span><span class="o">.</span><span class="n">below</span><span class="p">(</span><span class="n">D_row</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">D</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">D</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span>  <span class="c"># Empty Matrix</span>

        <span class="k">return</span> <span class="n">D</span>

    <span class="k">def</span> <span class="nf">_print_MatrixBase</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="n">D</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print_matrix_contents</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="n">D</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">D</span><span class="o">.</span><span class="n">parens</span><span class="p">(</span><span class="s">&#39;[&#39;</span><span class="p">,</span> <span class="s">&#39;]&#39;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">D</span>
    <span class="n">_print_ImmutableMatrix</span> <span class="o">=</span> <span class="n">_print_MatrixBase</span>
    <span class="n">_print_Matrix</span> <span class="o">=</span> <span class="n">_print_MatrixBase</span>


    <span class="k">def</span> <span class="nf">_print_MatrixElement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">sympy.matrices</span> <span class="kn">import</span> <span class="n">MatrixSymbol</span>
        <span class="kn">from</span> <span class="nn">sympy</span> <span class="kn">import</span> <span class="n">Symbol</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> <span class="n">MatrixSymbol</span><span class="p">)</span>
                <span class="ow">and</span> <span class="n">expr</span><span class="o">.</span><span class="n">i</span><span class="o">.</span><span class="n">is_number</span> <span class="ow">and</span> <span class="n">expr</span><span class="o">.</span><span class="n">j</span><span class="o">.</span><span class="n">is_number</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span>
                    <span class="n">Symbol</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s">&#39;_</span><span class="si">%d%d</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">i</span><span class="p">,</span> <span class="n">expr</span><span class="o">.</span><span class="n">j</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">prettyFunc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span>
            <span class="n">prettyIndices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print_seq</span><span class="p">((</span><span class="n">expr</span><span class="o">.</span><span class="n">i</span><span class="p">,</span> <span class="n">expr</span><span class="o">.</span><span class="n">j</span><span class="p">),</span> <span class="n">delimiter</span><span class="o">=</span><span class="s">&#39;, &#39;</span>
                    <span class="p">)</span><span class="o">.</span><span class="n">parens</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="s">&#39;[&#39;</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="s">&#39;]&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">pform</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="n">binding</span><span class="o">=</span><span class="n">prettyForm</span><span class="o">.</span><span class="n">FUNC</span><span class="p">,</span>
                    <span class="o">*</span><span class="n">stringPict</span><span class="o">.</span><span class="n">next</span><span class="p">(</span><span class="n">prettyFunc</span><span class="p">,</span> <span class="n">prettyIndices</span><span class="p">))</span>

            <span class="c"># store pform parts so it can be reassembled e.g. when powered</span>
            <span class="n">pform</span><span class="o">.</span><span class="n">prettyFunc</span> <span class="o">=</span> <span class="n">prettyFunc</span>
            <span class="n">pform</span><span class="o">.</span><span class="n">prettyArgs</span> <span class="o">=</span> <span class="n">prettyIndices</span>

            <span class="k">return</span> <span class="n">pform</span>


    <span class="k">def</span> <span class="nf">_print_MatrixSlice</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
        <span class="c"># XXX works only for applied functions</span>

        <span class="n">prettyFunc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">ppslice</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
            <span class="n">x</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">del</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">del</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
            <span class="k">return</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_print_seq</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s">&#39;:&#39;</span><span class="p">))</span>
        <span class="n">prettyArgs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print_seq</span><span class="p">((</span><span class="n">ppslice</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">rowslice</span><span class="p">),</span>
            <span class="n">ppslice</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">colslice</span><span class="p">)),</span> <span class="n">delimiter</span><span class="o">=</span><span class="s">&#39;, &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">parens</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="s">&#39;[&#39;</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="s">&#39;]&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">pform</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span>
            <span class="n">binding</span><span class="o">=</span><span class="n">prettyForm</span><span class="o">.</span><span class="n">FUNC</span><span class="p">,</span> <span class="o">*</span><span class="n">stringPict</span><span class="o">.</span><span class="n">next</span><span class="p">(</span><span class="n">prettyFunc</span><span class="p">,</span> <span class="n">prettyArgs</span><span class="p">))</span>

        <span class="c"># store pform parts so it can be reassembled e.g. when powered</span>
        <span class="n">pform</span><span class="o">.</span><span class="n">prettyFunc</span> <span class="o">=</span> <span class="n">prettyFunc</span>
        <span class="n">pform</span><span class="o">.</span><span class="n">prettyArgs</span> <span class="o">=</span> <span class="n">prettyArgs</span>

        <span class="k">return</span> <span class="n">pform</span>

    <span class="k">def</span> <span class="nf">_print_Transpose</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>
        <span class="n">pform</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">arg</span><span class="p">)</span>
        <span class="kn">from</span> <span class="nn">sympy.matrices</span> <span class="kn">import</span> <span class="n">MatrixSymbol</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">arg</span><span class="p">,</span> <span class="n">MatrixSymbol</span><span class="p">):</span>
            <span class="n">pform</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">pform</span><span class="o">.</span><span class="n">parens</span><span class="p">())</span>
        <span class="n">pform</span> <span class="o">=</span> <span class="n">pform</span><span class="o">**</span><span class="p">(</span><span class="n">prettyForm</span><span class="p">(</span><span class="s">&#39;T&#39;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">pform</span>

    <span class="k">def</span> <span class="nf">_print_Adjoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>
        <span class="n">pform</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">arg</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_unicode</span><span class="p">:</span>
            <span class="n">dag</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="n">u</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\u2020</span><span class="s">&#39;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dag</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="s">&#39;+&#39;</span><span class="p">)</span>
        <span class="kn">from</span> <span class="nn">sympy.matrices</span> <span class="kn">import</span> <span class="n">MatrixSymbol</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">arg</span><span class="p">,</span> <span class="n">MatrixSymbol</span><span class="p">):</span>
            <span class="n">pform</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">pform</span><span class="o">.</span><span class="n">parens</span><span class="p">())</span>
        <span class="n">pform</span> <span class="o">=</span> <span class="n">pform</span><span class="o">**</span><span class="n">dag</span>
        <span class="k">return</span> <span class="n">pform</span>

    <span class="k">def</span> <span class="nf">_print_BlockMatrix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">B</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">B</span><span class="o">.</span><span class="n">blocks</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">B</span><span class="o">.</span><span class="n">blocks</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">B</span><span class="o">.</span><span class="n">blocks</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_print_MatAdd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print_seq</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="s">&#39; + &#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_print_MatMul</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>
        <span class="n">args</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">)</span>
        <span class="kn">from</span> <span class="nn">sympy</span> <span class="kn">import</span> <span class="n">Add</span><span class="p">,</span> <span class="n">MatAdd</span><span class="p">,</span> <span class="n">HadamardProduct</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="p">(</span><span class="n">Add</span><span class="p">,</span> <span class="n">MatAdd</span><span class="p">,</span> <span class="n">HadamardProduct</span><span class="p">))</span>
                    <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">args</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">.</span><span class="n">parens</span><span class="p">())</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">args</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">prettyForm</span><span class="o">.</span><span class="n">__mul__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_print_MatPow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>
        <span class="n">pform</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">base</span><span class="p">)</span>
        <span class="kn">from</span> <span class="nn">sympy.matrices</span> <span class="kn">import</span> <span class="n">MatrixSymbol</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">base</span><span class="p">,</span> <span class="n">MatrixSymbol</span><span class="p">):</span>
            <span class="n">pform</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">pform</span><span class="o">.</span><span class="n">parens</span><span class="p">())</span>
        <span class="n">pform</span> <span class="o">=</span> <span class="n">pform</span><span class="o">**</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">exp</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">pform</span>

    <span class="k">def</span> <span class="nf">_print_HadamardProduct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">sympy</span> <span class="kn">import</span> <span class="n">MatAdd</span><span class="p">,</span> <span class="n">MatMul</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_unicode</span><span class="p">:</span>
            <span class="n">delim</span> <span class="o">=</span> <span class="n">pretty_atom</span><span class="p">(</span><span class="s">&#39;Ring&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">delim</span> <span class="o">=</span> <span class="s">&#39;.*&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print_seq</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">delim</span><span class="p">,</span>
                <span class="n">parenthesize</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="n">MatAdd</span><span class="p">,</span> <span class="n">MatMul</span><span class="p">)))</span>

    <span class="n">_print_MatrixSymbol</span> <span class="o">=</span> <span class="n">_print_Symbol</span>

    <span class="k">def</span> <span class="nf">_print_FunctionMatrix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
        <span class="n">D</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">lamda</span><span class="o">.</span><span class="n">expr</span><span class="p">)</span>
        <span class="n">D</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">D</span><span class="o">.</span><span class="n">parens</span><span class="p">(</span><span class="s">&#39;[&#39;</span><span class="p">,</span> <span class="s">&#39;]&#39;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">D</span>

    <span class="k">def</span> <span class="nf">_print_Piecewise</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pexpr</span><span class="p">):</span>

        <span class="n">P</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">ec</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">pexpr</span><span class="o">.</span><span class="n">args</span><span class="p">):</span>
            <span class="n">P</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">ec</span><span class="o">.</span><span class="n">expr</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ec</span><span class="o">.</span><span class="n">cond</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>
                <span class="n">P</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="s">&#39;otherwise&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">P</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span>
                    <span class="o">*</span><span class="n">prettyForm</span><span class="p">(</span><span class="s">&#39;for &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">ec</span><span class="o">.</span><span class="n">cond</span><span class="p">)))</span>
        <span class="n">hsep</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="n">vsep</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">len_args</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pexpr</span><span class="o">.</span><span class="n">args</span><span class="p">)</span>

        <span class="c"># max widths</span>
        <span class="n">maxw</span> <span class="o">=</span> <span class="p">[</span><span class="nb">max</span><span class="p">([</span><span class="n">P</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">width</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">len_args</span><span class="p">)])</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">)]</span>

        <span class="c"># FIXME: Refactor this code and matrix into some tabular environment.</span>
        <span class="c"># drawing result</span>
        <span class="n">D</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">len_args</span><span class="p">):</span>
            <span class="n">D_row</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
                <span class="n">p</span> <span class="o">=</span> <span class="n">P</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
                <span class="k">assert</span> <span class="n">p</span><span class="o">.</span><span class="n">width</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="n">maxw</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>

                <span class="n">wdelta</span> <span class="o">=</span> <span class="n">maxw</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">p</span><span class="o">.</span><span class="n">width</span><span class="p">()</span>
                <span class="n">wleft</span> <span class="o">=</span> <span class="n">wdelta</span> <span class="o">//</span> <span class="mi">2</span>
                <span class="n">wright</span> <span class="o">=</span> <span class="n">wdelta</span> <span class="o">-</span> <span class="n">wleft</span>

                <span class="n">p</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">p</span><span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="o">*</span><span class="n">wright</span><span class="p">))</span>
                <span class="n">p</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">p</span><span class="o">.</span><span class="n">left</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="o">*</span><span class="n">wleft</span><span class="p">))</span>

                <span class="k">if</span> <span class="n">D_row</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">D_row</span> <span class="o">=</span> <span class="n">p</span>
                    <span class="k">continue</span>

                <span class="n">D_row</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">D_row</span><span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="o">*</span><span class="n">hsep</span><span class="p">))</span>  <span class="c"># h-spacer</span>
                <span class="n">D_row</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">D_row</span><span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">D</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">D</span> <span class="o">=</span> <span class="n">D_row</span>       <span class="c"># first row in a picture</span>
                <span class="k">continue</span>

            <span class="c"># v-spacer</span>
            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">vsep</span><span class="p">):</span>
                <span class="n">D</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">D</span><span class="o">.</span><span class="n">below</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">))</span>

            <span class="n">D</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">D</span><span class="o">.</span><span class="n">below</span><span class="p">(</span><span class="n">D_row</span><span class="p">))</span>

        <span class="n">D</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">D</span><span class="o">.</span><span class="n">parens</span><span class="p">(</span><span class="s">&#39;{&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">))</span>
        <span class="n">D</span><span class="o">.</span><span class="n">baseline</span> <span class="o">=</span> <span class="n">D</span><span class="o">.</span><span class="n">height</span><span class="p">()</span><span class="o">//</span><span class="mi">2</span>
        <span class="n">D</span><span class="o">.</span><span class="n">binding</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="o">.</span><span class="n">OPEN</span>
        <span class="k">return</span> <span class="n">D</span>

    <span class="k">def</span> <span class="nf">_hprint_vec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="n">D</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">v</span><span class="p">:</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">a</span>
            <span class="k">if</span> <span class="n">D</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">D</span> <span class="o">=</span> <span class="n">p</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">D</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">D</span><span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="s">&#39;, &#39;</span><span class="p">))</span>
                <span class="n">D</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">D</span><span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">D</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">D</span> <span class="o">=</span> <span class="n">stringPict</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">D</span>

    <span class="k">def</span> <span class="nf">_hprint_vseparator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">):</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">p1</span><span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="n">p2</span><span class="p">))</span>
        <span class="n">sep</span> <span class="o">=</span> <span class="n">stringPict</span><span class="p">(</span><span class="n">vobj</span><span class="p">(</span><span class="s">&#39;|&#39;</span><span class="p">,</span> <span class="n">tmp</span><span class="o">.</span><span class="n">height</span><span class="p">()),</span> <span class="n">baseline</span><span class="o">=</span><span class="n">tmp</span><span class="o">.</span><span class="n">baseline</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">p1</span><span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="n">sep</span><span class="p">,</span> <span class="n">p2</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_print_hyper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="c"># FIXME refactor Matrix, Piecewise, and this into a tabular environment</span>
        <span class="n">ap</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">e</span><span class="o">.</span><span class="n">ap</span><span class="p">]</span>
        <span class="n">bq</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">e</span><span class="o">.</span><span class="n">bq</span><span class="p">]</span>

        <span class="n">P</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">argument</span><span class="p">)</span>
        <span class="n">P</span><span class="o">.</span><span class="n">baseline</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">height</span><span class="p">()</span><span class="o">//</span><span class="mi">2</span>

        <span class="c"># Drawing result - first create the ap, bq vectors</span>
        <span class="n">D</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="p">[</span><span class="n">ap</span><span class="p">,</span> <span class="n">bq</span><span class="p">]:</span>
            <span class="n">D_row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hprint_vec</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">D</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">D</span> <span class="o">=</span> <span class="n">D_row</span>       <span class="c"># first row in a picture</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">D</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">D</span><span class="o">.</span><span class="n">below</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">))</span>
                <span class="n">D</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">D</span><span class="o">.</span><span class="n">below</span><span class="p">(</span><span class="n">D_row</span><span class="p">))</span>

        <span class="c"># make sure that the argument `z&#39; is centred vertically</span>
        <span class="n">D</span><span class="o">.</span><span class="n">baseline</span> <span class="o">=</span> <span class="n">D</span><span class="o">.</span><span class="n">height</span><span class="p">()</span><span class="o">//</span><span class="mi">2</span>

        <span class="c"># insert horizontal separator</span>
        <span class="n">P</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">P</span><span class="o">.</span><span class="n">left</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">))</span>
        <span class="n">D</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">D</span><span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">))</span>

        <span class="c"># insert separating `|`</span>
        <span class="n">D</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hprint_vseparator</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">P</span><span class="p">)</span>

        <span class="c"># add parens</span>
        <span class="n">D</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">D</span><span class="o">.</span><span class="n">parens</span><span class="p">(</span><span class="s">&#39;(&#39;</span><span class="p">,</span> <span class="s">&#39;)&#39;</span><span class="p">))</span>

        <span class="c"># create the F symbol</span>
        <span class="n">above</span> <span class="o">=</span> <span class="n">D</span><span class="o">.</span><span class="n">height</span><span class="p">()</span><span class="o">//</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">below</span> <span class="o">=</span> <span class="n">D</span><span class="o">.</span><span class="n">height</span><span class="p">()</span> <span class="o">-</span> <span class="n">above</span> <span class="o">-</span> <span class="mi">1</span>

        <span class="n">sz</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">add</span><span class="p">,</span> <span class="n">img</span> <span class="o">=</span> <span class="n">annotated</span><span class="p">(</span><span class="s">&#39;F&#39;</span><span class="p">)</span>
        <span class="n">F</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">*</span> <span class="p">(</span><span class="n">above</span> <span class="o">-</span> <span class="n">t</span><span class="p">)</span> <span class="o">+</span> <span class="n">img</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">*</span> <span class="p">(</span><span class="n">below</span> <span class="o">-</span> <span class="n">b</span><span class="p">),</span>
                       <span class="n">baseline</span><span class="o">=</span><span class="n">above</span> <span class="o">+</span> <span class="n">sz</span><span class="p">)</span>
        <span class="n">add</span> <span class="o">=</span> <span class="p">(</span><span class="n">sz</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span>

        <span class="n">F</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">F</span><span class="o">.</span><span class="n">left</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">ap</span><span class="p">))))</span>
        <span class="n">F</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">F</span><span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">bq</span><span class="p">))))</span>
        <span class="n">F</span><span class="o">.</span><span class="n">baseline</span> <span class="o">=</span> <span class="n">above</span> <span class="o">+</span> <span class="n">add</span>

        <span class="n">D</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">F</span><span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span> <span class="n">D</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">D</span>

    <span class="k">def</span> <span class="nf">_print_meijerg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="c"># FIXME refactor Matrix, Piecewise, and this into a tabular environment</span>

        <span class="n">v</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">v</span><span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">e</span><span class="o">.</span><span class="n">an</span><span class="p">]</span>
        <span class="n">v</span><span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">e</span><span class="o">.</span><span class="n">aother</span><span class="p">]</span>
        <span class="n">v</span><span class="p">[(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">e</span><span class="o">.</span><span class="n">bm</span><span class="p">]</span>
        <span class="n">v</span><span class="p">[(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">e</span><span class="o">.</span><span class="n">bother</span><span class="p">]</span>

        <span class="n">P</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">argument</span><span class="p">)</span>
        <span class="n">P</span><span class="o">.</span><span class="n">baseline</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">height</span><span class="p">()</span><span class="o">//</span><span class="mi">2</span>

        <span class="n">vp</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">v</span><span class="p">:</span>
            <span class="n">vp</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hprint_vec</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
            <span class="n">maxw</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">vp</span><span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">)]</span><span class="o">.</span><span class="n">width</span><span class="p">(),</span> <span class="n">vp</span><span class="p">[(</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">)]</span><span class="o">.</span><span class="n">width</span><span class="p">())</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
                <span class="n">s</span> <span class="o">=</span> <span class="n">vp</span><span class="p">[(</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">)]</span>
                <span class="n">left</span> <span class="o">=</span> <span class="p">(</span><span class="n">maxw</span> <span class="o">-</span> <span class="n">s</span><span class="o">.</span><span class="n">width</span><span class="p">())</span> <span class="o">//</span> <span class="mi">2</span>
                <span class="n">right</span> <span class="o">=</span> <span class="n">maxw</span> <span class="o">-</span> <span class="n">left</span> <span class="o">-</span> <span class="n">s</span><span class="o">.</span><span class="n">width</span><span class="p">()</span>
                <span class="n">s</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">s</span><span class="o">.</span><span class="n">left</span><span class="p">(</span><span class="s">&#39; &#39;</span> <span class="o">*</span> <span class="n">left</span><span class="p">))</span>
                <span class="n">s</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">s</span><span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="s">&#39; &#39;</span> <span class="o">*</span> <span class="n">right</span><span class="p">))</span>
                <span class="n">vp</span><span class="p">[(</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">)]</span> <span class="o">=</span> <span class="n">s</span>

        <span class="n">D1</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">vp</span><span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)]</span><span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="s">&#39;  &#39;</span><span class="p">,</span> <span class="n">vp</span><span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)]))</span>
        <span class="n">D1</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">D1</span><span class="o">.</span><span class="n">below</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">))</span>
        <span class="n">D2</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">vp</span><span class="p">[(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)]</span><span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="s">&#39;  &#39;</span><span class="p">,</span> <span class="n">vp</span><span class="p">[(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)]))</span>
        <span class="n">D</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">D1</span><span class="o">.</span><span class="n">below</span><span class="p">(</span><span class="n">D2</span><span class="p">))</span>

        <span class="c"># make sure that the argument `z&#39; is centred vertically</span>
        <span class="n">D</span><span class="o">.</span><span class="n">baseline</span> <span class="o">=</span> <span class="n">D</span><span class="o">.</span><span class="n">height</span><span class="p">()</span><span class="o">//</span><span class="mi">2</span>

        <span class="c"># insert horizontal separator</span>
        <span class="n">P</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">P</span><span class="o">.</span><span class="n">left</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">))</span>
        <span class="n">D</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">D</span><span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">))</span>

        <span class="c"># insert separating `|`</span>
        <span class="n">D</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hprint_vseparator</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">P</span><span class="p">)</span>

        <span class="c"># add parens</span>
        <span class="n">D</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">D</span><span class="o">.</span><span class="n">parens</span><span class="p">(</span><span class="s">&#39;(&#39;</span><span class="p">,</span> <span class="s">&#39;)&#39;</span><span class="p">))</span>

        <span class="c"># create the G symbol</span>
        <span class="n">above</span> <span class="o">=</span> <span class="n">D</span><span class="o">.</span><span class="n">height</span><span class="p">()</span><span class="o">//</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">below</span> <span class="o">=</span> <span class="n">D</span><span class="o">.</span><span class="n">height</span><span class="p">()</span> <span class="o">-</span> <span class="n">above</span> <span class="o">-</span> <span class="mi">1</span>

        <span class="n">sz</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">add</span><span class="p">,</span> <span class="n">img</span> <span class="o">=</span> <span class="n">annotated</span><span class="p">(</span><span class="s">&#39;G&#39;</span><span class="p">)</span>
        <span class="n">F</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">*</span> <span class="p">(</span><span class="n">above</span> <span class="o">-</span> <span class="n">t</span><span class="p">)</span> <span class="o">+</span> <span class="n">img</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">*</span> <span class="p">(</span><span class="n">below</span> <span class="o">-</span> <span class="n">b</span><span class="p">),</span>
                       <span class="n">baseline</span><span class="o">=</span><span class="n">above</span> <span class="o">+</span> <span class="n">sz</span><span class="p">)</span>

        <span class="n">pp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">ap</span><span class="p">))</span>
        <span class="n">pq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">bq</span><span class="p">))</span>
        <span class="n">pm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">bm</span><span class="p">))</span>
        <span class="n">pn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">an</span><span class="p">))</span>

        <span class="k">def</span> <span class="nf">adjust</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">):</span>
            <span class="n">diff</span> <span class="o">=</span> <span class="n">p1</span><span class="o">.</span><span class="n">width</span><span class="p">()</span> <span class="o">-</span> <span class="n">p2</span><span class="o">.</span><span class="n">width</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">diff</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span>
            <span class="k">elif</span> <span class="n">diff</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">p1</span><span class="p">,</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">p2</span><span class="o">.</span><span class="n">left</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="o">*</span><span class="n">diff</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">p1</span><span class="o">.</span><span class="n">left</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="o">*-</span><span class="n">diff</span><span class="p">)),</span> <span class="n">p2</span>
        <span class="n">pp</span><span class="p">,</span> <span class="n">pm</span> <span class="o">=</span> <span class="n">adjust</span><span class="p">(</span><span class="n">pp</span><span class="p">,</span> <span class="n">pm</span><span class="p">)</span>
        <span class="n">pq</span><span class="p">,</span> <span class="n">pn</span> <span class="o">=</span> <span class="n">adjust</span><span class="p">(</span><span class="n">pq</span><span class="p">,</span> <span class="n">pn</span><span class="p">)</span>
        <span class="n">pu</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">pm</span><span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="s">&#39;, &#39;</span><span class="p">,</span> <span class="n">pn</span><span class="p">))</span>
        <span class="n">pl</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">pp</span><span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="s">&#39;, &#39;</span><span class="p">,</span> <span class="n">pq</span><span class="p">))</span>

        <span class="n">ht</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">baseline</span> <span class="o">-</span> <span class="n">above</span> <span class="o">-</span> <span class="mi">2</span>
        <span class="k">if</span> <span class="n">ht</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">pu</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">pu</span><span class="o">.</span><span class="n">below</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">*</span><span class="n">ht</span><span class="p">))</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">pu</span><span class="o">.</span><span class="n">below</span><span class="p">(</span><span class="n">pl</span><span class="p">))</span>

        <span class="n">F</span><span class="o">.</span><span class="n">baseline</span> <span class="o">=</span> <span class="n">above</span>
        <span class="n">F</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">F</span><span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>

        <span class="n">F</span><span class="o">.</span><span class="n">baseline</span> <span class="o">=</span> <span class="n">above</span> <span class="o">+</span> <span class="n">add</span>

        <span class="n">D</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">F</span><span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span> <span class="n">D</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">D</span>

    <span class="k">def</span> <span class="nf">_print_ExpBase</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="c"># TODO should exp_polar be printed differently?</span>
        <span class="c">#      what about exp_polar(0), exp_polar(1)?</span>
        <span class="n">base</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="n">pretty_atom</span><span class="p">(</span><span class="s">&#39;Exp1&#39;</span><span class="p">,</span> <span class="s">&#39;e&#39;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">base</span> <span class="o">**</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_print_Function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="c"># XXX works only for applied functions</span>
        <span class="n">func</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">func</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">args</span>
        <span class="k">if</span> <span class="n">sort</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">default_sort_key</span><span class="p">)</span>

        <span class="n">func_name</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="n">__name__</span>

        <span class="n">prettyFunc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">C</span><span class="o">.</span><span class="n">Symbol</span><span class="p">(</span><span class="n">func_name</span><span class="p">))</span>
        <span class="n">prettyArgs</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_print_seq</span><span class="p">(</span><span class="n">args</span><span class="p">)</span><span class="o">.</span><span class="n">parens</span><span class="p">())</span>
        <span class="c">#postioning func_name</span>
        <span class="n">mid</span> <span class="o">=</span> <span class="n">prettyArgs</span><span class="o">.</span><span class="n">height</span><span class="p">()</span><span class="o">//</span><span class="mi">2</span>
        <span class="k">if</span> <span class="n">mid</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">prettyFunc</span><span class="o">.</span><span class="n">baseline</span> <span class="o">=</span> <span class="o">-</span><span class="n">mid</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="n">pform</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span>
            <span class="n">binding</span><span class="o">=</span><span class="n">prettyForm</span><span class="o">.</span><span class="n">FUNC</span><span class="p">,</span> <span class="o">*</span><span class="n">stringPict</span><span class="o">.</span><span class="n">next</span><span class="p">(</span><span class="n">prettyFunc</span><span class="p">,</span> <span class="n">prettyArgs</span><span class="p">))</span>

        <span class="c"># store pform parts so it can be reassembled e.g. when powered</span>
        <span class="n">pform</span><span class="o">.</span><span class="n">prettyFunc</span> <span class="o">=</span> <span class="n">prettyFunc</span>
        <span class="n">pform</span><span class="o">.</span><span class="n">prettyArgs</span> <span class="o">=</span> <span class="n">prettyArgs</span>

        <span class="k">return</span> <span class="n">pform</span>

    <span class="k">def</span> <span class="nf">_print_GeometryEntity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>
        <span class="c"># GeometryEntity is based on Tuple but should not print like a Tuple</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">emptyPrinter</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_print_Lambda</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="n">symbols</span><span class="p">,</span> <span class="n">expr</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">args</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">symbols</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">symbols</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">symbols</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">symbols</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">symbols</span><span class="p">))</span>

        <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">symbols</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="p">))</span>

        <span class="n">prettyFunc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">C</span><span class="o">.</span><span class="n">Symbol</span><span class="p">(</span><span class="s">&quot;Lambda&quot;</span><span class="p">))</span>
        <span class="n">prettyArgs</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_print_seq</span><span class="p">(</span><span class="n">args</span><span class="p">)</span><span class="o">.</span><span class="n">parens</span><span class="p">())</span>

        <span class="n">pform</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span>
            <span class="n">binding</span><span class="o">=</span><span class="n">prettyForm</span><span class="o">.</span><span class="n">FUNC</span><span class="p">,</span> <span class="o">*</span><span class="n">stringPict</span><span class="o">.</span><span class="n">next</span><span class="p">(</span><span class="n">prettyFunc</span><span class="p">,</span> <span class="n">prettyArgs</span><span class="p">))</span>

        <span class="c"># store pform parts so it can be reassembled e.g. when powered</span>
        <span class="n">pform</span><span class="o">.</span><span class="n">prettyFunc</span> <span class="o">=</span> <span class="n">prettyFunc</span>
        <span class="n">pform</span><span class="o">.</span><span class="n">prettyArgs</span> <span class="o">=</span> <span class="n">prettyArgs</span>

        <span class="k">return</span> <span class="n">pform</span>

    <span class="k">def</span> <span class="nf">_print_Order</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>
        <span class="n">pform</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">expr</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">expr</span><span class="o">.</span><span class="n">point</span> <span class="o">!=</span> <span class="n">S</span><span class="o">.</span><span class="n">Zero</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">variables</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">pform</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">pform</span><span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="s">&quot;; &quot;</span><span class="p">))</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">variables</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">pform</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">pform</span><span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">variables</span><span class="p">)))</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">variables</span><span class="p">):</span>
                <span class="n">pform</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">pform</span><span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="mi">0</span><span class="p">])))</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_unicode</span><span class="p">:</span>
                <span class="n">pform</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">pform</span><span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="n">u</span><span class="p">(</span><span class="s">&quot; </span><span class="se">\u2192</span><span class="s"> &quot;</span><span class="p">)))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">pform</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">pform</span><span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="s">&quot; -&gt; &quot;</span><span class="p">))</span>
            <span class="n">pform</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">pform</span><span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">point</span><span class="p">)))</span>
        <span class="n">pform</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">pform</span><span class="o">.</span><span class="n">parens</span><span class="p">())</span>
        <span class="n">pform</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">pform</span><span class="o">.</span><span class="n">left</span><span class="p">(</span><span class="s">&quot;O&quot;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">pform</span>

    <span class="k">def</span> <span class="nf">_print_gamma</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_unicode</span><span class="p">:</span>
            <span class="n">pform</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">pform</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">pform</span><span class="o">.</span><span class="n">parens</span><span class="p">())</span>
            <span class="n">pform</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">pform</span><span class="o">.</span><span class="n">left</span><span class="p">(</span><span class="n">greek_unicode</span><span class="p">[</span><span class="s">&#39;Gamma&#39;</span><span class="p">]))</span>
            <span class="k">return</span> <span class="n">pform</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print_Function</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_print_uppergamma</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_unicode</span><span class="p">:</span>
            <span class="n">pform</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">pform</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">pform</span><span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="s">&#39;, &#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">])))</span>
            <span class="n">pform</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">pform</span><span class="o">.</span><span class="n">parens</span><span class="p">())</span>
            <span class="n">pform</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">pform</span><span class="o">.</span><span class="n">left</span><span class="p">(</span><span class="n">greek_unicode</span><span class="p">[</span><span class="s">&#39;Gamma&#39;</span><span class="p">]))</span>
            <span class="k">return</span> <span class="n">pform</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print_Function</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_print_lowergamma</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_unicode</span><span class="p">:</span>
            <span class="n">pform</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">pform</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">pform</span><span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="s">&#39;, &#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">])))</span>
            <span class="n">pform</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">pform</span><span class="o">.</span><span class="n">parens</span><span class="p">())</span>
            <span class="n">pform</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">pform</span><span class="o">.</span><span class="n">left</span><span class="p">(</span><span class="n">greek_unicode</span><span class="p">[</span><span class="s">&#39;gamma&#39;</span><span class="p">]))</span>
            <span class="k">return</span> <span class="n">pform</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print_Function</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_print_expint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">sympy</span> <span class="kn">import</span> <span class="n">Function</span>
        <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">is_Integer</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_unicode</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print_Function</span><span class="p">(</span><span class="n">Function</span><span class="p">(</span><span class="s">&#39;E_</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])(</span><span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print_Function</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_print_Chi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="c"># This needs a special case since otherwise it comes out as greek</span>
        <span class="c"># letter chi...</span>
        <span class="n">prettyFunc</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="s">&quot;Chi&quot;</span><span class="p">)</span>
        <span class="n">prettyArgs</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_print_seq</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">)</span><span class="o">.</span><span class="n">parens</span><span class="p">())</span>

        <span class="n">pform</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span>
            <span class="n">binding</span><span class="o">=</span><span class="n">prettyForm</span><span class="o">.</span><span class="n">FUNC</span><span class="p">,</span> <span class="o">*</span><span class="n">stringPict</span><span class="o">.</span><span class="n">next</span><span class="p">(</span><span class="n">prettyFunc</span><span class="p">,</span> <span class="n">prettyArgs</span><span class="p">))</span>

        <span class="c"># store pform parts so it can be reassembled e.g. when powered</span>
        <span class="n">pform</span><span class="o">.</span><span class="n">prettyFunc</span> <span class="o">=</span> <span class="n">prettyFunc</span>
        <span class="n">pform</span><span class="o">.</span><span class="n">prettyArgs</span> <span class="o">=</span> <span class="n">prettyArgs</span>

        <span class="k">return</span> <span class="n">pform</span>

    <span class="k">def</span> <span class="nf">_print_elliptic_e</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="n">pforma0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">pform</span> <span class="o">=</span> <span class="n">pforma0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pforma1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">pform</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hprint_vseparator</span><span class="p">(</span><span class="n">pforma0</span><span class="p">,</span> <span class="n">pforma1</span><span class="p">)</span>
        <span class="n">pform</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">pform</span><span class="o">.</span><span class="n">parens</span><span class="p">())</span>
        <span class="n">pform</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">pform</span><span class="o">.</span><span class="n">left</span><span class="p">(</span><span class="s">&#39;E&#39;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">pform</span>

    <span class="k">def</span> <span class="nf">_print_elliptic_k</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="n">pform</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">pform</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">pform</span><span class="o">.</span><span class="n">parens</span><span class="p">())</span>
        <span class="n">pform</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">pform</span><span class="o">.</span><span class="n">left</span><span class="p">(</span><span class="s">&#39;K&#39;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">pform</span>

    <span class="k">def</span> <span class="nf">_print_elliptic_f</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="n">pforma0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">pforma1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">pform</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hprint_vseparator</span><span class="p">(</span><span class="n">pforma0</span><span class="p">,</span> <span class="n">pforma1</span><span class="p">)</span>
        <span class="n">pform</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">pform</span><span class="o">.</span><span class="n">parens</span><span class="p">())</span>
        <span class="n">pform</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">pform</span><span class="o">.</span><span class="n">left</span><span class="p">(</span><span class="s">&#39;F&#39;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">pform</span>

    <span class="k">def</span> <span class="nf">_print_elliptic_pi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">greek_unicode</span><span class="p">[</span><span class="s">&#39;Pi&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_unicode</span> <span class="k">else</span> <span class="s">&#39;Pi&#39;</span>
        <span class="n">pforma0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">pforma1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">pform</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hprint_vseparator</span><span class="p">(</span><span class="n">pforma0</span><span class="p">,</span> <span class="n">pforma1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pforma2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">pforma</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hprint_vseparator</span><span class="p">(</span><span class="n">pforma1</span><span class="p">,</span> <span class="n">pforma2</span><span class="p">)</span>
            <span class="n">pforma</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">pforma</span><span class="o">.</span><span class="n">left</span><span class="p">(</span><span class="s">&#39;; &#39;</span><span class="p">))</span>
            <span class="n">pform</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">pforma</span><span class="o">.</span><span class="n">left</span><span class="p">(</span><span class="n">pforma0</span><span class="p">))</span>
        <span class="n">pform</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">pform</span><span class="o">.</span><span class="n">parens</span><span class="p">())</span>
        <span class="n">pform</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">pform</span><span class="o">.</span><span class="n">left</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">pform</span>

    <span class="k">def</span> <span class="nf">_print_Add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">order</span> <span class="o">==</span> <span class="s">&#39;none&#39;</span><span class="p">:</span>
            <span class="n">terms</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">terms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_as_ordered_terms</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">)</span>
        <span class="n">pforms</span><span class="p">,</span> <span class="n">indices</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>

        <span class="k">def</span> <span class="nf">pretty_negative</span><span class="p">(</span><span class="n">pform</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Prepend a minus sign to a pretty form. &quot;&quot;&quot;</span>
            <span class="c">#TODO: Move this code to prettyForm</span>
            <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">pform</span><span class="o">.</span><span class="n">height</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">pform_neg</span> <span class="o">=</span> <span class="s">&#39;- &#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">pform_neg</span> <span class="o">=</span> <span class="s">&#39;-&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">pform_neg</span> <span class="o">=</span> <span class="s">&#39; - &#39;</span>

            <span class="k">if</span> <span class="n">pform</span><span class="o">.</span><span class="n">binding</span> <span class="o">&gt;</span> <span class="n">prettyForm</span><span class="o">.</span><span class="n">NEG</span><span class="p">:</span>
                <span class="n">p</span> <span class="o">=</span> <span class="n">stringPict</span><span class="p">(</span><span class="o">*</span><span class="n">pform</span><span class="o">.</span><span class="n">parens</span><span class="p">())</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">p</span> <span class="o">=</span> <span class="n">pform</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">stringPict</span><span class="o">.</span><span class="n">next</span><span class="p">(</span><span class="n">pform_neg</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
            <span class="c"># Lower the binding to NEG, even if it was higher. Otherwise, it</span>
            <span class="c"># will print as a + ( - (b)), instead of a - (b).</span>
            <span class="k">return</span> <span class="n">prettyForm</span><span class="p">(</span><span class="n">binding</span><span class="o">=</span><span class="n">prettyForm</span><span class="o">.</span><span class="n">NEG</span><span class="p">,</span> <span class="o">*</span><span class="n">p</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">term</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">terms</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">term</span><span class="o">.</span><span class="n">is_Mul</span> <span class="ow">and</span> <span class="n">_coeff_isneg</span><span class="p">(</span><span class="n">term</span><span class="p">):</span>
                <span class="n">pform</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="o">-</span><span class="n">term</span><span class="p">)</span>
                <span class="n">pforms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pretty_negative</span><span class="p">(</span><span class="n">pform</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">term</span><span class="o">.</span><span class="n">is_Rational</span> <span class="ow">and</span> <span class="n">term</span><span class="o">.</span><span class="n">q</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">pforms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
                <span class="n">indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">term</span><span class="o">.</span><span class="n">is_Number</span> <span class="ow">and</span> <span class="n">term</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">pform</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="o">-</span><span class="n">term</span><span class="p">)</span>
                <span class="n">pforms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pretty_negative</span><span class="p">(</span><span class="n">pform</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">pforms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">term</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">indices</span><span class="p">:</span>
            <span class="n">large</span> <span class="o">=</span> <span class="bp">True</span>

            <span class="k">for</span> <span class="n">pform</span> <span class="ow">in</span> <span class="n">pforms</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">pform</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">pform</span><span class="o">.</span><span class="n">height</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">large</span> <span class="o">=</span> <span class="bp">False</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">:</span>
                <span class="n">term</span><span class="p">,</span> <span class="n">negative</span> <span class="o">=</span> <span class="n">terms</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="bp">False</span>

                <span class="k">if</span> <span class="n">term</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">term</span><span class="p">,</span> <span class="n">negative</span> <span class="o">=</span> <span class="o">-</span><span class="n">term</span><span class="p">,</span> <span class="bp">True</span>

                <span class="k">if</span> <span class="n">large</span><span class="p">:</span>
                    <span class="n">pform</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">term</span><span class="o">.</span><span class="n">p</span><span class="p">))</span><span class="o">/</span><span class="n">prettyForm</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">term</span><span class="o">.</span><span class="n">q</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">pform</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">term</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">negative</span><span class="p">:</span>
                    <span class="n">pform</span> <span class="o">=</span> <span class="n">pretty_negative</span><span class="p">(</span><span class="n">pform</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>

                <span class="n">pforms</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">pform</span>

        <span class="k">return</span> <span class="n">prettyForm</span><span class="o">.</span><span class="n">__add__</span><span class="p">(</span><span class="o">*</span><span class="n">pforms</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_print_Mul</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">product</span><span class="p">):</span>
        <span class="n">a</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c"># items in the numerator</span>
        <span class="n">b</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c"># items that are in the denominator (if any)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">order</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;old&#39;</span><span class="p">,</span> <span class="s">&#39;none&#39;</span><span class="p">):</span>
            <span class="n">args</span> <span class="o">=</span> <span class="n">product</span><span class="o">.</span><span class="n">as_ordered_factors</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">=</span> <span class="n">product</span><span class="o">.</span><span class="n">args</span>

        <span class="c"># Gather terms for numerator/denominator</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">is_commutative</span> <span class="ow">and</span> <span class="n">item</span><span class="o">.</span><span class="n">is_Pow</span> <span class="ow">and</span> <span class="n">item</span><span class="o">.</span><span class="n">exp</span><span class="o">.</span><span class="n">is_Rational</span> <span class="ow">and</span> <span class="n">item</span><span class="o">.</span><span class="n">exp</span><span class="o">.</span><span class="n">is_negative</span><span class="p">:</span>
                <span class="n">b</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">C</span><span class="o">.</span><span class="n">Pow</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">base</span><span class="p">,</span> <span class="o">-</span><span class="n">item</span><span class="o">.</span><span class="n">exp</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">item</span><span class="o">.</span><span class="n">is_Rational</span> <span class="ow">and</span> <span class="n">item</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">S</span><span class="o">.</span><span class="n">Infinity</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">p</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">C</span><span class="o">.</span><span class="n">Rational</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">p</span><span class="p">)</span> <span class="p">)</span>
                <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">q</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">b</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">C</span><span class="o">.</span><span class="n">Rational</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">q</span><span class="p">)</span> <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

        <span class="kn">from</span> <span class="nn">sympy</span> <span class="kn">import</span> <span class="n">Integral</span><span class="p">,</span> <span class="n">Piecewise</span><span class="p">,</span> <span class="n">Product</span><span class="p">,</span> <span class="n">Sum</span>

        <span class="c"># Convert to pretty forms. Add parens to Add instances if there</span>
        <span class="c"># is more than one term in the numer/denom</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">is_Add</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">i</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="ow">and</span>
                    <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="p">(</span><span class="n">Integral</span><span class="p">,</span> <span class="n">Piecewise</span><span class="p">,</span> <span class="n">Product</span><span class="p">,</span> <span class="n">Sum</span><span class="p">))):</span>
                <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">parens</span><span class="p">())</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">)):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">is_Add</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">i</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="ow">and</span>
                    <span class="nb">isinstance</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="p">(</span><span class="n">Integral</span><span class="p">,</span> <span class="n">Piecewise</span><span class="p">,</span> <span class="n">Product</span><span class="p">,</span> <span class="n">Sum</span><span class="p">))):</span>
                <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">parens</span><span class="p">())</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

        <span class="c"># Construct a pretty form</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">prettyForm</span><span class="o">.</span><span class="n">__mul__</span><span class="p">(</span><span class="o">*</span><span class="n">a</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">One</span><span class="p">)</span> <span class="p">)</span>
            <span class="k">return</span> <span class="n">prettyForm</span><span class="o">.</span><span class="n">__mul__</span><span class="p">(</span><span class="o">*</span><span class="n">a</span><span class="p">)</span><span class="o">/</span><span class="n">prettyForm</span><span class="o">.</span><span class="n">__mul__</span><span class="p">(</span><span class="o">*</span><span class="n">b</span><span class="p">)</span>

    <span class="c"># A helper function for _print_Pow to print x**(1/n)</span>
    <span class="k">def</span> <span class="nf">_print_nth_root</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">base</span><span class="p">,</span> <span class="n">expt</span><span class="p">):</span>
        <span class="n">bpretty</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">base</span><span class="p">)</span>

        <span class="c"># Construct root sign, start with the \/ shape</span>
        <span class="n">_zZ</span> <span class="o">=</span> <span class="n">xobj</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">rootsign</span> <span class="o">=</span> <span class="n">xobj</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\\</span><span class="s">&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">_zZ</span>
        <span class="c"># Make exponent number to put above it</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">expt</span><span class="p">,</span> <span class="n">C</span><span class="o">.</span><span class="n">Rational</span><span class="p">):</span>
            <span class="n">exp</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">expt</span><span class="o">.</span><span class="n">q</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">exp</span> <span class="o">==</span> <span class="s">&#39;2&#39;</span><span class="p">:</span>
                <span class="n">exp</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">exp</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">expt</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">exp</span> <span class="o">=</span> <span class="n">exp</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">exp</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">rootsign</span> <span class="o">=</span> <span class="s">&#39; &#39;</span><span class="o">*</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">exp</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">rootsign</span>
        <span class="c"># Stack the exponent</span>
        <span class="n">rootsign</span> <span class="o">=</span> <span class="n">stringPict</span><span class="p">(</span><span class="n">exp</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">+</span> <span class="n">rootsign</span><span class="p">)</span>
        <span class="n">rootsign</span><span class="o">.</span><span class="n">baseline</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c"># Diagonal: length is one less than height of base</span>
        <span class="n">linelength</span> <span class="o">=</span> <span class="n">bpretty</span><span class="o">.</span><span class="n">height</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">diagonal</span> <span class="o">=</span> <span class="n">stringPict</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="s">&#39; &#39;</span><span class="o">*</span><span class="p">(</span><span class="n">linelength</span> <span class="o">-</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">_zZ</span> <span class="o">+</span> <span class="s">&#39; &#39;</span><span class="o">*</span><span class="n">i</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">linelength</span><span class="p">)</span>
        <span class="p">))</span>
        <span class="c"># Put baseline just below lowest line: next to exp</span>
        <span class="n">diagonal</span><span class="o">.</span><span class="n">baseline</span> <span class="o">=</span> <span class="n">linelength</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="c"># Make the root symbol</span>
        <span class="n">rootsign</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">rootsign</span><span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="n">diagonal</span><span class="p">))</span>
        <span class="c"># Det the baseline to match contents to fix the height</span>
        <span class="c"># but if the height of bpretty is one, the rootsign must be one higher</span>
        <span class="n">rootsign</span><span class="o">.</span><span class="n">baseline</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">bpretty</span><span class="o">.</span><span class="n">baseline</span><span class="p">)</span>
        <span class="c">#build result</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="n">hobj</span><span class="p">(</span><span class="s">&#39;_&#39;</span><span class="p">,</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">bpretty</span><span class="o">.</span><span class="n">width</span><span class="p">()))</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">bpretty</span><span class="o">.</span><span class="n">above</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">s</span><span class="o">.</span><span class="n">left</span><span class="p">(</span><span class="n">rootsign</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">s</span>

    <span class="k">def</span> <span class="nf">_print_Pow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">power</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">sympy.simplify.simplify</span> <span class="kn">import</span> <span class="n">fraction</span>
        <span class="n">b</span><span class="p">,</span> <span class="n">e</span> <span class="o">=</span> <span class="n">power</span><span class="o">.</span><span class="n">as_base_exp</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">power</span><span class="o">.</span><span class="n">is_commutative</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">e</span> <span class="ow">is</span> <span class="n">S</span><span class="o">.</span><span class="n">NegativeOne</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">prettyForm</span><span class="p">(</span><span class="s">&quot;1&quot;</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
            <span class="n">n</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="n">fraction</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">n</span> <span class="ow">is</span> <span class="n">S</span><span class="o">.</span><span class="n">One</span> <span class="ow">and</span> <span class="n">d</span><span class="o">.</span><span class="n">is_Atom</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">e</span><span class="o">.</span><span class="n">is_Integer</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print_nth_root</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">is_Rational</span> <span class="ow">and</span> <span class="n">e</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">prettyForm</span><span class="p">(</span><span class="s">&quot;1&quot;</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">C</span><span class="o">.</span><span class="n">Pow</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="o">-</span><span class="n">e</span><span class="p">,</span> <span class="n">evaluate</span><span class="o">=</span><span class="bp">False</span><span class="p">))</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__print_numer_denom</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">q</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">p</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">prettyForm</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">),</span> <span class="n">binding</span><span class="o">=</span><span class="n">prettyForm</span><span class="o">.</span><span class="n">NEG</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">prettyForm</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>
        <span class="k">elif</span> <span class="nb">abs</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">10</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">10</span><span class="p">:</span>
            <span class="c"># If more than one digit in numer and denom, print larger fraction</span>
            <span class="k">if</span> <span class="n">p</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">prettyForm</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">),</span> <span class="n">binding</span><span class="o">=</span><span class="n">prettyForm</span><span class="o">.</span><span class="n">NEG</span><span class="p">)</span><span class="o">/</span><span class="n">prettyForm</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">q</span><span class="p">))</span>
                <span class="c"># Old printing method:</span>
                <span class="c">#pform = prettyForm(str(-p))/prettyForm(str(q))</span>
                <span class="c">#return prettyForm(binding=prettyForm.NEG, *pform.left(&#39;- &#39;))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">prettyForm</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">))</span><span class="o">/</span><span class="n">prettyForm</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">q</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">_print_Rational</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__print_numer_denom</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">p</span><span class="p">,</span> <span class="n">expr</span><span class="o">.</span><span class="n">q</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">result</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">emptyPrinter</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_print_Fraction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__print_numer_denom</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">numerator</span><span class="p">,</span> <span class="n">expr</span><span class="o">.</span><span class="n">denominator</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">result</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">emptyPrinter</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_print_ProductSet</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">sets</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">has_variety</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">sets</span><span class="p">):</span>
            <span class="kn">from</span> <span class="nn">sympy</span> <span class="kn">import</span> <span class="n">Pow</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">Pow</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">sets</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">sets</span><span class="p">),</span> <span class="n">evaluate</span><span class="o">=</span><span class="bp">False</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">prod_char</span> <span class="o">=</span> <span class="n">u</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\xd7</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print_seq</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">sets</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="s">&#39; </span><span class="si">%s</span><span class="s"> &#39;</span> <span class="o">%</span> <span class="n">prod_char</span><span class="p">,</span>
                <span class="n">parenthesize</span><span class="o">=</span><span class="k">lambda</span> <span class="nb">set</span><span class="p">:</span> <span class="nb">set</span><span class="o">.</span><span class="n">is_Union</span> <span class="ow">or</span> <span class="nb">set</span><span class="o">.</span><span class="n">is_Intersection</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_print_FiniteSet</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="n">items</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">args</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">default_sort_key</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print_seq</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="s">&#39;{&#39;</span><span class="p">,</span> <span class="s">&#39;}&#39;</span><span class="p">,</span> <span class="s">&#39;, &#39;</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_print_Range</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_unicode</span><span class="p">:</span>
            <span class="n">dots</span> <span class="o">=</span> <span class="n">u</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\u2026</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dots</span> <span class="o">=</span> <span class="s">&#39;...&#39;</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">it</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="n">printset</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">it</span><span class="p">),</span> <span class="nb">next</span><span class="p">(</span><span class="n">it</span><span class="p">),</span> <span class="n">dots</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="n">_last_element</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">printset</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print_seq</span><span class="p">(</span><span class="n">printset</span><span class="p">,</span> <span class="s">&#39;{&#39;</span><span class="p">,</span> <span class="s">&#39;}&#39;</span><span class="p">,</span> <span class="s">&#39;, &#39;</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_print_Interval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">start</span> <span class="o">==</span> <span class="n">i</span><span class="o">.</span><span class="n">end</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print_seq</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">args</span><span class="p">[:</span><span class="mi">1</span><span class="p">],</span> <span class="s">&#39;{&#39;</span><span class="p">,</span> <span class="s">&#39;}&#39;</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">left_open</span><span class="p">:</span>
                <span class="n">left</span> <span class="o">=</span> <span class="s">&#39;(&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">left</span> <span class="o">=</span> <span class="s">&#39;[&#39;</span>

            <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">right_open</span><span class="p">:</span>
                <span class="n">right</span> <span class="o">=</span> <span class="s">&#39;)&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">right</span> <span class="o">=</span> <span class="s">&#39;]&#39;</span>

            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print_seq</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">args</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_print_Intersection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">u</span><span class="p">):</span>

        <span class="n">delimiter</span> <span class="o">=</span> <span class="s">&#39; </span><span class="si">%s</span><span class="s"> &#39;</span> <span class="o">%</span> <span class="n">pretty_atom</span><span class="p">(</span><span class="s">&#39;Intersection&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print_seq</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">args</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">delimiter</span><span class="p">,</span>
                <span class="n">parenthesize</span><span class="o">=</span><span class="k">lambda</span> <span class="nb">set</span><span class="p">:</span> <span class="nb">set</span><span class="o">.</span><span class="n">is_ProductSet</span> <span class="ow">or</span> <span class="nb">set</span><span class="o">.</span><span class="n">is_Union</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_print_Union</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">u</span><span class="p">):</span>

        <span class="n">union_delimiter</span> <span class="o">=</span> <span class="s">&#39; </span><span class="si">%s</span><span class="s"> &#39;</span> <span class="o">%</span> <span class="n">pretty_atom</span><span class="p">(</span><span class="s">&#39;Union&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print_seq</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">args</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">union_delimiter</span><span class="p">,</span>
             <span class="n">parenthesize</span><span class="o">=</span><span class="k">lambda</span> <span class="nb">set</span><span class="p">:</span> <span class="nb">set</span><span class="o">.</span><span class="n">is_ProductSet</span> <span class="ow">or</span> <span class="nb">set</span><span class="o">.</span><span class="n">is_Intersection</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_print_TransformationSet</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ts</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_unicode</span><span class="p">:</span>
            <span class="n">inn</span> <span class="o">=</span> <span class="n">u</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\u220a</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">inn</span> <span class="o">=</span> <span class="s">&#39;in&#39;</span>
        <span class="n">variables</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print_seq</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">lamda</span><span class="o">.</span><span class="n">variables</span><span class="p">)</span>
        <span class="n">expr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">lamda</span><span class="o">.</span><span class="n">expr</span><span class="p">)</span>
        <span class="n">bar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="s">&quot;|&quot;</span><span class="p">)</span>
        <span class="n">base</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">base_set</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print_seq</span><span class="p">((</span><span class="n">expr</span><span class="p">,</span> <span class="n">bar</span><span class="p">,</span> <span class="n">variables</span><span class="p">,</span> <span class="n">inn</span><span class="p">,</span> <span class="n">base</span><span class="p">),</span> <span class="s">&quot;{&quot;</span><span class="p">,</span> <span class="s">&quot;}&quot;</span><span class="p">,</span> <span class="s">&#39; &#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_print_seq</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seq</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s">&#39;, &#39;</span><span class="p">,</span>
            <span class="n">parenthesize</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">False</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">seq</span><span class="p">:</span>
            <span class="n">pform</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">parenthesize</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
                <span class="n">pform</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">pform</span><span class="o">.</span><span class="n">parens</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">s</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="c"># first element</span>
                <span class="n">s</span> <span class="o">=</span> <span class="n">pform</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">s</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">stringPict</span><span class="o">.</span><span class="n">next</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">delimiter</span><span class="p">))</span>
                <span class="n">s</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">stringPict</span><span class="o">.</span><span class="n">next</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">pform</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">s</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">stringPict</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span>

        <span class="n">s</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">s</span><span class="o">.</span><span class="n">parens</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">ifascii_nougly</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">s</span>

    <span class="k">def</span> <span class="nf">join</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">delimiter</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
        <span class="n">pform</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">pform</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">pform</span> <span class="o">=</span> <span class="n">arg</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">pform</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">pform</span><span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="n">delimiter</span><span class="p">))</span>
                <span class="n">pform</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">pform</span><span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="n">arg</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">pform</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">prettyForm</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pform</span>

    <span class="k">def</span> <span class="nf">_print_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">l</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print_seq</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&#39;[&#39;</span><span class="p">,</span> <span class="s">&#39;]&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_print_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">ptuple</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">stringPict</span><span class="o">.</span><span class="n">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="s">&#39;,&#39;</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">ptuple</span><span class="o">.</span><span class="n">parens</span><span class="p">(</span><span class="s">&#39;(&#39;</span><span class="p">,</span> <span class="s">&#39;)&#39;</span><span class="p">,</span> <span class="n">ifascii_nougly</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print_seq</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="s">&#39;(&#39;</span><span class="p">,</span> <span class="s">&#39;)&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_print_Tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print_tuple</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_print_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="n">default_sort_key</span><span class="p">)</span>
        <span class="n">items</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
            <span class="n">K</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
            <span class="n">V</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">stringPict</span><span class="o">.</span><span class="n">next</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="s">&#39;: &#39;</span><span class="p">,</span> <span class="n">V</span><span class="p">))</span>

            <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print_seq</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="s">&#39;{&#39;</span><span class="p">,</span> <span class="s">&#39;}&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_print_Dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print_dict</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_print_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="n">items</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">default_sort_key</span><span class="p">)</span>
        <span class="n">pretty</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print_seq</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="s">&#39;[&#39;</span><span class="p">,</span> <span class="s">&#39;]&#39;</span><span class="p">)</span>
        <span class="n">pretty</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">pretty</span><span class="o">.</span><span class="n">parens</span><span class="p">(</span><span class="s">&#39;(&#39;</span><span class="p">,</span> <span class="s">&#39;)&#39;</span><span class="p">,</span> <span class="n">ifascii_nougly</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>
        <span class="n">pretty</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">stringPict</span><span class="o">.</span><span class="n">next</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="n">pretty</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">pretty</span>

    <span class="n">_print_frozenset</span> <span class="o">=</span> <span class="n">_print_set</span>

    <span class="k">def</span> <span class="nf">_print_PolyRing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ring</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">prettyForm</span><span class="p">(</span><span class="n">sstr</span><span class="p">(</span><span class="n">ring</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_print_FracField</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">prettyForm</span><span class="p">(</span><span class="n">sstr</span><span class="p">(</span><span class="n">field</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_print_PolyElement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">poly</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">prettyForm</span><span class="p">(</span><span class="n">sstr</span><span class="p">(</span><span class="n">poly</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_print_FracElement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frac</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">prettyForm</span><span class="p">(</span><span class="n">sstr</span><span class="p">(</span><span class="n">frac</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_print_AlgebraicNumber</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">expr</span><span class="o">.</span><span class="n">is_aliased</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">as_poly</span><span class="p">()</span><span class="o">.</span><span class="n">as_expr</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">as_expr</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">_print_RootOf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_print_Add</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">expr</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s">&#39;lex&#39;</span><span class="p">),</span> <span class="n">expr</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
        <span class="n">pform</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_print_seq</span><span class="p">(</span><span class="n">args</span><span class="p">)</span><span class="o">.</span><span class="n">parens</span><span class="p">())</span>
        <span class="n">pform</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">pform</span><span class="o">.</span><span class="n">left</span><span class="p">(</span><span class="s">&#39;RootOf&#39;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">pform</span>

    <span class="k">def</span> <span class="nf">_print_RootSum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_print_Add</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">expr</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s">&#39;lex&#39;</span><span class="p">)]</span>

        <span class="k">if</span> <span class="n">expr</span><span class="o">.</span><span class="n">fun</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">S</span><span class="o">.</span><span class="n">IdentityFunction</span><span class="p">:</span>
            <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">fun</span><span class="p">))</span>

        <span class="n">pform</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_print_seq</span><span class="p">(</span><span class="n">args</span><span class="p">)</span><span class="o">.</span><span class="n">parens</span><span class="p">())</span>
        <span class="n">pform</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">pform</span><span class="o">.</span><span class="n">left</span><span class="p">(</span><span class="s">&#39;RootSum&#39;</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">pform</span>

    <span class="k">def</span> <span class="nf">_print_FiniteField</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_unicode</span><span class="p">:</span>
            <span class="n">form</span> <span class="o">=</span> <span class="n">u</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\u2124</span><span class="s">_</span><span class="si">%d</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">form</span> <span class="o">=</span> <span class="s">&#39;GF(</span><span class="si">%d</span><span class="s">)&#39;</span>

        <span class="k">return</span> <span class="n">prettyForm</span><span class="p">(</span><span class="n">pretty_symbol</span><span class="p">(</span><span class="n">form</span> <span class="o">%</span> <span class="n">expr</span><span class="o">.</span><span class="n">mod</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_print_IntegerRing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_unicode</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">prettyForm</span><span class="p">(</span><span class="n">u</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\u2124</span><span class="s">&#39;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">prettyForm</span><span class="p">(</span><span class="s">&#39;ZZ&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_print_RationalField</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_unicode</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">prettyForm</span><span class="p">(</span><span class="n">u</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\u211A</span><span class="s">&#39;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">prettyForm</span><span class="p">(</span><span class="s">&#39;QQ&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_print_RealField</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_unicode</span><span class="p">:</span>
            <span class="n">prefix</span> <span class="o">=</span> <span class="n">u</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\u211D</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">prefix</span> <span class="o">=</span> <span class="s">&#39;RR&#39;</span>

        <span class="k">if</span> <span class="n">domain</span><span class="o">.</span><span class="n">has_default_precision</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">prettyForm</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">pretty_symbol</span><span class="p">(</span><span class="n">prefix</span> <span class="o">+</span> <span class="s">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">domain</span><span class="o">.</span><span class="n">precision</span><span class="p">)))</span>

    <span class="k">def</span> <span class="nf">_print_ComplexField</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_unicode</span><span class="p">:</span>
            <span class="n">prefix</span> <span class="o">=</span> <span class="n">u</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\u2102</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">prefix</span> <span class="o">=</span> <span class="s">&#39;CC&#39;</span>

        <span class="k">if</span> <span class="n">domain</span><span class="o">.</span><span class="n">has_default_precision</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">prettyForm</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">pretty_symbol</span><span class="p">(</span><span class="n">prefix</span> <span class="o">+</span> <span class="s">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">domain</span><span class="o">.</span><span class="n">precision</span><span class="p">)))</span>

    <span class="k">def</span> <span class="nf">_print_PolynomialRing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>
        <span class="n">args</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">symbols</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">expr</span><span class="o">.</span><span class="n">order</span><span class="o">.</span><span class="n">is_default</span><span class="p">:</span>
            <span class="n">order</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">prettyForm</span><span class="p">(</span><span class="s">&quot;order=&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">order</span><span class="p">)))</span>
            <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">order</span><span class="p">)</span>

        <span class="n">pform</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print_seq</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="s">&#39;[&#39;</span><span class="p">,</span> <span class="s">&#39;]&#39;</span><span class="p">)</span>
        <span class="n">pform</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">pform</span><span class="o">.</span><span class="n">left</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">domain</span><span class="p">)))</span>

        <span class="k">return</span> <span class="n">pform</span>

    <span class="k">def</span> <span class="nf">_print_FractionField</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>
        <span class="n">args</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">symbols</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">expr</span><span class="o">.</span><span class="n">order</span><span class="o">.</span><span class="n">is_default</span><span class="p">:</span>
            <span class="n">order</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">prettyForm</span><span class="p">(</span><span class="s">&quot;order=&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">order</span><span class="p">)))</span>
            <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">order</span><span class="p">)</span>

        <span class="n">pform</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print_seq</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="s">&#39;(&#39;</span><span class="p">,</span> <span class="s">&#39;)&#39;</span><span class="p">)</span>
        <span class="n">pform</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">pform</span><span class="o">.</span><span class="n">left</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">domain</span><span class="p">)))</span>

        <span class="k">return</span> <span class="n">pform</span>

    <span class="k">def</span> <span class="nf">_print_PolynomialRingBase</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">symbols</span>
        <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">order</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">str</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">default_order</span><span class="p">):</span>
            <span class="n">g</span> <span class="o">=</span> <span class="n">g</span> <span class="o">+</span> <span class="p">(</span><span class="s">&quot;order=&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">order</span><span class="p">),)</span>
        <span class="n">pform</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print_seq</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="s">&#39;[&#39;</span><span class="p">,</span> <span class="s">&#39;]&#39;</span><span class="p">)</span>
        <span class="n">pform</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">pform</span><span class="o">.</span><span class="n">left</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">domain</span><span class="p">)))</span>

        <span class="k">return</span> <span class="n">pform</span>

    <span class="k">def</span> <span class="nf">_print_GroebnerBasis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">basis</span><span class="p">):</span>
        <span class="n">exprs</span> <span class="o">=</span> <span class="p">[</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print_Add</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">basis</span><span class="o">.</span><span class="n">order</span><span class="p">)</span>
                  <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">basis</span><span class="o">.</span><span class="n">exprs</span> <span class="p">]</span>
        <span class="n">exprs</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&quot;, &quot;</span><span class="p">,</span> <span class="n">exprs</span><span class="p">)</span><span class="o">.</span><span class="n">parens</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="s">&quot;[&quot;</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="s">&quot;]&quot;</span><span class="p">))</span>

        <span class="n">gens</span> <span class="o">=</span> <span class="p">[</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">gen</span><span class="p">)</span> <span class="k">for</span> <span class="n">gen</span> <span class="ow">in</span> <span class="n">basis</span><span class="o">.</span><span class="n">gens</span> <span class="p">]</span>

        <span class="n">domain</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span>
            <span class="o">*</span><span class="n">prettyForm</span><span class="p">(</span><span class="s">&quot;domain=&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">basis</span><span class="o">.</span><span class="n">domain</span><span class="p">)))</span>
        <span class="n">order</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span>
            <span class="o">*</span><span class="n">prettyForm</span><span class="p">(</span><span class="s">&quot;order=&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">basis</span><span class="o">.</span><span class="n">order</span><span class="p">)))</span>

        <span class="n">pform</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&quot;, &quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">exprs</span><span class="p">]</span> <span class="o">+</span> <span class="n">gens</span> <span class="o">+</span> <span class="p">[</span><span class="n">domain</span><span class="p">,</span> <span class="n">order</span><span class="p">])</span>

        <span class="n">pform</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">pform</span><span class="o">.</span><span class="n">parens</span><span class="p">())</span>
        <span class="n">pform</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">pform</span><span class="o">.</span><span class="n">left</span><span class="p">(</span><span class="n">basis</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">pform</span>

    <span class="k">def</span> <span class="nf">_print_Subs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="n">pform</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">expr</span><span class="p">)</span>
        <span class="n">pform</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">pform</span><span class="o">.</span><span class="n">parens</span><span class="p">())</span>

        <span class="n">h</span> <span class="o">=</span> <span class="n">pform</span><span class="o">.</span><span class="n">height</span><span class="p">()</span> <span class="k">if</span> <span class="n">pform</span><span class="o">.</span><span class="n">height</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="mi">2</span>
        <span class="n">rvert</span> <span class="o">=</span> <span class="n">stringPict</span><span class="p">(</span><span class="n">vobj</span><span class="p">(</span><span class="s">&#39;|&#39;</span><span class="p">,</span> <span class="n">h</span><span class="p">),</span> <span class="n">baseline</span><span class="o">=</span><span class="n">pform</span><span class="o">.</span><span class="n">baseline</span><span class="p">)</span>
        <span class="n">pform</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">pform</span><span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="n">rvert</span><span class="p">))</span>

        <span class="n">b</span> <span class="o">=</span> <span class="n">pform</span><span class="o">.</span><span class="n">baseline</span>
        <span class="n">pform</span><span class="o">.</span><span class="n">baseline</span> <span class="o">=</span> <span class="n">pform</span><span class="o">.</span><span class="n">height</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">pform</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">pform</span><span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print_seq</span><span class="p">([</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_print_seq</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">xsym</span><span class="p">(</span><span class="s">&#39;==&#39;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">])),</span>
                <span class="n">delimiter</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">variables</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">point</span><span class="p">)</span> <span class="p">])))</span>

        <span class="n">pform</span><span class="o">.</span><span class="n">baseline</span> <span class="o">=</span> <span class="n">b</span>
        <span class="k">return</span> <span class="n">pform</span>

    <span class="k">def</span> <span class="nf">_print_euler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="n">pform</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="s">&quot;E&quot;</span><span class="p">)</span>
        <span class="n">arg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">pform_arg</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="o">*</span><span class="n">arg</span><span class="o">.</span><span class="n">width</span><span class="p">())</span>
        <span class="n">pform_arg</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">pform_arg</span><span class="o">.</span><span class="n">below</span><span class="p">(</span><span class="n">arg</span><span class="p">))</span>
        <span class="n">pform</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">pform</span><span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="n">pform_arg</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">pform</span>

    <span class="k">def</span> <span class="nf">_print_catalan</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="n">pform</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="s">&quot;C&quot;</span><span class="p">)</span>
        <span class="n">arg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">pform_arg</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="o">*</span><span class="n">arg</span><span class="o">.</span><span class="n">width</span><span class="p">())</span>
        <span class="n">pform_arg</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">pform_arg</span><span class="o">.</span><span class="n">below</span><span class="p">(</span><span class="n">arg</span><span class="p">))</span>
        <span class="n">pform</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">pform</span><span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="n">pform_arg</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">pform</span>

    <span class="k">def</span> <span class="nf">_print_KroneckerDelta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="n">pform</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">pform</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">pform</span><span class="o">.</span><span class="n">right</span><span class="p">((</span><span class="n">prettyForm</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">))))</span>
        <span class="n">pform</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">pform</span><span class="o">.</span><span class="n">right</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]))))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_unicode</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">stringPict</span><span class="p">(</span><span class="n">pretty_symbol</span><span class="p">(</span><span class="s">&#39;delta&#39;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">stringPict</span><span class="p">(</span><span class="s">&#39;d&#39;</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">pform</span>
        <span class="n">top</span> <span class="o">=</span> <span class="n">stringPict</span><span class="p">(</span><span class="o">*</span><span class="n">b</span><span class="o">.</span><span class="n">left</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="o">*</span><span class="n">a</span><span class="o">.</span><span class="n">width</span><span class="p">()))</span>
        <span class="n">bot</span> <span class="o">=</span> <span class="n">stringPict</span><span class="p">(</span><span class="o">*</span><span class="n">a</span><span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="o">*</span><span class="n">b</span><span class="o">.</span><span class="n">width</span><span class="p">()))</span>
        <span class="k">return</span> <span class="n">prettyForm</span><span class="p">(</span><span class="n">binding</span><span class="o">=</span><span class="n">prettyForm</span><span class="o">.</span><span class="n">POW</span><span class="p">,</span> <span class="o">*</span><span class="n">bot</span><span class="o">.</span><span class="n">below</span><span class="p">(</span><span class="n">top</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_print_RandomDomain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">pform</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="s">&#39;Domain: &#39;</span><span class="p">)</span>
            <span class="n">pform</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">pform</span><span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">as_boolean</span><span class="p">())))</span>
            <span class="k">return</span> <span class="n">pform</span>

        <span class="k">except</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">pform</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="s">&#39;Domain: &#39;</span><span class="p">)</span>
                <span class="n">pform</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">pform</span><span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">symbols</span><span class="p">)))</span>
                <span class="n">pform</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">pform</span><span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="s">&#39; in &#39;</span><span class="p">)))</span>
                <span class="n">pform</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">pform</span><span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">set</span><span class="p">)))</span>
                <span class="k">return</span> <span class="n">pform</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_print_DMP</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">ring</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="c"># TODO incorporate order</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">ring</span><span class="o">.</span><span class="n">to_sympy</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>
        <span class="k">except</span> <span class="n">SympifyError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_print_DMF</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print_DMP</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_print_Object</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">object</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">pretty_symbol</span><span class="p">(</span><span class="nb">object</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_print_Morphism</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">morphism</span><span class="p">):</span>
        <span class="n">arrow</span> <span class="o">=</span> <span class="n">xsym</span><span class="p">(</span><span class="s">&quot;--&gt;&quot;</span><span class="p">)</span>

        <span class="n">domain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">morphism</span><span class="o">.</span><span class="n">domain</span><span class="p">)</span>
        <span class="n">codomain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">morphism</span><span class="o">.</span><span class="n">codomain</span><span class="p">)</span>
        <span class="n">tail</span> <span class="o">=</span> <span class="n">domain</span><span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="n">arrow</span><span class="p">,</span> <span class="n">codomain</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">prettyForm</span><span class="p">(</span><span class="n">tail</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_print_NamedMorphism</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">morphism</span><span class="p">):</span>
        <span class="n">pretty_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">pretty_symbol</span><span class="p">(</span><span class="n">morphism</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
        <span class="n">pretty_morphism</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print_Morphism</span><span class="p">(</span><span class="n">morphism</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">prettyForm</span><span class="p">(</span><span class="n">pretty_name</span><span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="s">&quot;:&quot;</span><span class="p">,</span> <span class="n">pretty_morphism</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_print_IdentityMorphism</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">morphism</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">sympy.categories</span> <span class="kn">import</span> <span class="n">NamedMorphism</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print_NamedMorphism</span><span class="p">(</span>
            <span class="n">NamedMorphism</span><span class="p">(</span><span class="n">morphism</span><span class="o">.</span><span class="n">domain</span><span class="p">,</span> <span class="n">morphism</span><span class="o">.</span><span class="n">codomain</span><span class="p">,</span> <span class="s">&quot;id&quot;</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_print_CompositeMorphism</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">morphism</span><span class="p">):</span>

        <span class="n">circle</span> <span class="o">=</span> <span class="n">xsym</span><span class="p">(</span><span class="s">&quot;.&quot;</span><span class="p">)</span>

        <span class="c"># All components of the morphism have names and it is thus</span>
        <span class="c"># possible to build the name of the composite.</span>
        <span class="n">component_names_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">pretty_symbol</span><span class="p">(</span><span class="n">component</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="k">for</span>
                                <span class="n">component</span> <span class="ow">in</span> <span class="n">morphism</span><span class="o">.</span><span class="n">components</span><span class="p">]</span>
        <span class="n">component_names_list</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
        <span class="n">component_names</span> <span class="o">=</span> <span class="n">circle</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">component_names_list</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;:&quot;</span>

        <span class="n">pretty_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">component_names</span><span class="p">)</span>
        <span class="n">pretty_morphism</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print_Morphism</span><span class="p">(</span><span class="n">morphism</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">prettyForm</span><span class="p">(</span><span class="n">pretty_name</span><span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="n">pretty_morphism</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_print_Category</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">category</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">pretty_symbol</span><span class="p">(</span><span class="n">category</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_print_Diagram</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">diagram</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">diagram</span><span class="o">.</span><span class="n">premises</span><span class="p">:</span>
            <span class="c"># This is an empty diagram.</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">EmptySet</span><span class="p">)</span>

        <span class="n">pretty_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">diagram</span><span class="o">.</span><span class="n">premises</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">diagram</span><span class="o">.</span><span class="n">conclusions</span><span class="p">:</span>
            <span class="n">results_arrow</span> <span class="o">=</span> <span class="s">&quot; </span><span class="si">%s</span><span class="s"> &quot;</span> <span class="o">%</span> <span class="n">xsym</span><span class="p">(</span><span class="s">&quot;==&gt;&quot;</span><span class="p">)</span>

            <span class="n">pretty_conclusions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">diagram</span><span class="o">.</span><span class="n">conclusions</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">pretty_result</span> <span class="o">=</span> <span class="n">pretty_result</span><span class="o">.</span><span class="n">right</span><span class="p">(</span>
                <span class="n">results_arrow</span><span class="p">,</span> <span class="n">pretty_conclusions</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">prettyForm</span><span class="p">(</span><span class="n">pretty_result</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_print_DiagramGrid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">grid</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">sympy.matrices</span> <span class="kn">import</span> <span class="n">Matrix</span>
        <span class="kn">from</span> <span class="nn">sympy</span> <span class="kn">import</span> <span class="n">Symbol</span>
        <span class="n">matrix</span> <span class="o">=</span> <span class="n">Matrix</span><span class="p">([[</span><span class="n">grid</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="k">if</span> <span class="n">grid</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="k">else</span> <span class="n">Symbol</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">)</span>
                          <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">width</span><span class="p">)]</span>
                         <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">height</span><span class="p">)])</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print_matrix_contents</span><span class="p">(</span><span class="n">matrix</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_print_FreeModuleElement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
        <span class="c"># Print as row vector for convenience, for now.</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print_seq</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s">&#39;[&#39;</span><span class="p">,</span> <span class="s">&#39;]&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_print_SubModule</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">M</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print_seq</span><span class="p">(</span><span class="n">M</span><span class="o">.</span><span class="n">gens</span><span class="p">,</span> <span class="s">&#39;&lt;&#39;</span><span class="p">,</span> <span class="s">&#39;&gt;&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_print_FreeModule</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">M</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">M</span><span class="o">.</span><span class="n">ring</span><span class="p">)</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">M</span><span class="o">.</span><span class="n">rank</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_print_ModuleImplementedIdeal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">M</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print_seq</span><span class="p">([</span><span class="n">x</span> <span class="k">for</span> <span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="ow">in</span> <span class="n">M</span><span class="o">.</span><span class="n">_module</span><span class="o">.</span><span class="n">gens</span><span class="p">],</span> <span class="s">&#39;&lt;&#39;</span><span class="p">,</span> <span class="s">&#39;&gt;&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_print_QuotientRing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">R</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">R</span><span class="o">.</span><span class="n">ring</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">R</span><span class="o">.</span><span class="n">base_ideal</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_print_QuotientRingElement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">R</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">R</span><span class="o">.</span><span class="n">data</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">R</span><span class="o">.</span><span class="n">ring</span><span class="o">.</span><span class="n">base_ideal</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_print_QuotientModuleElement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">data</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">killed_module</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_print_QuotientModule</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">M</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">M</span><span class="o">.</span><span class="n">base</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">M</span><span class="o">.</span><span class="n">killed_module</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_print_MatrixHomomorphism</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">h</span><span class="p">):</span>
        <span class="n">matrix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">_sympy_matrix</span><span class="p">())</span>
        <span class="n">matrix</span><span class="o">.</span><span class="n">baseline</span> <span class="o">=</span> <span class="n">matrix</span><span class="o">.</span><span class="n">height</span><span class="p">()</span> <span class="o">//</span> <span class="mi">2</span>
        <span class="n">pform</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">matrix</span><span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="s">&#39; : &#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">domain</span><span class="p">),</span>
            <span class="s">&#39; </span><span class="si">%s</span><span class="s">&gt; &#39;</span> <span class="o">%</span> <span class="n">hobj</span><span class="p">(</span><span class="s">&#39;-&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">codomain</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">pform</span>

    <span class="k">def</span> <span class="nf">_print_BaseScalarField</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field</span><span class="p">):</span>
        <span class="n">string</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">_coord_sys</span><span class="o">.</span><span class="n">_names</span><span class="p">[</span><span class="n">field</span><span class="o">.</span><span class="n">_index</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">pretty_symbol</span><span class="p">(</span><span class="n">string</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_print_BaseVectorField</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">U</span><span class="p">(</span><span class="s">&#39;PARTIAL DIFFERENTIAL&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;_&#39;</span> <span class="o">+</span> <span class="n">field</span><span class="o">.</span><span class="n">_coord_sys</span><span class="o">.</span><span class="n">_names</span><span class="p">[</span><span class="n">field</span><span class="o">.</span><span class="n">_index</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">pretty_symbol</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_print_Differential</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">diff</span><span class="p">):</span>
        <span class="n">field</span> <span class="o">=</span> <span class="n">diff</span><span class="o">.</span><span class="n">_form_field</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="s">&#39;_coord_sys&#39;</span><span class="p">):</span>
            <span class="n">string</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">_coord_sys</span><span class="o">.</span><span class="n">_names</span><span class="p">[</span><span class="n">field</span><span class="o">.</span><span class="n">_index</span><span class="p">]</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">u</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\u2146</span><span class="s"> &#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">pretty_symbol</span><span class="p">(</span><span class="n">string</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pform</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>
            <span class="n">pform</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">pform</span><span class="o">.</span><span class="n">parens</span><span class="p">())</span>
            <span class="k">return</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">pform</span><span class="o">.</span><span class="n">left</span><span class="p">(</span><span class="n">u</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\u2146</span><span class="s">&quot;</span><span class="p">)))</span>

    <span class="k">def</span> <span class="nf">_print_Tr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="c">#TODO: Handle indices</span>
        <span class="n">pform</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">pform</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">pform</span><span class="o">.</span><span class="n">left</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">(&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">)))</span>
        <span class="n">pform</span> <span class="o">=</span> <span class="n">prettyForm</span><span class="p">(</span><span class="o">*</span><span class="n">pform</span><span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="s">&#39;)&#39;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">pform</span>

</div>
<div class="viewcode-block" id="pretty"><a class="viewcode-back" href="../../../../modules/printing.html#sympy.printing.pretty.pretty.pretty">[docs]</a><span class="k">def</span> <span class="nf">pretty</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="o">**</span><span class="n">settings</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns a string containing the prettified form of expr.</span>

<span class="sd">    For information on keyword arguments see pretty_print function.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">pp</span> <span class="o">=</span> <span class="n">PrettyPrinter</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>

    <span class="c"># XXX: this is an ugly hack, but at least it works</span>
    <span class="n">use_unicode</span> <span class="o">=</span> <span class="n">pp</span><span class="o">.</span><span class="n">_settings</span><span class="p">[</span><span class="s">&#39;use_unicode&#39;</span><span class="p">]</span>
    <span class="n">uflag</span> <span class="o">=</span> <span class="n">pretty_use_unicode</span><span class="p">(</span><span class="n">use_unicode</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">pp</span><span class="o">.</span><span class="n">doprint</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">pretty_use_unicode</span><span class="p">(</span><span class="n">uflag</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="pretty_print"><a class="viewcode-back" href="../../../../modules/printing.html#sympy.printing.pretty.pretty.pretty_print">[docs]</a><span class="k">def</span> <span class="nf">pretty_print</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="o">**</span><span class="n">settings</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Prints expr in pretty form.</span>

<span class="sd">    pprint is just a shortcut for this function.</span>


<span class="sd">    Parameters</span>
<span class="sd">    ==========</span>

<span class="sd">    expr : expression</span>
<span class="sd">        the expression to print</span>
<span class="sd">    wrap_line : bool, optional</span>
<span class="sd">        line wrapping enabled/disabled, defaults to True</span>
<span class="sd">    num_columns : bool, optional</span>
<span class="sd">        number of columns before line breaking (default to None which reads</span>
<span class="sd">        the terminal width), useful when using SymPy without terminal.</span>
<span class="sd">    use_unicode : bool or None, optional</span>
<span class="sd">        use unicode characters, such as the Greek letter pi instead of</span>
<span class="sd">        the string pi.</span>
<span class="sd">    full_prec : bool or string, optional</span>
<span class="sd">        use full precision. Default to &quot;auto&quot;</span>
<span class="sd">    order : bool or string, optional</span>
<span class="sd">        set to &#39;none&#39; for long expressions if slow; default is None</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">print</span><span class="p">(</span><span class="n">pretty</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="o">**</span><span class="n">settings</span><span class="p">))</span>
</div>
<span class="n">pprint</span> <span class="o">=</span> <span class="n">pretty_print</span>


<span class="k">def</span> <span class="nf">pager_print</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="o">**</span><span class="n">settings</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Prints expr using the pager, in pretty form.</span>

<span class="sd">    This invokes a pager command using pydoc. Lines are not wrapped</span>
<span class="sd">    automatically. This routine is meant to be used with a pager that allows</span>
<span class="sd">    sideways scrolling, like ``less -S``.</span>

<span class="sd">    Parameters are the same as for ``pretty_print``. If you wish to wrap lines,</span>
<span class="sd">    pass ``num_columns=None`` to auto-detect the width of the terminal.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">pydoc</span> <span class="kn">import</span> <span class="n">pager</span>
    <span class="kn">from</span> <span class="nn">locale</span> <span class="kn">import</span> <span class="n">getpreferredencoding</span>
    <span class="k">if</span> <span class="s">&#39;num_columns&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">settings</span><span class="p">:</span>
        <span class="n">settings</span><span class="p">[</span><span class="s">&#39;num_columns&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">500000</span>  <span class="c"># disable line wrap</span>
    <span class="n">pager</span><span class="p">(</span><span class="n">pretty</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="o">**</span><span class="n">settings</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">getpreferredencoding</span><span class="p">()))</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../../index.html">
              <img class="logo" src="../../../../_static/sympylogo.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../../../../np-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../../index.html">SymPy 0.7.3 documentation</a> &raquo;</li>
          <li><a href="../../../index.html" >Module code</a> &raquo;</li>
          <li><a href="../../../sympy.html" >sympy</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013 SymPy Development Team.
      Last updated on Aug 04, 2013.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>