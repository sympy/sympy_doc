

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>sympy.galgebra.GA &mdash; SymPy 0.7.2-git documentation</title>
    
    <link rel="stylesheet" href="../../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="http://live.sympy.org/static/live-core.css" type="text/css" />
    <link rel="stylesheet" href="http://live.sympy.org/static/live-autocomplete.css" type="text/css" />
    <link rel="stylesheet" href="http://live.sympy.org/static/live-sphinx.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '0.7.2-git',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://c328740.ssl.cf1.rackcdn.com/mathjax/latest/MathJax.js?config=TeX-AMS_HTML-full"></script>
    <script type="text/javascript" src="http://live.sympy.org/static/utilities.js"></script>
    <script type="text/javascript" src="http://live.sympy.org/static/external/classy.js"></script>
    <script type="text/javascript" src="http://live.sympy.org/static/live-core.js"></script>
    <script type="text/javascript" src="http://live.sympy.org/static/live-autocomplete.js"></script>
    <script type="text/javascript" src="http://live.sympy.org/static/live-sphinx.js"></script>
    <script type="text/javascript" src="../../../_static/sidebar.js"></script>
    <link rel="shortcut icon" href="../../../_static/SymPy-Favicon.ico"/>
    <link rel="top" title="SymPy 0.7.2-git documentation" href="../../../index.html" />
    <link rel="up" title="sympy" href="../../sympy.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../../../np-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">SymPy 0.7.2-git documentation</a> &raquo;</li>
          <li><a href="../../index.html" >Module code</a> &raquo;</li>
          <li><a href="../../sympy.html" accesskey="U">sympy</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for sympy.galgebra.GA</h1><div class="highlight"><pre>
<span class="c">#!/usr/bin/python</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">The module symbolicGA implements symbolic Geometric Algebra in python.</span>
<span class="sd">The relevant references for this module are:</span>

<span class="sd">    1. &quot;Geometric Algebra for Physicists&quot; by C. Doran and A. Lazenby,</span>
<span class="sd">       Cambridge University Press, 2003.</span>

<span class="sd">    2. &quot;Geometric Algebra for Computer Science&quot; by Leo Dorst,</span>
<span class="sd">       Daniel Fontijne, and Stephen Mann, Morgan Kaufmann Publishers, 2007.</span>

<span class="sd">    3. SymPy Tutorial, http://docs.sympy.org/</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">sympy</span>
<span class="kn">import</span> <span class="nn">re</span> <span class="kn">as</span> <span class="nn">regrep</span>
<span class="kn">import</span> <span class="nn">sympy.galgebra.latex_ex</span>
<span class="kn">from</span> <span class="nn">sympy.core.decorators</span> <span class="kn">import</span> <span class="n">deprecated</span>

<span class="n">NUMPAT</span> <span class="o">=</span> <span class="n">regrep</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span> <span class="s">&#39;([\-0-9])|([\-0-9]/[0-9])&#39;</span><span class="p">)</span>
<span class="sd">&quot;&quot;&quot;Re pattern for rational number&quot;&quot;&quot;</span>

<span class="n">ZERO</span> <span class="o">=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">Rational</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">ONE</span> <span class="o">=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">Rational</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">TWO</span> <span class="o">=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">Rational</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">HALF</span> <span class="o">=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">Rational</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">sympy.core</span> <span class="kn">import</span> <span class="n">Pow</span> <span class="k">as</span> <span class="n">pow_type</span>
<span class="kn">from</span> <span class="nn">sympy</span> <span class="kn">import</span> <span class="n">Abs</span> <span class="k">as</span> <span class="n">abs_type</span>
<span class="kn">from</span> <span class="nn">sympy.core</span> <span class="kn">import</span> <span class="n">Mul</span> <span class="k">as</span> <span class="n">mul_type</span>
<span class="kn">from</span> <span class="nn">sympy.core</span> <span class="kn">import</span> <span class="n">Add</span> <span class="k">as</span> <span class="n">add_type</span>


<span class="nd">@sympy.vectorize</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">substitute_array</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="k">return</span><span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">))</span>


<div class="viewcode-block" id="is_quasi_unit_numpy_array"><a class="viewcode-back" href="../../../modules/galgebra/GA.html#sympy.galgebra.GA.is_quasi_unit_numpy_array">[docs]</a><span class="k">def</span> <span class="nf">is_quasi_unit_numpy_array</span><span class="p">(</span><span class="n">array</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Determine if a array is square and diagonal with</span>
<span class="sd">    entries of +1 or -1.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">shape</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ix</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">ix</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">:</span>
            <span class="n">iy</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">while</span> <span class="n">iy</span> <span class="o">&lt;</span> <span class="n">ix</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">array</span><span class="p">[</span><span class="n">ix</span><span class="p">][</span><span class="n">iy</span><span class="p">]</span> <span class="o">!=</span> <span class="n">ZERO</span><span class="p">:</span>
                    <span class="k">return</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
                <span class="n">iy</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">sympy</span><span class="o">.</span><span class="n">Abs</span><span class="p">(</span><span class="n">array</span><span class="p">[</span><span class="n">ix</span><span class="p">][</span><span class="n">ix</span><span class="p">])</span> <span class="o">!=</span> <span class="n">ONE</span><span class="p">:</span>
                <span class="k">return</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
            <span class="n">ix</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>

</div>
<span class="nd">@deprecated</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="s">&quot;This function is no longer needed.&quot;</span><span class="p">,</span> <span class="n">issue</span><span class="o">=</span><span class="mi">3379</span><span class="p">,</span>
            <span class="n">deprecated_since_version</span><span class="o">=</span><span class="s">&quot;0.7.2&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">set_main</span><span class="p">(</span><span class="n">main_program</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="k">def</span> <span class="nf">plist</span><span class="p">(</span><span class="n">lst</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">lst</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">lst</span><span class="p">:</span>
            <span class="n">plist</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">lst</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="k">return</span>


<div class="viewcode-block" id="numeric"><a class="viewcode-back" href="../../../modules/galgebra/GA.html#sympy.galgebra.GA.numeric">[docs]</a><span class="k">def</span> <span class="nf">numeric</span><span class="p">(</span><span class="n">num_str</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns rational numbers compatible with symbols.</span>
<span class="sd">    Input is a string representing a fraction or integer</span>
<span class="sd">    or a simple integer.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">num_str</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span><span class="p">:</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">num_str</span>
        <span class="n">b</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="n">num_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">b</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">b</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">tmp</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">return</span><span class="p">(</span><span class="n">sympy</span><span class="o">.</span><span class="n">Rational</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="collect"><a class="viewcode-back" href="../../../modules/galgebra/GA.html#sympy.galgebra.GA.collect">[docs]</a><span class="k">def</span> <span class="nf">collect</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">lst</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Wrapper for sympy.collect.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">lst</span> <span class="o">=</span> <span class="n">MV</span><span class="o">.</span><span class="n">scalar_to_symbol</span><span class="p">(</span><span class="n">lst</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">sympy</span><span class="o">.</span><span class="n">collect</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">lst</span><span class="p">))</span>

</div>
<span class="k">def</span> <span class="nf">sqrt</span><span class="p">(</span><span class="n">expr</span><span class="p">):</span>
    <span class="k">return</span><span class="p">(</span><span class="n">sympy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">expr</span><span class="p">))</span>


<div class="viewcode-block" id="isint"><a class="viewcode-back" href="../../../modules/galgebra/GA.html#sympy.galgebra.GA.isint">[docs]</a><span class="k">def</span> <span class="nf">isint</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Test for integer.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="make_null_array"><a class="viewcode-back" href="../../../modules/galgebra/GA.html#sympy.galgebra.GA.make_null_array">[docs]</a><span class="k">def</span> <span class="nf">make_null_array</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return list of n empty lists.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">a</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
    <span class="k">return</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="test_int_flgs"><a class="viewcode-back" href="../../../modules/galgebra/GA.html#sympy.galgebra.GA.test_int_flgs">[docs]</a><span class="k">def</span> <span class="nf">test_int_flgs</span><span class="p">(</span><span class="n">lst</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Test if all elements in list are 0.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">lst</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">i</span><span class="p">:</span>
            <span class="k">return</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="comb"><a class="viewcode-back" href="../../../modules/galgebra/GA.html#sympy.galgebra.GA.comb">[docs]</a><span class="k">def</span> <span class="nf">comb</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">P</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the combinations of the integers [0,N-1] taken P at a time.</span>
<span class="sd">    The output is a list of lists of integers where the inner lists are</span>
<span class="sd">    the different combinations. Each combination is sorted in ascending</span>
<span class="sd">    order.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">rloop</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">combs</span><span class="p">,</span> <span class="n">comb</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">p</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
                <span class="n">newcomb</span> <span class="o">=</span> <span class="n">comb</span> <span class="o">+</span> <span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">np</span> <span class="o">=</span> <span class="n">p</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="n">rloop</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">np</span><span class="p">,</span> <span class="n">combs</span><span class="p">,</span> <span class="n">newcomb</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">combs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">comb</span><span class="p">)</span>
    <span class="n">combs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">rloop</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">combs</span><span class="p">,</span> <span class="p">[])</span>
    <span class="k">for</span> <span class="n">comb</span> <span class="ow">in</span> <span class="n">combs</span><span class="p">:</span>
        <span class="n">comb</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
    <span class="k">return</span><span class="p">(</span><span class="n">combs</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="diagpq"><a class="viewcode-back" href="../../../modules/galgebra/GA.html#sympy.galgebra.GA.diagpq">[docs]</a><span class="k">def</span> <span class="nf">diagpq</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns string equivalent metric tensor for signature (p, q).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">p</span> <span class="o">+</span> <span class="n">q</span>
    <span class="n">D</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
        <span class="n">D</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">i</span><span class="o">*</span><span class="s">&#39;0 &#39;</span> <span class="o">+</span><span class="s">&#39;1 &#39;</span><span class="o">+</span> <span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="s">&#39;0 &#39;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">n</span><span class="p">):</span>
        <span class="n">D</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">i</span><span class="o">*</span><span class="s">&#39;0 &#39;</span> <span class="o">+</span><span class="s">&#39;-1 &#39;</span><span class="o">+</span> <span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="s">&#39;0 &#39;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">return</span> <span class="s">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">D</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="arbitrary_metric"><a class="viewcode-back" href="../../../modules/galgebra/GA.html#sympy.galgebra.GA.arbitrary_metric">[docs]</a><span class="k">def</span> <span class="nf">arbitrary_metric</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns string equivalent metric tensor for arbitrary signature.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="s">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">n</span><span class="o">*</span><span class="p">[(</span><span class="n">n</span><span class="o">*</span><span class="s">&#39;# &#39;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
</div>
<div class="viewcode-block" id="arbitrary_metric_conformal"><a class="viewcode-back" href="../../../modules/galgebra/GA.html#sympy.galgebra.GA.arbitrary_metric_conformal">[docs]</a><span class="k">def</span> <span class="nf">arbitrary_metric_conformal</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns string equivalent metric tensor for arbitrary signature (n+1,1).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">str1</span> <span class="o">=</span> <span class="s">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">n</span><span class="o">*</span><span class="p">[</span><span class="n">n</span><span class="o">*</span><span class="s">&#39;# &#39;</span><span class="o">+</span><span class="s">&#39;0 0&#39;</span><span class="p">])</span>
    <span class="k">return</span> <span class="s">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">str1</span><span class="p">,</span> <span class="n">n</span><span class="o">*</span><span class="s">&#39;0 &#39;</span><span class="o">+</span><span class="s">&#39;1 0&#39;</span><span class="p">,</span> <span class="n">n</span><span class="o">*</span><span class="s">&#39;0 &#39;</span><span class="o">+</span><span class="s">&#39;0 -1&#39;</span><span class="p">])</span>

</div>
<div class="viewcode-block" id="make_scalars"><a class="viewcode-back" href="../../../modules/galgebra/GA.html#sympy.galgebra.GA.make_scalars">[docs]</a><span class="k">def</span> <span class="nf">make_scalars</span><span class="p">(</span><span class="n">symnamelst</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    make_scalars takes a string of symbol names separated by</span>
<span class="sd">    blanks and converts them to MV scalars and returns a list</span>
<span class="sd">    of the symbols.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">symlst</span> <span class="o">=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">symbols</span><span class="p">(</span><span class="n">symnamelst</span><span class="p">)</span>
    <span class="n">scalar_lst</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">symlst</span><span class="p">:</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="n">MV</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s">&#39;scalar&#39;</span><span class="p">)</span>
        <span class="n">scalar_lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">scalar_lst</span><span class="p">)</span>

</div>
<span class="nd">@deprecated</span><span class="p">(</span><span class="n">useinstead</span><span class="o">=</span><span class="s">&quot;sympy.symbols()&quot;</span><span class="p">,</span> <span class="n">issue</span><span class="o">=</span><span class="mi">3379</span><span class="p">,</span>
            <span class="n">deprecated_since_version</span><span class="o">=</span><span class="s">&quot;0.7.2&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">make_symbols</span><span class="p">(</span><span class="n">symnamelst</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">sympy</span><span class="o">.</span><span class="n">symbols</span><span class="p">(</span><span class="n">symnamelst</span><span class="p">)</span>


<div class="viewcode-block" id="israt"><a class="viewcode-back" href="../../../modules/galgebra/GA.html#sympy.galgebra.GA.israt">[docs]</a><span class="k">def</span> <span class="nf">israt</span><span class="p">(</span><span class="n">numstr</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Test if string represents a rational number.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">NUMPAT</span>
    <span class="k">if</span> <span class="n">NUMPAT</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">numstr</span><span class="p">):</span>
        <span class="k">return</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="dualsort"><a class="viewcode-back" href="../../../modules/galgebra/GA.html#sympy.galgebra.GA.dualsort">[docs]</a><span class="k">def</span> <span class="nf">dualsort</span><span class="p">(</span><span class="n">lst1</span><span class="p">,</span> <span class="n">lst2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Inplace dual sort of lst1 and lst2 keyed on sorted lst1.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_indices</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lst1</span><span class="p">))</span>
    <span class="n">_indices</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">lst2</span><span class="o">.</span><span class="n">__getitem__</span><span class="p">)</span>
    <span class="n">lst1</span><span class="p">[:]</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">lst1</span><span class="o">.</span><span class="n">__getitem__</span><span class="p">,</span> <span class="n">_indices</span><span class="p">)</span>
    <span class="n">lst2</span><span class="p">[:]</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">lst2</span><span class="o">.</span><span class="n">__getitem__</span><span class="p">,</span> <span class="n">_indices</span><span class="p">)</span>
    <span class="k">return</span>

</div>
<div class="viewcode-block" id="cp"><a class="viewcode-back" href="../../../modules/galgebra/GA.html#sympy.galgebra.GA.cp">[docs]</a><span class="k">def</span> <span class="nf">cp</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the commutator product (A*B-B*A)/2 for</span>
<span class="sd">    the objects A and B.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span><span class="p">(</span><span class="n">HALF</span><span class="o">*</span><span class="p">(</span><span class="n">A</span><span class="o">*</span><span class="n">B</span> <span class="o">-</span> <span class="n">B</span><span class="o">*</span><span class="n">A</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="reduce_base"><a class="viewcode-back" href="../../../modules/galgebra/GA.html#sympy.galgebra.GA.reduce_base">[docs]</a><span class="k">def</span> <span class="nf">reduce_base</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">base</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    If base is a list of sorted integers [i_1,...,i_R] then reduce_base</span>
<span class="sd">    sorts the list [k,i_1,...,i_R] and calculates whether an odd or even</span>
<span class="sd">    number of permutations is required to sort the list. The sorted list</span>
<span class="sd">    is returned and +1 for even permutations or -1 for odd permutations.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">base</span><span class="p">:</span>
        <span class="k">return</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">base</span><span class="p">)</span>
    <span class="n">grade</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">base</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">grade</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">base</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="k">return</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="n">base</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="n">base</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">k</span><span class="p">])</span>
    <span class="n">ilo</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">ihi</span> <span class="o">=</span> <span class="n">grade</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">base</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
        <span class="k">return</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">base</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">k</span> <span class="o">&gt;</span> <span class="n">base</span><span class="p">[</span><span class="n">ihi</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">grade</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">base</span> <span class="o">+</span> <span class="p">[</span><span class="n">k</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">base</span> <span class="o">+</span> <span class="p">[</span><span class="n">k</span><span class="p">])</span>
    <span class="n">imid</span> <span class="o">=</span> <span class="n">ihi</span> <span class="o">+</span> <span class="n">ilo</span>
    <span class="k">if</span> <span class="n">grade</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="n">base</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">k</span><span class="p">,</span> <span class="n">base</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">ihi</span> <span class="o">-</span> <span class="n">ilo</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="k">if</span> <span class="n">base</span><span class="p">[</span><span class="n">imid</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">k</span><span class="p">:</span>
            <span class="n">ihi</span> <span class="o">=</span> <span class="n">imid</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ilo</span> <span class="o">=</span> <span class="n">imid</span>
        <span class="n">imid</span> <span class="o">=</span> <span class="p">(</span><span class="n">ilo</span> <span class="o">+</span> <span class="n">ihi</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
    <span class="k">if</span> <span class="n">ilo</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">base</span><span class="p">[:</span><span class="n">ihi</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">base</span><span class="p">[</span><span class="n">ihi</span><span class="p">:])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">base</span><span class="p">[:</span><span class="n">ihi</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">base</span><span class="p">[</span><span class="n">ihi</span><span class="p">:])</span>

</div>
<div class="viewcode-block" id="sub_base"><a class="viewcode-back" href="../../../modules/galgebra/GA.html#sympy.galgebra.GA.sub_base">[docs]</a><span class="k">def</span> <span class="nf">sub_base</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">base</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    If base is a list of sorted integers [i_1,...,i_R] then sub_base returns</span>
<span class="sd">    a list with the k^th element removed. Note that k=0 removes the first</span>
<span class="sd">    element.  There is no test to see if k is in the range of the list.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">base</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span><span class="p">([])</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="n">base</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="k">return</span><span class="p">([</span><span class="n">base</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span><span class="p">([</span><span class="n">base</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
    <span class="k">return</span><span class="p">(</span><span class="n">base</span><span class="p">[:</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">base</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:])</span>

</div>
<div class="viewcode-block" id="magnitude"><a class="viewcode-back" href="../../../modules/galgebra/GA.html#sympy.galgebra.GA.magnitude">[docs]</a><span class="k">def</span> <span class="nf">magnitude</span><span class="p">(</span><span class="n">vector</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate magnitude of vector containing trig expressions</span>
<span class="sd">    and simplify.  This is a hack because of way he sign of</span>
<span class="sd">    magsq is determined and because of the way that absolute</span>
<span class="sd">    values are removed.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">magsq</span> <span class="o">=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">expand</span><span class="p">((</span><span class="n">vector</span> <span class="o">|</span> <span class="n">vector</span><span class="p">)())</span>
    <span class="n">magsq</span> <span class="o">=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">trigsimp</span><span class="p">(</span><span class="n">magsq</span><span class="p">,</span> <span class="n">deep</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="c">#print magsq</span>
    <span class="n">magsq_str</span> <span class="o">=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">galgebra</span><span class="o">.</span><span class="n">latex_ex</span><span class="o">.</span><span class="n">LatexPrinter</span><span class="p">()</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">magsq</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">magsq_str</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;-&#39;</span><span class="p">:</span>
        <span class="n">magsq</span> <span class="o">=</span> <span class="o">-</span><span class="n">magsq</span>
    <span class="n">mag</span> <span class="o">=</span> <span class="n">unabs</span><span class="p">(</span><span class="n">sqrt</span><span class="p">(</span><span class="n">magsq</span><span class="p">))</span>
    <span class="c">#print mag</span>
    <span class="k">return</span><span class="p">(</span><span class="n">mag</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="LaTeX_lst"><a class="viewcode-back" href="../../../modules/galgebra/GA.html#sympy.galgebra.GA.LaTeX_lst">[docs]</a><span class="k">def</span> <span class="nf">LaTeX_lst</span><span class="p">(</span><span class="n">lst</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Output a list in LaTeX format.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">title</span> <span class="o">!=</span> <span class="s">&#39;&#39;</span><span class="p">:</span>
        <span class="n">sympy</span><span class="o">.</span><span class="n">galgebra</span><span class="o">.</span><span class="n">latex_ex</span><span class="o">.</span><span class="n">LaTeX</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">lst</span><span class="p">:</span>
        <span class="n">sympy</span><span class="o">.</span><span class="n">galgebra</span><span class="o">.</span><span class="n">latex_ex</span><span class="o">.</span><span class="n">LaTeX</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">return</span>

</div>
<div class="viewcode-block" id="unabs"><a class="viewcode-back" href="../../../modules/galgebra/GA.html#sympy.galgebra.GA.unabs">[docs]</a><span class="k">def</span> <span class="nf">unabs</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Remove absolute values from expressions so a = sqrt(a**2).</span>
<span class="sd">    This is a hack.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="n">mul_type</span><span class="p">:</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">unabs</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">yi</span> <span class="ow">in</span> <span class="n">x</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="n">y</span> <span class="o">*=</span> <span class="n">unabs</span><span class="p">(</span><span class="n">yi</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="n">pow_type</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">HALF</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="n">add_type</span><span class="p">:</span>
            <span class="k">return</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">unabs</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">return</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="n">abs_type</span><span class="p">:</span>
        <span class="k">return</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">return</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

</div>
<span class="k">def</span> <span class="nf">function_lst</span><span class="p">(</span><span class="n">fstr</span><span class="p">,</span> <span class="n">xtuple</span><span class="p">):</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">fstr</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">fct_lst</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">xstr</span> <span class="ow">in</span> <span class="n">fstr</span><span class="o">.</span><span class="n">split</span><span class="p">():</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">Function</span><span class="p">(</span><span class="n">xstr</span><span class="p">)(</span><span class="o">*</span><span class="n">xtuple</span><span class="p">)</span>
        <span class="n">fct_lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">fct_lst</span><span class="p">)</span>


<div class="viewcode-block" id="vector_fct"><a class="viewcode-back" href="../../../modules/galgebra/GA.html#sympy.galgebra.GA.vector_fct">[docs]</a><span class="k">def</span> <span class="nf">vector_fct</span><span class="p">(</span><span class="n">Fstr</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a list of functions of arguments x.  One function is</span>
<span class="sd">    created for each variable in x.  Fstr is a string that is</span>
<span class="sd">    the base name of each function while each function in the</span>
<span class="sd">    list is given the name Fstr+&#39;__&#39;+str(x[ix]) so that if</span>
<span class="sd">    Fstr = &#39;f&#39; and str(x[1]) = &#39;theta&#39; then the LaTeX output</span>
<span class="sd">    of the second element in the output list would be &#39;f^{\\theta}&#39;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nx</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">Fvec</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">ix</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nx</span><span class="p">):</span>
        <span class="n">ftmp</span> <span class="o">=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">Function</span><span class="p">(</span><span class="n">Fstr</span> <span class="o">+</span> <span class="s">&#39;__&#39;</span> <span class="o">+</span> <span class="n">sympy</span><span class="o">.</span><span class="n">galgebra</span><span class="o">.</span><span class="n">latex_ex</span><span class="o">.</span><span class="n">LatexPrinter</span><span class="o">.</span><span class="n">str_basic</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">ix</span><span class="p">]))(</span><span class="o">*</span><span class="nb">tuple</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
        <span class="n">Fvec</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ftmp</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">Fvec</span><span class="p">)</span>

</div>
<span class="k">def</span> <span class="nf">print_lst</span><span class="p">(</span><span class="n">lst</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">lst</span><span class="p">:</span>
        <span class="k">print</span> <span class="n">x</span>
    <span class="k">return</span>


<div class="viewcode-block" id="normalize"><a class="viewcode-back" href="../../../modules/galgebra/GA.html#sympy.galgebra.GA.normalize">[docs]</a><span class="k">def</span> <span class="nf">normalize</span><span class="p">(</span><span class="n">elst</span><span class="p">,</span> <span class="n">nname_lst</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Normalize a list of vectors and rename the normalized vectors. &#39;elist&#39; is the list</span>
<span class="sd">    (or array) of vectors to be normalized and nname_lst is a list of the names for the</span>
<span class="sd">    normalized vectors.  The function returns the numpy arrays enlst and mags containing</span>
<span class="sd">    the normalized vectors (enlst) and the magnitudes of the original vectors (mags).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">mags</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">MV</span><span class="o">.</span><span class="n">n</span><span class="o">*</span><span class="p">[</span><span class="n">ZERO</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">object</span><span class="p">)</span>
    <span class="n">enlst</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">MV</span><span class="o">.</span><span class="n">n</span><span class="o">*</span><span class="p">[</span><span class="n">ZERO</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">object</span><span class="p">)</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">nname</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">elst</span><span class="p">,</span> <span class="n">nname_lst</span><span class="p">):</span>
        <span class="n">emag</span> <span class="o">=</span> <span class="n">magnitude</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="n">emaginv</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">emag</span>
        <span class="n">mags</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">emag</span>
        <span class="n">enorm</span> <span class="o">=</span> <span class="n">emaginv</span><span class="o">*</span><span class="n">e</span>
        <span class="n">enorm</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">nname</span>
        <span class="n">enlst</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">enorm</span>
        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span><span class="p">(</span><span class="n">enlst</span><span class="p">,</span> <span class="n">mags</span><span class="p">)</span>

</div>
<span class="k">def</span> <span class="nf">build_base</span><span class="p">(</span><span class="n">base_index</span><span class="p">,</span> <span class="n">base_vectors</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="n">base</span> <span class="o">=</span> <span class="n">base_vectors</span><span class="p">[</span><span class="n">base_index</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">base_index</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">base_index</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="n">base</span> <span class="o">=</span> <span class="n">base</span> <span class="o">^</span> <span class="n">base_vectors</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">reverse</span><span class="p">:</span>
        <span class="n">base</span> <span class="o">=</span> <span class="n">base</span><span class="o">.</span><span class="n">rev</span><span class="p">()</span>
    <span class="k">return</span><span class="p">(</span><span class="n">base</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">MV</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="n">is_setup</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">basislabel_lst</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">curvilinear_flg</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">coords</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">pad_zeros</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Pad list with zeros to length n. If length is &gt; n</span>
<span class="sd">        truncate list.  Return padded list.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nvalue</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">nvalue</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">value</span> <span class="o">+</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">nvalue</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="n">ZERO</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">nvalue</span> <span class="o">&gt;</span> <span class="n">n</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="p">[:</span><span class="n">n</span><span class="p">]</span>
        <span class="k">return</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">define_basis</span><span class="p">(</span><span class="n">basis</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates all the MV static variables needed for</span>
<span class="sd">        basis operations.  See reference 5 section 2.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">MV</span><span class="o">.</span><span class="n">vbasis</span> <span class="o">=</span> <span class="n">basis</span>
        <span class="n">MV</span><span class="o">.</span><span class="n">vsyms</span> <span class="o">=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">symbols</span><span class="p">(</span><span class="n">MV</span><span class="o">.</span><span class="n">vbasis</span><span class="p">)</span>
        <span class="n">MV</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">MV</span><span class="o">.</span><span class="n">vbasis</span><span class="p">)</span>
        <span class="n">MV</span><span class="o">.</span><span class="n">nrg</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">MV</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>
        <span class="n">MV</span><span class="o">.</span><span class="n">n1</span> <span class="o">=</span> <span class="n">MV</span><span class="o">.</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">MV</span><span class="o">.</span><span class="n">n1rg</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">MV</span><span class="o">.</span><span class="n">n1</span><span class="p">)</span>
        <span class="n">MV</span><span class="o">.</span><span class="n">npow</span> <span class="o">=</span> <span class="mi">2</span><span class="o">**</span><span class="n">MV</span><span class="o">.</span><span class="n">n</span>
        <span class="n">MV</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">MV</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>
        <span class="n">MV</span><span class="o">.</span><span class="n">gabasis</span> <span class="o">=</span> <span class="p">[[]]</span>
        <span class="n">MV</span><span class="o">.</span><span class="n">basis</span> <span class="o">=</span> <span class="p">(</span><span class="n">MV</span><span class="o">.</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">MV</span><span class="o">.</span><span class="n">basislabel</span> <span class="o">=</span> <span class="p">(</span><span class="n">MV</span><span class="o">.</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">MV</span><span class="o">.</span><span class="n">basis</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">MV</span><span class="o">.</span><span class="n">basislabel</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;1&#39;</span>
        <span class="n">MV</span><span class="o">.</span><span class="n">basislabel_lst</span> <span class="o">=</span> <span class="p">[[</span><span class="s">&#39;1&#39;</span><span class="p">]]</span>
        <span class="n">MV</span><span class="o">.</span><span class="n">nbasis</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">MV</span><span class="o">.</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">object</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">igrade</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">MV</span><span class="o">.</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="n">comb</span><span class="p">(</span><span class="n">MV</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">igrade</span><span class="p">)</span>
            <span class="n">MV</span><span class="o">.</span><span class="n">gabasis</span> <span class="o">+=</span> <span class="p">[</span><span class="n">tmp</span><span class="p">]</span>
            <span class="n">ntmp</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
            <span class="n">MV</span><span class="o">.</span><span class="n">nbasis</span><span class="p">[</span><span class="n">igrade</span><span class="p">]</span> <span class="o">=</span> <span class="n">ntmp</span>
            <span class="n">MV</span><span class="o">.</span><span class="n">basis</span><span class="p">[</span><span class="n">igrade</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp</span>
            <span class="n">gradelabels</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">gradelabel_lst</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ntmp</span><span class="p">):</span>
                <span class="n">tmp_lst</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">bstr</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">tmp</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                    <span class="n">bstr</span> <span class="o">+=</span> <span class="n">MV</span><span class="o">.</span><span class="n">vbasis</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                    <span class="n">tmp_lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">MV</span><span class="o">.</span><span class="n">vbasis</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                <span class="n">gradelabel_lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp_lst</span><span class="p">)</span>
                <span class="n">gradelabels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bstr</span><span class="p">)</span>
            <span class="n">MV</span><span class="o">.</span><span class="n">basislabel_lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gradelabel_lst</span><span class="p">)</span>
            <span class="n">MV</span><span class="o">.</span><span class="n">basislabel</span><span class="p">[</span><span class="n">igrade</span><span class="p">]</span> <span class="o">=</span> <span class="n">gradelabels</span>
        <span class="n">MV</span><span class="o">.</span><span class="n">basis_map</span> <span class="o">=</span> <span class="p">[{</span><span class="s">&#39;&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">}]</span>
        <span class="n">igrade</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">while</span> <span class="n">igrade</span> <span class="o">&lt;=</span> <span class="n">MV</span><span class="o">.</span><span class="n">n</span><span class="p">:</span>
            <span class="n">tmpdict</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">bases</span> <span class="o">=</span> <span class="n">MV</span><span class="o">.</span><span class="n">gabasis</span><span class="p">[</span><span class="n">igrade</span><span class="p">]</span>
            <span class="n">ibases</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">base</span> <span class="ow">in</span> <span class="n">bases</span><span class="p">:</span>
                <span class="n">tmpdict</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">base</span><span class="p">)]</span> <span class="o">=</span> <span class="n">ibases</span>
                <span class="n">ibases</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">MV</span><span class="o">.</span><span class="n">basis_map</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmpdict</span><span class="p">)</span>
            <span class="n">igrade</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">MV</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;basis strings =&#39;</span><span class="p">,</span> <span class="n">MV</span><span class="o">.</span><span class="n">vbasis</span>
            <span class="k">print</span> <span class="s">&#39;basis symbols =&#39;</span><span class="p">,</span> <span class="n">MV</span><span class="o">.</span><span class="n">vsyms</span>
            <span class="k">print</span> <span class="s">&#39;basis labels  =&#39;</span><span class="p">,</span> <span class="n">MV</span><span class="o">.</span><span class="n">basislabel</span>
            <span class="k">print</span> <span class="s">&#39;basis         =&#39;</span><span class="p">,</span> <span class="n">MV</span><span class="o">.</span><span class="n">basis</span>
            <span class="k">print</span> <span class="s">&#39;grades        =&#39;</span><span class="p">,</span> <span class="n">MV</span><span class="o">.</span><span class="n">nbasis</span>
            <span class="k">print</span> <span class="s">&#39;index         =&#39;</span><span class="p">,</span> <span class="n">MV</span><span class="o">.</span><span class="n">index</span>
        <span class="k">return</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">define_metric</span><span class="p">(</span><span class="n">metric</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates all the MV static variables needed for</span>
<span class="sd">        metric operations.  See reference 5 section 2.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">MV</span><span class="o">.</span><span class="n">metric_str</span><span class="p">:</span>
            <span class="n">MV</span><span class="o">.</span><span class="n">g</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">MV</span><span class="o">.</span><span class="n">metric</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">MV</span><span class="o">.</span><span class="n">n</span><span class="o">*</span><span class="p">[</span><span class="n">MV</span><span class="o">.</span><span class="n">n</span><span class="o">*</span><span class="p">[</span><span class="n">ZERO</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">object</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">metric</span> <span class="o">==</span> <span class="s">&#39;&#39;</span><span class="p">:</span>
                <span class="n">metric</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">MV</span><span class="o">.</span><span class="n">n</span><span class="o">*</span><span class="p">[</span><span class="n">MV</span><span class="o">.</span><span class="n">n</span><span class="o">*</span><span class="p">[</span><span class="s">&#39;#&#39;</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">object</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">MV</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">MV</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
                    <span class="n">gij</span> <span class="o">=</span> <span class="n">metric</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">israt</span><span class="p">(</span><span class="n">gij</span><span class="p">):</span>
                        <span class="n">MV</span><span class="o">.</span><span class="n">metric</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">numeric</span><span class="p">(</span><span class="n">gij</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">gij</span> <span class="o">==</span> <span class="s">&#39;#&#39;</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">j</span><span class="p">:</span>
                                <span class="n">gij</span> <span class="o">=</span> <span class="s">&#39;(&#39;</span> <span class="o">+</span> <span class="n">MV</span><span class="o">.</span><span class="n">vbasis</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="s">&#39;**2)&#39;</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">gij</span> <span class="o">=</span> <span class="s">&#39;(&#39;</span> <span class="o">+</span> <span class="n">MV</span><span class="o">.</span><span class="n">vbasis</span><span class="p">[</span><span class="nb">min</span><span class="p">(</span>
                                    <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)]</span> <span class="o">+</span> <span class="s">&#39;.&#39;</span> <span class="o">+</span> <span class="n">MV</span><span class="o">.</span><span class="n">vbasis</span><span class="p">[</span><span class="nb">max</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)]</span> <span class="o">+</span> <span class="s">&#39;)&#39;</span>
                        <span class="n">tmp</span> <span class="o">=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">Symbol</span><span class="p">(</span><span class="n">gij</span><span class="p">)</span>
                        <span class="n">MV</span><span class="o">.</span><span class="n">metric</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp</span>
                        <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">j</span><span class="p">:</span>
                            <span class="n">MV</span><span class="o">.</span><span class="n">g</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">MV</span><span class="o">.</span><span class="n">metric</span> <span class="o">=</span> <span class="n">metric</span>
            <span class="n">MV</span><span class="o">.</span><span class="n">g</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">metric</span><span class="p">:</span>
                <span class="n">g_row</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">metric</span><span class="p">:</span>
                    <span class="n">g_row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
                    <span class="n">MV</span><span class="o">.</span><span class="n">g</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">g_row</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">MV</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;metric =&#39;</span><span class="p">,</span> <span class="n">MV</span><span class="o">.</span><span class="n">metric</span>
        <span class="k">return</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">define_reciprocal_frame</span><span class="p">():</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates unscaled reciprocal vectors (MV.brecp) and scale</span>
<span class="sd">        factor (MV.Esq). The ith scaled reciprocal vector is</span>
<span class="sd">        (1/MV.Esq)*MV.brecp[i].  The pseudoscalar for the set of</span>
<span class="sd">        basis vectors is MV.E.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">MV</span><span class="o">.</span><span class="n">tables_flg</span><span class="p">:</span>
            <span class="n">MV</span><span class="o">.</span><span class="n">E</span> <span class="o">=</span> <span class="n">MV</span><span class="o">.</span><span class="n">bvec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">MV</span><span class="o">.</span><span class="n">brecp</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">MV</span><span class="o">.</span><span class="n">n</span><span class="p">):</span>
                <span class="n">MV</span><span class="o">.</span><span class="n">E</span> <span class="o">=</span> <span class="n">MV</span><span class="o">.</span><span class="n">E</span> <span class="o">^</span> <span class="n">MV</span><span class="o">.</span><span class="n">bvec</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">MV</span><span class="o">.</span><span class="n">n</span><span class="p">):</span>
                <span class="n">tmp</span> <span class="o">=</span> <span class="n">ONE</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">tmp</span> <span class="o">=</span> <span class="o">-</span><span class="n">ONE</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">MV</span><span class="o">.</span><span class="n">n</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">j</span><span class="p">:</span>
                        <span class="n">tmp</span> <span class="o">=</span> <span class="n">tmp</span> <span class="o">^</span> <span class="n">MV</span><span class="o">.</span><span class="n">bvec</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                <span class="n">tmp</span> <span class="o">=</span> <span class="n">tmp</span><span class="o">*</span><span class="n">MV</span><span class="o">.</span><span class="n">E</span>
                <span class="n">MV</span><span class="o">.</span><span class="n">brecp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
            <span class="n">MV</span><span class="o">.</span><span class="n">Esq</span> <span class="o">=</span> <span class="p">(</span><span class="n">MV</span><span class="o">.</span><span class="n">E</span><span class="o">*</span><span class="n">MV</span><span class="o">.</span><span class="n">E</span><span class="p">)()</span>
            <span class="n">MV</span><span class="o">.</span><span class="n">Esq_inv</span> <span class="o">=</span> <span class="n">ONE</span><span class="o">/</span><span class="n">MV</span><span class="o">.</span><span class="n">Esq</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">MV</span><span class="o">.</span><span class="n">n</span><span class="p">):</span>
                <span class="n">MV</span><span class="o">.</span><span class="n">brecp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">MV</span><span class="o">.</span><span class="n">brecp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">MV</span><span class="o">.</span><span class="n">Esq_inv</span>
        <span class="k">return</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">reduce_basis_loop</span><span class="p">(</span><span class="n">blst</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Makes one pass through basis product representation for</span>
<span class="sd">        reduction of representation to normal form.</span>
<span class="sd">        See reference 5 section 3.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nblst</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">blst</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">nblst</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">jstep</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">while</span> <span class="n">jstep</span> <span class="o">&lt;</span> <span class="n">nblst</span><span class="p">:</span>
            <span class="n">istep</span> <span class="o">=</span> <span class="n">jstep</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">blst</span><span class="p">[</span><span class="n">istep</span><span class="p">]</span> <span class="o">==</span> <span class="n">blst</span><span class="p">[</span><span class="n">jstep</span><span class="p">]:</span>
                <span class="n">i</span> <span class="o">=</span> <span class="n">blst</span><span class="p">[</span><span class="n">istep</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">blst</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">blst</span> <span class="o">=</span> <span class="n">blst</span><span class="p">[:</span><span class="n">istep</span><span class="p">]</span> <span class="o">+</span> <span class="n">blst</span><span class="p">[</span><span class="n">jstep</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">blst</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">blst</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">jstep</span> <span class="o">==</span> <span class="n">nblst</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">blst_flg</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">blst_flg</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">return</span><span class="p">(</span><span class="n">MV</span><span class="o">.</span><span class="n">metric</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">blst</span><span class="p">,</span> <span class="n">blst_flg</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">blst</span><span class="p">[</span><span class="n">istep</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">blst</span><span class="p">[</span><span class="n">jstep</span><span class="p">]:</span>
                <span class="n">blst1</span> <span class="o">=</span> <span class="n">blst</span><span class="p">[:</span><span class="n">istep</span><span class="p">]</span> <span class="o">+</span> <span class="n">blst</span><span class="p">[</span><span class="n">jstep</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:]</span>
                <span class="n">a1</span> <span class="o">=</span> <span class="n">TWO</span><span class="o">*</span><span class="n">MV</span><span class="o">.</span><span class="n">metric</span><span class="p">[</span><span class="n">blst</span><span class="p">[</span><span class="n">jstep</span><span class="p">]][</span><span class="n">blst</span><span class="p">[</span><span class="n">istep</span><span class="p">]]</span>
                <span class="n">blst</span> <span class="o">=</span> <span class="n">blst</span><span class="p">[:</span><span class="n">istep</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">blst</span><span class="p">[</span><span class="n">jstep</span><span class="p">]]</span> <span class="o">+</span> <span class="p">[</span><span class="n">blst</span><span class="p">[</span><span class="n">istep</span><span class="p">]]</span> <span class="o">+</span> <span class="n">blst</span><span class="p">[</span><span class="n">jstep</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">blst1</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">blst1_flg</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">blst1_flg</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">return</span><span class="p">(</span><span class="n">a1</span><span class="p">,</span> <span class="n">blst1</span><span class="p">,</span> <span class="n">blst1_flg</span><span class="p">,</span> <span class="n">blst</span><span class="p">)</span>
            <span class="n">jstep</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">reduce_basis</span><span class="p">(</span><span class="n">blst</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Repetitively applies reduce_basis_loop to basis</span>
<span class="sd">        product representation until normal form is</span>
<span class="sd">        realized.  See reference 5 section 3.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">blst</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">blst_coef</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">blst_expand</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">MV</span><span class="o">.</span><span class="n">n1rg</span><span class="p">:</span>
                <span class="n">blst_coef</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
                <span class="n">blst_expand</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
            <span class="n">blst_expand</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
            <span class="n">blst_coef</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ONE</span><span class="p">)</span>
            <span class="k">return</span><span class="p">(</span><span class="n">blst_coef</span><span class="p">,</span> <span class="n">blst_expand</span><span class="p">)</span>
        <span class="n">blst_expand</span> <span class="o">=</span> <span class="p">[</span><span class="n">blst</span><span class="p">]</span>
        <span class="n">blst_coef</span> <span class="o">=</span> <span class="p">[</span><span class="n">ONE</span><span class="p">]</span>
        <span class="n">blst_flg</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">while</span> <span class="n">test_int_flgs</span><span class="p">(</span><span class="n">blst_flg</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">blst_flg</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">blst_flg</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                    <span class="n">tmp</span> <span class="o">=</span> <span class="n">MV</span><span class="o">.</span><span class="n">reduce_basis_loop</span><span class="p">(</span><span class="n">blst_expand</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">tmp</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">blst_flg</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                            <span class="n">blst_coef</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">blst_coef</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                            <span class="n">blst_expand</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                            <span class="n">blst_flg</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">blst_coef</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">blst_coef</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                            <span class="n">blst_flg</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                            <span class="n">blst_expand</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                            <span class="n">blst_coef</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="n">blst_coef</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                            <span class="n">blst_expand</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                            <span class="n">blst_flg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="p">(</span><span class="n">blst_coef</span><span class="p">,</span> <span class="n">blst_expand</span><span class="p">)</span> <span class="o">=</span> <span class="n">MV</span><span class="o">.</span><span class="n">combine_common_factors</span><span class="p">(</span>
            <span class="n">blst_coef</span><span class="p">,</span> <span class="n">blst_expand</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="n">blst_coef</span><span class="p">,</span> <span class="n">blst_expand</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">combine_common_factors</span><span class="p">(</span><span class="n">blst_coef</span><span class="p">,</span> <span class="n">blst_expand</span><span class="p">):</span>
        <span class="n">new_blst_coef</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">new_blst_expand</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">MV</span><span class="o">.</span><span class="n">n1</span><span class="p">):</span>
            <span class="n">new_blst_coef</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
            <span class="n">new_blst_expand</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
        <span class="n">nfac</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">blst_coef</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ifac</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nfac</span><span class="p">):</span>
            <span class="n">blen</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">blst_expand</span><span class="p">[</span><span class="n">ifac</span><span class="p">])</span>
            <span class="n">new_blst_coef</span><span class="p">[</span><span class="n">blen</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">blst_coef</span><span class="p">[</span><span class="n">ifac</span><span class="p">])</span>
            <span class="n">new_blst_expand</span><span class="p">[</span><span class="n">blen</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">blst_expand</span><span class="p">[</span><span class="n">ifac</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">MV</span><span class="o">.</span><span class="n">n1</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_blst_coef</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">MV</span><span class="o">.</span><span class="n">contract</span><span class="p">(</span><span class="n">new_blst_coef</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">new_blst_expand</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="k">return</span><span class="p">(</span><span class="n">new_blst_coef</span><span class="p">,</span> <span class="n">new_blst_expand</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">contract</span><span class="p">(</span><span class="n">coefs</span><span class="p">,</span> <span class="n">bases</span><span class="p">):</span>
        <span class="n">dualsort</span><span class="p">(</span><span class="n">coefs</span><span class="p">,</span> <span class="n">bases</span><span class="p">)</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">bases</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">:</span>
            <span class="n">j</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">bases</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">bases</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>
                <span class="n">coefs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">coefs</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                <span class="n">bases</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
                <span class="n">coefs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
                <span class="n">n</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">coefs</span><span class="p">)</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">coefs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">ZERO</span><span class="p">:</span>
                <span class="n">coefs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="n">bases</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="n">n</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">convert</span><span class="p">(</span><span class="n">coefs</span><span class="p">,</span> <span class="n">bases</span><span class="p">):</span>
        <span class="n">mv</span> <span class="o">=</span> <span class="n">MV</span><span class="p">()</span>
        <span class="n">mv</span><span class="o">.</span><span class="n">bladeflg</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">igrade</span> <span class="ow">in</span> <span class="n">MV</span><span class="o">.</span><span class="n">n1rg</span><span class="p">:</span>
            <span class="n">coef</span> <span class="o">=</span> <span class="n">coefs</span><span class="p">[</span><span class="n">igrade</span><span class="p">]</span>
            <span class="n">base</span> <span class="o">=</span> <span class="n">bases</span><span class="p">[</span><span class="n">igrade</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">coef</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">nbases</span> <span class="o">=</span> <span class="n">MV</span><span class="o">.</span><span class="n">nbasis</span><span class="p">[</span><span class="n">igrade</span><span class="p">]</span>
                <span class="n">mv</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">igrade</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">nbases</span><span class="o">*</span><span class="p">[</span><span class="n">ZERO</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">object</span><span class="p">)</span>
                <span class="n">nbaserg</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">base</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">ibase</span> <span class="ow">in</span> <span class="n">nbaserg</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">igrade</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">k</span> <span class="o">=</span> <span class="n">MV</span><span class="o">.</span><span class="n">basis</span><span class="p">[</span><span class="n">igrade</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">base</span><span class="p">[</span><span class="n">ibase</span><span class="p">])</span>
                        <span class="n">mv</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">igrade</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">coef</span><span class="p">[</span><span class="n">ibase</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">mv</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">igrade</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                            <span class="p">[</span><span class="n">coef</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">object</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="n">mv</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">set_str_format</span><span class="p">(</span><span class="n">str_mode</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="n">MV</span><span class="o">.</span><span class="n">str_mode</span> <span class="o">=</span> <span class="n">str_mode</span>
        <span class="k">return</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">str_rep</span><span class="p">(</span><span class="n">mv</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">         Converts internal representation of a multivector to a string</span>
<span class="sd">         for outputting.  If lst_mode = 1, str_rep outputs a list of</span>
<span class="sd">         strings where each string contains one multivector coefficient</span>
<span class="sd">         concatenated with the corresponding base or blade symbol.</span>

<span class="sd">            MV.str_mode     Effect</span>
<span class="sd">                0           Print entire multivector on one line (default)</span>
<span class="sd">                1           Print each grade on a single line</span>
<span class="sd">                2           Print each base on a single line</span>
<span class="sd">         &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">MV</span><span class="o">.</span><span class="n">bladeprint</span><span class="p">:</span>
            <span class="n">mv</span><span class="o">.</span><span class="n">convert_to_blades</span><span class="p">()</span>
            <span class="n">labels</span> <span class="o">=</span> <span class="n">MV</span><span class="o">.</span><span class="n">bladelabel</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">mv</span><span class="o">.</span><span class="n">bladeflg</span><span class="p">:</span>
                <span class="n">labels</span> <span class="o">=</span> <span class="n">MV</span><span class="o">.</span><span class="n">basislabel</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">labels</span> <span class="o">=</span> <span class="n">MV</span><span class="o">.</span><span class="n">bladelabel</span>
        <span class="n">mv</span><span class="o">.</span><span class="n">compact</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mv</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="p">(</span><span class="n">mv</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">__str__</span><span class="p">()</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="n">dummy</span> <span class="o">=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">Dummy</span><span class="p">(</span><span class="s">&#39;dummy&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">igrade</span> <span class="ow">in</span> <span class="n">MV</span><span class="o">.</span><span class="n">n1rg</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mv</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">igrade</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">mv</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">igrade</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">x</span> <span class="o">!=</span> <span class="n">ZERO</span><span class="p">:</span>
                        <span class="n">xstr</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">dummy</span><span class="p">)</span><span class="o">.</span><span class="n">__str__</span><span class="p">()</span>
                        <span class="n">xstr</span> <span class="o">=</span> <span class="n">xstr</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">xstr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&#39;-&#39;</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">xstr</span> <span class="o">=</span> <span class="s">&#39;+&#39;</span> <span class="o">+</span> <span class="n">xstr</span>
                        <span class="k">if</span> <span class="n">xstr</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;_dummy&#39;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">xstr</span><span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">:]</span> <span class="o">!=</span> <span class="s">&#39;_dummy&#39;</span><span class="p">:</span>
                            <span class="n">xstr</span> <span class="o">=</span> <span class="n">xstr</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
                                <span class="s">&#39;_dummy*&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;*&#39;</span> <span class="o">+</span> <span class="n">labels</span><span class="p">[</span><span class="n">igrade</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">xstr</span> <span class="o">=</span> <span class="n">xstr</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;_dummy&#39;</span><span class="p">,</span> <span class="n">labels</span><span class="p">[</span><span class="n">igrade</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">MV</span><span class="o">.</span><span class="n">str_mode</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                            <span class="n">xstr</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
                        <span class="n">value</span> <span class="o">+=</span> <span class="n">xstr</span>
                    <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">MV</span><span class="o">.</span><span class="n">str_mode</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="s">&#39;&#39;</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="s">&#39;0&#39;</span>
        <span class="c">#value = value.replace(&#39; &#39;,&#39;&#39;)</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;dummy&#39;</span><span class="p">,</span> <span class="s">&#39;1&#39;</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">xstr_rep</span><span class="p">(</span><span class="n">mv</span><span class="p">,</span> <span class="n">lst_mode</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">         Converts internal representation of a multivector to a string</span>
<span class="sd">         for outputing.  If lst_mode = 1, str_rep outputs a list of</span>
<span class="sd">         strings where each string contains one multivector coefficient</span>
<span class="sd">         concatenated with the corresponding base or blade symbol.</span>
<span class="sd">         &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">lst_mode</span><span class="p">:</span>
            <span class="n">outlst</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">MV</span><span class="o">.</span><span class="n">bladeprint</span><span class="p">:</span>
            <span class="n">mv</span><span class="o">.</span><span class="n">convert_to_blades</span><span class="p">()</span>
            <span class="n">labels</span> <span class="o">=</span> <span class="n">MV</span><span class="o">.</span><span class="n">bladelabel</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">mv</span><span class="o">.</span><span class="n">bladeflg</span><span class="p">:</span>
                <span class="n">labels</span> <span class="o">=</span> <span class="n">MV</span><span class="o">.</span><span class="n">basislabel</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">labels</span> <span class="o">=</span> <span class="n">MV</span><span class="o">.</span><span class="n">bladelabel</span>
        <span class="n">value</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">igrade</span> <span class="ow">in</span> <span class="n">MV</span><span class="o">.</span><span class="n">n1rg</span><span class="p">:</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mv</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">igrade</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">mv</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">igrade</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">x</span> <span class="o">!=</span> <span class="n">ZERO</span><span class="p">:</span>
                        <span class="n">xstr</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">__str__</span><span class="p">()</span>
                        <span class="k">if</span> <span class="n">xstr</span> <span class="o">==</span> <span class="s">&#39;+1&#39;</span> <span class="ow">or</span> <span class="n">xstr</span> <span class="o">==</span> <span class="s">&#39;1&#39;</span> <span class="ow">or</span> <span class="n">xstr</span> <span class="o">==</span> <span class="s">&#39;-1&#39;</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">xstr</span> <span class="o">==</span> <span class="s">&#39;+1&#39;</span> <span class="ow">or</span> <span class="n">xstr</span> <span class="o">==</span> <span class="s">&#39;1&#39;</span><span class="p">:</span>
                                <span class="n">xstr</span> <span class="o">=</span> <span class="s">&#39;+&#39;</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">xstr</span> <span class="o">=</span> <span class="s">&#39;-&#39;</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">xstr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&#39;+&#39;</span><span class="p">:</span>
                                <span class="n">xstr</span> <span class="o">=</span> <span class="s">&#39;+(&#39;</span> <span class="o">+</span> <span class="n">xstr</span> <span class="o">+</span> <span class="s">&#39;)&#39;</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">xstr</span> <span class="o">=</span> <span class="s">&#39;+(&#39;</span> <span class="o">+</span> <span class="n">xstr</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="s">&#39;)&#39;</span>
                        <span class="n">value</span> <span class="o">+=</span> <span class="n">xstr</span> <span class="o">+</span> <span class="n">labels</span><span class="p">[</span><span class="n">igrade</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">MV</span><span class="o">.</span><span class="n">str_mode</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">lst_mode</span><span class="p">:</span>
                            <span class="n">value</span> <span class="o">+=</span> <span class="n">value</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
                        <span class="k">if</span> <span class="n">lst_mode</span><span class="p">:</span>
                            <span class="n">tmp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                    <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">lst_mode</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">outlst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
                <span class="n">value</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">lst_mode</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;+&#39;</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="s">&#39;0&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">outlst</span>
        <span class="k">return</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="n">basis</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">rframe</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">coords</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        MV.setup initializes the MV class by calculating the static</span>
<span class="sd">        multivector tables required for geometric algebra operations</span>
<span class="sd">        on multivectors.  See reference 5 section 2 for details on</span>
<span class="sd">        basis and metric arguments.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">MV</span><span class="o">.</span><span class="n">is_setup</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">MV</span><span class="o">.</span><span class="n">metric_str</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="n">MV</span><span class="o">.</span><span class="n">debug</span> <span class="o">=</span> <span class="n">debug</span>
        <span class="n">MV</span><span class="o">.</span><span class="n">bladeprint</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">MV</span><span class="o">.</span><span class="n">tables_flg</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">MV</span><span class="o">.</span><span class="n">str_mode</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">MV</span><span class="o">.</span><span class="n">basisroot</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="n">MV</span><span class="o">.</span><span class="n">index_offset</span> <span class="o">=</span> <span class="n">offset</span>
        <span class="k">if</span> <span class="n">coords</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">MV</span><span class="o">.</span><span class="n">coords</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">MV</span><span class="o">.</span><span class="n">coords</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span>
            <span class="n">rframe</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">basis</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
            <span class="n">basislst</span> <span class="o">=</span> <span class="n">basis</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">basislst</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">MV</span><span class="o">.</span><span class="n">basisroot</span> <span class="o">=</span> <span class="n">basislst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">basislst</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">coord</span> <span class="ow">in</span> <span class="n">coords</span><span class="p">:</span>
                    <span class="n">basislst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">MV</span><span class="o">.</span><span class="n">basisroot</span> <span class="o">+</span> <span class="s">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">coord</span><span class="p">))</span>
            <span class="n">MV</span><span class="o">.</span><span class="n">define_basis</span><span class="p">(</span><span class="n">basislst</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">metric</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
            <span class="n">MV</span><span class="o">.</span><span class="n">metric_str</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">metric</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">metric</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;[&#39;</span> <span class="ow">and</span> <span class="n">metric</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;]&#39;</span><span class="p">:</span>
                    <span class="n">tmps</span> <span class="o">=</span> <span class="n">metric</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)</span>
                    <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmps</span><span class="p">)</span>
                    <span class="n">metric</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">itmp</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">for</span> <span class="n">tmp</span> <span class="ow">in</span> <span class="n">tmps</span><span class="p">:</span>
                        <span class="n">xtmp</span> <span class="o">=</span> <span class="n">N</span><span class="o">*</span><span class="p">[</span><span class="s">&#39;0&#39;</span><span class="p">]</span>
                        <span class="n">xtmp</span><span class="p">[</span><span class="n">itmp</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp</span>
                        <span class="n">itmp</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="n">metric</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xtmp</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">tmps</span> <span class="o">=</span> <span class="n">metric</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)</span>
                    <span class="n">metric</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">tmp</span> <span class="ow">in</span> <span class="n">tmps</span><span class="p">:</span>
                        <span class="n">xlst</span> <span class="o">=</span> <span class="n">tmp</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                        <span class="n">xtmp</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xlst</span><span class="p">:</span>
                            <span class="n">xtmp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
                        <span class="n">metric</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xtmp</span><span class="p">)</span>

        <span class="n">MV</span><span class="o">.</span><span class="n">define_metric</span><span class="p">(</span><span class="n">metric</span><span class="p">)</span>
        <span class="n">MV</span><span class="o">.</span><span class="n">multiplication_table</span><span class="p">()</span>
        <span class="n">MV</span><span class="o">.</span><span class="n">blade_table</span><span class="p">()</span>
        <span class="n">MV</span><span class="o">.</span><span class="n">inverse_blade_table</span><span class="p">()</span>
        <span class="n">MV</span><span class="o">.</span><span class="n">tables_flg</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">isym</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">MV</span><span class="o">.</span><span class="n">bvec</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">MV</span><span class="o">.</span><span class="n">vbasis</span><span class="p">:</span>
            <span class="n">bvar</span> <span class="o">=</span> <span class="n">MV</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">isym</span><span class="p">,</span> <span class="n">mvtype</span><span class="o">=</span><span class="s">&#39;basisvector&#39;</span><span class="p">,</span> <span class="n">mvname</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
            <span class="n">bvar</span><span class="o">.</span><span class="n">bladeflg</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">MV</span><span class="o">.</span><span class="n">bvec</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bvar</span><span class="p">)</span>
            <span class="n">isym</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">rframe</span><span class="p">:</span>
            <span class="n">MV</span><span class="o">.</span><span class="n">define_reciprocal_frame</span><span class="p">()</span>
        <span class="n">MV</span><span class="o">.</span><span class="n">I</span> <span class="o">=</span> <span class="n">MV</span><span class="p">(</span><span class="n">ONE</span><span class="p">,</span> <span class="s">&#39;pseudo&#39;</span><span class="p">,</span> <span class="s">&#39;I&#39;</span><span class="p">)</span>
        <span class="n">MV</span><span class="o">.</span><span class="n">ZERO</span> <span class="o">=</span> <span class="n">MV</span><span class="p">()</span>
        <span class="n">Isq</span> <span class="o">=</span> <span class="p">(</span><span class="n">MV</span><span class="o">.</span><span class="n">I</span><span class="o">*</span><span class="n">MV</span><span class="o">.</span><span class="n">I</span><span class="p">)()</span>
        <span class="n">MV</span><span class="o">.</span><span class="n">Iinv</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">Isq</span><span class="p">)</span><span class="o">*</span><span class="n">MV</span><span class="o">.</span><span class="n">I</span>
        <span class="k">return</span> <span class="n">MV</span><span class="o">.</span><span class="n">bvec</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">set_coords</span><span class="p">(</span><span class="n">coords</span><span class="p">):</span>
        <span class="n">MV</span><span class="o">.</span><span class="n">coords</span> <span class="o">=</span> <span class="n">coords</span>
        <span class="k">return</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">scalar_fct</span><span class="p">(</span><span class="n">fct_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create multivector scalar function with name fct_name (string) and</span>
<span class="sd">        independent variables coords (list of variable).  Default variables are</span>
<span class="sd">        those associated with each dimension of vector space.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">phi</span> <span class="o">=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">Function</span><span class="p">(</span><span class="n">fct_name</span><span class="p">)(</span><span class="o">*</span><span class="n">MV</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span>
        <span class="n">Phi</span> <span class="o">=</span> <span class="n">MV</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="s">&#39;scalar&#39;</span><span class="p">)</span>
        <span class="n">Phi</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">fct_name</span>
        <span class="k">return</span><span class="p">(</span><span class="n">Phi</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">vector_fct</span><span class="p">(</span><span class="n">fct_name</span><span class="p">,</span> <span class="nb">vars</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create multivector vector function with name fct_name (string) and</span>
<span class="sd">        independent variables coords (list of variable).  Default variables are</span>
<span class="sd">        those associated with each dimension of vector space.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">vars</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">Acoefs</span> <span class="o">=</span> <span class="n">vector_fct</span><span class="p">(</span><span class="n">fct_name</span><span class="p">,</span> <span class="n">MV</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Acoefs</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">MV</span><span class="o">.</span><span class="n">n</span><span class="o">*</span><span class="p">[</span><span class="n">ZERO</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">object</span><span class="p">)</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">MV</span><span class="o">.</span><span class="n">coords</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">vars</span><span class="p">,</span> <span class="n">sympy</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">symbol</span><span class="o">.</span><span class="n">Symbol</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">icoef</span> <span class="ow">in</span> <span class="n">MV</span><span class="o">.</span><span class="n">nrg</span><span class="p">:</span>
                    <span class="n">Acoefs</span><span class="p">[</span><span class="n">icoef</span><span class="p">]</span> <span class="o">=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">Function</span><span class="p">(</span><span class="n">fct_name</span> <span class="o">+</span> <span class="s">&#39;__&#39;</span> <span class="o">+</span>
                                   <span class="n">sympy</span><span class="o">.</span><span class="n">galgebra</span><span class="o">.</span><span class="n">latex_ex</span><span class="o">.</span><span class="n">LatexPrinter</span><span class="o">.</span><span class="n">str_basic</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">icoef</span><span class="p">]))(</span><span class="nb">vars</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">icoef</span> <span class="ow">in</span> <span class="n">MV</span><span class="o">.</span><span class="n">nrg</span><span class="p">:</span>
                    <span class="n">Acoefs</span><span class="p">[</span><span class="n">icoef</span><span class="p">]</span> <span class="o">=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">Function</span><span class="p">(</span><span class="n">fct_name</span> <span class="o">+</span> <span class="s">&#39;__&#39;</span> <span class="o">+</span>
                                   <span class="n">sympy</span><span class="o">.</span><span class="n">galgebra</span><span class="o">.</span><span class="n">latex_ex</span><span class="o">.</span><span class="n">LatexPrinter</span><span class="o">.</span><span class="n">str_basic</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">icoef</span><span class="p">]))(</span><span class="o">*</span><span class="nb">tuple</span><span class="p">(</span><span class="nb">vars</span><span class="p">))</span>
        <span class="n">A</span> <span class="o">=</span> <span class="n">MV</span><span class="p">(</span><span class="n">Acoefs</span><span class="p">,</span> <span class="s">&#39;vector&#39;</span><span class="p">,</span> <span class="n">fct_name</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">rebase</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">coords</span><span class="p">,</span> <span class="n">base_name</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">debug_level</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Define curvilinear coordinates for previously defined vector (multivector) space (MV.setup has been run)</span>
<span class="sd">        with position vector, x, that is a vector function of the independent coordinates, coords (list of</span>
<span class="sd">        sympy variables equal in length to dimension of vector space), and calculate:</span>

<span class="sd">            1. Frame (basis) vectors</span>
<span class="sd">            2. Normalized frame (basis) vectors.</span>
<span class="sd">            3. Metric tensor</span>
<span class="sd">            4. Reciprocal frame vectors</span>
<span class="sd">            5. Reciprocal metric tensor</span>
<span class="sd">            6. Connection multivectors</span>

<span class="sd">        The basis vectors are named with the base_name (string) and a subscript derived from the name of each</span>
<span class="sd">        coordinate.  So that if the base name is &#39;e&#39; and the coordinated are [r,theta,z] the variable names</span>
<span class="sd">        of the frame vectors would be e_r, e_theta, and e_z.  For LaTeX output the names of the frame vectors</span>
<span class="sd">        would be e_{r}, e_{\theta}, and e_{z}.  Everything needed to compute the geometric, outer, and inner</span>
<span class="sd">        derivatives of multivector functions in curvilinear coordinates is calculated.</span>

<span class="sd">        If debug is True all the quantities in the above list are output in LaTeX format.</span>

<span class="sd">        Currently rebase works with cylindrical and spherical coordinates in any dimension.  The limitation is the</span>
<span class="sd">        ability to automatically simplify complex sympy expressions generated while calculating the quantities in</span>
<span class="sd">        the above list.  This is why the debug option is included.  The debug_level can equal 0,1,2, or 3 and</span>
<span class="sd">        determines how far in the list to calculate (input 0 to do the entire list) while debugging.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c">#Form root names for basis, reciprocal basis, normalized basis, and normalized reciprocal basis</span>

        <span class="k">if</span> <span class="n">base_name</span> <span class="o">==</span> <span class="s">&#39;&#39;</span><span class="p">:</span>
            <span class="n">base_name</span> <span class="o">=</span> <span class="n">MV</span><span class="o">.</span><span class="n">basisroot</span> <span class="o">+</span> <span class="s">&#39;prm&#39;</span>

        <span class="n">LaTeX_base</span> <span class="o">=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">galgebra</span><span class="o">.</span><span class="n">latex_ex</span><span class="o">.</span><span class="n">LatexPrinter</span><span class="o">.</span><span class="n">extended_symbol</span><span class="p">(</span>
            <span class="n">base_name</span><span class="p">)</span>
        <span class="n">bm</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\\</span><span class="s">bm{&#39;</span> <span class="o">+</span> <span class="n">LaTeX_base</span> <span class="o">+</span> <span class="s">&#39;}&#39;</span>
        <span class="n">bmhat</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\\</span><span class="s">hat{&#39;</span> <span class="o">+</span> <span class="n">bm</span> <span class="o">+</span> <span class="s">&#39;}&#39;</span>
        <span class="n">bstr</span> <span class="o">=</span> <span class="n">bmhat</span> <span class="o">+</span> <span class="s">&#39;_{[i_{1},\dots, i_{R}]}&#39;</span>
        <span class="n">base_name</span> <span class="o">+=</span> <span class="s">&#39;bm&#39;</span>
        <span class="n">base_name_hat</span> <span class="o">=</span> <span class="n">base_name</span> <span class="o">+</span> <span class="s">&#39;hat&#39;</span>

        <span class="n">base_name_lst</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">nbase_name_lst</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">rbase_name_lst</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">rnbase_name_lst</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">coords_lst</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">coord</span> <span class="ow">in</span> <span class="n">coords</span><span class="p">:</span>
            <span class="n">coord_str</span> <span class="o">=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">galgebra</span><span class="o">.</span><span class="n">latex_ex</span><span class="o">.</span><span class="n">LatexPrinter</span><span class="o">.</span><span class="n">str_basic</span><span class="p">(</span><span class="n">coord</span><span class="p">)</span>
            <span class="n">coords_lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coord_str</span><span class="p">)</span>
            <span class="n">base_name_lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">base_name</span> <span class="o">+</span> <span class="s">&#39;_&#39;</span> <span class="o">+</span> <span class="n">coord_str</span><span class="p">)</span>
            <span class="n">rbase_name_lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">base_name</span> <span class="o">+</span> <span class="s">&#39;__&#39;</span> <span class="o">+</span> <span class="n">coord_str</span><span class="p">)</span>
            <span class="n">nbase_name_lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">base_name_hat</span> <span class="o">+</span> <span class="s">&#39;_&#39;</span> <span class="o">+</span> <span class="n">coord_str</span><span class="p">)</span>
            <span class="n">rnbase_name_lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">base_name_hat</span> <span class="o">+</span> <span class="s">&#39;__&#39;</span> <span class="o">+</span> <span class="n">coord_str</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">MV</span><span class="o">.</span><span class="n">n</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">base_name_lst</span><span class="p">)):</span>
            <span class="k">print</span> <span class="s">&#39;rebaseMV inputs not congruent:&#39;</span>
            <span class="k">print</span> <span class="s">&#39;MV.n =&#39;</span><span class="p">,</span> <span class="n">MV</span><span class="o">.</span><span class="n">n</span>
            <span class="k">print</span> <span class="s">&#39;coords =&#39;</span><span class="p">,</span> <span class="n">coords</span>
            <span class="k">print</span> <span class="s">&#39;bases =&#39;</span><span class="p">,</span> <span class="n">base_name</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">MV</span><span class="p">):</span>

            <span class="c">#Calculate basis vectors from derivatives of position vector x</span>

            <span class="n">bases</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">MV</span><span class="o">.</span><span class="n">n</span><span class="o">*</span><span class="p">[</span><span class="n">ZERO</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">object</span><span class="p">)</span>
            <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">coord</span> <span class="ow">in</span> <span class="n">coords</span><span class="p">:</span>
                <span class="n">ei</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="n">ei</span><span class="o">.</span><span class="n">set_name</span><span class="p">(</span><span class="n">base_name_lst</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="n">bases</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">ei</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="c">#Calculate normalizee basis vectors and basis vector magnitudes</span>

            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
                <span class="k">print</span> <span class="s">&#39;Coordinate Generating Vector&#39;</span>
                <span class="k">print</span> <span class="n">x</span>
                <span class="k">print</span> <span class="s">&#39;Basis Vectors&#39;</span>
                <span class="k">for</span> <span class="n">base</span> <span class="ow">in</span> <span class="n">bases</span><span class="p">:</span>
                    <span class="k">print</span> <span class="n">base</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="c">#Input basis vectors as N vector fields</span>

            <span class="n">bases</span> <span class="o">=</span> <span class="n">x</span>

            <span class="k">for</span> <span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">bases</span><span class="p">,</span> <span class="n">base_name_lst</span><span class="p">):</span>
                <span class="n">base</span><span class="o">.</span><span class="n">set_name</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
                <span class="k">print</span> <span class="s">&#39;Basis Vectors&#39;</span>
                <span class="k">for</span> <span class="n">base</span> <span class="ow">in</span> <span class="n">bases</span><span class="p">:</span>
                    <span class="k">print</span> <span class="n">base</span>
                <span class="k">if</span> <span class="n">debug_level</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">return</span>

        <span class="k">if</span> <span class="n">debug_level</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c">#Calculate normalized basis vectors and magnitudes of</span>
        <span class="c">#unormalized basis vectors</span>

        <span class="p">(</span><span class="n">nbases</span><span class="p">,</span> <span class="n">mags</span><span class="p">)</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">bases</span><span class="p">,</span> <span class="n">nbase_name_lst</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;Magnitudes&#39;</span>
            <span class="k">print</span> <span class="s">&#39;</span><span class="se">\\</span><span class="s">abs{&#39;</span> <span class="o">+</span> <span class="n">LaTeX_base</span> <span class="o">+</span> <span class="s">&#39;_{i}} = &#39;</span><span class="p">,</span> <span class="n">mags</span>
            <span class="k">print</span> <span class="s">&#39;Normalized Basis Vectors&#39;</span>
            <span class="k">for</span> <span class="n">nbase</span> <span class="ow">in</span> <span class="n">nbases</span><span class="p">:</span>
                <span class="k">print</span> <span class="n">nbase</span>

        <span class="n">g</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">MV</span><span class="o">.</span><span class="n">n</span><span class="o">*</span><span class="p">[</span><span class="n">MV</span><span class="o">.</span><span class="n">n</span><span class="o">*</span><span class="p">[</span><span class="n">ZERO</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">object</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">irow</span> <span class="ow">in</span> <span class="n">MV</span><span class="o">.</span><span class="n">nrg</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">icol</span> <span class="ow">in</span> <span class="n">MV</span><span class="o">.</span><span class="n">nrg</span><span class="p">:</span>
                <span class="n">magsq</span> <span class="o">=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">expand</span><span class="p">((</span><span class="n">nbases</span><span class="p">[</span><span class="n">irow</span><span class="p">]</span> <span class="o">|</span> <span class="n">nbases</span><span class="p">[</span><span class="n">icol</span><span class="p">])())</span>
                <span class="n">g</span><span class="p">[</span><span class="n">irow</span><span class="p">][</span><span class="n">icol</span><span class="p">]</span> <span class="o">=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">simplify</span><span class="p">(</span>
                    <span class="n">sympy</span><span class="o">.</span><span class="n">trigsimp</span><span class="p">(</span><span class="n">magsq</span><span class="p">,</span> <span class="n">deep</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;Metric $</span><span class="se">\\</span><span class="s">hat{g}_{ij} = </span><span class="se">\\</span><span class="s">hat{&#39;</span> <span class="o">+</span> <span class="n">LaTeX_base</span> <span class="o">+</span> \
                <span class="s">&#39;}_{i}</span><span class="se">\\</span><span class="s">cdot </span><span class="se">\\</span><span class="s">hat{&#39;</span> <span class="o">+</span> <span class="n">LaTeX_base</span> <span class="o">+</span> <span class="s">&#39;}_{j}$&#39;</span>
            <span class="k">print</span> <span class="s">r&#39;\hat{g}_{ij} =&#39;</span><span class="p">,</span> <span class="n">sympy</span><span class="o">.</span><span class="n">galgebra</span><span class="o">.</span><span class="n">latex_ex</span><span class="o">.</span><span class="n">LaTeX</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">debug_level</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c">#Calculate reciprocal normalized basis vectors</span>

        <span class="n">rnbases</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="n">is_quasi_unit_numpy_array</span><span class="p">(</span><span class="n">g</span><span class="p">):</span>
            <span class="n">ibasis</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">while</span> <span class="n">ibasis</span> <span class="o">&lt;</span> <span class="n">MV</span><span class="o">.</span><span class="n">n</span><span class="p">:</span>
                <span class="n">base</span> <span class="o">=</span> <span class="n">g</span><span class="p">[</span><span class="n">ibasis</span><span class="p">][</span><span class="n">ibasis</span><span class="p">]</span><span class="o">*</span><span class="n">nbases</span><span class="p">[</span><span class="n">ibasis</span><span class="p">]</span>
                <span class="n">base</span><span class="o">.</span><span class="n">set_name</span><span class="p">(</span><span class="n">rnbase_name_lst</span><span class="p">[</span><span class="n">ibasis</span><span class="p">])</span>
                <span class="n">base</span><span class="o">.</span><span class="n">simplify</span><span class="p">()</span>
                <span class="n">base</span><span class="o">.</span><span class="n">trigsimp</span><span class="p">()</span>
                <span class="n">rnbases</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">base</span><span class="p">)</span>
                <span class="n">ibasis</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rnbases</span> <span class="o">=</span> <span class="n">reciprocal_frame</span><span class="p">(</span><span class="n">nbases</span><span class="p">,</span> <span class="n">rnbase_name_lst</span><span class="p">)</span>
            <span class="n">ibase</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">base</span> <span class="ow">in</span> <span class="n">rnbases</span><span class="p">:</span>
                <span class="n">base</span><span class="o">.</span><span class="n">simplify</span><span class="p">()</span>
                <span class="n">base</span><span class="o">.</span><span class="n">trigsimp</span><span class="p">()</span>
                <span class="n">rnbases</span><span class="p">[</span><span class="n">ibase</span><span class="p">]</span> <span class="o">=</span> <span class="n">base</span>
                <span class="n">ibase</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">debug_level</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">sympy</span><span class="o">.</span><span class="n">galgebra</span><span class="o">.</span><span class="n">latex_ex</span><span class="o">.</span><span class="n">MV_format</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">print</span> <span class="s">&#39;Reciprocal Normalized Basis Vectors&#39;</span>
            <span class="k">for</span> <span class="n">rnbase</span> <span class="ow">in</span> <span class="n">rnbases</span><span class="p">:</span>
                <span class="k">print</span> <span class="n">rnbase</span>

        <span class="k">if</span> <span class="n">debug_level</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c">#Calculate components of inverse vectors</span>

        <span class="n">Acoef</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">ibasis</span> <span class="ow">in</span> <span class="n">MV</span><span class="o">.</span><span class="n">nrg</span><span class="p">:</span>
            <span class="n">evec</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">MV</span><span class="o">.</span><span class="n">n</span><span class="o">*</span><span class="p">[</span><span class="n">ZERO</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">object</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">jbasis</span> <span class="ow">in</span> <span class="n">MV</span><span class="o">.</span><span class="n">nrg</span><span class="p">:</span>
                <span class="n">evec</span><span class="p">[</span><span class="n">jbasis</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">MV</span><span class="o">.</span><span class="n">bvec</span><span class="p">[</span><span class="n">ibasis</span><span class="p">]</span> <span class="o">|</span> <span class="n">rnbases</span><span class="p">[</span><span class="n">jbasis</span><span class="p">])()</span>
            <span class="n">Acoef</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">evec</span><span class="p">)</span>

        <span class="c">#Calculat metric tensors</span>

        <span class="n">gr</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">MV</span><span class="o">.</span><span class="n">n</span><span class="o">*</span><span class="p">[</span><span class="n">MV</span><span class="o">.</span><span class="n">n</span><span class="o">*</span><span class="p">[</span><span class="n">ZERO</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">object</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">irow</span> <span class="ow">in</span> <span class="n">MV</span><span class="o">.</span><span class="n">nrg</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">icol</span> <span class="ow">in</span> <span class="n">MV</span><span class="o">.</span><span class="n">nrg</span><span class="p">:</span>
                <span class="n">magsq</span> <span class="o">=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">expand</span><span class="p">((</span><span class="n">rnbases</span><span class="p">[</span><span class="n">irow</span><span class="p">]</span> <span class="o">|</span> <span class="n">rnbases</span><span class="p">[</span><span class="n">icol</span><span class="p">])())</span>
                <span class="n">gr</span><span class="p">[</span><span class="n">irow</span><span class="p">][</span><span class="n">icol</span><span class="p">]</span> <span class="o">=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">simplify</span><span class="p">(</span>
                    <span class="n">sympy</span><span class="o">.</span><span class="n">trigsimp</span><span class="p">(</span><span class="n">magsq</span><span class="p">,</span> <span class="n">deep</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;Metric $</span><span class="se">\\</span><span class="s">hat{g}^{ij} = </span><span class="se">\\</span><span class="s">hat{&#39;</span> <span class="o">+</span> <span class="n">LaTeX_base</span> <span class="o">+</span> \
                <span class="s">&#39;}^{i}</span><span class="se">\\</span><span class="s">cdot </span><span class="se">\\</span><span class="s">hat{&#39;</span> <span class="o">+</span> <span class="n">LaTeX_base</span> <span class="o">+</span> <span class="s">&#39;}^{j}$&#39;</span>
            <span class="k">print</span> <span class="s">r&#39;\hat{g}^{ij} =&#39;</span><span class="p">,</span> <span class="n">sympy</span><span class="o">.</span><span class="n">galgebra</span><span class="o">.</span><span class="n">latex_ex</span><span class="o">.</span><span class="n">LaTeX</span><span class="p">(</span><span class="n">gr</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">debug_level</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c">#Calculate bases and reciprocal bases for curvilinear mulitvectors</span>

        <span class="n">MV_bases</span> <span class="o">=</span> <span class="p">[[</span><span class="n">ONE</span><span class="p">]]</span>
        <span class="n">MV_rbases</span> <span class="o">=</span> <span class="p">[[</span><span class="n">ONE</span><span class="p">]]</span>
        <span class="n">igrade</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">while</span> <span class="n">igrade</span> <span class="o">&lt;=</span> <span class="n">MV</span><span class="o">.</span><span class="n">n</span><span class="p">:</span>
            <span class="n">base_index</span> <span class="o">=</span> <span class="n">MV</span><span class="o">.</span><span class="n">gabasis</span><span class="p">[</span><span class="n">igrade</span><span class="p">]</span>
            <span class="n">grade_bases</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">rgrade_bases</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">base_index</span><span class="p">:</span>
                <span class="n">base</span> <span class="o">=</span> <span class="n">build_base</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">nbases</span><span class="p">)</span>
                <span class="n">base</span><span class="o">.</span><span class="n">simplify</span><span class="p">()</span>
                <span class="n">base</span><span class="o">.</span><span class="n">trigsimp</span><span class="p">()</span>
                <span class="n">rbase</span> <span class="o">=</span> <span class="n">build_base</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">rnbases</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
                <span class="n">rbase</span><span class="o">.</span><span class="n">simplify</span><span class="p">()</span>
                <span class="n">rbase</span><span class="o">.</span><span class="n">trigsimp</span><span class="p">()</span>
                <span class="n">grade_bases</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">base</span><span class="p">)</span>
                <span class="n">rgrade_bases</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rbase</span><span class="p">)</span>
            <span class="n">igrade</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">MV_bases</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">grade_bases</span><span class="p">)</span>
            <span class="n">MV_rbases</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rgrade_bases</span><span class="p">)</span>

        <span class="c">#Calculate connection multivectors for geometric derivative</span>

        <span class="n">MV_connect</span> <span class="o">=</span> <span class="p">[[</span><span class="n">ZERO</span><span class="p">]]</span>
        <span class="n">igrade</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">while</span> <span class="n">igrade</span> <span class="o">&lt;=</span> <span class="n">MV</span><span class="o">.</span><span class="n">n</span><span class="p">:</span>
            <span class="n">grade_connect</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">ibase</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">base</span> <span class="ow">in</span> <span class="n">MV_bases</span><span class="p">[</span><span class="n">igrade</span><span class="p">]:</span>
                <span class="nb">sum</span> <span class="o">=</span> <span class="n">MV</span><span class="p">()</span>
                <span class="n">itheta</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">for</span> <span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">etheta</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">rnbases</span><span class="p">):</span>
                    <span class="n">psum</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">mags</span><span class="p">[</span><span class="n">itheta</span><span class="p">])</span><span class="o">*</span><span class="n">etheta</span><span class="o">*</span><span class="n">base</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
                    <span class="n">psum</span><span class="o">.</span><span class="n">trigsimp</span><span class="p">()</span>
                    <span class="nb">sum</span> <span class="o">+=</span> <span class="n">psum</span>
                    <span class="n">itheta</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="nb">sum</span><span class="o">.</span><span class="n">simplify</span><span class="p">()</span>
                <span class="nb">sum</span><span class="o">.</span><span class="n">trigsimp</span><span class="p">()</span>
                <span class="n">grade_connect</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">sum</span><span class="p">)</span>
                <span class="n">ibase</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">MV_connect</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">grade_connect</span><span class="p">)</span>
            <span class="n">igrade</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;Curvilinear Bases: $&#39;</span> <span class="o">+</span> <span class="n">bstr</span> <span class="o">+</span> <span class="s">&#39; = &#39;</span> <span class="o">+</span> <span class="n">bmhat</span> <span class="o">+</span> \
                <span class="s">&#39;_{i_{1}}</span><span class="se">\\</span><span class="s">W</span><span class="se">\\</span><span class="s">dots</span><span class="se">\\</span><span class="s">W&#39;</span> <span class="o">+</span> <span class="n">bmhat</span> <span class="o">+</span> <span class="s">&#39;_{i_{R}}$&#39;</span>
            <span class="n">igrade</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">for</span> <span class="n">grade</span> <span class="ow">in</span> <span class="n">MV_bases</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                <span class="n">ibase</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">for</span> <span class="n">base</span> <span class="ow">in</span> <span class="n">grade</span><span class="p">:</span>
                    <span class="n">index</span> <span class="o">=</span> <span class="n">MV</span><span class="o">.</span><span class="n">gabasis</span><span class="p">[</span><span class="n">igrade</span><span class="p">][</span><span class="n">ibase</span><span class="p">]</span>
                    <span class="n">sub_str</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">index</span><span class="p">:</span>
                        <span class="n">sub_str</span> <span class="o">+=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">galgebra</span><span class="o">.</span><span class="n">latex_ex</span><span class="o">.</span><span class="n">LatexPrinter</span><span class="o">.</span><span class="n">extended_symbol</span><span class="p">(</span><span class="n">coords_lst</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="n">base_str</span> <span class="o">=</span> <span class="n">bmhat</span> <span class="o">+</span> <span class="s">&#39;_{[&#39;</span> <span class="o">+</span> <span class="n">sub_str</span> <span class="o">+</span> <span class="s">&#39;]} = &#39;</span>
                    <span class="k">print</span> <span class="n">base_str</span><span class="p">,</span> <span class="n">base</span>
                    <span class="n">ibase</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">igrade</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">debug_level</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c">#Calculate representation of connection multivectors in curvilinear system</span>

        <span class="n">MV_Connect</span> <span class="o">=</span> <span class="p">[[</span><span class="n">ZERO</span><span class="p">]]</span>
        <span class="n">igrade</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">while</span> <span class="n">igrade</span> <span class="o">&lt;=</span> <span class="n">MV</span><span class="o">.</span><span class="n">n</span><span class="p">:</span>
            <span class="n">grade_connect</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">ibase</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">nbase</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">MV_bases</span><span class="p">[</span><span class="n">igrade</span><span class="p">])</span>

            <span class="k">if</span> <span class="n">igrade</span> <span class="o">&lt;</span> <span class="n">MV</span><span class="o">.</span><span class="n">n</span><span class="p">:</span>
                <span class="n">ibase</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">p1base</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">MV_bases</span><span class="p">[</span><span class="n">igrade</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
                <span class="n">m1base</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">MV_bases</span><span class="p">[</span><span class="n">igrade</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
                <span class="k">while</span> <span class="n">ibase</span> <span class="o">&lt;</span> <span class="n">nbase</span><span class="p">:</span>
                    <span class="n">Cm1</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">m1base</span><span class="o">*</span><span class="p">[</span><span class="n">ZERO</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">object</span><span class="p">)</span>
                    <span class="n">Cp1</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">p1base</span><span class="o">*</span><span class="p">[</span><span class="n">ZERO</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">object</span><span class="p">)</span>
                    <span class="n">C</span> <span class="o">=</span> <span class="n">MV_connect</span><span class="p">[</span><span class="n">igrade</span><span class="p">][</span><span class="n">ibase</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">igrade</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">X</span> <span class="o">=</span> <span class="n">C</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">X</span> <span class="o">=</span> <span class="n">MV</span><span class="p">()</span>
                    <span class="n">jbase</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">while</span> <span class="n">jbase</span> <span class="o">&lt;</span> <span class="n">m1base</span><span class="p">:</span>
                        <span class="n">Cm1</span><span class="p">[</span><span class="n">jbase</span><span class="p">]</span> <span class="o">=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">trigsimp</span><span class="p">((</span><span class="n">MV</span><span class="o">.</span><span class="n">inner_product</span><span class="p">(</span><span class="n">MV_rbases</span><span class="p">[</span><span class="n">igrade</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="n">jbase</span><span class="p">],</span> <span class="n">C</span><span class="p">))(),</span> <span class="n">deep</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                        <span class="n">jbase</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">jbase</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">while</span> <span class="n">jbase</span> <span class="o">&lt;</span> <span class="n">p1base</span><span class="p">:</span>
                        <span class="n">Cp1</span><span class="p">[</span><span class="n">jbase</span><span class="p">]</span> <span class="o">=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">trigsimp</span><span class="p">((</span><span class="n">MV</span><span class="o">.</span><span class="n">inner_product</span><span class="p">(</span><span class="n">MV_rbases</span><span class="p">[</span><span class="n">igrade</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="n">jbase</span><span class="p">],</span> <span class="n">C</span><span class="p">))(),</span> <span class="n">deep</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                        <span class="n">jbase</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">X</span> <span class="o">+=</span> <span class="n">MV</span><span class="p">(</span>
                        <span class="p">(</span><span class="n">igrade</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Cm1</span><span class="p">),</span> <span class="s">&#39;grade&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">MV</span><span class="p">((</span><span class="n">igrade</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Cp1</span><span class="p">),</span> <span class="s">&#39;grade&#39;</span><span class="p">)</span>
                    <span class="n">X</span><span class="o">.</span><span class="n">simplify</span><span class="p">()</span>
                    <span class="n">X</span><span class="o">.</span><span class="n">trigsimp</span><span class="p">()</span>
                    <span class="n">grade_connect</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
                    <span class="n">ibase</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ibase</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">m1base</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">MV_bases</span><span class="p">[</span><span class="n">igrade</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
                <span class="k">while</span> <span class="n">ibase</span> <span class="o">&lt;</span> <span class="n">nbase</span><span class="p">:</span>
                    <span class="n">Cm1</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">m1base</span><span class="o">*</span><span class="p">[</span><span class="n">ZERO</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">object</span><span class="p">)</span>
                    <span class="n">C</span> <span class="o">=</span> <span class="n">MV_connect</span><span class="p">[</span><span class="n">igrade</span><span class="p">][</span><span class="n">ibase</span><span class="p">]</span>
                    <span class="n">jbase</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">while</span> <span class="n">jbase</span> <span class="o">&lt;</span> <span class="n">m1base</span><span class="p">:</span>
                        <span class="n">Cm1</span><span class="p">[</span><span class="n">jbase</span><span class="p">]</span> <span class="o">=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">trigsimp</span><span class="p">((</span><span class="n">MV</span><span class="o">.</span><span class="n">inner_product</span><span class="p">(</span><span class="n">MV_rbases</span><span class="p">[</span><span class="n">igrade</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="n">jbase</span><span class="p">],</span> <span class="n">C</span><span class="p">))(),</span> <span class="n">deep</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                        <span class="n">jbase</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">X</span> <span class="o">=</span> <span class="n">MV</span><span class="p">()</span>
                    <span class="n">X</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">MV</span><span class="o">.</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">Cm1</span>
                    <span class="n">X</span><span class="o">.</span><span class="n">simplify</span><span class="p">()</span>
                    <span class="n">X</span><span class="o">.</span><span class="n">trigsimp</span><span class="p">()</span>
                    <span class="n">grade_connect</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
                    <span class="n">ibase</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="n">MV_Connect</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">grade_connect</span><span class="p">)</span>
            <span class="n">igrade</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="n">base_str</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">coord</span> <span class="ow">in</span> <span class="n">coords</span><span class="p">:</span>
            <span class="n">base_str</span> <span class="o">+=</span> <span class="n">base_name</span> <span class="o">+</span> <span class="s">&#39;_&#39;</span> <span class="o">+</span> \
                <span class="n">sympy</span><span class="o">.</span><span class="n">galgebra</span><span class="o">.</span><span class="n">latex_ex</span><span class="o">.</span><span class="n">LatexPrinter</span><span class="o">.</span><span class="n">str_basic</span><span class="p">(</span><span class="n">coord</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39; &#39;</span>
        <span class="n">base_str</span> <span class="o">=</span> <span class="n">base_str</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">old_names</span> <span class="o">=</span> <span class="n">MV</span><span class="o">.</span><span class="n">vbasis</span>

        <span class="n">MV</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="n">base_str</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="n">coords</span><span class="p">)</span>

        <span class="n">MV</span><span class="o">.</span><span class="n">curvilinear_flg</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">MV</span><span class="o">.</span><span class="n">Connect</span> <span class="o">=</span> <span class="n">MV_Connect</span>
        <span class="n">sympy</span><span class="o">.</span><span class="n">galgebra</span><span class="o">.</span><span class="n">latex_ex</span><span class="o">.</span><span class="n">LatexPrinter</span><span class="o">.</span><span class="n">latex_bases</span><span class="p">()</span>
        <span class="n">MV</span><span class="o">.</span><span class="n">Rframe</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">MV</span><span class="o">.</span><span class="n">n</span><span class="o">*</span><span class="p">[</span><span class="n">ZERO</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">object</span><span class="p">)</span>
        <span class="n">ibasis</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">ibasis</span> <span class="o">&lt;</span> <span class="n">MV</span><span class="o">.</span><span class="n">n</span><span class="p">:</span>
            <span class="n">base</span> <span class="o">=</span> <span class="n">MV</span><span class="p">()</span>
            <span class="n">jbasis</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">while</span> <span class="n">jbasis</span> <span class="o">&lt;</span> <span class="n">MV</span><span class="o">.</span><span class="n">n</span><span class="p">:</span>
                <span class="n">base</span><span class="o">.</span><span class="n">add_in_place</span><span class="p">(</span><span class="n">gr</span><span class="p">[</span><span class="n">ibasis</span><span class="p">][</span><span class="n">jbasis</span><span class="p">]</span><span class="o">*</span><span class="n">MV</span><span class="o">.</span><span class="n">bvec</span><span class="p">[</span><span class="n">jbasis</span><span class="p">])</span>
                <span class="n">jbasis</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">base</span><span class="o">.</span><span class="n">scalar_mul_inplace</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">mags</span><span class="p">[</span><span class="n">ibasis</span><span class="p">])</span>
            <span class="n">MV</span><span class="o">.</span><span class="n">Rframe</span><span class="p">[</span><span class="n">ibasis</span><span class="p">]</span> <span class="o">=</span> <span class="n">base</span>
            <span class="n">ibasis</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="n">MV</span><span class="o">.</span><span class="n">org_basis</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ibasis</span> <span class="ow">in</span> <span class="n">MV</span><span class="o">.</span><span class="n">nrg</span><span class="p">:</span>
            <span class="n">evec</span> <span class="o">=</span> <span class="n">MV</span><span class="p">(</span><span class="n">Acoef</span><span class="p">[</span><span class="n">ibasis</span><span class="p">],</span> <span class="s">&#39;vector&#39;</span><span class="p">,</span> <span class="n">old_names</span><span class="p">[</span><span class="n">ibasis</span><span class="p">])</span>
            <span class="n">MV</span><span class="o">.</span><span class="n">org_basis</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">evec</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">MV</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">sympy</span><span class="o">.</span><span class="n">Symbol</span><span class="p">(</span><span class="s">&#39;t&#39;</span><span class="p">):</span>
            <span class="n">MV</span><span class="o">.</span><span class="n">dedt</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="c"># I can&#39;t fix this no name error because I have no clue what the</span>
            <span class="c"># original writer was trying to do.</span>
            <span class="k">for</span> <span class="n">coef</span> <span class="ow">in</span> <span class="n">dedt_coef</span><span class="p">:</span>
                <span class="n">MV</span><span class="o">.</span><span class="n">dedt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">MV</span><span class="p">(</span><span class="n">coef</span><span class="p">,</span> <span class="s">&#39;vector&#39;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">MV</span><span class="o">.</span><span class="n">dedt</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;Representation of Original Basis Vectors&#39;</span>
            <span class="k">for</span> <span class="n">evec</span> <span class="ow">in</span> <span class="n">MV</span><span class="o">.</span><span class="n">org_basis</span><span class="p">:</span>
                <span class="k">print</span> <span class="n">evec</span>

            <span class="k">print</span> <span class="s">&#39;Renormalized Reciprocal Vectors &#39;</span> <span class="o">+</span> <span class="s">&#39;$</span><span class="se">\\</span><span class="s">bfrac{&#39;</span> <span class="o">+</span> <span class="n">bmhat</span> <span class="o">+</span> \
                <span class="s">&#39;^{k}}{</span><span class="se">\\</span><span class="s">abs{</span><span class="se">\\</span><span class="s">bm{&#39;</span> <span class="o">+</span> <span class="n">LaTeX_base</span> <span class="o">+</span> <span class="s">&#39;}_{k}}}$&#39;</span>

            <span class="n">ibasis</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">while</span> <span class="n">ibasis</span> <span class="o">&lt;</span> <span class="n">MV</span><span class="o">.</span><span class="n">n</span><span class="p">:</span>
                <span class="n">c_str</span> <span class="o">=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">galgebra</span><span class="o">.</span><span class="n">latex_ex</span><span class="o">.</span><span class="n">LatexPrinter</span><span class="o">.</span><span class="n">extended_symbol</span><span class="p">(</span>
                    <span class="n">coords_lst</span><span class="p">[</span><span class="n">ibasis</span><span class="p">])</span>
                <span class="k">print</span> <span class="s">&#39;</span><span class="se">\\</span><span class="s">bfrac{</span><span class="se">\\</span><span class="s">bm{</span><span class="se">\\</span><span class="s">hat{&#39;</span> <span class="o">+</span> <span class="n">LaTeX_base</span> <span class="o">+</span> <span class="s">&#39;}}^{&#39;</span> <span class="o">+</span> <span class="n">c_str</span> <span class="o">+</span> \
                    <span class="s">&#39;}}{</span><span class="se">\\</span><span class="s">abs{</span><span class="se">\\</span><span class="s">bm{&#39;</span> <span class="o">+</span> <span class="n">LaTeX_base</span> <span class="o">+</span> <span class="s">&#39;}_{&#39;</span> <span class="o">+</span> <span class="n">c_str</span> <span class="o">+</span> <span class="s">&#39;}}} =&#39;</span><span class="p">,</span> \
                    <span class="n">MV</span><span class="o">.</span><span class="n">Rframe</span><span class="p">[</span><span class="n">ibasis</span><span class="p">]</span>
                <span class="n">ibasis</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="n">title_str</span> <span class="o">=</span> <span class="s">&#39;Connection Multivectors: $C</span><span class="se">\\</span><span class="s">lbrc&#39;</span> <span class="o">+</span> <span class="n">bstr</span> <span class="o">+</span> \
                <span class="s">&#39;</span><span class="se">\\</span><span class="s">rbrc = &#39;</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\\</span><span class="s">bfrac{&#39;</span> <span class="o">+</span> <span class="n">bmhat</span> <span class="o">+</span> <span class="s">&#39;^{k}}{</span><span class="se">\\</span><span class="s">abs{&#39;</span> <span class="o">+</span> <span class="n">bmhat</span> <span class="o">+</span> \
                <span class="s">&#39;_{k}}}</span><span class="se">\\</span><span class="s">pdiff{&#39;</span> <span class="o">+</span> <span class="n">bstr</span> <span class="o">+</span> <span class="s">&#39;}{</span><span class="se">\\</span><span class="s">theta^{k}}$&#39;</span>

            <span class="k">print</span> <span class="n">title_str</span>
            <span class="n">igrade</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">for</span> <span class="n">grade</span> <span class="ow">in</span> <span class="n">MV</span><span class="o">.</span><span class="n">Connect</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                <span class="n">ibase</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">for</span> <span class="n">base</span> <span class="ow">in</span> <span class="n">grade</span><span class="p">:</span>
                    <span class="n">index</span> <span class="o">=</span> <span class="n">MV</span><span class="o">.</span><span class="n">gabasis</span><span class="p">[</span><span class="n">igrade</span><span class="p">][</span><span class="n">ibase</span><span class="p">]</span>
                    <span class="n">sub_str</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">index</span><span class="p">:</span>
                        <span class="n">sub_str</span> <span class="o">+=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">galgebra</span><span class="o">.</span><span class="n">latex_ex</span><span class="o">.</span><span class="n">LatexPrinter</span><span class="o">.</span><span class="n">extended_symbol</span><span class="p">(</span><span class="n">coords_lst</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

                    <span class="n">base_str</span> <span class="o">=</span> <span class="s">&#39;C</span><span class="se">\\</span><span class="s">lbrc</span><span class="se">\\</span><span class="s">hat{&#39;</span> <span class="o">+</span> \
                        <span class="n">LaTeX_base</span> <span class="o">+</span> <span class="s">&#39;}_{[&#39;</span> <span class="o">+</span> <span class="n">sub_str</span> <span class="o">+</span> <span class="s">&#39;]}</span><span class="se">\\</span><span class="s">rbrc = &#39;</span>
                    <span class="k">print</span> <span class="n">base_str</span><span class="p">,</span> <span class="n">base</span>
                    <span class="n">ibase</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">igrade</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">print_blades</span><span class="p">():</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set multivector output to blade representation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">MV</span><span class="o">.</span><span class="n">bladeprint</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">return</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">print_bases</span><span class="p">():</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set multivector output to base representation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">MV</span><span class="o">.</span><span class="n">bladeprint</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">multiplication_table</span><span class="p">():</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate geometric product base multiplication table.</span>
<span class="sd">        See reference 5 section 3 for details.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">MV</span><span class="o">.</span><span class="n">mtable</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">igrade</span> <span class="ow">in</span> <span class="n">MV</span><span class="o">.</span><span class="n">n1rg</span><span class="p">:</span>
            <span class="n">MV</span><span class="o">.</span><span class="n">mtable</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
            <span class="k">for</span> <span class="n">ibase</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">MV</span><span class="o">.</span><span class="n">nbasis</span><span class="p">[</span><span class="n">igrade</span><span class="p">]):</span>
                <span class="n">MV</span><span class="o">.</span><span class="n">mtable</span><span class="p">[</span><span class="n">igrade</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
                <span class="k">if</span> <span class="n">igrade</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">base1</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">base1</span> <span class="o">=</span> <span class="n">MV</span><span class="o">.</span><span class="n">basis</span><span class="p">[</span><span class="n">igrade</span><span class="p">][</span><span class="n">ibase</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">jgrade</span> <span class="ow">in</span> <span class="n">MV</span><span class="o">.</span><span class="n">n1rg</span><span class="p">:</span>
                    <span class="n">MV</span><span class="o">.</span><span class="n">mtable</span><span class="p">[</span><span class="n">igrade</span><span class="p">][</span><span class="n">ibase</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
                    <span class="k">for</span> <span class="n">jbase</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">MV</span><span class="o">.</span><span class="n">nbasis</span><span class="p">[</span><span class="n">jgrade</span><span class="p">]):</span>
                        <span class="k">if</span> <span class="n">jgrade</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">base2</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">base2</span> <span class="o">=</span> <span class="n">MV</span><span class="o">.</span><span class="n">basis</span><span class="p">[</span><span class="n">jgrade</span><span class="p">][</span><span class="n">jbase</span><span class="p">]</span>
                        <span class="n">base</span> <span class="o">=</span> <span class="n">base1</span> <span class="o">+</span> <span class="n">base2</span>
                        <span class="p">(</span><span class="n">coefs</span><span class="p">,</span> <span class="n">bases</span><span class="p">)</span> <span class="o">=</span> <span class="n">MV</span><span class="o">.</span><span class="n">reduce_basis</span><span class="p">(</span><span class="n">base</span><span class="p">)</span>
                        <span class="n">product</span> <span class="o">=</span> <span class="n">MV</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">coefs</span><span class="p">,</span> <span class="n">bases</span><span class="p">)</span>
                        <span class="n">product</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;(&#39;</span> <span class="o">+</span> <span class="n">MV</span><span class="o">.</span><span class="n">basislabel</span><span class="p">[</span><span class="n">igrade</span><span class="p">][</span><span class="n">ibase</span><span class="p">]</span> <span class="o">+</span> \
                            <span class="s">&#39;)(&#39;</span> <span class="o">+</span> <span class="n">MV</span><span class="o">.</span><span class="n">basislabel</span><span class="p">[</span><span class="n">jgrade</span><span class="p">][</span><span class="n">jbase</span><span class="p">]</span> <span class="o">+</span> <span class="s">&#39;)&#39;</span>
                        <span class="n">MV</span><span class="o">.</span><span class="n">mtable</span><span class="p">[</span><span class="n">igrade</span><span class="p">][</span><span class="n">ibase</span><span class="p">][</span><span class="n">jgrade</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">product</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">MV</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;Multiplication Table:&#39;</span>
            <span class="k">for</span> <span class="n">level1</span> <span class="ow">in</span> <span class="n">MV</span><span class="o">.</span><span class="n">mtable</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">level2</span> <span class="ow">in</span> <span class="n">level1</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">level3</span> <span class="ow">in</span> <span class="n">level2</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">mv</span> <span class="ow">in</span> <span class="n">level3</span><span class="p">:</span>
                            <span class="n">mv</span><span class="o">.</span><span class="n">printmv</span><span class="p">()</span>
        <span class="k">return</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">geometric_product</span><span class="p">(</span><span class="n">mv1</span><span class="p">,</span> <span class="n">mv2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        MV.geometric_product(mv1,mv2) calculates the geometric</span>
<span class="sd">        product the multivectors mv1 and mv2 (mv1*mv2). See</span>
<span class="sd">        reference 5 section 3.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">product</span> <span class="o">=</span> <span class="n">MV</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mv1</span><span class="p">,</span> <span class="n">MV</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mv2</span><span class="p">,</span> <span class="n">MV</span><span class="p">):</span>
            <span class="n">bladeflg1</span> <span class="o">=</span> <span class="n">mv1</span><span class="o">.</span><span class="n">bladeflg</span>
            <span class="n">bladeflg2</span> <span class="o">=</span> <span class="n">mv2</span><span class="o">.</span><span class="n">bladeflg</span>
            <span class="k">if</span> <span class="n">bladeflg1</span><span class="p">:</span>
                <span class="n">mv1</span><span class="o">.</span><span class="n">convert_from_blades</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">bladeflg2</span><span class="p">:</span>
                <span class="n">mv2</span><span class="o">.</span><span class="n">convert_from_blades</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">igrade</span> <span class="ow">in</span> <span class="n">MV</span><span class="o">.</span><span class="n">n1rg</span><span class="p">:</span>
                <span class="n">gradei</span> <span class="o">=</span> <span class="n">mv1</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">igrade</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gradei</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">ibase</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">MV</span><span class="o">.</span><span class="n">nbasis</span><span class="p">[</span><span class="n">igrade</span><span class="p">]):</span>
                        <span class="n">xi</span> <span class="o">=</span> <span class="n">gradei</span><span class="p">[</span><span class="n">ibase</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">xi</span> <span class="o">!=</span> <span class="n">ZERO</span><span class="p">:</span>
                            <span class="k">for</span> <span class="n">jgrade</span> <span class="ow">in</span> <span class="n">MV</span><span class="o">.</span><span class="n">n1rg</span><span class="p">:</span>
                                <span class="n">gradej</span> <span class="o">=</span> <span class="n">mv2</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">jgrade</span><span class="p">]</span>
                                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gradej</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                                    <span class="k">for</span> <span class="n">jbase</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">MV</span><span class="o">.</span><span class="n">nbasis</span><span class="p">[</span><span class="n">jgrade</span><span class="p">]):</span>
                                        <span class="n">xj</span> <span class="o">=</span> <span class="n">gradej</span><span class="p">[</span><span class="n">jbase</span><span class="p">]</span>
                                        <span class="k">if</span> <span class="n">xj</span> <span class="o">!=</span> <span class="n">ZERO</span><span class="p">:</span>
                                            <span class="n">xixj</span> <span class="o">=</span> <span class="n">MV</span><span class="o">.</span><span class="n">mtable</span><span class="p">[</span><span class="n">igrade</span><span class="p">][</span><span class="n">ibase</span><span class="p">][</span><span class="n">jgrade</span><span class="p">][</span><span class="n">jbase</span><span class="p">]</span><span class="o">.</span><span class="n">scalar_mul</span><span class="p">(</span><span class="n">xi</span><span class="o">*</span><span class="n">xj</span><span class="p">)</span>
                                            <span class="n">product</span><span class="o">.</span><span class="n">add_in_place</span><span class="p">(</span><span class="n">xixj</span><span class="p">)</span>
            <span class="n">product</span><span class="o">.</span><span class="n">bladeflg</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">if</span> <span class="n">bladeflg1</span><span class="p">:</span>
                <span class="n">mv1</span><span class="o">.</span><span class="n">convert_to_blades</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">bladeflg2</span><span class="p">:</span>
                <span class="n">mv1</span><span class="o">.</span><span class="n">convert_to_blades</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">bladeflg1</span> <span class="ow">and</span> <span class="n">bladeflg2</span><span class="p">:</span>
                <span class="n">product</span><span class="o">.</span><span class="n">convert_to_blades</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mv1</span><span class="p">,</span> <span class="n">MV</span><span class="p">):</span>
                <span class="n">product</span> <span class="o">=</span> <span class="n">mv1</span><span class="o">.</span><span class="n">scalar_mul</span><span class="p">(</span><span class="n">mv2</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">product</span> <span class="o">=</span> <span class="n">mv2</span><span class="o">.</span><span class="n">scalar_mul</span><span class="p">(</span><span class="n">mv1</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="n">product</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">wedge</span><span class="p">(</span><span class="n">igrade1</span><span class="p">,</span> <span class="n">blade1</span><span class="p">,</span> <span class="n">vector2</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the outer product of a multivector blade</span>
<span class="sd">        and a vector.  See reference 5 section 5 for details.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">w12</span> <span class="o">=</span> <span class="n">blade1</span><span class="o">*</span><span class="n">vector2</span>
        <span class="n">w21</span> <span class="o">=</span> <span class="n">vector2</span><span class="o">*</span><span class="n">blade1</span>
        <span class="k">if</span> <span class="n">igrade1</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">w</span> <span class="o">=</span> <span class="n">w12</span> <span class="o">-</span> <span class="n">w21</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">w</span> <span class="o">=</span> <span class="n">w12</span> <span class="o">+</span> <span class="n">w21</span>
        <span class="n">w</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="k">return</span><span class="p">(</span><span class="n">w</span><span class="o">*</span><span class="n">HALF</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">blade_table</span><span class="p">():</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate basis blades in terms of bases. See reference 5</span>
<span class="sd">        section 5 for details. Used to convert from blade to base</span>
<span class="sd">        representation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">MV</span><span class="o">.</span><span class="n">btable</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">MV</span><span class="o">.</span><span class="n">bladelabel</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">basis_str</span> <span class="o">=</span> <span class="n">MV</span><span class="o">.</span><span class="n">basislabel</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">igrade</span> <span class="ow">in</span> <span class="n">MV</span><span class="o">.</span><span class="n">n1rg</span><span class="p">:</span>
            <span class="n">MV</span><span class="o">.</span><span class="n">bladelabel</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
            <span class="k">if</span> <span class="n">igrade</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">MV</span><span class="o">.</span><span class="n">bladelabel</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;1&#39;</span><span class="p">)</span>
                <span class="n">tmp</span> <span class="o">=</span> <span class="p">[</span><span class="n">MV</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">ONE</span><span class="p">,</span> <span class="n">mvtype</span><span class="o">=</span><span class="s">&#39;scalar&#39;</span><span class="p">,</span> <span class="n">mvname</span><span class="o">=</span><span class="s">&#39;1&#39;</span><span class="p">)]</span>
            <span class="k">if</span> <span class="n">igrade</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">tmp</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">ibase</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">MV</span><span class="o">.</span><span class="n">nbasis</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                    <span class="n">MV</span><span class="o">.</span><span class="n">bladelabel</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">basis_str</span><span class="p">[</span><span class="n">ibase</span><span class="p">])</span>
                    <span class="n">tmp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">MV</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">ibase</span><span class="p">,</span>
                               <span class="n">mvtype</span><span class="o">=</span><span class="s">&#39;basisvector&#39;</span><span class="p">,</span> <span class="n">mvname</span><span class="o">=</span><span class="n">basis_str</span><span class="p">[</span><span class="n">ibase</span><span class="p">]))</span>
            <span class="k">if</span> <span class="n">igrade</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">tmp</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">basis</span> <span class="o">=</span> <span class="n">MV</span><span class="o">.</span><span class="n">basis</span><span class="p">[</span><span class="n">igrade</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">blade</span> <span class="ow">in</span> <span class="n">basis</span><span class="p">:</span>
                    <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">blade</span><span class="p">:</span>
                        <span class="n">name</span> <span class="o">+=</span> <span class="n">basis_str</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="s">&#39;^&#39;</span>
                    <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">MV</span><span class="o">.</span><span class="n">bladelabel</span><span class="p">[</span><span class="n">igrade</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                    <span class="n">lblade</span> <span class="o">=</span> <span class="n">MV</span><span class="o">.</span><span class="n">basis</span><span class="p">[</span><span class="n">igrade</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">blade</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                    <span class="n">rblade</span> <span class="o">=</span> <span class="n">blade</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">igrade1</span> <span class="o">=</span> <span class="n">igrade</span> <span class="o">-</span> <span class="mi">1</span>
                    <span class="n">blade1</span> <span class="o">=</span> <span class="n">MV</span><span class="o">.</span><span class="n">btable</span><span class="p">[</span><span class="n">igrade1</span><span class="p">][</span><span class="n">lblade</span><span class="p">]</span>
                    <span class="n">vector2</span> <span class="o">=</span> <span class="n">MV</span><span class="o">.</span><span class="n">btable</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">rblade</span><span class="p">]</span>
                    <span class="n">b1Wv2</span> <span class="o">=</span> <span class="n">MV</span><span class="o">.</span><span class="n">wedge</span><span class="p">(</span><span class="n">igrade1</span><span class="p">,</span> <span class="n">blade1</span><span class="p">,</span> <span class="n">vector2</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
                    <span class="n">tmp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">b1Wv2</span><span class="p">)</span>
            <span class="n">MV</span><span class="o">.</span><span class="n">btable</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">MV</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;Blade Tabel:&#39;</span>
            <span class="k">for</span> <span class="n">grade</span> <span class="ow">in</span> <span class="n">MV</span><span class="o">.</span><span class="n">btable</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">mv</span> <span class="ow">in</span> <span class="n">grade</span><span class="p">:</span>
                    <span class="k">print</span> <span class="n">mv</span>
            <span class="k">print</span> <span class="s">&#39;Blade Labels:&#39;</span>
            <span class="k">print</span> <span class="n">MV</span><span class="o">.</span><span class="n">bladelabel</span>
        <span class="k">return</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">inverse_blade_table</span><span class="p">():</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate bases in terms of basis blades. See reference 5</span>
<span class="sd">        section 5 for details. Used to convert from base to blade</span>
<span class="sd">        representation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">MV</span><span class="o">.</span><span class="n">ibtable</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">igrade</span> <span class="ow">in</span> <span class="n">MV</span><span class="o">.</span><span class="n">n1rg</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">igrade</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">tmp</span> <span class="o">=</span> <span class="p">[</span><span class="n">MV</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">ONE</span><span class="p">,</span> <span class="n">mvtype</span><span class="o">=</span><span class="s">&#39;scalar&#39;</span><span class="p">,</span> <span class="n">mvname</span><span class="o">=</span><span class="s">&#39;1&#39;</span><span class="p">)]</span>
            <span class="k">if</span> <span class="n">igrade</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">tmp</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">ibase</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">MV</span><span class="o">.</span><span class="n">nbasis</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                    <span class="n">tmp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">MV</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">ibase</span><span class="p">,</span> <span class="n">mvtype</span><span class="o">=</span><span class="s">&#39;basisvector&#39;</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">igrade</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">tmp</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">iblade</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">for</span> <span class="n">blade</span> <span class="ow">in</span> <span class="n">MV</span><span class="o">.</span><span class="n">btable</span><span class="p">[</span><span class="n">igrade</span><span class="p">]:</span>
                    <span class="n">invblade</span> <span class="o">=</span> <span class="n">MV</span><span class="p">()</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">igrade</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                        <span class="n">invblade</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">blade</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                        <span class="n">invblade</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">igrade</span><span class="p">]</span> <span class="o">=</span> <span class="o">+</span><span class="n">blade</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">igrade</span><span class="p">]</span>
                        <span class="n">invblade</span><span class="o">.</span><span class="n">bladeflg</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="k">if</span> <span class="n">igrade</span> <span class="o">&gt;=</span> <span class="mi">4</span><span class="p">:</span>
                        <span class="n">jgrade</span> <span class="o">=</span> <span class="n">igrade</span> <span class="o">-</span> <span class="mi">2</span>
                        <span class="k">while</span> <span class="n">jgrade</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                            <span class="k">for</span> <span class="n">ibase</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">MV</span><span class="o">.</span><span class="n">nbasis</span><span class="p">[</span><span class="n">jgrade</span><span class="p">]):</span>
                                <span class="n">invblade</span><span class="o">.</span><span class="n">substitute_base</span><span class="p">(</span>
                                    <span class="n">jgrade</span><span class="p">,</span> <span class="n">ibase</span><span class="p">,</span> <span class="n">MV</span><span class="o">.</span><span class="n">ibtable</span><span class="p">[</span><span class="n">jgrade</span><span class="p">][</span><span class="n">ibase</span><span class="p">])</span>
                            <span class="n">jgrade</span> <span class="o">-=</span> <span class="mi">2</span>
                    <span class="n">invblade</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">MV</span><span class="o">.</span><span class="n">basislabel</span><span class="p">[</span><span class="n">igrade</span><span class="p">][</span><span class="n">iblade</span><span class="p">]</span>
                    <span class="n">iblade</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">tmp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">invblade</span><span class="p">)</span>
            <span class="n">MV</span><span class="o">.</span><span class="n">ibtable</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">MV</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;Inverse Blade Tabel:&#39;</span>
            <span class="k">for</span> <span class="n">grade</span> <span class="ow">in</span> <span class="n">MV</span><span class="o">.</span><span class="n">ibtable</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">mv</span> <span class="ow">in</span> <span class="n">grade</span><span class="p">:</span>
                    <span class="n">mv</span><span class="o">.</span><span class="n">printmv</span><span class="p">()</span>
        <span class="k">return</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">outer_product</span><span class="p">(</span><span class="n">mv1</span><span class="p">,</span> <span class="n">mv2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        MV.outer_product(mv1,mv2) calculates the outer (exterior,wedge)</span>
<span class="sd">        product of the multivectors mv1 and mv2 (mv1^mv2). See</span>
<span class="sd">        reference 5 section 6.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">mv1</span><span class="p">)</span> <span class="o">==</span> <span class="nb">type</span><span class="p">(</span><span class="n">MV</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">mv2</span><span class="p">)</span> <span class="o">==</span> <span class="nb">type</span><span class="p">(</span><span class="n">MV</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">mv1</span><span class="o">.</span><span class="n">is_scalar</span><span class="p">()</span> <span class="ow">and</span> <span class="n">mv2</span><span class="o">.</span><span class="n">is_scalar</span><span class="p">():</span>
                <span class="k">return</span><span class="p">(</span><span class="n">mv1</span><span class="o">*</span><span class="n">mv2</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mv1</span><span class="p">,</span> <span class="n">MV</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mv2</span><span class="p">,</span> <span class="n">MV</span><span class="p">):</span>
            <span class="n">product</span> <span class="o">=</span> <span class="n">MV</span><span class="p">()</span>
            <span class="n">product</span><span class="o">.</span><span class="n">bladeflg</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">mv1</span><span class="o">.</span><span class="n">convert_to_blades</span><span class="p">()</span>
            <span class="n">mv2</span><span class="o">.</span><span class="n">convert_to_blades</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">igrade1</span> <span class="ow">in</span> <span class="n">MV</span><span class="o">.</span><span class="n">n1rg</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mv1</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">igrade1</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                    <span class="n">pg1</span> <span class="o">=</span> <span class="n">mv1</span><span class="o">.</span><span class="n">project</span><span class="p">(</span><span class="n">igrade1</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">igrade2</span> <span class="ow">in</span> <span class="n">MV</span><span class="o">.</span><span class="n">n1rg</span><span class="p">:</span>
                        <span class="n">igrade</span> <span class="o">=</span> <span class="n">igrade1</span> <span class="o">+</span> <span class="n">igrade2</span>
                        <span class="k">if</span> <span class="n">igrade</span> <span class="o">&lt;=</span> <span class="n">MV</span><span class="o">.</span><span class="n">n</span><span class="p">:</span>
                            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mv2</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">igrade2</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                                <span class="n">pg2</span> <span class="o">=</span> <span class="n">mv2</span><span class="o">.</span><span class="n">project</span><span class="p">(</span><span class="n">igrade2</span><span class="p">)</span>
                                <span class="n">pg1pg2</span> <span class="o">=</span> <span class="n">pg1</span><span class="o">*</span><span class="n">pg2</span>
                                <span class="n">product</span><span class="o">.</span><span class="n">add_in_place</span><span class="p">(</span><span class="n">pg1pg2</span><span class="o">.</span><span class="n">project</span><span class="p">(</span><span class="n">igrade</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mv1</span><span class="p">,</span> <span class="n">MV</span><span class="p">):</span>
                <span class="n">product</span> <span class="o">=</span> <span class="n">mv1</span><span class="o">.</span><span class="n">scalar_mul</span><span class="p">(</span><span class="n">mv2</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mv2</span><span class="p">,</span> <span class="n">MV</span><span class="p">):</span>
                <span class="n">product</span> <span class="o">=</span> <span class="n">mv2</span><span class="o">.</span><span class="n">scalar_mul</span><span class="p">(</span><span class="n">mv1</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="n">product</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">inner_product</span><span class="p">(</span><span class="n">mv1</span><span class="p">,</span> <span class="n">mv2</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&#39;s&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        MV.inner_product(mv1,mv2) calculates the inner</span>

<span class="sd">        mode = &#39;s&#39; - symmetric (Doran &amp; Lasenby)</span>
<span class="sd">        mode = &#39;l&#39; - left contraction (Dorst)</span>
<span class="sd">        mode = &#39;r&#39; - right contraction (Dorst)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">mv1</span><span class="p">)</span> <span class="o">==</span> <span class="nb">type</span><span class="p">(</span><span class="n">MV</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">mv2</span><span class="p">)</span> <span class="o">==</span> <span class="nb">type</span><span class="p">(</span><span class="n">MV</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">mv1</span><span class="o">.</span><span class="n">is_scalar</span><span class="p">()</span> <span class="ow">and</span> <span class="n">mv2</span><span class="o">.</span><span class="n">is_scalar</span><span class="p">():</span>
                <span class="k">return</span><span class="p">(</span><span class="n">mv1</span><span class="o">*</span><span class="n">mv2</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mv1</span><span class="p">,</span> <span class="n">MV</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mv2</span><span class="p">,</span> <span class="n">MV</span><span class="p">):</span>
            <span class="n">product</span> <span class="o">=</span> <span class="n">MV</span><span class="p">()</span>
            <span class="n">product</span><span class="o">.</span><span class="n">bladeflg</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">mv1</span><span class="o">.</span><span class="n">convert_to_blades</span><span class="p">()</span>
            <span class="n">mv2</span><span class="o">.</span><span class="n">convert_to_blades</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">igrade1</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">MV</span><span class="o">.</span><span class="n">n1</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mv1</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">igrade1</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                    <span class="n">pg1</span> <span class="o">=</span> <span class="n">mv1</span><span class="o">.</span><span class="n">project</span><span class="p">(</span><span class="n">igrade1</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">igrade2</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">MV</span><span class="o">.</span><span class="n">n1</span><span class="p">):</span>
                        <span class="n">igrade</span> <span class="o">=</span> <span class="n">igrade1</span> <span class="o">-</span> <span class="n">igrade2</span>
                        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s">&#39;s&#39;</span><span class="p">:</span>
                            <span class="n">igrade</span> <span class="o">=</span> <span class="n">igrade</span><span class="o">.</span><span class="n">__abs__</span><span class="p">()</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s">&#39;l&#39;</span><span class="p">:</span>
                                <span class="n">igrade</span> <span class="o">=</span> <span class="o">-</span><span class="n">igrade</span>
                        <span class="k">if</span> <span class="n">igrade</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mv2</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">igrade2</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                                <span class="n">pg2</span> <span class="o">=</span> <span class="n">mv2</span><span class="o">.</span><span class="n">project</span><span class="p">(</span><span class="n">igrade2</span><span class="p">)</span>
                                <span class="n">pg1pg2</span> <span class="o">=</span> <span class="n">pg1</span><span class="o">*</span><span class="n">pg2</span>
                                <span class="n">product</span><span class="o">.</span><span class="n">add_in_place</span><span class="p">(</span><span class="n">pg1pg2</span><span class="o">.</span><span class="n">project</span><span class="p">(</span><span class="n">igrade</span><span class="p">))</span>
            <span class="k">return</span><span class="p">(</span><span class="n">product</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s">&#39;s&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mv1</span><span class="p">,</span> <span class="n">MV</span><span class="p">):</span>
                    <span class="n">product</span> <span class="o">=</span> <span class="n">mv1</span><span class="o">.</span><span class="n">scalar_mul</span><span class="p">(</span><span class="n">mv2</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mv2</span><span class="p">,</span> <span class="n">MV</span><span class="p">):</span>
                    <span class="n">product</span> <span class="o">=</span> <span class="n">mv2</span><span class="o">.</span><span class="n">scalar_mul</span><span class="p">(</span><span class="n">mv1</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">product</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">return</span><span class="p">(</span><span class="n">product</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">addition</span><span class="p">(</span><span class="n">mv1</span><span class="p">,</span> <span class="n">mv2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        MV.addition(mv1,mv2) calculates the sum</span>
<span class="sd">        of the multivectors mv1 and mv2 (mv1+mv2).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">sum</span> <span class="o">=</span> <span class="n">MV</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mv1</span><span class="p">,</span> <span class="n">MV</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mv2</span><span class="p">,</span> <span class="n">MV</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">mv1</span><span class="o">.</span><span class="n">bladeflg</span> <span class="ow">or</span> <span class="n">mv2</span><span class="o">.</span><span class="n">bladeflg</span><span class="p">:</span>
                <span class="n">mv1</span><span class="o">.</span><span class="n">convert_to_blades</span><span class="p">()</span>
                <span class="n">mv2</span><span class="o">.</span><span class="n">convert_to_blades</span><span class="p">()</span>
                <span class="nb">sum</span><span class="o">.</span><span class="n">bladeflg</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">MV</span><span class="o">.</span><span class="n">n1rg</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mv1</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mv2</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                    <span class="nb">sum</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">mv1</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">mv2</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mv1</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mv2</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                        <span class="nb">sum</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">+</span><span class="n">mv1</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mv2</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mv1</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                            <span class="nb">sum</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">+</span><span class="n">mv2</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">return</span><span class="p">(</span><span class="nb">sum</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mv1</span><span class="p">,</span> <span class="n">MV</span><span class="p">):</span>
                <span class="k">return</span><span class="p">(</span><span class="n">mv1</span> <span class="o">+</span> <span class="n">MV</span><span class="p">(</span><span class="n">mv2</span><span class="p">,</span> <span class="s">&#39;scalar&#39;</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span><span class="p">(</span><span class="n">MV</span><span class="p">(</span><span class="n">mv1</span><span class="p">,</span> <span class="s">&#39;scalar&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">mv2</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">subtraction</span><span class="p">(</span><span class="n">mv1</span><span class="p">,</span> <span class="n">mv2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        MV.subtraction(mv1,mv2) calculates the difference</span>
<span class="sd">        of the multivectors mv1 and mv2 (mv1-mv2).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">MV</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mv1</span><span class="p">,</span> <span class="n">MV</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mv2</span><span class="p">,</span> <span class="n">MV</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">mv1</span><span class="o">.</span><span class="n">bladeflg</span> <span class="ow">or</span> <span class="n">mv2</span><span class="o">.</span><span class="n">bladeflg</span><span class="p">:</span>
                <span class="n">mv1</span><span class="o">.</span><span class="n">convert_to_blades</span><span class="p">()</span>
                <span class="n">mv2</span><span class="o">.</span><span class="n">convert_to_blades</span><span class="p">()</span>
                <span class="n">diff</span><span class="o">.</span><span class="n">bladeflg</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">MV</span><span class="o">.</span><span class="n">n1rg</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mv1</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mv2</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                    <span class="n">diff</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">mv1</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">mv2</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mv1</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mv2</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                        <span class="n">diff</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">+</span><span class="n">mv1</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mv1</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mv2</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                            <span class="n">diff</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">mv2</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">return</span><span class="p">(</span><span class="n">diff</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mv1</span><span class="p">,</span> <span class="n">MV</span><span class="p">):</span>
                <span class="k">return</span><span class="p">(</span><span class="n">mv1</span> <span class="o">-</span> <span class="n">MV</span><span class="p">(</span><span class="n">mv2</span><span class="p">,</span> <span class="s">&#39;scalar&#39;</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span><span class="p">(</span><span class="n">MV</span><span class="p">(</span><span class="n">mv1</span><span class="p">,</span> <span class="s">&#39;scalar&#39;</span><span class="p">)</span> <span class="o">-</span> <span class="n">mv2</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">vdiff</span><span class="p">(</span><span class="n">vec</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">dvec</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vec</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="n">ZERO</span><span class="p">])</span>
        <span class="n">ivec</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">veci</span> <span class="ow">in</span> <span class="n">vec</span><span class="p">:</span>
            <span class="n">dvec</span><span class="p">[</span><span class="n">ivec</span><span class="p">]</span> <span class="o">=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">veci</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
            <span class="n">ivec</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span><span class="p">(</span><span class="n">dvec</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">scalar_to_symbol</span><span class="p">(</span><span class="n">scalar</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">scalar</span><span class="p">,</span> <span class="n">MV</span><span class="p">):</span>
            <span class="k">return</span><span class="p">(</span><span class="n">scalar</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">scalar</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
            <span class="n">sym</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">scalar</span><span class="p">:</span>
                <span class="n">sym</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">MV</span><span class="o">.</span><span class="n">scalar_to_symbol</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
            <span class="k">return</span><span class="p">(</span><span class="n">sym</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="n">scalar</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">mvtype</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">mvname</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">fct</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="nb">vars</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialization of multivector X. Inputs are as follows</span>

<span class="sd">        mvtype           value                       result</span>

<span class="sd">        default         default                  Zero multivector</span>
<span class="sd">        &#39;basisvector&#39;   int i                    ith basis vector</span>
<span class="sd">        &#39;basisbivector&#39; int i                    ith basis bivector</span>
<span class="sd">        &#39;scalar&#39;        symbol x                 scalar of value x</span>
<span class="sd">                        string s</span>
<span class="sd">        &#39;grade&#39;         [int i, symbol array A]  X.grade(i) = A</span>
<span class="sd">                        [int i, string s]</span>
<span class="sd">        &#39;vector&#39;        symbol array A           X.grade(1) = A</span>
<span class="sd">                        string s</span>
<span class="sd">        &#39;grade2&#39;        symbol array A           X.grade(2) = A</span>
<span class="sd">                        string s</span>
<span class="sd">        &#39;pseudo&#39;        symbol x                 X.grade(n) = x</span>
<span class="sd">                        string s</span>
<span class="sd">        &#39;spinor&#39;        string s                 spinor with coefficients</span>
<span class="sd">                                                 s__indices and name sbm</span>

<span class="sd">        mvname is name of multivector.</span>
<span class="sd">        If fct is &#39;True&#39; and MV.coords is defined in MV.setup then a</span>
<span class="sd">        multivector field of MV.coords is instantiated.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">mvname</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mv</span> <span class="o">=</span> <span class="n">MV</span><span class="o">.</span><span class="n">n1</span><span class="o">*</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bladeflg</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c"># 1 for blade expansion</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">puregrade</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">mvtype</span> <span class="o">==</span> <span class="s">&#39;basisvector&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">MV</span><span class="o">.</span><span class="n">nbasis</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="p">[</span><span class="n">ZERO</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">object</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">value</span><span class="p">]</span> <span class="o">=</span> <span class="n">ONE</span>
        <span class="k">if</span> <span class="n">mvtype</span> <span class="o">==</span> <span class="s">&#39;basisbivector&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">MV</span><span class="o">.</span><span class="n">nbasis</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="p">[</span><span class="n">ZERO</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">object</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">value</span><span class="p">]</span> <span class="o">=</span> <span class="n">ONE</span>
        <span class="k">if</span> <span class="n">mvtype</span> <span class="o">==</span> <span class="s">&#39;scalar&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">Symbol</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">Rational</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">value</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">object</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mvtype</span> <span class="o">==</span> <span class="s">&#39;pseudo&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">Symbol</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">MV</span><span class="o">.</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">value</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">object</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mvtype</span> <span class="o">==</span> <span class="s">&#39;vector&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>  <span class="c"># Most general vector</span>
                <span class="n">symbol_str</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
                <span class="k">for</span> <span class="n">ibase</span> <span class="ow">in</span> <span class="n">MV</span><span class="o">.</span><span class="n">nrg</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">MV</span><span class="o">.</span><span class="n">coords</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="n">symbol</span> <span class="o">=</span> <span class="n">value</span> <span class="o">+</span> <span class="s">&#39;__&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ibase</span> <span class="o">+</span> <span class="n">MV</span><span class="o">.</span><span class="n">index_offset</span><span class="p">)</span>
                        <span class="n">symbol_str</span> <span class="o">+=</span> <span class="n">symbol</span> <span class="o">+</span> <span class="s">&#39; &#39;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">symbol</span> <span class="o">=</span> <span class="n">value</span> <span class="o">+</span> <span class="s">&#39;__&#39;</span> <span class="o">+</span> <span class="p">(</span><span class="n">MV</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="n">ibase</span><span class="p">])</span><span class="o">.</span><span class="n">name</span>
                        <span class="n">symbol_str</span> <span class="o">+=</span> <span class="n">symbol</span> <span class="o">+</span> <span class="s">&#39; &#39;</span>
                <span class="n">symbol_lst</span> <span class="o">=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">symbols</span><span class="p">(</span><span class="n">symbol_str</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">symbol_lst</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">object</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">MV</span><span class="o">.</span><span class="n">pad_zeros</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">MV</span><span class="o">.</span><span class="n">nbasis</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">object</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mvtype</span> <span class="o">==</span> <span class="s">&#39;grade2&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>  <span class="c"># Most general grade-2 multivector</span>
                <span class="k">if</span> <span class="n">value</span> <span class="o">!=</span> <span class="s">&#39;&#39;</span><span class="p">:</span>
                    <span class="n">symbol_str</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
                    <span class="k">for</span> <span class="n">base</span> <span class="ow">in</span> <span class="n">MV</span><span class="o">.</span><span class="n">basis</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
                        <span class="n">symbol</span> <span class="o">=</span> <span class="n">value</span> <span class="o">+</span> <span class="n">MV</span><span class="o">.</span><span class="n">construct_index</span><span class="p">(</span><span class="n">base</span><span class="p">)</span>
                        <span class="n">symbol_str</span> <span class="o">+=</span> <span class="n">symbol</span> <span class="o">+</span> <span class="s">&#39; &#39;</span>
                    <span class="n">symbol_lst</span> <span class="o">=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">symbols</span><span class="p">(</span><span class="n">symbol_str</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">symbol_lst</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">object</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">MV</span><span class="o">.</span><span class="n">pad_zeros</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">MV</span><span class="o">.</span><span class="n">nbasis</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">object</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mvtype</span> <span class="o">==</span> <span class="s">&#39;grade&#39;</span><span class="p">:</span>
            <span class="n">igrade</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">coefs</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">coefs</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>  <span class="c"># Most general pure grade multivector</span>
                <span class="n">base_symbol</span> <span class="o">=</span> <span class="n">coefs</span>
                <span class="n">coefs</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">bases</span> <span class="o">=</span> <span class="n">MV</span><span class="o">.</span><span class="n">basis</span><span class="p">[</span><span class="n">igrade</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">igrade</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                        <span class="p">[</span><span class="n">sympy</span><span class="o">.</span><span class="n">Symbol</span><span class="p">(</span><span class="n">base_symbol</span><span class="p">)],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">object</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">base</span> <span class="ow">in</span> <span class="n">bases</span><span class="p">:</span>
                        <span class="n">coef</span> <span class="o">=</span> <span class="n">base_symbol</span> <span class="o">+</span> <span class="n">MV</span><span class="o">.</span><span class="n">construct_index</span><span class="p">(</span><span class="n">base</span><span class="p">)</span>
                        <span class="n">coef</span> <span class="o">=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">Symbol</span><span class="p">(</span><span class="n">coef</span><span class="p">)</span>
                        <span class="n">coefs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coef</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">igrade</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">coefs</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">object</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">igrade</span><span class="p">]</span> <span class="o">=</span> <span class="n">coefs</span>
        <span class="k">if</span> <span class="n">mvtype</span> <span class="o">==</span> <span class="s">&#39;base&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                <span class="n">MV</span><span class="o">.</span><span class="n">nbasis</span><span class="p">[</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">*</span><span class="p">[</span><span class="n">ZERO</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">object</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">ONE</span>
        <span class="k">if</span> <span class="n">mvtype</span> <span class="o">==</span> <span class="s">&#39;spinor&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>  <span class="c"># Most general spinor</span>
                <span class="k">for</span> <span class="n">grade</span> <span class="ow">in</span> <span class="n">MV</span><span class="o">.</span><span class="n">n1rg</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">grade</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">symbol_str</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
                        <span class="k">if</span> <span class="n">grade</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">symbol_lst</span> <span class="o">=</span> <span class="p">[]</span>
                            <span class="k">for</span> <span class="n">base</span> <span class="ow">in</span> <span class="n">MV</span><span class="o">.</span><span class="n">basis</span><span class="p">[</span><span class="n">grade</span><span class="p">]:</span>
                                <span class="n">symbol</span> <span class="o">=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">Symbol</span><span class="p">(</span>
                                    <span class="n">value</span> <span class="o">+</span> <span class="n">MV</span><span class="o">.</span><span class="n">construct_index</span><span class="p">(</span><span class="n">base</span><span class="p">))</span>
                                <span class="n">symbol_lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">symbol</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">grade</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                                <span class="n">symbol_lst</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">object</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                                <span class="p">[</span><span class="n">sympy</span><span class="o">.</span><span class="n">Symbol</span><span class="p">(</span><span class="n">value</span><span class="p">)],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">object</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">value</span> <span class="o">+</span> <span class="s">&#39;bm&#39;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">mvtype</span> <span class="o">==</span> <span class="s">&#39;&#39;</span><span class="p">:</span>  <span class="c"># Most general multivector</span>
            <span class="k">if</span> <span class="n">value</span> <span class="o">!=</span> <span class="s">&#39;&#39;</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">grade</span> <span class="ow">in</span> <span class="n">MV</span><span class="o">.</span><span class="n">n1rg</span><span class="p">:</span>
                    <span class="n">symbol_str</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
                    <span class="k">if</span> <span class="n">grade</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">symbol_lst</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="k">for</span> <span class="n">base</span> <span class="ow">in</span> <span class="n">MV</span><span class="o">.</span><span class="n">basis</span><span class="p">[</span><span class="n">grade</span><span class="p">]:</span>
                            <span class="n">symbol</span> <span class="o">=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">Symbol</span><span class="p">(</span>
                                <span class="n">value</span> <span class="o">+</span> <span class="n">MV</span><span class="o">.</span><span class="n">construct_index</span><span class="p">(</span><span class="n">base</span><span class="p">))</span>
                            <span class="n">symbol_lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">symbol</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">grade</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                            <span class="n">symbol_lst</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">object</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                            <span class="p">[</span><span class="n">sympy</span><span class="o">.</span><span class="n">Symbol</span><span class="p">(</span><span class="n">value</span><span class="p">)],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">object</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">value</span> <span class="o">+</span> <span class="s">&#39;bm&#39;</span>
        <span class="k">if</span> <span class="n">fct</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">vars</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="nb">vars</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">vars</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">grade</span> <span class="ow">in</span> <span class="n">MV</span><span class="o">.</span><span class="n">n1rg</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">grade</span><span class="p">],</span> <span class="nb">int</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">grade</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">coef</span> <span class="o">=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">galgebra</span><span class="o">.</span><span class="n">latex_ex</span><span class="o">.</span><span class="n">LatexPrinter</span><span class="o">.</span><span class="n">str_basic</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                        <span class="k">if</span> <span class="nb">vars</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">MV</span><span class="o">.</span><span class="n">coords</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">sympy</span><span class="o">.</span><span class="n">Function</span><span class="p">(</span>
                                <span class="n">coef</span><span class="p">)(</span><span class="o">*</span><span class="n">MV</span><span class="o">.</span><span class="n">coords</span><span class="p">)],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">object</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">sympy</span><span class="o">.</span><span class="n">Function</span><span class="p">(</span>
                                <span class="n">coef</span><span class="p">)(</span><span class="o">*</span><span class="nb">vars</span><span class="p">)],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">object</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">base</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">MV</span><span class="o">.</span><span class="n">nbasis</span><span class="p">[</span><span class="n">grade</span><span class="p">]):</span>
                            <span class="n">coef</span> <span class="o">=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">galgebra</span><span class="o">.</span><span class="n">latex_ex</span><span class="o">.</span><span class="n">LatexPrinter</span><span class="o">.</span><span class="n">str_basic</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">grade</span><span class="p">][</span><span class="n">base</span><span class="p">])</span>
                            <span class="k">if</span> <span class="nb">vars</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">MV</span><span class="o">.</span><span class="n">coords</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">grade</span><span class="p">][</span>
                                    <span class="n">base</span><span class="p">]</span> <span class="o">=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">Function</span><span class="p">(</span><span class="n">coef</span><span class="p">)(</span><span class="o">*</span><span class="n">MV</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span>
                                    <span class="n">grade</span><span class="p">][</span><span class="n">base</span><span class="p">]</span> <span class="o">=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">Function</span><span class="p">(</span><span class="n">coef</span><span class="p">)(</span><span class="o">*</span><span class="nb">vars</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">construct_index</span><span class="p">(</span><span class="n">base</span><span class="p">):</span>
        <span class="n">index_str</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">base</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">MV</span><span class="o">.</span><span class="n">coords</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ix</span> <span class="ow">in</span> <span class="n">base</span><span class="p">:</span>
                <span class="n">index_str</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">ix</span> <span class="o">+</span> <span class="n">MV</span><span class="o">.</span><span class="n">index_offset</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ix</span> <span class="ow">in</span> <span class="n">base</span><span class="p">:</span>
                <span class="n">index_str</span> <span class="o">+=</span> <span class="p">(</span><span class="n">MV</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="n">ix</span><span class="p">])</span><span class="o">.</span><span class="n">name</span>
        <span class="k">return</span><span class="p">(</span><span class="s">&#39;__&#39;</span> <span class="o">+</span> <span class="n">index_str</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">namestr</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">namestr</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">max_grade</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        X.max_grade() is maximum grade of non-zero grades of X.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">MV</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                <span class="k">return</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">coord</span><span class="p">(</span><span class="n">xname</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="n">xi_str</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">MV</span><span class="o">.</span><span class="n">nrg</span><span class="p">:</span>
            <span class="n">xi_str</span> <span class="o">+=</span> <span class="n">xname</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="n">offset</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39; &#39;</span>
        <span class="n">xi</span> <span class="o">=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">symbols</span><span class="p">(</span><span class="n">xi_str</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">MV</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="s">&#39;vector&#39;</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">x</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">isint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="k">return</span><span class="p">(</span><span class="n">ZERO</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">set_coef</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">grade</span><span class="p">,</span> <span class="n">base</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">grade</span><span class="p">],</span> <span class="nb">int</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">grade</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                <span class="n">MV</span><span class="o">.</span><span class="n">nbasis</span><span class="p">[</span><span class="n">grade</span><span class="p">]</span><span class="o">*</span><span class="p">[</span><span class="n">ZERO</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">object</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">grade</span><span class="p">][</span><span class="n">base</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">return</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">named</span><span class="p">(</span><span class="n">mvname</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">mvtype</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">mvname</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="n">MV</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">,</span> <span class="n">mvtype</span><span class="o">=</span><span class="n">mvtype</span><span class="p">,</span> <span class="n">mvname</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">__name__</span><span class="p">],</span> <span class="n">name</span><span class="p">,</span> <span class="n">tmp</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">printnm</span><span class="p">(</span><span class="n">tpl</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">tpl</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">a</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&#39; =&#39;</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">mv</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span><span class="p">(</span><span class="n">MV</span><span class="o">.</span><span class="n">str_rep</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">printmv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="n">title</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="k">if</span> <span class="n">name</span><span class="p">:</span>
            <span class="n">title</span> <span class="o">+=</span> <span class="n">name</span> <span class="o">+</span> <span class="s">&#39; = &#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
                <span class="n">title</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s">&#39; = &#39;</span>
        <span class="k">print</span> <span class="n">title</span> <span class="o">+</span> <span class="n">MV</span><span class="o">.</span><span class="n">str_rep</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">set_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">igrade</span><span class="p">,</span> <span class="n">ibase</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">igrade</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">igrade</span><span class="p">][</span><span class="n">ibase</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">igrade</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                <span class="n">MV</span><span class="o">.</span><span class="n">nbasis</span><span class="p">[</span><span class="n">igrade</span><span class="p">]</span><span class="o">*</span><span class="p">[</span><span class="n">ZERO</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">object</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">igrade</span><span class="p">][</span><span class="n">ibase</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">add_in_place</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mv</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        X.add_in_place(mv) increments multivector X by multivector</span>
<span class="sd">        mv.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bladeflg</span> <span class="ow">or</span> <span class="n">mv</span><span class="o">.</span><span class="n">bladeflg</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">convert_to_blades</span><span class="p">()</span>
            <span class="n">mv</span><span class="o">.</span><span class="n">convert_to_blades</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">MV</span><span class="o">.</span><span class="n">n1rg</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mv</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">mv</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mv</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">+</span><span class="n">mv</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">sub_in_place</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mv</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        X.sub_in_place(mv) decrements multivector X by multivector</span>
<span class="sd">        mv.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bladeflg</span> <span class="ow">or</span> <span class="n">mv</span><span class="o">.</span><span class="n">bladeflg</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">convert_to_blades</span><span class="p">()</span>
            <span class="n">mv</span><span class="o">.</span><span class="n">convert_to_blades</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">MV</span><span class="o">.</span><span class="n">n1rg</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mv</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-=</span> <span class="n">mv</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mv</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">+</span><span class="n">mv</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">__pos__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">MV</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">bladeflg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bladeflg</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">MV</span><span class="o">.</span><span class="n">n1rg</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                <span class="n">p</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">return</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__neg__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">MV</span><span class="p">()</span>
        <span class="n">n</span><span class="o">.</span><span class="n">bladeflg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bladeflg</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">MV</span><span class="o">.</span><span class="n">n1rg</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                <span class="n">n</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">return</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__add_ab__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mv</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_in_place</span><span class="p">(</span><span class="n">mv</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">__sub_ab__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mv</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sub_in_place</span><span class="p">(</span><span class="n">mv</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mv</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;See MV.addition(self,mv)&quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="n">MV</span><span class="o">.</span><span class="n">addition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mv</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__radd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mv</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;See MV.addition(mv,self)&quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="n">MV</span><span class="o">.</span><span class="n">addition</span><span class="p">(</span><span class="n">mv</span><span class="p">,</span> <span class="bp">self</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mv</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;See MV.subtraction(self,mv)&quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="n">MV</span><span class="o">.</span><span class="n">subtraction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mv</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__rsub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mv</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;See MV.subtraction(mv,self)&quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="n">MV</span><span class="o">.</span><span class="n">subtraction</span><span class="p">(</span><span class="n">mv</span><span class="p">,</span> <span class="bp">self</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__xor__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mv</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;See MV.outer_product(self,mv)&quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="n">MV</span><span class="o">.</span><span class="n">outer_product</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mv</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__pow__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mv</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;See MV.outer_product(self,mv)&quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="n">MV</span><span class="o">.</span><span class="n">outer_product</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mv</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__rxor__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mv</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;See MV.outer_product(mv,self)&quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="n">MV</span><span class="o">.</span><span class="n">outer_product</span><span class="p">(</span><span class="n">mv</span><span class="p">,</span> <span class="bp">self</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__or__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mv</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;See MV.inner_product(self,mv)&quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="n">MV</span><span class="o">.</span><span class="n">inner_product</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mv</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__ror__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mv</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;See MV.inner_product(mv,self)&quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="n">MV</span><span class="o">.</span><span class="n">inner_product</span><span class="p">(</span><span class="n">mv</span><span class="p">,</span> <span class="bp">self</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mv</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;See MV.inner_product(self,mv)&quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="n">MV</span><span class="o">.</span><span class="n">inner_product</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mv</span><span class="p">,</span> <span class="s">&#39;l&#39;</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__lshift__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mv</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;See MV.inner_product(self,mv)&quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="n">MV</span><span class="o">.</span><span class="n">inner_product</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mv</span><span class="p">,</span> <span class="s">&#39;l&#39;</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__rlshift__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mv</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;See MV.inner_product(self,mv)&quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="n">MV</span><span class="o">.</span><span class="n">inner_product</span><span class="p">(</span><span class="n">mv</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="s">&#39;l&#39;</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">lc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mv</span><span class="p">):</span>
        <span class="k">return</span><span class="p">(</span><span class="n">MV</span><span class="o">.</span><span class="n">inner_product</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mv</span><span class="p">,</span> <span class="s">&#39;l&#39;</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__gt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mv</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;See MV.inner_product(self,mv)&quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="n">MV</span><span class="o">.</span><span class="n">inner_product</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mv</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__rshift__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mv</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;See MV.inner_product(self,mv)&quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="n">MV</span><span class="o">.</span><span class="n">inner_product</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mv</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__rrshift__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mv</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;See MV.inner_product(self,mv)&quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="n">MV</span><span class="o">.</span><span class="n">inner_product</span><span class="p">(</span><span class="n">mv</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">rc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mv</span><span class="p">):</span>
        <span class="k">return</span><span class="p">(</span><span class="n">MV</span><span class="o">.</span><span class="n">inner_product</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mv</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">scalar_mul</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Y = X.scalar_mul(c), multiply multivector X by scalar c and return</span>
<span class="sd">        result.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mv</span> <span class="o">=</span> <span class="n">MV</span><span class="p">()</span>
        <span class="n">mv</span><span class="o">.</span><span class="n">bladeflg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bladeflg</span>
        <span class="n">mv</span><span class="o">.</span><span class="n">puregrade</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">puregrade</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">MV</span><span class="o">.</span><span class="n">n1rg</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                <span class="c">#print self.mv[i]</span>
                <span class="c">#print c,type(c)</span>
                <span class="n">mv</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">c</span>
        <span class="k">return</span><span class="p">(</span><span class="n">mv</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">scalar_mul_inplace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        X.scalar_mul_inplace(c), multiply multivector X by scalar c and save</span>
<span class="sd">        result in X.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">MV</span><span class="o">.</span><span class="n">n1rg</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">c</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mv</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;See MV.geometric_product(self,mv)&quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="n">MV</span><span class="o">.</span><span class="n">geometric_product</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mv</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__rmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mv</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;See MV.geometric_product(mv,self)&quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="n">MV</span><span class="o">.</span><span class="n">geometric_product</span><span class="p">(</span><span class="n">mv</span><span class="p">,</span> <span class="bp">self</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__div__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scalar</span><span class="p">):</span>
        <span class="n">div</span> <span class="o">=</span> <span class="n">MV</span><span class="p">()</span>
        <span class="n">div</span><span class="o">.</span><span class="n">bladeflg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bladeflg</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">MV</span><span class="o">.</span><span class="n">n1rg</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                <span class="n">div</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="n">scalar</span>
        <span class="k">return</span><span class="p">(</span><span class="n">div</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__div_ab__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scalar</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">MV</span><span class="o">.</span><span class="n">n1rg</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/=</span> <span class="n">scalar</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">igrade</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ibase</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        X(i,j) returns symbol in ith grade and jth base or blade of</span>
<span class="sd">        multivector X.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">igrade</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="k">return</span><span class="p">(</span><span class="n">ZERO</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">igrade</span><span class="p">][</span><span class="n">ibase</span><span class="p">])</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">equal</span><span class="p">(</span><span class="n">mv1</span><span class="p">,</span> <span class="n">mv2</span><span class="p">):</span>
        <span class="n">mv1</span><span class="o">.</span><span class="n">compact</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mv2</span><span class="p">,</span> <span class="n">MV</span><span class="p">):</span>
            <span class="n">mv2</span><span class="o">.</span><span class="n">compact</span><span class="p">()</span>
        <span class="n">pure_grade</span> <span class="o">=</span> <span class="n">mv1</span><span class="o">.</span><span class="n">is_pure</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mv2</span><span class="p">,</span> <span class="n">MV</span><span class="p">)</span> <span class="ow">and</span> <span class="n">pure_grade</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mv2</span><span class="p">,</span> <span class="n">MV</span><span class="p">)</span> <span class="ow">and</span> <span class="n">pure_grade</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mv1</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">int</span><span class="p">):</span>
                <span class="k">return</span><span class="p">(</span><span class="n">mv2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span><span class="p">(</span><span class="n">mv1</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">mv2</span><span class="p">)</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">mvi</span><span class="p">,</span> <span class="n">mvj</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">mv1</span><span class="o">.</span><span class="n">mv</span><span class="p">,</span> <span class="n">mv2</span><span class="o">.</span><span class="n">mv</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">isint</span><span class="p">(</span><span class="n">mvi</span><span class="p">)</span> <span class="o">^</span> <span class="n">isint</span><span class="p">(</span><span class="n">mvj</span><span class="p">):</span>
                <span class="k">return</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mvi</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mvj</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                <span class="k">for</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">mvi</span><span class="p">,</span> <span class="n">mvj</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">x</span> <span class="o">!=</span> <span class="n">y</span><span class="p">:</span>
                        <span class="k">return</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mv</span><span class="p">):</span>
        <span class="k">return</span><span class="p">(</span><span class="n">MV</span><span class="o">.</span><span class="n">equal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mv</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sub</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Y = X.copy(), make a deep copy of multivector X in multivector</span>
<span class="sd">        Y so that Y can be modified without affecting X.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cpy</span> <span class="o">=</span> <span class="n">MV</span><span class="p">()</span>
        <span class="n">cpy</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
        <span class="n">cpy</span><span class="o">.</span><span class="n">bladeflg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bladeflg</span>
        <span class="n">cpy</span><span class="o">.</span><span class="n">puregrade</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">puregrade</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">MV</span><span class="o">.</span><span class="n">n1rg</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">sub</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                    <span class="n">cpy</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                    <span class="n">cpy</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">return</span><span class="p">(</span><span class="n">cpy</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">substitute_base</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">igrade</span><span class="p">,</span> <span class="n">base</span><span class="p">,</span> <span class="n">mv</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">igrade</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">ibase</span> <span class="o">=</span> <span class="n">MV</span><span class="o">.</span><span class="n">basis</span><span class="p">[</span><span class="n">igrade</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">base</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ibase</span> <span class="o">=</span> <span class="n">base</span>
        <span class="n">coef</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">igrade</span><span class="p">][</span><span class="n">ibase</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">coef</span> <span class="o">==</span> <span class="n">ZERO</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">igrade</span><span class="p">][</span><span class="n">ibase</span><span class="p">]</span> <span class="o">=</span> <span class="n">ZERO</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_in_place</span><span class="p">(</span><span class="n">mv</span><span class="o">*</span><span class="n">coef</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">convert_to_blades</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        X.convert_to_blades(), inplace convert base representation</span>
<span class="sd">        to blade representation.  See reference 5 section 5.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bladeflg</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bladeflg</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">igrade</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">MV</span><span class="o">.</span><span class="n">n1</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">igrade</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">ibase</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">MV</span><span class="o">.</span><span class="n">nbasis</span><span class="p">[</span><span class="n">igrade</span><span class="p">]):</span>
                    <span class="n">coef</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">igrade</span><span class="p">][</span><span class="n">ibase</span><span class="p">]</span>
                    <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">coef</span> <span class="o">==</span> <span class="n">ZERO</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">igrade</span><span class="p">][</span><span class="n">ibase</span><span class="p">]</span> <span class="o">=</span> <span class="n">ZERO</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">add_in_place</span><span class="p">(</span><span class="n">MV</span><span class="o">.</span><span class="n">ibtable</span><span class="p">[</span><span class="n">igrade</span><span class="p">][</span><span class="n">ibase</span><span class="p">]</span><span class="o">*</span><span class="n">coef</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">convert_from_blades</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        X.convert_from_blades(), inplace convert blade representation</span>
<span class="sd">        to base representation.  See reference 5 section 5.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">bladeflg</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bladeflg</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">igrade</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">MV</span><span class="o">.</span><span class="n">n1</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">igrade</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">ibase</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">MV</span><span class="o">.</span><span class="n">nbasis</span><span class="p">[</span><span class="n">igrade</span><span class="p">]):</span>
                    <span class="n">coef</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">igrade</span><span class="p">][</span><span class="n">ibase</span><span class="p">]</span>
                    <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">coef</span> <span class="o">==</span> <span class="n">ZERO</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">igrade</span><span class="p">][</span><span class="n">ibase</span><span class="p">]</span> <span class="o">=</span> <span class="n">ZERO</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">add_in_place</span><span class="p">(</span><span class="n">MV</span><span class="o">.</span><span class="n">btable</span><span class="p">[</span><span class="n">igrade</span><span class="p">][</span><span class="n">ibase</span><span class="p">]</span><span class="o">*</span><span class="n">coef</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">project</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Grade projection operator. For multivector X, X.project(r)</span>
<span class="sd">        returns multivector of grade r components of X if r is an</span>
<span class="sd">        integer. If r is a multivector X.project(r) returns a</span>
<span class="sd">        multivector consisting of the grade of X for which r has non-</span>
<span class="sd">        zero grades. For example if X is a general multivector and</span>
<span class="sd">        r is a general spinor then X.project(r) will return the even</span>
<span class="sd">        grades of X.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">grade_r</span> <span class="o">=</span> <span class="n">MV</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">r</span> <span class="o">&gt;</span> <span class="n">MV</span><span class="o">.</span><span class="n">n</span><span class="p">:</span>
                <span class="k">return</span><span class="p">(</span><span class="n">grade_r</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">convert_to_blades</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">r</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                <span class="k">return</span><span class="p">(</span><span class="n">grade_r</span><span class="p">)</span>
            <span class="n">grade_r</span><span class="o">.</span><span class="n">bladeflg</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">grade_r</span><span class="o">.</span><span class="n">puregrade</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">grade_r</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">r</span><span class="p">]</span> <span class="o">=</span> <span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">r</span><span class="p">]</span>
            <span class="k">return</span><span class="p">(</span><span class="n">grade_r</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">MV</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">convert_to_blades</span><span class="p">()</span>
            <span class="n">r</span><span class="o">.</span><span class="n">convert_to_blades</span><span class="p">()</span>
            <span class="n">proj</span> <span class="o">=</span> <span class="n">MV</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">MV</span><span class="o">.</span><span class="n">n1rg</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="nb">int</span><span class="p">):</span>
                    <span class="n">proj</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">proj</span><span class="o">.</span><span class="n">bladeflg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bladeflg</span>
            <span class="k">return</span><span class="p">(</span><span class="n">proj</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">even</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Even grade projection operator. For multivector X, X.even()</span>
<span class="sd">        returns multivector of even grade components of X.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">egrades</span> <span class="o">=</span> <span class="n">MV</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">convert_to_blades</span><span class="p">()</span>
        <span class="n">egrades</span><span class="o">.</span><span class="n">bladeflg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bladeflg</span>
        <span class="n">egrades</span><span class="o">.</span><span class="n">puregrade</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">puregrade</span>
        <span class="k">for</span> <span class="n">igrade</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">MV</span><span class="o">.</span><span class="n">n1</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
            <span class="n">egrades</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">igrade</span><span class="p">]</span> <span class="o">=</span> <span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">igrade</span><span class="p">]</span>
        <span class="k">return</span><span class="p">(</span><span class="n">egrades</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">odd</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Odd grade projection operator. For multivector X, X.odd()</span>
<span class="sd">        returns multivector of odd grade components of X.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ogrades</span> <span class="o">=</span> <span class="n">MV</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">convert_to_blades</span><span class="p">()</span>
        <span class="n">ogrades</span><span class="o">.</span><span class="n">bladeflg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bladeflg</span>
        <span class="n">ogrades</span><span class="o">.</span><span class="n">puregrade</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">puregrade</span>
        <span class="k">for</span> <span class="n">igrade</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">MV</span><span class="o">.</span><span class="n">n1</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
            <span class="n">ogrades</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">igrade</span><span class="p">]</span> <span class="o">=</span> <span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">igrade</span><span class="p">]</span>
        <span class="k">return</span><span class="p">(</span><span class="n">ogrades</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">rev</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Revision operator. For multivector X, X.rev()</span>
<span class="sd">        returns reversed multivector of X.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">revmv</span> <span class="o">=</span> <span class="n">MV</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">convert_to_blades</span><span class="p">()</span>
        <span class="n">revmv</span><span class="o">.</span><span class="n">bladeflg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bladeflg</span>
        <span class="n">revmv</span><span class="o">.</span><span class="n">puregrade</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">puregrade</span>
        <span class="k">for</span> <span class="n">igrade</span> <span class="ow">in</span> <span class="n">MV</span><span class="o">.</span><span class="n">n1rg</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">igrade</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">igrade</span> <span class="o">&lt;</span> <span class="mi">2</span> <span class="ow">or</span> <span class="p">(</span><span class="ow">not</span> <span class="p">(((</span><span class="n">igrade</span><span class="o">*</span><span class="p">(</span><span class="n">igrade</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span><span class="p">)):</span>
                    <span class="n">revmv</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">igrade</span><span class="p">]</span> <span class="o">=</span> <span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">igrade</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">revmv</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">igrade</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">igrade</span><span class="p">]</span>
        <span class="k">return</span><span class="p">(</span><span class="n">revmv</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">cse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">grade</span><span class="p">):</span>
        <span class="n">cse_lst</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">grade</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">ibase</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">MV</span><span class="o">.</span><span class="n">nbasis</span><span class="p">[</span><span class="n">grade</span><span class="p">]):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">grade</span><span class="p">][</span><span class="n">ibase</span><span class="p">]</span> <span class="o">!=</span> <span class="n">ZERO</span><span class="p">:</span>
                    <span class="n">cse_lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sympy</span><span class="o">.</span><span class="n">cse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">grade</span><span class="p">][</span><span class="n">ibase</span><span class="p">]))</span>
        <span class="k">return</span><span class="p">(</span><span class="n">cse_lst</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">div</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">grade</span><span class="p">,</span> <span class="n">divisor</span><span class="p">):</span>
        <span class="n">div_lst</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">grade</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">ibase</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">MV</span><span class="o">.</span><span class="n">nbasis</span><span class="p">[</span><span class="n">grade</span><span class="p">]):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">grade</span><span class="p">][</span><span class="n">ibase</span><span class="p">]</span> <span class="o">!=</span> <span class="n">ZERO</span><span class="p">:</span>
                    <span class="n">div_lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">grade</span><span class="p">][</span><span class="n">ibase</span><span class="p">]</span><span class="o">.</span><span class="n">as_coefficient</span><span class="p">(</span><span class="n">divisor</span><span class="p">))</span>
        <span class="k">return</span><span class="p">(</span><span class="n">div_lst</span><span class="p">)</span>

    <span class="c"># don&#39;t know which one is correctly named</span>

    <span class="k">def</span> <span class="nf">div</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">grad_int</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">collect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lst</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Applies sympy collect function to each component</span>
<span class="sd">        of multivector.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">igrade</span> <span class="ow">in</span> <span class="n">MV</span><span class="o">.</span><span class="n">n1rg</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">igrade</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">ibase</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">MV</span><span class="o">.</span><span class="n">nbasis</span><span class="p">[</span><span class="n">igrade</span><span class="p">]):</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">igrade</span><span class="p">][</span><span class="n">ibase</span><span class="p">]</span> <span class="o">!=</span> <span class="n">ZERO</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">igrade</span><span class="p">][</span><span class="n">ibase</span><span class="p">]</span> <span class="o">=</span> \
                            <span class="n">sympy</span><span class="o">.</span><span class="n">collect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">igrade</span><span class="p">][</span><span class="n">ibase</span><span class="p">],</span> <span class="n">lst</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">sqrfree</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lst</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Applies sympy sqrfree function to each component</span>
<span class="sd">        of multivector.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">igrade</span> <span class="ow">in</span> <span class="n">MV</span><span class="o">.</span><span class="n">n1rg</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">igrade</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">ibase</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">MV</span><span class="o">.</span><span class="n">nbasis</span><span class="p">[</span><span class="n">igrade</span><span class="p">]):</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">igrade</span><span class="p">][</span><span class="n">ibase</span><span class="p">]</span> <span class="o">!=</span> <span class="n">ZERO</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">igrade</span><span class="p">][</span><span class="n">ibase</span><span class="p">]</span> <span class="o">=</span> \
                            <span class="n">sympy</span><span class="o">.</span><span class="n">sqrfree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">igrade</span><span class="p">][</span><span class="n">ibase</span><span class="p">],</span> <span class="n">lst</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">flatten</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">flst</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">igrade</span> <span class="ow">in</span> <span class="n">MV</span><span class="o">.</span><span class="n">n1rg</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">igrade</span><span class="p">],</span> <span class="nb">int</span><span class="p">):</span>
                <span class="n">flst</span> <span class="o">+=</span> <span class="n">MV</span><span class="o">.</span><span class="n">nbasis</span><span class="p">[</span><span class="n">igrade</span><span class="p">]</span><span class="o">*</span><span class="p">[</span><span class="n">ZERO</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">coef</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">igrade</span><span class="p">]:</span>
                    <span class="n">flst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coef</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="n">flst</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">subs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">MV</span><span class="p">()</span>
        <span class="n">X</span><span class="o">.</span><span class="n">bladeflg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bladeflg</span>
        <span class="n">X</span><span class="o">.</span><span class="n">puregrade</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">puregrade</span>
        <span class="k">for</span> <span class="n">igrade</span> <span class="ow">in</span> <span class="n">MV</span><span class="o">.</span><span class="n">n1rg</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">igrade</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                <span class="n">X</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">igrade</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                    <span class="n">substitute_array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">igrade</span><span class="p">],</span> <span class="o">*</span><span class="n">args</span><span class="p">))</span>
        <span class="k">return</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">sub_mv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mv1</span><span class="p">,</span> <span class="n">mv2</span><span class="p">):</span>
        <span class="n">mv1_flat</span> <span class="o">=</span> <span class="n">mv1</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="n">mv2_flat</span> <span class="o">=</span> <span class="n">mv2</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sub_scalar</span><span class="p">(</span><span class="n">mv1_flat</span><span class="p">,</span> <span class="n">mv2_flat</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">sub_scalar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr1</span><span class="p">,</span> <span class="n">expr2</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">expr1</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">expr2</span><span class="p">,</span> <span class="nb">list</span><span class="p">))</span> <span class="ow">or</span> \
           <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">expr1</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">expr2</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">var1</span><span class="p">,</span> <span class="n">var2</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">expr1</span><span class="p">,</span> <span class="n">expr2</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sub_scalar</span><span class="p">(</span><span class="n">var1</span><span class="p">,</span> <span class="n">var2</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">igrade</span> <span class="ow">in</span> <span class="n">MV</span><span class="o">.</span><span class="n">n1rg</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">igrade</span><span class="p">],</span> <span class="nb">int</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">ibase</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">MV</span><span class="o">.</span><span class="n">nbasis</span><span class="p">[</span><span class="n">igrade</span><span class="p">]):</span>
                        <span class="k">if</span> <span class="n">expr1</span> <span class="o">!=</span> <span class="n">ZERO</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">igrade</span><span class="p">][</span><span class="n">ibase</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span>
                                <span class="n">igrade</span><span class="p">][</span><span class="n">ibase</span><span class="p">]</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">expr1</span><span class="p">,</span> <span class="n">expr2</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">simplify</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Applies sympy simplify function</span>
<span class="sd">        to each component of multivector.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">igrade</span> <span class="ow">in</span> <span class="n">MV</span><span class="o">.</span><span class="n">n1rg</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">igrade</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">ibase</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">MV</span><span class="o">.</span><span class="n">nbasis</span><span class="p">[</span><span class="n">igrade</span><span class="p">]):</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">igrade</span><span class="p">][</span><span class="n">ibase</span><span class="p">]</span> <span class="o">!=</span> <span class="n">ZERO</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">igrade</span><span class="p">][</span><span class="n">ibase</span><span class="p">]</span> <span class="o">=</span> \
                            <span class="n">sympy</span><span class="o">.</span><span class="n">simplify</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">igrade</span><span class="p">][</span><span class="n">ibase</span><span class="p">])</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">trigsimp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Applies sympy trigsimp function</span>
<span class="sd">        to each component of multivector</span>
<span class="sd">        using the recursive option.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">igrade</span> <span class="ow">in</span> <span class="n">MV</span><span class="o">.</span><span class="n">n1rg</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">igrade</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">ibase</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">MV</span><span class="o">.</span><span class="n">nbasis</span><span class="p">[</span><span class="n">igrade</span><span class="p">]):</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">igrade</span><span class="p">][</span><span class="n">ibase</span><span class="p">]</span> <span class="o">!=</span> <span class="n">ZERO</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">igrade</span><span class="p">][</span><span class="n">ibase</span><span class="p">]</span> <span class="o">=</span> \
                            <span class="n">sympy</span><span class="o">.</span><span class="n">trigsimp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">igrade</span><span class="p">]</span>
                                           <span class="p">[</span><span class="n">ibase</span><span class="p">],</span> <span class="n">deep</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">cancel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Applies sympy cancel function</span>
<span class="sd">        to each component of multivector.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">igrade</span> <span class="ow">in</span> <span class="n">MV</span><span class="o">.</span><span class="n">n1rg</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">igrade</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">ibase</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">MV</span><span class="o">.</span><span class="n">nbasis</span><span class="p">[</span><span class="n">igrade</span><span class="p">]):</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">igrade</span><span class="p">][</span><span class="n">ibase</span><span class="p">]</span> <span class="o">!=</span> <span class="n">ZERO</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">igrade</span><span class="p">][</span><span class="n">ibase</span><span class="p">]</span> <span class="o">=</span> \
                            <span class="n">sympy</span><span class="o">.</span><span class="n">cancel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">igrade</span><span class="p">][</span><span class="n">ibase</span><span class="p">])</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">expand</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Applies sympy expand function to each component</span>
<span class="sd">        of multivector.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">igrade</span> <span class="ow">in</span> <span class="n">MV</span><span class="o">.</span><span class="n">n1rg</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">igrade</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">ibase</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">MV</span><span class="o">.</span><span class="n">nbasis</span><span class="p">[</span><span class="n">igrade</span><span class="p">]):</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">igrade</span><span class="p">][</span><span class="n">ibase</span><span class="p">]</span> <span class="o">!=</span> <span class="n">ZERO</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">igrade</span><span class="p">][</span><span class="n">ibase</span><span class="p">]</span> <span class="o">=</span> \
                            <span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">igrade</span><span class="p">][</span><span class="n">ibase</span><span class="p">]</span><span class="o">.</span><span class="n">expand</span><span class="p">()</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">is_pure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">igrade</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">ngrade</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compact</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">MV</span><span class="o">.</span><span class="n">n1rg</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">base</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">base</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">igrade</span> <span class="o">=</span> <span class="n">i</span>
                        <span class="n">ngrade</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="k">break</span>
                <span class="k">if</span> <span class="n">ngrade</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">return</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">igrade</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="n">igrade</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">is_scalar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_pure</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">compact</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert zero numpy arrays to single integer zero place holder</span>
<span class="sd">        in grade list for instantiated multivector. For example if</span>
<span class="sd">        numpy array of grade one components is a zero array then replace</span>
<span class="sd">        with single integer equal to zero.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">MV</span><span class="o">.</span><span class="n">n1rg</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">isint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">i</span><span class="p">]):</span>
                <span class="n">zero_flg</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">x</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">zero_flg</span> <span class="o">=</span> <span class="bp">False</span>
                        <span class="k">break</span>
                <span class="k">if</span> <span class="n">zero_flg</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">diff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate partial derivative of multivector with respect to</span>
<span class="sd">        argument x.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">D</span> <span class="o">=</span> <span class="n">MV</span><span class="p">()</span>
        <span class="n">igrade</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">grade</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">grade</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                <span class="n">D</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">igrade</span><span class="p">]</span> <span class="o">=</span> <span class="n">MV</span><span class="o">.</span><span class="n">vdiff</span><span class="p">(</span><span class="n">grade</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
            <span class="n">igrade</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span><span class="p">(</span><span class="n">D</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">ddt</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">MV</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">Symbol</span><span class="p">(</span><span class="s">&#39;t&#39;</span><span class="p">):</span>
            <span class="k">return</span><span class="p">(</span><span class="n">MV</span><span class="p">())</span>
        <span class="n">dxdt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">MV</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">ibase</span> <span class="ow">in</span> <span class="n">MV</span><span class="o">.</span><span class="n">nrg</span><span class="p">:</span>
            <span class="n">dxdt</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">ibase</span><span class="p">]</span><span class="o">*</span><span class="n">MV</span><span class="o">.</span><span class="n">dedt</span><span class="p">[</span><span class="n">ibase</span><span class="p">]</span>
        <span class="c">#dxdt.simplify()</span>
        <span class="c">#dxdt.trigsimp()</span>
        <span class="k">return</span><span class="p">(</span><span class="n">dxdt</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">grad</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate geometric (grad) derivative of multivector function</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">D</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">dD</span> <span class="o">=</span> <span class="n">MV</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">theta</span> <span class="ow">in</span> <span class="n">MV</span><span class="o">.</span><span class="n">coords</span><span class="p">:</span>
            <span class="n">D</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">theta</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">MV</span><span class="o">.</span><span class="n">curvilinear_flg</span><span class="p">:</span>
            <span class="n">recp</span> <span class="o">=</span> <span class="n">MV</span><span class="o">.</span><span class="n">Rframe</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">recp</span> <span class="o">=</span> <span class="n">MV</span><span class="o">.</span><span class="n">brecp</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">rbase</span><span class="p">,</span> <span class="n">iD</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">recp</span><span class="p">,</span> <span class="n">D</span><span class="p">):</span>
            <span class="n">dD</span><span class="o">.</span><span class="n">add_in_place</span><span class="p">(</span><span class="n">rbase</span><span class="o">*</span><span class="n">iD</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">MV</span><span class="o">.</span><span class="n">curvilinear_flg</span><span class="p">:</span>  <span class="c"># Add Connection</span>
            <span class="n">igrade</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">while</span> <span class="n">igrade</span> <span class="o">&lt;=</span> <span class="n">MV</span><span class="o">.</span><span class="n">n</span><span class="p">:</span>
                <span class="n">coefs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">igrade</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">coefs</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">int</span><span class="p">:</span>
                    <span class="k">for</span> <span class="p">(</span><span class="n">coef</span><span class="p">,</span> <span class="n">connect</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">coefs</span><span class="p">,</span> <span class="n">MV</span><span class="o">.</span><span class="n">Connect</span><span class="p">[</span><span class="n">igrade</span><span class="p">]):</span>
                        <span class="n">dD</span><span class="o">.</span><span class="n">add_in_place</span><span class="p">(</span><span class="n">coef</span><span class="o">*</span><span class="n">connect</span><span class="p">)</span>
                <span class="n">igrade</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span><span class="p">(</span><span class="n">dD</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">grad_ext</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate outer (exterior,curl) derivative of multivector function.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">D</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">dD</span> <span class="o">=</span> <span class="n">MV</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">ix</span> <span class="ow">in</span> <span class="n">MV</span><span class="o">.</span><span class="n">coords</span><span class="p">:</span>
            <span class="n">D</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">ix</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">MV</span><span class="o">.</span><span class="n">curvilinear_flg</span><span class="p">:</span>
            <span class="n">recp</span> <span class="o">=</span> <span class="n">MV</span><span class="o">.</span><span class="n">Rframe</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">recp</span> <span class="o">=</span> <span class="n">MV</span><span class="o">.</span><span class="n">brecp</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">irbase</span><span class="p">,</span> <span class="n">iD</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">recp</span><span class="p">,</span> <span class="n">D</span><span class="p">):</span>
            <span class="n">dD</span><span class="o">.</span><span class="n">add_in_place</span><span class="p">(</span><span class="n">irbase</span> <span class="o">^</span> <span class="n">iD</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">MV</span><span class="o">.</span><span class="n">curvilinear_flg</span><span class="p">:</span>  <span class="c"># Add Connection</span>
            <span class="n">igrade</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">while</span> <span class="n">igrade</span> <span class="o">&lt;=</span> <span class="n">MV</span><span class="o">.</span><span class="n">n</span><span class="p">:</span>
                <span class="n">coefs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">igrade</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">coefs</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">int</span><span class="p">:</span>
                    <span class="k">for</span> <span class="p">(</span><span class="n">coef</span><span class="p">,</span> <span class="n">connect</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">coefs</span><span class="p">,</span> <span class="n">MV</span><span class="o">.</span><span class="n">Connect</span><span class="p">[</span><span class="n">igrade</span><span class="p">]):</span>
                        <span class="k">if</span> <span class="n">igrade</span> <span class="o">&lt;</span> <span class="n">MV</span><span class="o">.</span><span class="n">n</span><span class="p">:</span>
                            <span class="n">dD</span><span class="o">.</span><span class="n">add_in_place</span><span class="p">(</span><span class="n">coef</span><span class="o">*</span><span class="n">connect</span><span class="o">.</span><span class="n">project</span><span class="p">(</span><span class="n">igrade</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
                <span class="n">igrade</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span><span class="p">(</span><span class="n">dD</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">curl</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grad_ext</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">grad_int</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate inner (interior,div) derivative of multivector function.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">D</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">dD</span> <span class="o">=</span> <span class="n">MV</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">ix</span> <span class="ow">in</span> <span class="n">MV</span><span class="o">.</span><span class="n">coords</span><span class="p">:</span>
            <span class="n">D</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">ix</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">MV</span><span class="o">.</span><span class="n">curvilinear_flg</span><span class="p">:</span>
            <span class="n">recp</span> <span class="o">=</span> <span class="n">MV</span><span class="o">.</span><span class="n">Rframe</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">recp</span> <span class="o">=</span> <span class="n">MV</span><span class="o">.</span><span class="n">brecp</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">irbase</span><span class="p">,</span> <span class="n">iD</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">recp</span><span class="p">,</span> <span class="n">D</span><span class="p">):</span>
            <span class="n">dD</span><span class="o">.</span><span class="n">add_in_place</span><span class="p">(</span><span class="n">irbase</span> <span class="o">|</span> <span class="n">iD</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">MV</span><span class="o">.</span><span class="n">curvilinear_flg</span><span class="p">:</span>  <span class="c"># Add Connection</span>
            <span class="n">igrade</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">while</span> <span class="n">igrade</span> <span class="o">&lt;=</span> <span class="n">MV</span><span class="o">.</span><span class="n">n</span><span class="p">:</span>
                <span class="n">coefs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mv</span><span class="p">[</span><span class="n">igrade</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">coefs</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">int</span><span class="p">:</span>
                    <span class="k">for</span> <span class="p">(</span><span class="n">coef</span><span class="p">,</span> <span class="n">connect</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">coefs</span><span class="p">,</span> <span class="n">MV</span><span class="o">.</span><span class="n">Connect</span><span class="p">[</span><span class="n">igrade</span><span class="p">]):</span>
                        <span class="n">dD</span><span class="o">.</span><span class="n">add_in_place</span><span class="p">(</span><span class="n">coef</span><span class="o">*</span><span class="n">connect</span><span class="o">.</span><span class="n">project</span><span class="p">(</span><span class="n">igrade</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
                <span class="n">igrade</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span><span class="p">(</span><span class="n">dD</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">mag2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate scalar component of square of multivector.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">((</span><span class="bp">self</span> <span class="o">|</span> <span class="bp">self</span><span class="p">)())</span>

    <span class="k">def</span> <span class="nf">Name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get LaTeX name of multivector.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="n">sympy</span><span class="o">.</span><span class="n">galgebra</span><span class="o">.</span><span class="n">latex_ex</span><span class="o">.</span><span class="n">LatexPrinter</span><span class="o">.</span><span class="n">extended_symbol</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>


<div class="viewcode-block" id="set_names"><a class="viewcode-back" href="../../../modules/galgebra/GA.html#sympy.galgebra.GA.set_names">[docs]</a><span class="k">def</span> <span class="nf">set_names</span><span class="p">(</span><span class="n">var_lst</span><span class="p">,</span> <span class="n">var_str</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Set the names of a list of multivectors (var_lst) for a space delimited</span>
<span class="sd">    string (var_str) containing the names.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">var_str_lst</span> <span class="o">=</span> <span class="n">var_str</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">var_lst</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">var_str_lst</span><span class="p">):</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">var_name</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">var_lst</span><span class="p">,</span> <span class="n">var_str_lst</span><span class="p">):</span>
            <span class="n">var</span><span class="o">.</span><span class="n">set_name</span><span class="p">(</span><span class="n">var_name</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;Error in set_names. Lists incongruent!</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>
    <span class="k">return</span>

</div>
<div class="viewcode-block" id="reciprocal_frame"><a class="viewcode-back" href="../../../modules/galgebra/GA.html#sympy.galgebra.GA.reciprocal_frame">[docs]</a><span class="k">def</span> <span class="nf">reciprocal_frame</span><span class="p">(</span><span class="n">vlst</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate reciprocal frame of list (vlst) of vectors.  If desired name each</span>
<span class="sd">    vector in list of reciprocal vectors with names in space delimited string</span>
<span class="sd">    (names).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">E</span> <span class="o">=</span> <span class="n">vlst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">recp</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">names</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">name_lst</span> <span class="o">=</span> <span class="n">names</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">names</span> <span class="o">!=</span> <span class="s">&#39;&#39;</span><span class="p">:</span>
            <span class="n">name_lst</span> <span class="o">=</span> <span class="n">names</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">MV</span><span class="o">.</span><span class="n">n</span><span class="p">):</span>
        <span class="n">E</span> <span class="o">=</span> <span class="n">E</span> <span class="o">^</span> <span class="n">vlst</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">MV</span><span class="o">.</span><span class="n">n</span><span class="p">):</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="n">ONE</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="o">-</span><span class="n">ONE</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">MV</span><span class="o">.</span><span class="n">n</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">j</span><span class="p">:</span>
                <span class="n">tmp</span> <span class="o">=</span> <span class="n">tmp</span> <span class="o">^</span> <span class="n">vlst</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="n">tmp</span><span class="o">*</span><span class="n">E</span>
        <span class="n">recp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
    <span class="n">Esq</span> <span class="o">=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">trigsimp</span><span class="p">(</span><span class="n">E</span><span class="o">.</span><span class="n">mag2</span><span class="p">(),</span> <span class="n">deep</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="k">print</span> <span class="n">Esq</span>
    <span class="k">print</span> <span class="n">sympy</span><span class="o">.</span><span class="n">simplify</span><span class="p">(</span><span class="n">Esq</span><span class="p">)</span>
    <span class="n">Esq_inv</span> <span class="o">=</span> <span class="n">ONE</span><span class="o">/</span><span class="n">Esq</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">MV</span><span class="o">.</span><span class="n">n</span><span class="p">):</span>
        <span class="n">recp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">trigsimp</span><span class="p">()</span>
        <span class="n">recp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">recp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">Esq_inv</span>
        <span class="k">if</span> <span class="n">names</span> <span class="o">!=</span> <span class="s">&#39;&#39;</span><span class="p">:</span>
            <span class="n">recp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_name</span><span class="p">(</span><span class="n">name_lst</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span><span class="p">(</span><span class="n">recp</span><span class="p">)</span>

</div>
<span class="k">def</span> <span class="nf">S</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="k">return</span><span class="p">(</span><span class="n">MV</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&#39;scalar&#39;</span><span class="p">))</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/sympylogo.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../../../np-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">SymPy 0.7.2-git documentation</a> &raquo;</li>
          <li><a href="../../index.html" >Module code</a> &raquo;</li>
          <li><a href="../../sympy.html" >sympy</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013 SymPy Development Team.
      Last updated on May 16, 2013.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>