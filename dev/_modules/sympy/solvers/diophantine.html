<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>sympy.solvers.diophantine &mdash; SymPy 0.7.5-git documentation</title>
    
    <link rel="stylesheet" href="../../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="http://live.sympy.org/static/live-core.css" type="text/css" />
    <link rel="stylesheet" href="http://live.sympy.org/static/live-autocomplete.css" type="text/css" />
    <link rel="stylesheet" href="http://live.sympy.org/static/live-sphinx.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '0.7.5-git',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://c328740.ssl.cf1.rackcdn.com/mathjax/latest/MathJax.js?config=TeX-AMS_HTML-full"></script>
    <script type="text/javascript" src="http://live.sympy.org/static/utilities.js"></script>
    <script type="text/javascript" src="http://live.sympy.org/static/external/classy.js"></script>
    <script type="text/javascript" src="http://live.sympy.org/static/live-core.js"></script>
    <script type="text/javascript" src="http://live.sympy.org/static/live-autocomplete.js"></script>
    <script type="text/javascript" src="http://live.sympy.org/static/live-sphinx.js"></script>
    <script type="text/javascript" src="../../../_static/sidebar.js"></script>
    <link rel="shortcut icon" href="../../../_static/sympy-notailtext-favicon.ico"/>
    <link rel="top" title="SymPy 0.7.5-git documentation" href="../../../index.html" />
    <link rel="up" title="sympy" href="../../sympy.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">SymPy 0.7.5-git documentation</a> &raquo;</li>
          <li><a href="../../index.html" >Module code</a> &raquo;</li>
          <li><a href="../../sympy.html" accesskey="U">sympy</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for sympy.solvers.diophantine</h1><div class="highlight"><pre>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span><span class="p">,</span> <span class="n">division</span>

<span class="kn">from</span> <span class="nn">sympy</span> <span class="kn">import</span> <span class="p">(</span><span class="n">degree_list</span><span class="p">,</span> <span class="n">Poly</span><span class="p">,</span> <span class="n">igcd</span><span class="p">,</span> <span class="n">divisors</span><span class="p">,</span> <span class="n">sign</span><span class="p">,</span> <span class="n">symbols</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">Wild</span><span class="p">,</span> <span class="n">Symbol</span><span class="p">,</span> <span class="n">factorint</span><span class="p">,</span>
    <span class="n">Add</span><span class="p">,</span> <span class="n">Mul</span><span class="p">,</span> <span class="n">solve</span><span class="p">,</span> <span class="n">ceiling</span><span class="p">,</span> <span class="n">floor</span><span class="p">,</span> <span class="n">sqrt</span><span class="p">,</span> <span class="n">sympify</span><span class="p">,</span> <span class="n">Subs</span><span class="p">,</span> <span class="n">ilcm</span><span class="p">,</span> <span class="n">Matrix</span><span class="p">,</span> <span class="n">factor_list</span><span class="p">,</span> <span class="n">perfect_power</span><span class="p">,</span>
    <span class="n">isprime</span><span class="p">,</span> <span class="n">nextprime</span><span class="p">,</span> <span class="n">integer_nthroot</span><span class="p">,</span> <span class="n">Expr</span><span class="p">,</span> <span class="n">Pow</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">sympy.simplify.simplify</span> <span class="kn">import</span> <span class="n">rad_rationalize</span><span class="p">,</span> <span class="n">_mexpand</span>
<span class="kn">from</span> <span class="nn">sympy.ntheory.modular</span> <span class="kn">import</span> <span class="n">solve_congruence</span>
<span class="kn">from</span> <span class="nn">sympy.utilities</span> <span class="kn">import</span> <span class="n">default_sort_key</span><span class="p">,</span> <span class="n">numbered_symbols</span>
<span class="kn">from</span> <span class="nn">sympy.core.numbers</span> <span class="kn">import</span> <span class="n">igcdex</span>
<span class="kn">from</span> <span class="nn">sympy.ntheory.residue_ntheory</span> <span class="kn">import</span> <span class="n">sqrt_mod</span>
<span class="kn">from</span> <span class="nn">sympy.core.compatibility</span> <span class="kn">import</span> <span class="nb">xrange</span>
<span class="kn">from</span> <span class="nn">sympy.core.relational</span> <span class="kn">import</span> <span class="n">Eq</span>
<span class="kn">from</span> <span class="nn">sympy.solvers.solvers</span> <span class="kn">import</span> <span class="n">check_assumptions</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;diophantine&#39;</span><span class="p">,</span> <span class="s">&#39;diop_solve&#39;</span><span class="p">,</span> <span class="s">&#39;classify_diop&#39;</span><span class="p">,</span> <span class="s">&#39;diop_linear&#39;</span><span class="p">,</span> <span class="s">&#39;base_solution_linear&#39;</span><span class="p">,</span>
<span class="s">&#39;diop_quadratic&#39;</span><span class="p">,</span> <span class="s">&#39;diop_DN&#39;</span><span class="p">,</span> <span class="s">&#39;cornacchia&#39;</span><span class="p">,</span> <span class="s">&#39;diop_bf_DN&#39;</span><span class="p">,</span> <span class="s">&#39;transformation_to_DN&#39;</span><span class="p">,</span> <span class="s">&#39;find_DN&#39;</span><span class="p">,</span>
<span class="s">&#39;diop_ternary_quadratic&#39;</span><span class="p">,</span>  <span class="s">&#39;square_factor&#39;</span><span class="p">,</span> <span class="s">&#39;descent&#39;</span><span class="p">,</span> <span class="s">&#39;diop_general_pythagorean&#39;</span><span class="p">,</span>
<span class="s">&#39;diop_general_sum_of_squares&#39;</span><span class="p">,</span> <span class="s">&#39;partition&#39;</span><span class="p">,</span> <span class="s">&#39;sum_of_three_squares&#39;</span><span class="p">,</span> <span class="s">&#39;sum_of_four_squares&#39;</span><span class="p">]</span>


<div class="viewcode-block" id="diophantine"><a class="viewcode-back" href="../../../modules/solvers/diophantine.html#sympy.solvers.diophantine.diophantine">[docs]</a><span class="k">def</span> <span class="nf">diophantine</span><span class="p">(</span><span class="n">eq</span><span class="p">,</span> <span class="n">param</span><span class="o">=</span><span class="n">symbols</span><span class="p">(</span><span class="s">&quot;t&quot;</span><span class="p">,</span> <span class="n">integer</span><span class="o">=</span><span class="bp">True</span><span class="p">)):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Simplify the solution procedure of diophantine equation ``eq`` by</span>
<span class="sd">    converting it into a product of terms which should equal zero.</span>

<span class="sd">    For example, when solving, `x^2 - y^2 = 0` this is treated as</span>
<span class="sd">    `(x + y)(x - y) = 0` and `x+y = 0` and `x-y = 0` are solved independently</span>
<span class="sd">    and combined. Each term is solved by calling ``diop_solve()``.</span>

<span class="sd">    Output of ``diophantine()`` is a set of tuples. Each tuple represents a</span>
<span class="sd">    solution of the input equation. In a tuple, solution for each variable is</span>
<span class="sd">    listed according to the alphabetic order of input variables. i.e. if we have</span>
<span class="sd">    an equation with two variables `a` and `b`, first element of the tuple will</span>
<span class="sd">    give the solution for `a` and the second element will give the solution for</span>
<span class="sd">    `b`.</span>

<span class="sd">    Usage</span>
<span class="sd">    =====</span>

<span class="sd">    ``diophantine(eq, t)``: Solve the diophantine equation ``eq``.</span>
<span class="sd">    ``t`` is the parameter to be used by ``diop_solve()``.</span>

<span class="sd">    Details</span>
<span class="sd">    =======</span>

<span class="sd">    ``eq`` should be an expression which is assumed to be zero.</span>
<span class="sd">    ``t`` is the parameter to be used in the solution.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.solvers.diophantine import diophantine</span>
<span class="sd">    &gt;&gt;&gt; from sympy.abc import x, y, z</span>
<span class="sd">    &gt;&gt;&gt; diophantine(x**2 - y**2)</span>
<span class="sd">    set([(-t, -t), (t, -t)])</span>

<span class="sd">    #&gt;&gt;&gt; diophantine(x*(2*x + 3*y - z))</span>
<span class="sd">    #set([(0, n1, n2), (3*t - z, -2*t + z, z)])</span>
<span class="sd">    #&gt;&gt;&gt; diophantine(x**2 + 3*x*y + 4*x)</span>
<span class="sd">    #set([(0, n1), (3*t - 4, -t)])</span>

<span class="sd">    See Also</span>
<span class="sd">    ========</span>

<span class="sd">    diop_solve()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">eq</span><span class="p">,</span> <span class="n">Eq</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="n">eq</span><span class="o">.</span><span class="n">lhs</span> <span class="o">-</span> <span class="n">eq</span><span class="o">.</span><span class="n">rhs</span>

    <span class="n">eq</span> <span class="o">=</span> <span class="n">Poly</span><span class="p">(</span><span class="n">eq</span><span class="p">)</span><span class="o">.</span><span class="n">as_expr</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">eq</span><span class="o">.</span><span class="n">is_polynomial</span><span class="p">()</span> <span class="ow">or</span> <span class="n">eq</span><span class="o">.</span><span class="n">is_number</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;Equation input format not supported&quot;</span><span class="p">)</span>

    <span class="n">var</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">eq</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="n">force</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span><span class="o">.</span><span class="n">free_symbols</span><span class="p">)</span>
    <span class="n">var</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">default_sort_key</span><span class="p">)</span>

    <span class="n">terms</span> <span class="o">=</span> <span class="n">factor_list</span><span class="p">(</span><span class="n">eq</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">sols</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>

    <span class="k">for</span> <span class="n">term</span> <span class="ow">in</span> <span class="n">terms</span><span class="p">:</span>

        <span class="n">base</span> <span class="o">=</span> <span class="n">term</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">var_t</span><span class="p">,</span> <span class="n">jnk</span><span class="p">,</span> <span class="n">eq_type</span> <span class="o">=</span> <span class="n">classify_diop</span><span class="p">(</span><span class="n">base</span><span class="p">)</span>
        <span class="n">solution</span> <span class="o">=</span> <span class="n">diop_solve</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">param</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">eq_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&quot;linear&quot;</span><span class="p">,</span> <span class="s">&quot;homogeneous_ternary_quadratic&quot;</span><span class="p">,</span> <span class="s">&quot;general_pythagorean&quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">merge_solution</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">var_t</span><span class="p">,</span> <span class="n">solution</span><span class="p">)</span> <span class="o">!=</span> <span class="p">():</span>
                <span class="n">sols</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">merge_solution</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">var_t</span><span class="p">,</span> <span class="n">solution</span><span class="p">))</span>

        <span class="k">elif</span> <span class="n">eq_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&quot;binary_quadratic&quot;</span><span class="p">,</span>  <span class="s">&quot;general_sum_of_squares&quot;</span><span class="p">,</span> <span class="s">&quot;univariate&quot;</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">sol</span> <span class="ow">in</span> <span class="n">solution</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">merge_solution</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">var_t</span><span class="p">,</span> <span class="n">sol</span><span class="p">)</span> <span class="o">!=</span> <span class="p">():</span>
                    <span class="n">sols</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">merge_solution</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">var_t</span><span class="p">,</span> <span class="n">sol</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">sols</span>

</div>
<div class="viewcode-block" id="merge_solution"><a class="viewcode-back" href="../../../modules/solvers/diophantine.html#sympy.solvers.diophantine.merge_solution">[docs]</a><span class="k">def</span> <span class="nf">merge_solution</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">var_t</span><span class="p">,</span> <span class="n">solution</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is used to construct the full solution from the solutions of sub</span>
<span class="sd">    equations.</span>

<span class="sd">    For example when solving the equation `(x - y)(x^2 + y^2 - z^2) = 0`,</span>
<span class="sd">    solutions for each of the equations `x-y = 0` and `x^2 + y^2 - z^2` are</span>
<span class="sd">    found independently. Solutions for `x - y = 0` are `(x, y) = (t, t)`. But</span>
<span class="sd">    we should introduce a value for z when we output the solution for the</span>
<span class="sd">    original equation. This function converts `(t, t)` into `(t, t, n_{1})`</span>
<span class="sd">    where `n_{1}` is an integer parameter.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">l</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="bp">None</span> <span class="ow">in</span> <span class="n">solution</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">()</span>

    <span class="n">solution</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">solution</span><span class="p">)</span>
    <span class="n">params</span> <span class="o">=</span> <span class="n">numbered_symbols</span><span class="p">(</span><span class="s">&quot;n&quot;</span><span class="p">,</span> <span class="n">Integer</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">var</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">var_t</span><span class="p">:</span>
            <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">solution</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">params</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">val</span><span class="p">,</span> <span class="n">symb</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">var</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">check_assumptions</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="o">**</span><span class="n">symb</span><span class="o">.</span><span class="n">assumptions0</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">False</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">tuple</span><span class="p">()</span>

    <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="diop_solve"><a class="viewcode-back" href="../../../modules/solvers/diophantine.html#sympy.solvers.diophantine.diop_solve">[docs]</a><span class="k">def</span> <span class="nf">diop_solve</span><span class="p">(</span><span class="n">eq</span><span class="p">,</span> <span class="n">param</span><span class="o">=</span><span class="n">symbols</span><span class="p">(</span><span class="s">&quot;t&quot;</span><span class="p">,</span> <span class="n">integer</span><span class="o">=</span><span class="bp">True</span><span class="p">)):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Solves the diophantine equation ``eq``.</span>

<span class="sd">    Similar to ``diophantine()`` but doesn&#39;t try to factor ``eq`` as latter</span>
<span class="sd">    does. Uses ``classify_diop()`` to determine the type of the eqaution and</span>
<span class="sd">    calls the appropriate solver function.</span>

<span class="sd">    Usage</span>
<span class="sd">    =====</span>

<span class="sd">    ``diop_solve(eq, t)``: Solve diophantine equation, ``eq`` using ``t``</span>
<span class="sd">    as a parameter if needed.</span>

<span class="sd">    Details</span>
<span class="sd">    =======</span>

<span class="sd">    ``eq`` should be an expression which is assumed to be zero.</span>
<span class="sd">    ``t`` is a parameter to be used in the solution.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.solvers.diophantine import diop_solve</span>
<span class="sd">    &gt;&gt;&gt; from sympy.abc import x, y, z, w</span>
<span class="sd">    &gt;&gt;&gt; diop_solve(2*x + 3*y - 5)</span>
<span class="sd">    (3*t - 5, -2*t + 5)</span>
<span class="sd">    &gt;&gt;&gt; diop_solve(4*x + 3*y -4*z + 5)</span>
<span class="sd">    (3*t + 4*z - 5, -4*t - 4*z + 5,  z)</span>
<span class="sd">    &gt;&gt;&gt; diop_solve(x + 3*y - 4*z + w -6)</span>
<span class="sd">    (t, -t - 3*y + 4*z + 6, y, z)</span>
<span class="sd">    &gt;&gt;&gt; diop_solve(x**2 + y**2 - 5)</span>
<span class="sd">    set([(-2, -1), (-2, 1), (2, -1), (2, 1)])</span>

<span class="sd">    See Also</span>
<span class="sd">    ========</span>

<span class="sd">    diophantine()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">var</span><span class="p">,</span> <span class="n">coeff</span><span class="p">,</span> <span class="n">eq_type</span> <span class="o">=</span> <span class="n">classify_diop</span><span class="p">(</span><span class="n">eq</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">eq_type</span> <span class="o">==</span> <span class="s">&quot;linear&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_diop_linear</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">coeff</span><span class="p">,</span> <span class="n">param</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">eq_type</span> <span class="o">==</span> <span class="s">&quot;binary_quadratic&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_diop_quadratic</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">coeff</span><span class="p">,</span> <span class="n">param</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">eq_type</span> <span class="o">==</span> <span class="s">&quot;homogeneous_ternary_quadratic&quot;</span><span class="p">:</span>
        <span class="n">x_0</span><span class="p">,</span> <span class="n">y_0</span><span class="p">,</span> <span class="n">z_0</span> <span class="o">=</span> <span class="n">_diop_ternary_quadratic</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">coeff</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">_parametrize_ternary_quadratic</span><span class="p">((</span><span class="n">x_0</span><span class="p">,</span> <span class="n">y_0</span><span class="p">,</span> <span class="n">z_0</span><span class="p">),</span> <span class="n">var</span><span class="p">,</span> <span class="n">coeff</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">eq_type</span> <span class="o">==</span> <span class="s">&quot;general_pythagorean&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_diop_general_pythagorean</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">coeff</span><span class="p">,</span> <span class="n">param</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">eq_type</span> <span class="o">==</span> <span class="s">&quot;univariate&quot;</span><span class="p">:</span>
        <span class="n">l</span> <span class="o">=</span> <span class="n">solve</span><span class="p">(</span><span class="n">eq</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>

        <span class="k">for</span> <span class="n">soln</span> <span class="ow">in</span> <span class="n">l</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">soln</span><span class="p">,</span> <span class="n">Integer</span><span class="p">):</span>
                <span class="n">s</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">soln</span><span class="p">,))</span>
        <span class="k">return</span> <span class="n">s</span>

    <span class="k">elif</span> <span class="n">eq_type</span> <span class="o">==</span> <span class="s">&quot;general_sum_of_squares&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_diop_general_sum_of_squares</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">coeff</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="classify_diop"><a class="viewcode-back" href="../../../modules/solvers/diophantine.html#sympy.solvers.diophantine.classify_diop">[docs]</a><span class="k">def</span> <span class="nf">classify_diop</span><span class="p">(</span><span class="n">eq</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Helper routine used by diop_solve() to find the type of the ``eq`` etc.</span>

<span class="sd">    Returns a tuple containing the type of the diophantine equation along with</span>
<span class="sd">    the variables(free symbols) and their coefficients. Variables are returned</span>
<span class="sd">    as a list and coefficients are returned as a dict with the key being the</span>
<span class="sd">    respective term and the constant term is keyed to Integer(1). Type is an</span>
<span class="sd">    element in the set {&quot;linear&quot;, &quot;binary_quadratic&quot;, &quot;general_pythagorean&quot;,</span>
<span class="sd">    &quot;homogeneous_ternary_quadratic&quot;, &quot;univariate&quot;, &quot;general_sum_of_squares&quot;}</span>

<span class="sd">    Usage</span>
<span class="sd">    =====</span>

<span class="sd">    ``classify_diop(eq)``: Return variables, coefficients and type of the</span>
<span class="sd">    ``eq``.</span>

<span class="sd">    Details</span>
<span class="sd">    =======</span>

<span class="sd">    ``eq`` should be an expression which is assumed to be zero.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.solvers.diophantine import classify_diop</span>
<span class="sd">    &gt;&gt;&gt; from sympy.abc import x, y, z, w, t</span>
<span class="sd">    &gt;&gt;&gt; classify_diop(4*x + 6*y - 4)</span>
<span class="sd">    ([x, y], {1: -4, x: 4, y: 6}, &#39;linear&#39;)</span>
<span class="sd">    &gt;&gt;&gt; classify_diop(x + 3*y -4*z + 5)</span>
<span class="sd">    ([x, y, z], {1: 5, x: 1, y: 3, z: -4}, &#39;linear&#39;)</span>
<span class="sd">    &gt;&gt;&gt; classify_diop(x**2 + y**2 - x*y + x + 5)</span>
<span class="sd">    ([x, y], {1: 5, x: 1, x**2: 1, y: 0, y**2: 1, x*y: -1}, &#39;binary_quadratic&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">eq</span> <span class="o">=</span> <span class="n">eq</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="n">force</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">var</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">eq</span><span class="o">.</span><span class="n">free_symbols</span><span class="p">)</span>
    <span class="n">var</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">default_sort_key</span><span class="p">)</span>

    <span class="n">coeff</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">diop_type</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="n">coeff</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([</span><span class="nb">reversed</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">as_independent</span><span class="p">(</span><span class="o">*</span><span class="n">var</span><span class="p">))</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">eq</span><span class="o">.</span><span class="n">args</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">coeff</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">coeff</span><span class="p">[</span><span class="n">v</span><span class="p">],</span> <span class="n">Integer</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;Coefficients should be Integers&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">var</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">diop_type</span> <span class="o">=</span> <span class="s">&quot;univariate&quot;</span>
    <span class="k">elif</span> <span class="n">Poly</span><span class="p">(</span><span class="n">eq</span><span class="p">)</span><span class="o">.</span><span class="n">total_degree</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">diop_type</span> <span class="o">=</span> <span class="s">&quot;linear&quot;</span>
    <span class="k">elif</span> <span class="n">Poly</span><span class="p">(</span><span class="n">eq</span><span class="p">)</span><span class="o">.</span><span class="n">total_degree</span><span class="p">()</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">var</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">diop_type</span> <span class="o">=</span> <span class="s">&quot;binary_quadratic&quot;</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">var</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">eq</span><span class="p">,</span> <span class="n">Mul</span><span class="p">):</span>
            <span class="n">coeff</span> <span class="o">=</span> <span class="p">{</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="n">x</span><span class="o">*</span><span class="n">y</span><span class="p">:</span> <span class="n">eq</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Integer</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span> <span class="mi">0</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">term</span> <span class="ow">in</span> <span class="p">[</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">x</span><span class="o">*</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">Integer</span><span class="p">(</span><span class="mi">1</span><span class="p">)]:</span>
                <span class="k">if</span> <span class="n">term</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">coeff</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">coeff</span><span class="p">[</span><span class="n">term</span><span class="p">]</span> <span class="o">=</span> <span class="n">Integer</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">Poly</span><span class="p">(</span><span class="n">eq</span><span class="p">)</span><span class="o">.</span><span class="n">total_degree</span><span class="p">()</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">var</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">Integer</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">coeff</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">var</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">coeff</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">diop_type</span> <span class="o">=</span> <span class="s">&quot;inhomogeneous_ternary_quadratic&quot;</span>
                <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">diop_type</span> <span class="o">=</span> <span class="s">&quot;homogeneous_ternary_quadratic&quot;</span>

            <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">var</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>

            <span class="k">for</span> <span class="n">term</span> <span class="ow">in</span> <span class="p">[</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">z</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">x</span><span class="o">*</span><span class="n">y</span><span class="p">,</span> <span class="n">y</span><span class="o">*</span><span class="n">z</span><span class="p">,</span> <span class="n">x</span><span class="o">*</span><span class="n">z</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">term</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">coeff</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">coeff</span><span class="p">[</span><span class="n">term</span><span class="p">]</span> <span class="o">=</span> <span class="n">Integer</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">Poly</span><span class="p">(</span><span class="n">eq</span><span class="p">)</span><span class="o">.</span><span class="n">degree</span><span class="p">()</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">var</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>

        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">var</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">coeff</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">diop_type</span> <span class="o">=</span> <span class="s">&quot;inhomogeneous_general_quadratic&quot;</span>
                <span class="k">break</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">Integer</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="ow">in</span> <span class="n">coeff</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">constant_term</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">constant_term</span> <span class="o">=</span> <span class="bp">False</span>

            <span class="n">non_square_degree_2_terms</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">var</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">var</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">u</span> <span class="o">!=</span> <span class="n">v</span> <span class="ow">and</span> <span class="n">u</span><span class="o">*</span><span class="n">v</span> <span class="ow">in</span> <span class="n">coeff</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="n">non_square_degree_2_terms</span> <span class="o">=</span> <span class="bp">True</span>
                        <span class="k">break</span>
                <span class="k">if</span> <span class="n">non_square_degree_2_terms</span><span class="p">:</span>
                    <span class="k">break</span>

            <span class="k">if</span> <span class="n">constant_term</span> <span class="ow">and</span> <span class="n">non_square_degree_2_terms</span><span class="p">:</span>
                <span class="n">diop_type</span> <span class="o">=</span> <span class="s">&quot;inhomogeneous_general_quadratic&quot;</span>

            <span class="k">elif</span> <span class="n">constant_term</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">non_square_degree_2_terms</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">var</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">coeff</span><span class="p">[</span><span class="n">v</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="k">break</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">diop_type</span> <span class="o">=</span> <span class="s">&quot;general_sum_of_squares&quot;</span>

            <span class="k">elif</span> <span class="ow">not</span> <span class="n">constant_term</span> <span class="ow">and</span> <span class="n">non_square_degree_2_terms</span><span class="p">:</span>
                <span class="n">diop_type</span> <span class="o">=</span> <span class="s">&quot;homogeneous_general_quadratic&quot;</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">coeff_sign_sum</span> <span class="o">=</span> <span class="mi">0</span>

                <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">var</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">Integer</span><span class="p">(</span><span class="n">coeff</span><span class="p">[</span><span class="n">v</span><span class="o">**</span><span class="mi">2</span><span class="p">]))),</span> <span class="n">Integer</span><span class="p">):</span>
                        <span class="k">break</span>
                    <span class="n">coeff_sign_sum</span> <span class="o">=</span> <span class="n">coeff_sign_sum</span> <span class="o">+</span> <span class="n">sign</span><span class="p">(</span><span class="n">coeff</span><span class="p">[</span><span class="n">v</span><span class="o">**</span><span class="mi">2</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">coeff_sign_sum</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">var</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">constant_term</span><span class="p">:</span>
                        <span class="n">diop_type</span> <span class="o">=</span> <span class="s">&quot;general_pythagorean&quot;</span>

    <span class="k">elif</span> <span class="n">Poly</span><span class="p">(</span><span class="n">eq</span><span class="p">)</span><span class="o">.</span><span class="n">total_degree</span><span class="p">()</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">var</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>

        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">var</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">diop_type</span> <span class="o">=</span> <span class="s">&quot;cubic_thue&quot;</span>

        <span class="k">for</span> <span class="n">term</span> <span class="ow">in</span> <span class="p">[</span><span class="n">x</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="o">*</span><span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">y</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span> <span class="n">Integer</span><span class="p">(</span><span class="mi">1</span><span class="p">)]:</span>
            <span class="k">if</span> <span class="n">term</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">coeff</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">coeff</span><span class="p">[</span><span class="n">term</span><span class="p">]</span> <span class="o">==</span> <span class="n">Integer</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">diop_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">var</span><span class="p">,</span> <span class="n">coeff</span><span class="p">,</span> <span class="n">diop_type</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s">&quot;Still not implemented&quot;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="diop_linear"><a class="viewcode-back" href="../../../modules/solvers/diophantine.html#sympy.solvers.diophantine.diop_linear">[docs]</a><span class="k">def</span> <span class="nf">diop_linear</span><span class="p">(</span><span class="n">eq</span><span class="p">,</span> <span class="n">param</span><span class="o">=</span><span class="n">symbols</span><span class="p">(</span><span class="s">&quot;t&quot;</span><span class="p">,</span> <span class="n">integer</span><span class="o">=</span><span class="bp">True</span><span class="p">)):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Solves linear diophantine equations.</span>

<span class="sd">    A linear diophantine equation is an equation of the form `a_{1}x_{1} +</span>
<span class="sd">    a_{2}x_{2} + .. + a_{n}x_{n} = 0` where `a_{1}, a_{2}, ..a_{n}` are</span>
<span class="sd">    integer constants and `x_{1}, x_{2}, ..x_{n}` are integer variables.</span>

<span class="sd">    Usage</span>
<span class="sd">    =====</span>

<span class="sd">    ``diop_linear(eq)``: Returns a tuple containing solutions to the</span>
<span class="sd">    diophantine equation ``eq``. Values in the tuple is arranged in the same</span>
<span class="sd">    order as the sorted variables.</span>

<span class="sd">    Details</span>
<span class="sd">    =======</span>

<span class="sd">    ``eq`` is a linear diophantine equation which is assumed to be zero.</span>
<span class="sd">    ``param`` is the parameter to be used in the solution.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.solvers.diophantine import diop_linear</span>
<span class="sd">    &gt;&gt;&gt; from sympy.abc import x, y, z, t</span>
<span class="sd">    &gt;&gt;&gt; from sympy import Integer</span>
<span class="sd">    &gt;&gt;&gt; diop_linear(2*x - 3*y - 5) #solves equation 2*x - 3*y -5 = 0</span>
<span class="sd">    (-3*t - 5, -2*t - 5)</span>

<span class="sd">    Here x = -3*t - 5 and y = -2*t - 5</span>

<span class="sd">    &gt;&gt;&gt; diop_linear(2*x - 3*y - 4*z -3)</span>
<span class="sd">    (-3*t - 4*z - 3, -2*t - 4*z - 3,  z)</span>

<span class="sd">    See Also</span>
<span class="sd">    ========</span>

<span class="sd">    diop_quadratic(), diop_ternary_quadratic(), diop_general_pythagorean(),</span>
<span class="sd">    diop_general_sum_of_squares()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">var</span><span class="p">,</span> <span class="n">coeff</span><span class="p">,</span> <span class="n">diop_type</span> <span class="o">=</span> <span class="n">classify_diop</span><span class="p">(</span><span class="n">eq</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">diop_type</span> <span class="o">==</span> <span class="s">&quot;linear&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_diop_linear</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">coeff</span><span class="p">,</span> <span class="n">param</span><span class="p">)</span>

</div>
<span class="k">def</span> <span class="nf">_diop_linear</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">coeff</span><span class="p">,</span> <span class="n">param</span><span class="p">):</span>

    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">var</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="n">y</span><span class="p">]</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">var</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">coeff</span><span class="p">):</span>
        <span class="n">c</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">c</span> <span class="o">=</span> <span class="o">-</span><span class="n">coeff</span><span class="p">[</span><span class="n">Integer</span><span class="p">(</span><span class="mi">1</span><span class="p">)]</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">var</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">sol_x</span><span class="p">,</span> <span class="n">sol_y</span> <span class="o">=</span> <span class="n">base_solution_linear</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">param</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">sol_x</span><span class="p">,</span> <span class="n">sol_y</span><span class="p">)</span>

    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">var</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">X</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">Y</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">var</span><span class="p">[</span><span class="mi">2</span><span class="p">:]:</span>
            <span class="n">sol_x</span><span class="p">,</span> <span class="n">sol_y</span>  <span class="o">=</span> <span class="n">base_solution_linear</span><span class="p">(</span><span class="o">-</span><span class="n">coeff</span><span class="p">[</span><span class="n">v</span><span class="p">],</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
            <span class="n">X</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sol_x</span><span class="o">*</span><span class="n">v</span><span class="p">)</span>
            <span class="n">Y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sol_y</span><span class="o">*</span><span class="n">v</span><span class="p">)</span>

        <span class="n">sol_x</span><span class="p">,</span> <span class="n">sol_y</span> <span class="o">=</span> <span class="n">base_solution_linear</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">param</span><span class="p">)</span>
        <span class="n">X</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sol_x</span><span class="p">)</span>
        <span class="n">Y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sol_y</span><span class="p">)</span>

        <span class="n">l</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">None</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">X</span> <span class="ow">and</span> <span class="bp">None</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">Y</span><span class="p">:</span>
            <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Add</span><span class="p">(</span><span class="o">*</span><span class="n">X</span><span class="p">))</span>
            <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Add</span><span class="p">(</span><span class="o">*</span><span class="n">Y</span><span class="p">))</span>

            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">var</span><span class="p">[</span><span class="mi">2</span><span class="p">:]:</span>
                <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">var</span><span class="p">:</span>
                <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>


<div class="viewcode-block" id="base_solution_linear"><a class="viewcode-back" href="../../../modules/solvers/diophantine.html#sympy.solvers.diophantine.base_solution_linear">[docs]</a><span class="k">def</span> <span class="nf">base_solution_linear</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the base solution for a linear diophantine equation with two</span>
<span class="sd">    variables.</span>

<span class="sd">    Used by ``diop_linear()`` to find the base solution of a linear</span>
<span class="sd">    Diophantine equation. If ``t`` is given then the parametrized solution is</span>
<span class="sd">    returned.</span>

<span class="sd">    Usage</span>
<span class="sd">    =====</span>

<span class="sd">    ``base_solution_linear(c, a, b, t)``: ``a``, ``b``, ``c`` are coefficients</span>
<span class="sd">    in `ax + by = c` and ``t`` is the parameter to be used in the solution.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.solvers.diophantine import base_solution_linear</span>
<span class="sd">    &gt;&gt;&gt; from sympy.abc import t</span>
<span class="sd">    &gt;&gt;&gt; base_solution_linear(5, 2, 3) # equation 2*x + 3*y = 5</span>
<span class="sd">    (-5, 5)</span>
<span class="sd">    &gt;&gt;&gt; base_solution_linear(0, 5, 7) # equation 5*x + 7*y = 0</span>
<span class="sd">    (0, 0)</span>
<span class="sd">    &gt;&gt;&gt; base_solution_linear(5, 2, 3, t) # equation 2*x + 3*y = 5</span>
<span class="sd">    (3*t - 5, -2*t + 5)</span>
<span class="sd">    &gt;&gt;&gt; base_solution_linear(0, 5, 7, t) # equation 5*x + 7*y = 0</span>
<span class="sd">    (7*t, -5*t)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">igcd</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">igcd</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">a</span> <span class="o">//</span> <span class="n">d</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">b</span> <span class="o">//</span> <span class="n">d</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">c</span> <span class="o">//</span> <span class="n">d</span>

    <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">t</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">b</span><span class="o">*</span><span class="n">t</span> <span class="p">,</span> <span class="o">-</span><span class="n">a</span><span class="o">*</span><span class="n">t</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">Zero</span><span class="p">,</span> <span class="n">S</span><span class="o">.</span><span class="n">Zero</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="n">extended_euclid</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">a</span><span class="p">)),</span> <span class="nb">int</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">b</span><span class="p">)))</span>

        <span class="n">x0</span> <span class="o">=</span> <span class="n">x0</span> <span class="o">*</span> <span class="n">sign</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
        <span class="n">y0</span> <span class="o">=</span> <span class="n">y0</span> <span class="o">*</span> <span class="n">sign</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">divisible</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">t</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">(</span><span class="n">c</span><span class="o">*</span><span class="n">x0</span> <span class="o">+</span> <span class="n">b</span><span class="o">*</span><span class="n">t</span><span class="p">,</span> <span class="n">c</span><span class="o">*</span><span class="n">y0</span> <span class="o">-</span> <span class="n">a</span><span class="o">*</span><span class="n">t</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">(</span><span class="n">Integer</span><span class="p">(</span><span class="n">c</span><span class="o">*</span><span class="n">x0</span><span class="p">),</span> <span class="n">Integer</span><span class="p">(</span><span class="n">c</span><span class="o">*</span><span class="n">y0</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="extended_euclid"><a class="viewcode-back" href="../../../modules/solvers/diophantine.html#sympy.solvers.diophantine.extended_euclid">[docs]</a><span class="k">def</span> <span class="nf">extended_euclid</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    For given ``a``, ``b`` returns a tuple containing integers `x`, `y` and `d`</span>
<span class="sd">    such that `ax + by = d`. Here `d = gcd(a, b)`.</span>

<span class="sd">    Usage</span>
<span class="sd">    =====</span>

<span class="sd">    ``extended_euclid(a, b)``: returns `x`, `y` and `\gcd(a, b)`.</span>

<span class="sd">    Details</span>
<span class="sd">    =======</span>

<span class="sd">    ``a`` Any instance of Integer.</span>
<span class="sd">    ``b`` Any instance of Integer.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.solvers.diophantine import extended_euclid</span>
<span class="sd">    &gt;&gt;&gt; extended_euclid(4, 6)</span>
<span class="sd">    (-1, 1, 2)</span>
<span class="sd">    &gt;&gt;&gt; extended_euclid(3, 5)</span>
<span class="sd">    (2, -1, 1)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">b</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>

    <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="n">extended_euclid</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="o">%</span><span class="n">b</span><span class="p">)</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">y0</span><span class="p">,</span> <span class="n">x0</span> <span class="o">-</span> <span class="p">(</span><span class="n">a</span><span class="o">//</span><span class="n">b</span><span class="p">)</span> <span class="o">*</span> <span class="n">y0</span>

    <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">d</span>

</div>
<div class="viewcode-block" id="divisible"><a class="viewcode-back" href="../../../modules/solvers/diophantine.html#sympy.solvers.diophantine.divisible">[docs]</a><span class="k">def</span> <span class="nf">divisible</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns `True` if ``a`` is divisible by ``b`` and `False` otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">igcd</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">b</span><span class="p">))</span> <span class="o">==</span> <span class="nb">abs</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">b</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="diop_quadratic"><a class="viewcode-back" href="../../../modules/solvers/diophantine.html#sympy.solvers.diophantine.diop_quadratic">[docs]</a><span class="k">def</span> <span class="nf">diop_quadratic</span><span class="p">(</span><span class="n">eq</span><span class="p">,</span> <span class="n">param</span><span class="o">=</span><span class="n">symbols</span><span class="p">(</span><span class="s">&quot;t&quot;</span><span class="p">,</span> <span class="n">integer</span><span class="o">=</span><span class="bp">True</span><span class="p">)):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Solves quadratic diophantine equations.</span>

<span class="sd">    i.e. equations of the form `Ax^2 + Bxy + Cy^2 + Dx + Ey + F = 0`. Returns a</span>
<span class="sd">    set containing the tuples `(x, y)` which contains the solutions. If there</span>
<span class="sd">    are no solutions then `(None, None)` is returned.</span>

<span class="sd">    Usage</span>
<span class="sd">    =====</span>

<span class="sd">    ``diop_quadratic(eq, param)``: ``eq`` is a quadratic binary diophantine</span>
<span class="sd">    equation. ``param`` is used to indicate the parameter to be used in the</span>
<span class="sd">    solution.</span>

<span class="sd">    Details</span>
<span class="sd">    =======</span>

<span class="sd">    ``eq`` should be an expression which is assumed to be zero.</span>
<span class="sd">    ``param`` is a parameter to be used in the solution.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.abc import x, y, t</span>
<span class="sd">    &gt;&gt;&gt; from sympy.solvers.diophantine import diop_quadratic</span>
<span class="sd">    &gt;&gt;&gt; diop_quadratic(x**2 + y**2 + 2*x + 2*y + 2, t)</span>
<span class="sd">    set([(-1, -1)])</span>

<span class="sd">    References</span>
<span class="sd">    ==========</span>

<span class="sd">    .. [1] Methods to solve Ax^2 + Bxy + Cy^2 + Dx + Ey + F = 0,[online],</span>
<span class="sd">          Available: http://www.alpertron.com.ar/METHODS.HTM</span>
<span class="sd">    .. [2] Solving the equation ax^2+ bxy + cy^2 + dx + ey + f= 0, [online],</span>
<span class="sd">          Available: http://www.jpr2718.org/ax2p.pdf</span>

<span class="sd">    See Also</span>
<span class="sd">    ========</span>

<span class="sd">    diop_linear(), diop_ternary_quadratic(), diop_general_sum_of_squares(),</span>
<span class="sd">    diop_general_pythagorean()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">var</span><span class="p">,</span> <span class="n">coeff</span><span class="p">,</span> <span class="n">diop_type</span> <span class="o">=</span> <span class="n">classify_diop</span><span class="p">(</span><span class="n">eq</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">diop_type</span> <span class="o">==</span> <span class="s">&quot;binary_quadratic&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_diop_quadratic</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">coeff</span><span class="p">,</span> <span class="n">param</span><span class="p">)</span>

</div>
<span class="k">def</span> <span class="nf">_diop_quadratic</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">coeff</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>

    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">var</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">term</span> <span class="ow">in</span> <span class="p">[</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">x</span><span class="o">*</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">Integer</span><span class="p">(</span><span class="mi">1</span><span class="p">)]:</span>
        <span class="k">if</span> <span class="n">term</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">coeff</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">coeff</span><span class="p">[</span><span class="n">term</span><span class="p">]</span> <span class="o">=</span> <span class="n">Integer</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">A</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">B</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="n">x</span><span class="o">*</span><span class="n">y</span><span class="p">]</span>
    <span class="n">C</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">D</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>
    <span class="n">E</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="n">y</span><span class="p">]</span>
    <span class="n">F</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="n">Integer</span><span class="p">(</span><span class="mi">1</span><span class="p">)]</span>

    <span class="n">d</span> <span class="o">=</span> <span class="n">igcd</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">igcd</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">igcd</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">igcd</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">igcd</span><span class="p">(</span><span class="n">E</span><span class="p">,</span> <span class="n">F</span><span class="p">)))))</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">A</span> <span class="o">//</span> <span class="n">d</span>
    <span class="n">B</span> <span class="o">=</span> <span class="n">B</span> <span class="o">//</span> <span class="n">d</span>
    <span class="n">C</span> <span class="o">=</span> <span class="n">C</span> <span class="o">//</span> <span class="n">d</span>
    <span class="n">D</span> <span class="o">=</span> <span class="n">D</span> <span class="o">//</span> <span class="n">d</span>
    <span class="n">E</span> <span class="o">=</span> <span class="n">E</span> <span class="o">//</span> <span class="n">d</span>
    <span class="n">F</span> <span class="o">=</span> <span class="n">F</span> <span class="o">//</span> <span class="n">d</span>

    <span class="c"># (1) Linear case: A = B = C = 0 ==&gt; considered under linear diophantine equations</span>

    <span class="c"># (2) Simple-Hyperbolic case:A = C = 0, B != 0</span>
    <span class="c"># In this case equation can be converted to (Bx + E)(By + D) = DE - BF</span>
    <span class="c"># We consider two cases; DE - BF = 0 and DE - BF != 0</span>
    <span class="c"># More details, http://www.alpertron.com.ar/METHODS.HTM#SHyperb</span>

    <span class="n">l</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>

    <span class="k">if</span> <span class="n">A</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">C</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">B</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>

        <span class="k">if</span> <span class="n">D</span><span class="o">*</span><span class="n">E</span> <span class="o">-</span> <span class="n">B</span><span class="o">*</span><span class="n">F</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">divisible</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">E</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">B</span><span class="p">)):</span>
                <span class="n">l</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="o">-</span><span class="n">E</span><span class="o">/</span><span class="n">B</span><span class="p">,</span> <span class="n">t</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">divisible</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">D</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">B</span><span class="p">)):</span>
                <span class="n">l</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">t</span><span class="p">,</span> <span class="o">-</span><span class="n">D</span><span class="o">/</span><span class="n">B</span><span class="p">))</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">div</span> <span class="o">=</span> <span class="n">divisors</span><span class="p">(</span><span class="n">D</span><span class="o">*</span><span class="n">E</span> <span class="o">-</span> <span class="n">B</span><span class="o">*</span><span class="n">F</span><span class="p">)</span>
            <span class="n">div</span> <span class="o">=</span> <span class="n">div</span> <span class="o">+</span> <span class="p">[</span><span class="o">-</span><span class="n">term</span> <span class="k">for</span> <span class="n">term</span> <span class="ow">in</span> <span class="n">div</span><span class="p">]</span>

            <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">div</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">divisible</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">d</span> <span class="o">-</span> <span class="n">E</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">B</span><span class="p">)):</span>
                    <span class="n">x0</span>  <span class="o">=</span> <span class="p">(</span><span class="n">d</span> <span class="o">-</span> <span class="n">E</span><span class="p">)</span> <span class="o">//</span> <span class="n">B</span>
                    <span class="k">if</span> <span class="n">divisible</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">D</span><span class="o">*</span><span class="n">E</span> <span class="o">-</span> <span class="n">B</span><span class="o">*</span><span class="n">F</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">d</span><span class="p">)):</span>
                        <span class="k">if</span> <span class="n">divisible</span><span class="p">(</span><span class="nb">int</span><span class="p">((</span><span class="n">D</span><span class="o">*</span><span class="n">E</span> <span class="o">-</span> <span class="n">B</span><span class="o">*</span><span class="n">F</span><span class="p">)</span><span class="o">//</span> <span class="n">d</span> <span class="o">-</span> <span class="n">D</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">B</span><span class="p">)):</span>
                            <span class="n">y0</span> <span class="o">=</span> <span class="p">((</span><span class="n">D</span><span class="o">*</span><span class="n">E</span> <span class="o">-</span> <span class="n">B</span><span class="o">*</span><span class="n">F</span><span class="p">)</span> <span class="o">//</span> <span class="n">d</span> <span class="o">-</span> <span class="n">D</span><span class="p">)</span> <span class="o">//</span> <span class="n">B</span>
                            <span class="n">l</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">))</span>

    <span class="c"># (3) Parabolic case: B**2 - 4*A*C = 0</span>
    <span class="c"># There are two subcases to be considered in this case.</span>
    <span class="c"># sqrt(c)D - sqrt(a)E = 0 and sqrt(c)D - sqrt(a)E != 0</span>
    <span class="c"># More Details, http://www.alpertron.com.ar/METHODS.HTM#Parabol</span>

    <span class="k">elif</span> <span class="n">B</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">4</span><span class="o">*</span><span class="n">A</span><span class="o">*</span><span class="n">C</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>

        <span class="k">if</span> <span class="n">A</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">_diop_quadratic</span><span class="p">([</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">],</span> <span class="n">coeff</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">soln</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
                <span class="n">l</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">soln</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">soln</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">g</span> <span class="o">=</span> <span class="n">igcd</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">C</span><span class="p">)</span>
            <span class="n">g</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">g</span><span class="p">)</span> <span class="o">*</span> <span class="n">sign</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">A</span> <span class="o">//</span> <span class="n">g</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">B</span> <span class="o">//</span> <span class="n">g</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">C</span> <span class="o">//</span> <span class="n">g</span>
            <span class="n">e</span> <span class="o">=</span> <span class="n">sign</span><span class="p">(</span><span class="n">B</span><span class="o">/</span><span class="n">A</span><span class="p">)</span>


            <span class="k">if</span> <span class="n">e</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="o">*</span><span class="n">D</span> <span class="o">-</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">*</span><span class="n">E</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">z</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s">&quot;z&quot;</span><span class="p">,</span> <span class="n">real</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                <span class="n">roots</span> <span class="o">=</span> <span class="n">solve</span><span class="p">(</span><span class="n">sqrt</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">*</span><span class="n">g</span><span class="o">*</span><span class="n">z</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">D</span><span class="o">*</span><span class="n">z</span> <span class="o">+</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">*</span><span class="n">F</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">root</span> <span class="ow">in</span> <span class="n">roots</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">Integer</span><span class="p">):</span>
                        <span class="n">l</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">diop_solve</span><span class="p">(</span><span class="n">sqrt</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">e</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="o">*</span><span class="n">y</span> <span class="o">-</span> <span class="n">root</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">diop_solve</span><span class="p">(</span><span class="n">sqrt</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">e</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="o">*</span><span class="n">y</span> <span class="o">-</span> <span class="n">root</span><span class="p">)[</span><span class="mi">1</span><span class="p">]))</span>

            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="o">*</span><span class="n">D</span> <span class="o">-</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">*</span><span class="n">E</span><span class="p">,</span> <span class="n">Integer</span><span class="p">):</span>
                <span class="n">solve_x</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">u</span><span class="p">:</span> <span class="n">e</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="o">*</span><span class="n">g</span><span class="o">*</span><span class="p">(</span><span class="n">sqrt</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">*</span><span class="n">E</span> <span class="o">-</span> <span class="n">e</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="o">*</span><span class="n">D</span><span class="p">)</span><span class="o">*</span><span class="n">t</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="p">(</span><span class="n">E</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">e</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="o">*</span><span class="n">g</span><span class="o">*</span><span class="n">u</span><span class="p">)</span><span class="o">*</span><span class="n">t</span>\
                    <span class="o">-</span> <span class="p">(</span><span class="n">e</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="o">*</span><span class="n">g</span><span class="o">*</span><span class="n">u</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">E</span><span class="o">*</span><span class="n">u</span> <span class="o">+</span> <span class="n">e</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="o">*</span><span class="n">F</span><span class="p">)</span> <span class="o">//</span> <span class="p">(</span><span class="n">e</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="o">*</span><span class="n">D</span> <span class="o">-</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">*</span><span class="n">E</span><span class="p">)</span>

                <span class="n">solve_y</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">u</span><span class="p">:</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">*</span><span class="n">g</span><span class="o">*</span><span class="p">(</span><span class="n">e</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="o">*</span><span class="n">D</span> <span class="o">-</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">*</span><span class="n">E</span><span class="p">)</span><span class="o">*</span><span class="n">t</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">*</span><span class="n">g</span><span class="o">*</span><span class="n">u</span><span class="p">)</span><span class="o">*</span><span class="n">t</span> \
                    <span class="o">+</span> <span class="p">(</span><span class="n">sqrt</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">*</span><span class="n">g</span><span class="o">*</span><span class="n">u</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">D</span><span class="o">*</span><span class="n">u</span> <span class="o">+</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">*</span><span class="n">F</span><span class="p">)</span> <span class="o">//</span> <span class="p">(</span><span class="n">e</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="o">*</span><span class="n">D</span> <span class="o">-</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">*</span><span class="n">E</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">z0</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">e</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="o">*</span><span class="n">D</span> <span class="o">-</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">*</span><span class="n">E</span><span class="p">)):</span>
                    <span class="k">if</span> <span class="n">divisible</span><span class="p">(</span><span class="n">sqrt</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">*</span><span class="n">g</span><span class="o">*</span><span class="n">z0</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">D</span><span class="o">*</span><span class="n">z0</span> <span class="o">+</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">*</span><span class="n">F</span><span class="p">,</span> <span class="n">e</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="o">*</span><span class="n">D</span> <span class="o">-</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">*</span><span class="n">E</span><span class="p">):</span>
                        <span class="n">l</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">solve_x</span><span class="p">(</span><span class="n">z0</span><span class="p">),</span> <span class="n">solve_y</span><span class="p">(</span><span class="n">z0</span><span class="p">)))</span>

    <span class="c"># (4) Method used when B**2 - 4*A*C is a square, is descibed in p. 6 of the below paper</span>
    <span class="c"># by John P. Robertson.</span>
    <span class="c"># http://www.jpr2718.org/ax2p.pdf</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sqrt</span><span class="p">(</span><span class="n">B</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">4</span><span class="o">*</span><span class="n">A</span><span class="o">*</span><span class="n">C</span><span class="p">),</span> <span class="n">Integer</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">A</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">B</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">4</span><span class="o">*</span><span class="n">A</span><span class="o">*</span><span class="n">C</span><span class="p">)</span>
            <span class="n">u</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s">&quot;u, v&quot;</span><span class="p">,</span> <span class="n">integer</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="n">eq</span> <span class="o">=</span> <span class="n">_mexpand</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">A</span><span class="o">*</span><span class="n">r</span><span class="o">*</span><span class="n">u</span><span class="o">*</span><span class="n">v</span> <span class="o">+</span> <span class="mi">4</span><span class="o">*</span><span class="n">A</span><span class="o">*</span><span class="n">D</span><span class="o">*</span><span class="p">(</span><span class="n">B</span><span class="o">*</span><span class="n">v</span> <span class="o">+</span> <span class="n">r</span><span class="o">*</span><span class="n">u</span> <span class="o">+</span> <span class="n">r</span><span class="o">*</span><span class="n">v</span> <span class="o">-</span> <span class="n">B</span><span class="o">*</span><span class="n">u</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">A</span><span class="o">*</span><span class="mi">4</span><span class="o">*</span><span class="n">A</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="p">(</span><span class="n">u</span> <span class="o">-</span> <span class="n">v</span><span class="p">)</span> <span class="o">+</span> <span class="mi">4</span><span class="o">*</span><span class="n">A</span><span class="o">*</span><span class="n">r</span><span class="o">*</span><span class="mi">4</span><span class="o">*</span><span class="n">A</span><span class="o">*</span><span class="n">F</span><span class="p">)</span>

            <span class="n">sol</span> <span class="o">=</span> <span class="n">diop_solve</span><span class="p">(</span><span class="n">eq</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
            <span class="n">sol</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">sol</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">solution</span> <span class="ow">in</span> <span class="n">sol</span><span class="p">:</span>
                <span class="n">s0</span> <span class="o">=</span> <span class="n">solution</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">t0</span> <span class="o">=</span> <span class="n">solution</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

                <span class="n">x_0</span> <span class="o">=</span> <span class="n">S</span><span class="p">(</span><span class="n">B</span><span class="o">*</span><span class="n">t0</span> <span class="o">+</span> <span class="n">r</span><span class="o">*</span><span class="n">s0</span> <span class="o">+</span> <span class="n">r</span><span class="o">*</span><span class="n">t0</span> <span class="o">-</span> <span class="n">B</span><span class="o">*</span><span class="n">s0</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">A</span><span class="o">*</span><span class="n">r</span><span class="p">)</span>
                <span class="n">y_0</span> <span class="o">=</span> <span class="n">S</span><span class="p">(</span><span class="n">s0</span> <span class="o">-</span> <span class="n">t0</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">r</span><span class="p">)</span>

                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s0</span><span class="p">,</span> <span class="n">Symbol</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">t0</span><span class="p">,</span> <span class="n">Symbol</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">check_param</span><span class="p">(</span><span class="n">x_0</span><span class="p">,</span> <span class="n">y_0</span><span class="p">,</span> <span class="mi">4</span><span class="o">*</span><span class="n">A</span><span class="o">*</span><span class="n">r</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span> <span class="o">!=</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">):</span>
                        <span class="n">l</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">check_param</span><span class="p">(</span><span class="n">x_0</span><span class="p">,</span> <span class="n">y_0</span><span class="p">,</span> <span class="mi">4</span><span class="o">*</span><span class="n">A</span><span class="o">*</span><span class="n">r</span><span class="p">,</span> <span class="n">t</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">check_param</span><span class="p">(</span><span class="n">x_0</span><span class="p">,</span> <span class="n">y_0</span><span class="p">,</span> <span class="mi">4</span><span class="o">*</span><span class="n">A</span><span class="o">*</span><span class="n">r</span><span class="p">,</span> <span class="n">t</span><span class="p">)[</span><span class="mi">1</span><span class="p">]))</span>

                <span class="k">elif</span> <span class="n">divisible</span><span class="p">(</span><span class="n">B</span><span class="o">*</span><span class="n">t0</span> <span class="o">+</span> <span class="n">r</span><span class="o">*</span><span class="n">s0</span> <span class="o">+</span> <span class="n">r</span><span class="o">*</span><span class="n">t0</span> <span class="o">-</span> <span class="n">B</span><span class="o">*</span><span class="n">s0</span><span class="p">,</span> <span class="mi">4</span><span class="o">*</span><span class="n">A</span><span class="o">*</span><span class="n">r</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">divisible</span><span class="p">(</span><span class="n">s0</span> <span class="o">-</span> <span class="n">t0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">r</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">is_solution_quad</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">coeff</span><span class="p">,</span> <span class="n">x_0</span><span class="p">,</span> <span class="n">y_0</span><span class="p">):</span>
                            <span class="n">l</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">x_0</span><span class="p">,</span> <span class="n">y_0</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_var</span> <span class="o">=</span> <span class="n">var</span>
            <span class="n">_var</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">_var</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">_var</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">_var</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c"># Interchange x and y</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">_diop_quadratic</span><span class="p">(</span><span class="n">_var</span><span class="p">,</span> <span class="n">coeff</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>

            <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">sol</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                <span class="n">l</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">sol</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">sol</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>


    <span class="c"># (5) B**2 - 4*A*C &gt; 0 and B**2 - 4*A*C not a square or B**2 - 4*A*C &lt; 0</span>

    <span class="k">else</span><span class="p">:</span>

        <span class="n">P</span><span class="p">,</span> <span class="n">Q</span> <span class="o">=</span> <span class="n">_transformation_to_DN</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">coeff</span><span class="p">)</span>
        <span class="n">D</span><span class="p">,</span> <span class="n">N</span> <span class="o">=</span> <span class="n">_find_DN</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">coeff</span><span class="p">)</span>
        <span class="n">solns_pell</span> <span class="o">=</span> <span class="n">diop_DN</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">D</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">solution</span> <span class="ow">in</span> <span class="n">solns_pell</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">X_i</span> <span class="ow">in</span> <span class="p">[</span><span class="o">-</span><span class="n">solution</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">solution</span><span class="p">[</span><span class="mi">0</span><span class="p">]]:</span>
                    <span class="k">for</span> <span class="n">Y_i</span> <span class="ow">in</span> <span class="p">[</span><span class="o">-</span><span class="n">solution</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">solution</span><span class="p">[</span><span class="mi">1</span><span class="p">]]:</span>
                        <span class="n">x_i</span><span class="p">,</span> <span class="n">y_i</span> <span class="o">=</span> <span class="p">(</span><span class="n">P</span><span class="o">*</span><span class="n">Matrix</span><span class="p">([</span><span class="n">X_i</span><span class="p">,</span> <span class="n">Y_i</span><span class="p">])</span> <span class="o">+</span> <span class="n">Q</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="n">P</span><span class="o">*</span><span class="n">Matrix</span><span class="p">([</span><span class="n">X_i</span><span class="p">,</span> <span class="n">Y_i</span><span class="p">])</span> <span class="o">+</span> <span class="n">Q</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x_i</span><span class="p">,</span> <span class="n">Integer</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">y_i</span><span class="p">,</span> <span class="n">Integer</span><span class="p">):</span>
                            <span class="n">l</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">x_i</span><span class="p">,</span> <span class="n">y_i</span><span class="p">))</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c"># In this case equation can be transformed into a Pell equation</span>
            <span class="c">#n = symbols(&quot;n&quot;, integer=True)</span>

            <span class="n">a</span> <span class="o">=</span> <span class="n">diop_DN</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">T</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">U</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>

            <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">P</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Integer</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">P</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">Integer</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">P</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">Integer</span><span class="p">)</span>
                <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">P</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">Integer</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">Q</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Integer</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">Q</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">Integer</span><span class="p">)):</span>

                <span class="k">for</span> <span class="n">sol</span> <span class="ow">in</span> <span class="n">solns_pell</span><span class="p">:</span>

                    <span class="n">r</span> <span class="o">=</span> <span class="n">sol</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">s</span> <span class="o">=</span> <span class="n">sol</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">x_n</span> <span class="o">=</span> <span class="n">S</span><span class="p">((</span><span class="n">r</span> <span class="o">+</span> <span class="n">s</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="n">D</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="n">T</span> <span class="o">+</span> <span class="n">U</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="n">D</span><span class="p">))</span><span class="o">**</span><span class="n">t</span> <span class="o">+</span> <span class="p">(</span><span class="n">r</span> <span class="o">-</span> <span class="n">s</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="n">D</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="n">T</span> <span class="o">-</span> <span class="n">U</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="n">D</span><span class="p">))</span><span class="o">**</span><span class="n">t</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
                    <span class="n">y_n</span> <span class="o">=</span> <span class="n">S</span><span class="p">((</span><span class="n">r</span> <span class="o">+</span> <span class="n">s</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="n">D</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="n">T</span> <span class="o">+</span> <span class="n">U</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="n">D</span><span class="p">))</span><span class="o">**</span><span class="n">t</span> <span class="o">-</span> <span class="p">(</span><span class="n">r</span> <span class="o">-</span> <span class="n">s</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="n">D</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="n">T</span> <span class="o">-</span> <span class="n">U</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="n">D</span><span class="p">))</span><span class="o">**</span><span class="n">t</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="n">D</span><span class="p">))</span>

                    <span class="n">x_n</span> <span class="o">=</span> <span class="n">_mexpand</span><span class="p">(</span><span class="n">x_n</span><span class="p">)</span>
                    <span class="n">y_n</span> <span class="o">=</span> <span class="n">_mexpand</span><span class="p">(</span><span class="n">y_n</span><span class="p">)</span>
                    <span class="n">x_n</span><span class="p">,</span> <span class="n">y_n</span> <span class="o">=</span> <span class="p">(</span><span class="n">P</span><span class="o">*</span><span class="n">Matrix</span><span class="p">([</span><span class="n">x_n</span><span class="p">,</span> <span class="n">y_n</span><span class="p">])</span> <span class="o">+</span> <span class="n">Q</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="n">P</span><span class="o">*</span><span class="n">Matrix</span><span class="p">([</span><span class="n">x_n</span><span class="p">,</span> <span class="n">y_n</span><span class="p">])</span> <span class="o">+</span> <span class="n">Q</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

                    <span class="n">l</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">x_n</span><span class="p">,</span> <span class="n">y_n</span><span class="p">))</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">L</span> <span class="o">=</span> <span class="n">ilcm</span><span class="p">(</span><span class="n">S</span><span class="p">(</span><span class="n">P</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">q</span><span class="p">,</span> <span class="n">ilcm</span><span class="p">(</span><span class="n">S</span><span class="p">(</span><span class="n">P</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">q</span><span class="p">,</span> <span class="n">ilcm</span><span class="p">(</span><span class="n">S</span><span class="p">(</span><span class="n">P</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">q</span><span class="p">,</span> <span class="n">ilcm</span><span class="p">(</span><span class="n">S</span><span class="p">(</span><span class="n">P</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span><span class="o">.</span><span class="n">q</span><span class="p">,</span> <span class="n">ilcm</span><span class="p">(</span><span class="n">S</span><span class="p">(</span><span class="n">Q</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">q</span><span class="p">,</span> <span class="n">S</span><span class="p">(</span><span class="n">Q</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">q</span><span class="p">)))))</span>

                <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">done</span> <span class="o">=</span> <span class="bp">False</span>

                <span class="n">T_k</span> <span class="o">=</span> <span class="n">T</span>
                <span class="n">U_k</span> <span class="o">=</span> <span class="n">U</span>

                <span class="k">while</span> <span class="ow">not</span> <span class="n">done</span><span class="p">:</span>
                    <span class="n">k</span> <span class="o">=</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span>

                    <span class="k">if</span> <span class="p">(</span><span class="n">T_k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">L</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">U_k</span> <span class="o">%</span> <span class="n">L</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">done</span> <span class="o">=</span> <span class="bp">True</span>
                    <span class="n">T_k</span><span class="p">,</span> <span class="n">U_k</span> <span class="o">=</span> <span class="n">T_k</span><span class="o">*</span><span class="n">T</span> <span class="o">+</span> <span class="n">D</span><span class="o">*</span><span class="n">U_k</span><span class="o">*</span><span class="n">U</span><span class="p">,</span> <span class="n">T_k</span><span class="o">*</span><span class="n">U</span> <span class="o">+</span> <span class="n">U_k</span><span class="o">*</span><span class="n">T</span>

                <span class="k">for</span> <span class="n">soln</span> <span class="ow">in</span> <span class="n">solns_pell</span><span class="p">:</span>

                    <span class="n">X</span> <span class="o">=</span> <span class="n">soln</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">Y</span> <span class="o">=</span> <span class="n">soln</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

                    <span class="n">done</span> <span class="o">=</span> <span class="bp">False</span>

                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>

                        <span class="n">X_1</span> <span class="o">=</span> <span class="n">X</span><span class="o">*</span><span class="n">T</span> <span class="o">+</span> <span class="n">D</span><span class="o">*</span><span class="n">U</span><span class="o">*</span><span class="n">Y</span>
                        <span class="n">Y_1</span> <span class="o">=</span> <span class="n">X</span><span class="o">*</span><span class="n">U</span> <span class="o">+</span> <span class="n">Y</span><span class="o">*</span><span class="n">T</span>

                        <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">P</span><span class="o">*</span><span class="n">Matrix</span><span class="p">([</span><span class="n">X_1</span><span class="p">,</span> <span class="n">Y_1</span><span class="p">])</span> <span class="o">+</span> <span class="n">Q</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="n">P</span><span class="o">*</span><span class="n">Matrix</span><span class="p">([</span><span class="n">X_1</span><span class="p">,</span> <span class="n">Y_1</span><span class="p">])</span> <span class="o">+</span> <span class="n">Q</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

                        <span class="k">if</span> <span class="n">is_solution_quad</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">coeff</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
                            <span class="n">done</span> <span class="o">=</span> <span class="bp">True</span>


                            <span class="n">x_n</span> <span class="o">=</span> <span class="n">S</span><span class="p">(</span> <span class="p">(</span><span class="n">X_1</span> <span class="o">+</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">D</span><span class="p">)</span><span class="o">*</span><span class="n">Y_1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">T</span> <span class="o">+</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">D</span><span class="p">)</span><span class="o">*</span><span class="n">U</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">t</span><span class="o">*</span><span class="n">L</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">X_1</span> <span class="o">-</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">D</span><span class="p">)</span><span class="o">*</span><span class="n">Y_1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">T</span> <span class="o">-</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">D</span><span class="p">)</span><span class="o">*</span><span class="n">U</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">t</span><span class="o">*</span><span class="n">L</span><span class="p">)</span> <span class="p">)</span><span class="o">/</span> <span class="mi">2</span>
                            <span class="n">y_n</span> <span class="o">=</span> <span class="n">S</span><span class="p">(</span> <span class="p">(</span><span class="n">X_1</span> <span class="o">+</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">D</span><span class="p">)</span><span class="o">*</span><span class="n">Y_1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">T</span> <span class="o">+</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">D</span><span class="p">)</span><span class="o">*</span><span class="n">U</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">t</span><span class="o">*</span><span class="n">L</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">X_1</span> <span class="o">-</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">D</span><span class="p">)</span><span class="o">*</span><span class="n">Y_1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">T</span> <span class="o">-</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">D</span><span class="p">)</span><span class="o">*</span><span class="n">U</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">t</span><span class="o">*</span><span class="n">L</span><span class="p">)</span> <span class="p">)</span><span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="n">D</span><span class="p">))</span>

                            <span class="n">x_n</span> <span class="o">=</span> <span class="n">_mexpand</span><span class="p">(</span><span class="n">x_n</span><span class="p">)</span>
                            <span class="n">y_n</span> <span class="o">=</span> <span class="n">_mexpand</span><span class="p">(</span><span class="n">y_n</span><span class="p">)</span>
                            <span class="n">x_n</span><span class="p">,</span> <span class="n">y_n</span> <span class="o">=</span> <span class="p">(</span><span class="n">P</span><span class="o">*</span><span class="n">Matrix</span><span class="p">([</span><span class="n">x_n</span><span class="p">,</span> <span class="n">y_n</span><span class="p">])</span> <span class="o">+</span> <span class="n">Q</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="n">P</span><span class="o">*</span><span class="n">Matrix</span><span class="p">([</span><span class="n">x_n</span><span class="p">,</span> <span class="n">y_n</span><span class="p">])</span> <span class="o">+</span> <span class="n">Q</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                            <span class="n">l</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">x_n</span><span class="p">,</span> <span class="n">y_n</span><span class="p">))</span>

                        <span class="k">if</span> <span class="n">done</span><span class="p">:</span>
                            <span class="k">break</span>


    <span class="k">return</span> <span class="n">l</span>


<span class="k">def</span> <span class="nf">is_solution_quad</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">coeff</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check whether `(u, v)` is solution to the quadratic binary diophantine</span>
<span class="sd">    equation with the variable list ``var`` and coefficient dictionary</span>
<span class="sd">    ``coeff``.</span>

<span class="sd">    Not intended for use by normal users.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">var</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>

    <span class="n">eq</span> <span class="o">=</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">coeff</span><span class="p">[</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="o">*</span><span class="n">y</span><span class="o">*</span><span class="n">coeff</span><span class="p">[</span><span class="n">x</span><span class="o">*</span><span class="n">y</span><span class="p">]</span> <span class="o">+</span> <span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">coeff</span><span class="p">[</span><span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="o">*</span><span class="n">coeff</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">+</span> <span class="n">y</span><span class="o">*</span><span class="n">coeff</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="o">+</span> <span class="n">coeff</span><span class="p">[</span><span class="n">Integer</span><span class="p">(</span><span class="mi">1</span><span class="p">)]</span>

    <span class="k">return</span> <span class="n">_mexpand</span><span class="p">(</span><span class="n">Subs</span><span class="p">(</span><span class="n">eq</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">))</span><span class="o">.</span><span class="n">doit</span><span class="p">())</span> <span class="o">==</span> <span class="mi">0</span>


<div class="viewcode-block" id="diop_DN"><a class="viewcode-back" href="../../../modules/solvers/diophantine.html#sympy.solvers.diophantine.diop_DN">[docs]</a><span class="k">def</span> <span class="nf">diop_DN</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="n">symbols</span><span class="p">(</span><span class="s">&quot;t&quot;</span><span class="p">,</span> <span class="n">integer</span><span class="o">=</span><span class="bp">True</span><span class="p">)):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Solves the equation `x^2 - Dy^2 = N`.</span>

<span class="sd">    Mainly concerned in the case `D &gt; 0, D` is not a perfect square, which is</span>
<span class="sd">    the same as generalized Pell equation. To solve the generalized Pell</span>
<span class="sd">    equation this function Uses LMM algorithm. Refer [1]_ for more details on</span>
<span class="sd">    the algorithm.</span>
<span class="sd">    Returns one solution for each class of the solutions. Other solutions of</span>
<span class="sd">    the class can be constructed according to the values of ``D`` and ``N``.</span>
<span class="sd">    Returns a list containing the solution tuples `(x, y)`.</span>

<span class="sd">    Usage</span>
<span class="sd">    =====</span>

<span class="sd">    ``diop_DN(D, N, t)``: D and N are integers as in `x^2 - Dy^2 = N` and</span>
<span class="sd">    ``t`` is the parameter to be used in the solutions.</span>

<span class="sd">    Details</span>
<span class="sd">    =======</span>

<span class="sd">    ``D`` and ``N`` correspond to D and N in the equation.</span>
<span class="sd">    ``t`` is the parameter to be used in the solutions.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.solvers.diophantine import diop_DN</span>
<span class="sd">    &gt;&gt;&gt; diop_DN(13, -4) # Solves equation x**2 - 13*y**2 = -4</span>
<span class="sd">    [(3, 1), (393, 109), (36, 10)]</span>

<span class="sd">    The output can be interpreted as follows: There are three fundamental</span>
<span class="sd">    solutions to the equation `x^2 - 13y^2 = -4` given by (3, 1), (393, 109)</span>
<span class="sd">    and (36, 10). Each tuple is in the form (x, y), i. e solution (3, 1) means</span>
<span class="sd">    that `x = 3` and `y = 1`.</span>

<span class="sd">    &gt;&gt;&gt; diop_DN(986, 1) # Solves equation x**2 - 986*y**2 = 1</span>
<span class="sd">    [(49299, 1570)]</span>

<span class="sd">    See Also</span>
<span class="sd">    ========</span>

<span class="sd">    find_DN(), diop_bf_DN()</span>

<span class="sd">    References</span>
<span class="sd">    ==========</span>

<span class="sd">    .. [1] Solving the generalized Pell equation x**2 - D*y**2 = N, John P.</span>
<span class="sd">        Robertson, July 31, 2004, Pages 16 - 17. [online], Available:</span>
<span class="sd">        http://www.jpr2718.org/pell.pdf</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">D</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">N</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[(</span><span class="n">S</span><span class="o">.</span><span class="n">Zero</span><span class="p">,</span> <span class="n">S</span><span class="o">.</span><span class="n">Zero</span><span class="p">)]</span>
        <span class="k">elif</span> <span class="n">N</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>
        <span class="k">elif</span> <span class="n">N</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">divisors</span><span class="p">(</span><span class="n">square_factor</span><span class="p">(</span><span class="n">N</span><span class="p">))</span>
            <span class="n">sol</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">divisor</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
                <span class="n">sols</span> <span class="o">=</span> <span class="n">cornacchia</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="n">D</span><span class="p">,</span> <span class="n">N</span> <span class="o">//</span> <span class="n">divisor</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">sols</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">sols</span><span class="p">:</span>
                        <span class="n">sol</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">divisor</span><span class="o">*</span><span class="n">x</span><span class="p">,</span> <span class="n">divisor</span><span class="o">*</span><span class="n">y</span><span class="p">))</span>

            <span class="k">return</span> <span class="n">sol</span>

    <span class="k">elif</span> <span class="n">D</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">N</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sqrt</span><span class="p">(</span><span class="n">N</span><span class="p">),</span> <span class="n">Integer</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">N</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[(</span><span class="n">S</span><span class="o">.</span><span class="n">Zero</span><span class="p">,</span> <span class="n">t</span><span class="p">)]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sqrt</span><span class="p">(</span><span class="n">N</span><span class="p">),</span> <span class="n">Integer</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">[(</span><span class="n">sqrt</span><span class="p">(</span><span class="n">N</span><span class="p">),</span> <span class="n">t</span><span class="p">)]</span>

    <span class="k">else</span><span class="p">:</span> <span class="c"># D &gt; 0</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sqrt</span><span class="p">(</span><span class="n">D</span><span class="p">),</span> <span class="n">Integer</span><span class="p">):</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">D</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">N</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[(</span><span class="n">r</span><span class="o">*</span><span class="n">t</span><span class="p">,</span> <span class="n">t</span><span class="p">)]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sol</span> <span class="o">=</span> <span class="p">[]</span>

                <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">floor</span><span class="p">(</span><span class="n">sign</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">N</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">r</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sqrt</span><span class="p">(</span><span class="n">D</span><span class="o">*</span><span class="n">y</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">N</span><span class="p">),</span> <span class="n">Integer</span><span class="p">):</span>
                        <span class="n">sol</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">sqrt</span><span class="p">(</span><span class="n">D</span><span class="o">*</span><span class="n">y</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">N</span><span class="p">),</span> <span class="n">y</span><span class="p">))</span>

                <span class="k">return</span> <span class="n">sol</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">N</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[(</span><span class="n">S</span><span class="o">.</span><span class="n">Zero</span><span class="p">,</span> <span class="n">S</span><span class="o">.</span><span class="n">Zero</span><span class="p">)]</span>

            <span class="k">elif</span> <span class="nb">abs</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>

                <span class="n">pqa</span> <span class="o">=</span> <span class="n">PQa</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">D</span><span class="p">)</span>
                <span class="n">a_0</span> <span class="o">=</span> <span class="n">floor</span><span class="p">(</span><span class="n">sqrt</span><span class="p">(</span><span class="n">D</span><span class="p">))</span>
                <span class="n">l</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">G</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">B</span> <span class="o">=</span> <span class="p">[]</span>

                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">pqa</span><span class="p">:</span>

                    <span class="n">a</span> <span class="o">=</span> <span class="n">i</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                    <span class="n">G</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
                    <span class="n">B</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>

                    <span class="k">if</span> <span class="n">l</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">a</span> <span class="o">==</span> <span class="mi">2</span><span class="o">*</span><span class="n">a_0</span><span class="p">:</span>
                        <span class="k">break</span>
                    <span class="n">l</span> <span class="o">=</span> <span class="n">l</span> <span class="o">+</span> <span class="mi">1</span>

                <span class="k">if</span> <span class="n">l</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>

                    <span class="k">if</span> <span class="n">N</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                        <span class="n">x</span> <span class="o">=</span> <span class="n">G</span><span class="p">[</span><span class="n">l</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                        <span class="n">y</span> <span class="o">=</span> <span class="n">B</span><span class="p">[</span><span class="n">l</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">count</span> <span class="o">=</span> <span class="n">l</span>
                        <span class="k">while</span> <span class="n">count</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="o">*</span><span class="n">l</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                            <span class="n">i</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">pqa</span><span class="p">)</span>
                            <span class="n">G</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
                            <span class="n">B</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
                            <span class="n">count</span> <span class="o">=</span> <span class="n">count</span> <span class="o">+</span> <span class="mi">1</span>

                        <span class="n">x</span> <span class="o">=</span> <span class="n">G</span><span class="p">[</span><span class="n">count</span><span class="p">]</span>
                        <span class="n">y</span> <span class="o">=</span> <span class="n">B</span><span class="p">[</span><span class="n">count</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">N</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">x</span> <span class="o">=</span> <span class="n">G</span><span class="p">[</span><span class="n">l</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                        <span class="n">y</span> <span class="o">=</span> <span class="n">B</span><span class="p">[</span><span class="n">l</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">return</span> <span class="p">[]</span>

                <span class="k">return</span> <span class="p">[(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)]</span>

            <span class="k">else</span><span class="p">:</span>

                <span class="n">fs</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">sol</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">div</span> <span class="o">=</span> <span class="n">divisors</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">div</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">divisible</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">d</span><span class="o">**</span><span class="mi">2</span><span class="p">):</span>
                        <span class="n">fs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fs</span><span class="p">:</span>
                    <span class="n">m</span> <span class="o">=</span> <span class="n">N</span> <span class="o">//</span> <span class="n">f</span><span class="o">**</span><span class="mi">2</span>
                    <span class="n">zs</span> <span class="o">=</span> <span class="n">sqrt_mod</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">m</span><span class="p">),</span> <span class="bp">True</span><span class="p">)</span>

                    <span class="n">zs</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">zs</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span> <span class="p">]</span>
                    <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="n">zs</span> <span class="o">=</span> <span class="n">zs</span> <span class="o">+</span> <span class="p">[</span><span class="o">-</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">zs</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">S</span><span class="o">.</span><span class="n">Zero</span> <span class="ow">in</span> <span class="n">zs</span><span class="p">:</span>
                            <span class="n">zs</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">Zero</span><span class="p">)</span> <span class="c"># Remove duplicate zero</span>

                    <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">zs</span><span class="p">:</span>

                        <span class="n">pqa</span> <span class="o">=</span> <span class="n">PQa</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">m</span><span class="p">),</span> <span class="n">D</span><span class="p">)</span>
                        <span class="n">l</span> <span class="o">=</span> <span class="mi">0</span>
                        <span class="n">G</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="n">B</span> <span class="o">=</span> <span class="p">[]</span>

                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">pqa</span><span class="p">:</span>

                            <span class="n">a</span> <span class="o">=</span> <span class="n">i</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                            <span class="n">G</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
                            <span class="n">B</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>

                            <span class="k">if</span> <span class="n">l</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                                <span class="n">r</span> <span class="o">=</span> <span class="n">G</span><span class="p">[</span><span class="n">l</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                                <span class="n">s</span> <span class="o">=</span> <span class="n">B</span><span class="p">[</span><span class="n">l</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

                                <span class="k">if</span> <span class="n">r</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">D</span><span class="o">*</span><span class="n">s</span><span class="o">**</span><span class="mi">2</span> <span class="o">==</span> <span class="n">m</span><span class="p">:</span>
                                    <span class="n">sol</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">f</span><span class="o">*</span><span class="n">r</span><span class="p">,</span> <span class="n">f</span><span class="o">*</span><span class="n">s</span><span class="p">))</span>

                                <span class="k">elif</span> <span class="n">diop_DN</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="p">[]:</span>
                                    <span class="n">a</span> <span class="o">=</span> <span class="n">diop_DN</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                                    <span class="n">sol</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">f</span><span class="o">*</span><span class="p">(</span><span class="n">r</span><span class="o">*</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">s</span><span class="o">*</span><span class="n">D</span><span class="p">),</span> <span class="n">f</span><span class="o">*</span><span class="p">(</span><span class="n">r</span><span class="o">*</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">s</span><span class="o">*</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])))</span>

                                <span class="k">break</span>

                            <span class="n">l</span> <span class="o">=</span> <span class="n">l</span> <span class="o">+</span> <span class="mi">1</span>
                            <span class="k">if</span> <span class="n">l</span> <span class="o">==</span> <span class="n">length</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">m</span><span class="p">),</span> <span class="n">D</span><span class="p">):</span>
                                <span class="k">break</span>

                <span class="k">return</span> <span class="n">sol</span>

</div>
<div class="viewcode-block" id="cornacchia"><a class="viewcode-back" href="../../../modules/solvers/diophantine.html#sympy.solvers.diophantine.cornacchia">[docs]</a><span class="k">def</span> <span class="nf">cornacchia</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Solves `ax^2 + by^2 = m` where `\gcd(a, b) = 1 = gcd(a, m)` and `a, b &gt; 0`.</span>

<span class="sd">    Uses the algorithm due to Cornacchia. The method only finds primitive</span>
<span class="sd">    solutions, i.e. ones with `\gcd(x, y) = 1`. So this method can&#39;t be used to</span>
<span class="sd">    find the solutions of `x^2 + y^2 = 20` since the only solution to former is</span>
<span class="sd">    `(x,y) = (4, 2)` and it is not primitive. When ` a = b = 1`, only the</span>
<span class="sd">    solutions with `x \geq y` are found. For more details, see the References.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.solvers.diophantine import cornacchia</span>
<span class="sd">    &gt;&gt;&gt; cornacchia(2, 3, 35) # equation 2x**2 + 3y**2 = 35</span>
<span class="sd">    set([(2, 3), (4, 1)])</span>
<span class="sd">    &gt;&gt;&gt; cornacchia(1, 1, 25) # equation x**2 + y**2 = 25</span>
<span class="sd">    set([(4, 3)])</span>

<span class="sd">    References</span>
<span class="sd">    ===========</span>

<span class="sd">    .. [1] A. Nitaj, &quot;L&#39;algorithme de Cornacchia&quot;</span>
<span class="sd">    .. [2] Solving the diophantine equation ax**2 + by**2 = m by Cornacchia&#39;s</span>
<span class="sd">        method, [online], Available:</span>
<span class="sd">        http://www.numbertheory.org/php/cornacchia.html</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sols</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>

    <span class="n">a1</span> <span class="o">=</span> <span class="n">igcdex</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">m</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">sqrt_mod</span><span class="p">(</span><span class="o">-</span><span class="n">b</span><span class="o">*</span><span class="n">a1</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">None</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="n">v</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">v</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">t</span> <span class="o">&lt;</span> <span class="n">m</span> <span class="o">//</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">continue</span>

        <span class="n">u</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="n">t</span><span class="p">,</span> <span class="n">m</span>

        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
            <span class="n">u</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="n">r</span><span class="p">,</span> <span class="n">u</span> <span class="o">%</span> <span class="n">r</span>
            <span class="k">if</span> <span class="n">a</span><span class="o">*</span><span class="n">r</span><span class="o">**</span><span class="mi">2</span> <span class="o">&lt;</span> <span class="n">m</span><span class="p">:</span>
                <span class="k">break</span>

        <span class="n">m1</span> <span class="o">=</span> <span class="n">m</span> <span class="o">-</span> <span class="n">a</span><span class="o">*</span><span class="n">r</span><span class="o">**</span><span class="mi">2</span>

        <span class="k">if</span> <span class="n">m1</span> <span class="o">%</span> <span class="n">b</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">m1</span> <span class="o">=</span> <span class="n">m1</span> <span class="o">//</span> <span class="n">b</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sqrt</span><span class="p">(</span><span class="n">m1</span><span class="p">),</span> <span class="n">Integer</span><span class="p">):</span>
                <span class="n">s</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">m1</span><span class="p">)</span>
                <span class="n">sols</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="nb">int</span><span class="p">(</span><span class="n">r</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">s</span><span class="p">)))</span>

    <span class="k">return</span> <span class="n">sols</span>

</div>
<div class="viewcode-block" id="PQa"><a class="viewcode-back" href="../../../modules/solvers/diophantine.html#sympy.solvers.diophantine.PQa">[docs]</a><span class="k">def</span> <span class="nf">PQa</span><span class="p">(</span><span class="n">P_0</span><span class="p">,</span> <span class="n">Q_0</span><span class="p">,</span> <span class="n">D</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns useful information needed to solve the Pell equation.</span>

<span class="sd">    There are six sequences of integers defined related to the continued</span>
<span class="sd">    fraction representation of `\\frac{P + \sqrt{D}}{Q}`, namely {`P_{i}`},</span>
<span class="sd">    {`Q_{i}`}, {`a_{i}`},{`A_{i}`}, {`B_{i}`}, {`G_{i}`}. ``PQa()`` Returns</span>
<span class="sd">    these values as a 6-tuple in the same order as mentioned above. Refer [1]_</span>
<span class="sd">    for more detailed information.</span>

<span class="sd">    Usage</span>
<span class="sd">    =====</span>

<span class="sd">    ``PQa(P_0, Q_0, D)``: ``P_0``, ``Q_0`` and ``D`` are integers corresponding</span>
<span class="sd">    to `P_{0}`, `Q_{0}` and `D` in the continued fraction</span>
<span class="sd">    `\\frac{P_{0} + \sqrt{D}}{Q_{0}}`.</span>
<span class="sd">    Also it&#39;s assumed that `P_{0}^2 == D mod(|Q_{0}|)` and `D` is square free.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.solvers.diophantine import PQa</span>
<span class="sd">    &gt;&gt;&gt; pqa = PQa(13, 4, 5) # (13 + sqrt(5))/4</span>
<span class="sd">    &gt;&gt;&gt; next(pqa) # (P_0, Q_0, a_0, A_0, B_0, G_0)</span>
<span class="sd">    (13, 4, 3, 3, 1, -1)</span>
<span class="sd">    &gt;&gt;&gt; next(pqa) # (P_1, Q_1, a_1, A_1, B_1, G_1)</span>
<span class="sd">    (-1, 1, 1, 4, 1, 3)</span>

<span class="sd">    References</span>
<span class="sd">    ==========</span>

<span class="sd">    .. [1] Solving the generalized Pell equation x^2 - Dy^2 = N, John P.</span>
<span class="sd">        Robertson, July 31, 2004, Pages 4 - 8. http://www.jpr2718.org/pell.pdf</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">A_i_2</span> <span class="o">=</span> <span class="n">B_i_1</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">A_i_1</span> <span class="o">=</span> <span class="n">B_i_2</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="n">G_i_2</span> <span class="o">=</span> <span class="o">-</span><span class="n">P_0</span>
    <span class="n">G_i_1</span> <span class="o">=</span> <span class="n">Q_0</span>

    <span class="n">P_i</span> <span class="o">=</span> <span class="n">P_0</span>
    <span class="n">Q_i</span> <span class="o">=</span> <span class="n">Q_0</span>

    <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span>

        <span class="n">a_i</span> <span class="o">=</span> <span class="n">floor</span><span class="p">((</span><span class="n">P_i</span> <span class="o">+</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">D</span><span class="p">))</span><span class="o">/</span><span class="n">Q_i</span><span class="p">)</span>
        <span class="n">A_i</span> <span class="o">=</span> <span class="n">a_i</span><span class="o">*</span><span class="n">A_i_1</span> <span class="o">+</span> <span class="n">A_i_2</span>
        <span class="n">B_i</span> <span class="o">=</span> <span class="n">a_i</span><span class="o">*</span><span class="n">B_i_1</span> <span class="o">+</span> <span class="n">B_i_2</span>
        <span class="n">G_i</span> <span class="o">=</span> <span class="n">a_i</span><span class="o">*</span><span class="n">G_i_1</span> <span class="o">+</span> <span class="n">G_i_2</span>

        <span class="k">yield</span> <span class="n">P_i</span><span class="p">,</span> <span class="n">Q_i</span><span class="p">,</span> <span class="n">a_i</span><span class="p">,</span> <span class="n">A_i</span><span class="p">,</span> <span class="n">B_i</span><span class="p">,</span> <span class="n">G_i</span>

        <span class="n">A_i_1</span><span class="p">,</span> <span class="n">A_i_2</span> <span class="o">=</span> <span class="n">A_i</span><span class="p">,</span> <span class="n">A_i_1</span>
        <span class="n">B_i_1</span><span class="p">,</span> <span class="n">B_i_2</span> <span class="o">=</span> <span class="n">B_i</span><span class="p">,</span> <span class="n">B_i_1</span>
        <span class="n">G_i_1</span><span class="p">,</span> <span class="n">G_i_2</span> <span class="o">=</span> <span class="n">G_i</span><span class="p">,</span> <span class="n">G_i_1</span>

        <span class="n">P_i</span> <span class="o">=</span> <span class="n">a_i</span><span class="o">*</span><span class="n">Q_i</span> <span class="o">-</span> <span class="n">P_i</span>
        <span class="n">Q_i</span> <span class="o">=</span> <span class="p">(</span><span class="n">D</span> <span class="o">-</span> <span class="n">P_i</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">Q_i</span>

</div>
<div class="viewcode-block" id="diop_bf_DN"><a class="viewcode-back" href="../../../modules/solvers/diophantine.html#sympy.solvers.diophantine.diop_bf_DN">[docs]</a><span class="k">def</span> <span class="nf">diop_bf_DN</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="n">symbols</span><span class="p">(</span><span class="s">&quot;t&quot;</span><span class="p">,</span> <span class="n">integer</span><span class="o">=</span><span class="bp">True</span><span class="p">)):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Uses brute force to solve the equation, `x^2 - Dy^2 = N`.</span>

<span class="sd">    Mainly concerned with the generalized Pell equation which is the case when</span>
<span class="sd">    `D &gt; 0, D` is not a perfect square. For more information on the case refer</span>
<span class="sd">    [1]_. Let `(t, u)` be the minimal positive solution of the equation</span>
<span class="sd">    `x^2 - Dy^2 = 1`. Then this method requires</span>
<span class="sd">    `\sqrt{\\frac{\mid N \mid (t \pm 1)}{2D}}` to be small.</span>

<span class="sd">    Usage</span>
<span class="sd">    =====</span>

<span class="sd">    ``diop_bf_DN(D, N, t)``: ``D`` and ``N`` are coefficients in</span>
<span class="sd">    `x^2 - Dy^2 = N` and ``t`` is the parameter to be used in the solutions.</span>

<span class="sd">    Details</span>
<span class="sd">    =======</span>

<span class="sd">    ``D`` and ``N`` correspond to D and N in the equation.</span>
<span class="sd">    ``t`` is the parameter to be used in the solutions.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.solvers.diophantine import diop_bf_DN</span>
<span class="sd">    &gt;&gt;&gt; diop_bf_DN(13, -4)</span>
<span class="sd">    [(3, 1), (-3, 1), (36, 10)]</span>
<span class="sd">    &gt;&gt;&gt; diop_bf_DN(986, 1)</span>
<span class="sd">    [(49299, 1570)]</span>

<span class="sd">    See Also</span>
<span class="sd">    ========</span>

<span class="sd">    diop_DN()</span>

<span class="sd">    References</span>
<span class="sd">    ==========</span>

<span class="sd">    .. [1] Solving the generalized Pell equation x**2 - D*y**2 = N, John P.</span>
<span class="sd">        Robertson, July 31, 2004, Page 15. http://www.jpr2718.org/pell.pdf</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sol</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">diop_DN</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>


    <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">diop_DN</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">N</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">L1</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">L2</span> <span class="o">=</span> <span class="n">floor</span><span class="p">(</span><span class="n">sqrt</span><span class="p">(</span><span class="n">S</span><span class="p">(</span><span class="n">N</span><span class="o">*</span><span class="p">(</span><span class="n">u</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">D</span><span class="p">)))</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="k">elif</span> <span class="n">N</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">L1</span> <span class="o">=</span> <span class="n">ceiling</span><span class="p">(</span><span class="n">sqrt</span><span class="p">(</span><span class="n">S</span><span class="p">(</span><span class="o">-</span><span class="n">N</span><span class="p">)</span><span class="o">/</span><span class="n">D</span><span class="p">))</span>
        <span class="n">L2</span> <span class="o">=</span> <span class="n">floor</span><span class="p">(</span><span class="n">sqrt</span><span class="p">(</span><span class="n">S</span><span class="p">(</span><span class="o">-</span><span class="n">N</span><span class="o">*</span><span class="p">(</span><span class="n">u</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">D</span><span class="p">)))</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">D</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[(</span><span class="n">S</span><span class="o">.</span><span class="n">Zero</span><span class="p">,</span> <span class="n">S</span><span class="o">.</span><span class="n">Zero</span><span class="p">)]</span>
        <span class="k">elif</span> <span class="n">D</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[(</span><span class="n">S</span><span class="o">.</span><span class="n">Zero</span><span class="p">,</span> <span class="n">t</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sqrt</span><span class="p">(</span><span class="n">D</span><span class="p">),</span> <span class="n">Integer</span><span class="p">):</span>
                <span class="k">return</span> <span class="p">[(</span><span class="n">sqrt</span><span class="p">(</span><span class="n">D</span><span class="p">)</span><span class="o">*</span><span class="n">t</span><span class="p">,</span> <span class="n">t</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="n">sqrt</span><span class="p">(</span><span class="n">D</span><span class="p">)</span><span class="o">*</span><span class="n">t</span><span class="p">,</span> <span class="n">t</span><span class="p">)]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[(</span><span class="n">S</span><span class="o">.</span><span class="n">Zero</span><span class="p">,</span> <span class="n">S</span><span class="o">.</span><span class="n">Zero</span><span class="p">)]</span>


    <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">L1</span><span class="p">,</span> <span class="n">L2</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sqrt</span><span class="p">(</span><span class="n">N</span> <span class="o">+</span> <span class="n">D</span><span class="o">*</span><span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="p">),</span> <span class="n">Integer</span><span class="p">):</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">N</span> <span class="o">+</span> <span class="n">D</span><span class="o">*</span><span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">sol</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">equivalent</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="o">-</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>
                <span class="n">sol</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="o">-</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">sol</span>

</div>
<div class="viewcode-block" id="equivalent"><a class="viewcode-back" href="../../../modules/solvers/diophantine.html#sympy.solvers.diophantine.equivalent">[docs]</a><span class="k">def</span> <span class="nf">equivalent</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns True if two solutions `(u, v)` and `(r, s)` of `x^2 - Dy^2 = N`</span>
<span class="sd">    belongs to the same equivalence class and False otherwise.</span>

<span class="sd">    Two solutions `(u, v)` and `(r, s)` to the above equation fall to the same</span>
<span class="sd">    equivalence class iff both `(ur - Dvs)` and `(us - vr)` are divisible by</span>
<span class="sd">    `N`. See reference [1]_. No test is performed to test whether `(u, v)` and</span>
<span class="sd">    `(r, s)` are actually solutions to the equation. User should take care of</span>
<span class="sd">    this.</span>

<span class="sd">    Usage</span>
<span class="sd">    =====</span>

<span class="sd">    ``equivalent(u, v, r, s, D, N)``: `(u, v)` and `(r, s)` are two solutions</span>
<span class="sd">    of the equation `x^2 - Dy^2 = N` and all parameters involved are integers.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.solvers.diophantine import equivalent</span>
<span class="sd">    &gt;&gt;&gt; equivalent(18, 5, -18, -5, 13, -1)</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; equivalent(3, 1, -18, 393, 109, -4)</span>
<span class="sd">    False</span>

<span class="sd">    References</span>
<span class="sd">    ==========</span>

<span class="sd">    .. [1] Solving the generalized Pell equation x**2 - D*y**2 = N, John P.</span>
<span class="sd">        Robertson, July 31, 2004, Page 12. http://www.jpr2718.org/pell.pdf</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">divisible</span><span class="p">(</span><span class="n">u</span><span class="o">*</span><span class="n">r</span> <span class="o">-</span> <span class="n">D</span><span class="o">*</span><span class="n">v</span><span class="o">*</span><span class="n">s</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span> <span class="ow">and</span> <span class="n">divisible</span><span class="p">(</span><span class="n">u</span><span class="o">*</span><span class="n">s</span> <span class="o">-</span> <span class="n">v</span><span class="o">*</span><span class="n">r</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>

</div>
<span class="k">def</span> <span class="nf">length</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">Q</span><span class="p">,</span> <span class="n">D</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the (length of aperiodic part + length of periodic part) of</span>
<span class="sd">    continued fraction representation of `\\frac{P + \sqrt{D}}{Q}`.</span>

<span class="sd">    It is important to remember that this does NOT return the length of the</span>
<span class="sd">    periodic part but the addition of the legths of the two parts as mentioned</span>
<span class="sd">    above.</span>

<span class="sd">    Usage</span>
<span class="sd">    =====</span>

<span class="sd">    ``length(P, Q, D)``: ``P``, ``Q`` and ``D`` are integers corresponding to</span>
<span class="sd">    the continued fraction `\\frac{P + \sqrt{D}}{Q}`.</span>

<span class="sd">    Details</span>
<span class="sd">    =======</span>

<span class="sd">    ``P``, ``D`` and ``Q`` corresponds to P, D and Q in the continued fraction,</span>
<span class="sd">    `\\frac{P + \sqrt{D}}{Q}`.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.solvers.diophantine import length</span>
<span class="sd">    &gt;&gt;&gt; length(-2 , 4, 5) # (-2 + sqrt(5))/4</span>
<span class="sd">    3</span>
<span class="sd">    &gt;&gt;&gt; length(-5, 4, 17) # (-5 + sqrt(17))/4</span>
<span class="sd">    4</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">P</span> <span class="o">+</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">D</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">Q</span>

    <span class="n">x</span> <span class="o">=</span> <span class="n">sympify</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">v</span><span class="p">,</span> <span class="n">res</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">x</span><span class="o">/</span><span class="n">y</span>

    <span class="k">if</span> <span class="n">q</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">v</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
        <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">floor</span><span class="p">(</span><span class="n">q</span><span class="p">))</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">q</span> <span class="o">-</span> <span class="n">floor</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
        <span class="n">num</span><span class="p">,</span> <span class="n">den</span> <span class="o">=</span> <span class="n">rad_rationalize</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">num</span> <span class="o">/</span> <span class="n">den</span>

    <span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">v</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
        <span class="n">a</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
        <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">q</span> <span class="o">==</span> <span class="n">a</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>

        <span class="n">num</span><span class="p">,</span> <span class="n">den</span> <span class="o">=</span> <span class="n">rad_rationalize</span><span class="p">(</span><span class="mi">1</span><span class="p">,(</span><span class="n">q</span> <span class="o">-</span> <span class="n">a</span><span class="p">))</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">num</span> <span class="o">/</span> <span class="n">den</span>

        <span class="k">if</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>


<div class="viewcode-block" id="transformation_to_DN"><a class="viewcode-back" href="../../../modules/solvers/diophantine.html#sympy.solvers.diophantine.transformation_to_DN">[docs]</a><span class="k">def</span> <span class="nf">transformation_to_DN</span><span class="p">(</span><span class="n">eq</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function transforms general quadratic,</span>
<span class="sd">    `ax^2 + bxy + cy^2 + dx + ey + f = 0`</span>
<span class="sd">    to more easy to deal with `X^2 - DY^2 = N` form.</span>

<span class="sd">    This is used to solve the general quadratic equation by transforming it to</span>
<span class="sd">    the latter form. Refer [1]_ for more detailed information on the</span>
<span class="sd">    transformation. This function returns a tuple (A, B) where A is a 2 X 2</span>
<span class="sd">    matrix and B is a 2 X 1 matrix such that,</span>

<span class="sd">    Transpose([x y]) =  A * Transpose([X Y]) + B</span>

<span class="sd">    Usage</span>
<span class="sd">    =====</span>

<span class="sd">    ``transformation_to_DN(eq)``: where ``eq`` is the quadratic to be</span>
<span class="sd">    transformed.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.abc import x, y</span>
<span class="sd">    &gt;&gt;&gt; from sympy.solvers.diophantine import transformation_to_DN</span>
<span class="sd">    &gt;&gt;&gt; from sympy.solvers.diophantine import classify_diop</span>
<span class="sd">    &gt;&gt;&gt; A, B = transformation_to_DN(x**2 - 3*x*y - y**2 - 2*y + 1)</span>
<span class="sd">    &gt;&gt;&gt; A</span>
<span class="sd">    Matrix([</span>
<span class="sd">    [1/26, 3/26],</span>
<span class="sd">    [   0, 1/13]])</span>
<span class="sd">    &gt;&gt;&gt; B</span>
<span class="sd">    Matrix([</span>
<span class="sd">    [-6/13],</span>
<span class="sd">    [-4/13]])</span>

<span class="sd">    A, B  returned are such that Transpose((x y)) =  A * Transpose((X Y)) + B.</span>
<span class="sd">    Substituting these values for `x` and `y` and a bit of simplifying work</span>
<span class="sd">    will give an equation of the form `x^2 - Dy^2 = N`.</span>

<span class="sd">    &gt;&gt;&gt; from sympy.abc import X, Y</span>
<span class="sd">    &gt;&gt;&gt; from sympy import Matrix, simplify, Subs</span>
<span class="sd">    &gt;&gt;&gt; u = (A*Matrix([X, Y]) + B)[0] # Transformation for x</span>
<span class="sd">    &gt;&gt;&gt; u</span>
<span class="sd">    X/26 + 3*Y/26 - 6/13</span>
<span class="sd">    &gt;&gt;&gt; v = (A*Matrix([X, Y]) + B)[1] # Transformation for y</span>
<span class="sd">    &gt;&gt;&gt; v</span>
<span class="sd">    Y/13 - 4/13</span>

<span class="sd">    Next we will substitute these formulas for `x` and `y` and do</span>
<span class="sd">    ``simplify()``.</span>

<span class="sd">    &gt;&gt;&gt; eq = simplify(Subs(x**2 - 3*x*y - y**2 - 2*y + 1, (x, y), (u, v)).doit())</span>
<span class="sd">    &gt;&gt;&gt; eq</span>
<span class="sd">    X**2/676 - Y**2/52 + 17/13</span>

<span class="sd">    By multiplying the denominator appropriately, we can get a Pell equation</span>
<span class="sd">    in the standard form.</span>

<span class="sd">    &gt;&gt;&gt; eq * 676</span>
<span class="sd">    X**2 - 13*Y**2 + 884</span>

<span class="sd">    If only the final equation is needed, ``find_DN()`` can be used.</span>

<span class="sd">    See Also</span>
<span class="sd">    ========</span>

<span class="sd">    find_DN()</span>

<span class="sd">    References</span>
<span class="sd">    ==========</span>

<span class="sd">    .. [1] Solving the equation ax^2 + bxy + cy^2 + dx + ey + f = 0,</span>
<span class="sd">           John P.Robertson, May 8, 2003, Page 7 - 11.</span>
<span class="sd">           http://www.jpr2718.org/ax2p.pdf</span>
<span class="sd">    &quot;&quot;&quot;</span>


    <span class="n">var</span><span class="p">,</span> <span class="n">coeff</span><span class="p">,</span> <span class="n">diop_type</span> <span class="o">=</span> <span class="n">classify_diop</span><span class="p">(</span><span class="n">eq</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">diop_type</span> <span class="o">==</span> <span class="s">&quot;binary_quadratic&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_transformation_to_DN</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">coeff</span><span class="p">)</span>

</div>
<span class="k">def</span> <span class="nf">_transformation_to_DN</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">coeff</span><span class="p">):</span>

    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">var</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>

    <span class="n">a</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="n">x</span><span class="o">*</span><span class="n">y</span><span class="p">]</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>
    <span class="n">e</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="n">y</span><span class="p">]</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="n">Integer</span><span class="p">(</span><span class="mi">1</span><span class="p">)]</span>

    <span class="n">g</span> <span class="o">=</span> <span class="n">igcd</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">igcd</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">igcd</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">igcd</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">igcd</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">f</span><span class="p">)))))</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">a</span> <span class="o">//</span> <span class="n">g</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">b</span> <span class="o">//</span> <span class="n">g</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">c</span> <span class="o">//</span> <span class="n">g</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">d</span> <span class="o">//</span> <span class="n">g</span>
    <span class="n">e</span> <span class="o">=</span> <span class="n">e</span> <span class="o">//</span> <span class="n">g</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">f</span> <span class="o">//</span> <span class="n">g</span>

    <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s">&quot;X, Y&quot;</span><span class="p">,</span> <span class="n">integer</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">b</span> <span class="o">!=</span> <span class="n">Integer</span><span class="p">(</span><span class="mi">0</span><span class="p">):</span>
        <span class="n">B</span> <span class="o">=</span> <span class="p">(</span><span class="n">S</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">a</span><span class="p">)</span><span class="o">/</span><span class="n">b</span><span class="p">)</span><span class="o">.</span><span class="n">p</span>
        <span class="n">C</span> <span class="o">=</span> <span class="p">(</span><span class="n">S</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">a</span><span class="p">)</span><span class="o">/</span><span class="n">b</span><span class="p">)</span><span class="o">.</span><span class="n">q</span>
        <span class="n">A</span> <span class="o">=</span> <span class="p">(</span><span class="n">S</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">/</span><span class="n">B</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">p</span>
        <span class="n">T</span> <span class="o">=</span> <span class="p">(</span><span class="n">S</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">/</span><span class="n">B</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">q</span>

        <span class="c"># eq_1 = A*B*X**2 + B*(c*T - A*C**2)*Y**2 + d*T*X + (B*e*T - d*T*C)*Y + f*T*B</span>
        <span class="n">coeff</span> <span class="o">=</span> <span class="p">{</span><span class="n">X</span><span class="o">**</span><span class="mi">2</span><span class="p">:</span> <span class="n">A</span><span class="o">*</span><span class="n">B</span><span class="p">,</span> <span class="n">X</span><span class="o">*</span><span class="n">Y</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Y</span><span class="o">**</span><span class="mi">2</span><span class="p">:</span> <span class="n">B</span><span class="o">*</span><span class="p">(</span><span class="n">c</span><span class="o">*</span><span class="n">T</span> <span class="o">-</span> <span class="n">A</span><span class="o">*</span><span class="n">C</span><span class="o">**</span><span class="mi">2</span><span class="p">),</span> <span class="n">X</span><span class="p">:</span> <span class="n">d</span><span class="o">*</span><span class="n">T</span><span class="p">,</span> <span class="n">Y</span><span class="p">:</span> <span class="n">B</span><span class="o">*</span><span class="n">e</span><span class="o">*</span><span class="n">T</span> <span class="o">-</span> <span class="n">d</span><span class="o">*</span><span class="n">T</span><span class="o">*</span><span class="n">C</span><span class="p">,</span> <span class="n">Integer</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span> <span class="n">f</span><span class="o">*</span><span class="n">T</span><span class="o">*</span><span class="n">B</span><span class="p">}</span>
        <span class="n">A_0</span><span class="p">,</span> <span class="n">B_0</span> <span class="o">=</span> <span class="n">_transformation_to_DN</span><span class="p">([</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">],</span> <span class="n">coeff</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Matrix</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="n">S</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">B</span><span class="p">,</span> <span class="o">-</span><span class="n">S</span><span class="p">(</span><span class="n">C</span><span class="p">)</span><span class="o">/</span><span class="n">B</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="n">A_0</span><span class="p">,</span> <span class="n">Matrix</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="n">S</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">B</span><span class="p">,</span> <span class="o">-</span><span class="n">S</span><span class="p">(</span><span class="n">C</span><span class="p">)</span><span class="o">/</span><span class="n">B</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="n">B_0</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">d</span> <span class="o">!=</span> <span class="n">Integer</span><span class="p">(</span><span class="mi">0</span><span class="p">):</span>
            <span class="n">B</span> <span class="o">=</span> <span class="p">(</span><span class="n">S</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">a</span><span class="p">)</span><span class="o">/</span><span class="n">d</span><span class="p">)</span><span class="o">.</span><span class="n">p</span>
            <span class="n">C</span> <span class="o">=</span> <span class="p">(</span><span class="n">S</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">a</span><span class="p">)</span><span class="o">/</span><span class="n">d</span><span class="p">)</span><span class="o">.</span><span class="n">q</span>
            <span class="n">A</span> <span class="o">=</span> <span class="p">(</span><span class="n">S</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">/</span><span class="n">B</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">p</span>
            <span class="n">T</span> <span class="o">=</span> <span class="p">(</span><span class="n">S</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">/</span><span class="n">B</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">q</span>

            <span class="c"># eq_2 = A*X**2 + c*T*Y**2 + e*T*Y + f*T - A*C**2</span>
            <span class="n">coeff</span> <span class="o">=</span> <span class="p">{</span><span class="n">X</span><span class="o">**</span><span class="mi">2</span><span class="p">:</span> <span class="n">A</span><span class="p">,</span> <span class="n">X</span><span class="o">*</span><span class="n">Y</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Y</span><span class="o">**</span><span class="mi">2</span><span class="p">:</span> <span class="n">c</span><span class="o">*</span><span class="n">T</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Y</span><span class="p">:</span> <span class="n">e</span><span class="o">*</span><span class="n">T</span><span class="p">,</span> <span class="n">Integer</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span> <span class="n">f</span><span class="o">*</span><span class="n">T</span> <span class="o">-</span> <span class="n">A</span><span class="o">*</span><span class="n">C</span><span class="o">**</span><span class="mi">2</span><span class="p">}</span>
            <span class="n">A_0</span><span class="p">,</span> <span class="n">B_0</span> <span class="o">=</span> <span class="n">_transformation_to_DN</span><span class="p">([</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">],</span> <span class="n">coeff</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">Matrix</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="n">S</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">B</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="n">A_0</span><span class="p">,</span> <span class="n">Matrix</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="n">S</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">B</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="n">B_0</span> <span class="o">+</span> <span class="n">Matrix</span><span class="p">([</span><span class="o">-</span><span class="n">S</span><span class="p">(</span><span class="n">C</span><span class="p">)</span><span class="o">/</span><span class="n">B</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">e</span> <span class="o">!=</span> <span class="n">Integer</span><span class="p">(</span><span class="mi">0</span><span class="p">):</span>
                <span class="n">B</span> <span class="o">=</span> <span class="p">(</span><span class="n">S</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">c</span><span class="p">)</span><span class="o">/</span><span class="n">e</span><span class="p">)</span><span class="o">.</span><span class="n">p</span>
                <span class="n">C</span> <span class="o">=</span> <span class="p">(</span><span class="n">S</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">c</span><span class="p">)</span><span class="o">/</span><span class="n">e</span><span class="p">)</span><span class="o">.</span><span class="n">q</span>
                <span class="n">A</span> <span class="o">=</span> <span class="p">(</span><span class="n">S</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="o">/</span><span class="n">B</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">p</span>
                <span class="n">T</span> <span class="o">=</span> <span class="p">(</span><span class="n">S</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="o">/</span><span class="n">B</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">q</span>

                <span class="c"># eq_3 = a*T*X**2 + A*Y**2 + f*T - A*C**2</span>
                <span class="n">coeff</span> <span class="o">=</span> <span class="p">{</span><span class="n">X</span><span class="o">**</span><span class="mi">2</span><span class="p">:</span> <span class="n">a</span><span class="o">*</span><span class="n">T</span><span class="p">,</span> <span class="n">X</span><span class="o">*</span><span class="n">Y</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Y</span><span class="o">**</span><span class="mi">2</span><span class="p">:</span> <span class="n">A</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Y</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Integer</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span> <span class="n">f</span><span class="o">*</span><span class="n">T</span> <span class="o">-</span> <span class="n">A</span><span class="o">*</span><span class="n">C</span><span class="o">**</span><span class="mi">2</span><span class="p">}</span>
                <span class="n">A_0</span><span class="p">,</span> <span class="n">B_0</span> <span class="o">=</span> <span class="n">_transformation_to_DN</span><span class="p">([</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">],</span> <span class="n">coeff</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">Matrix</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">S</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">B</span><span class="p">])</span><span class="o">*</span><span class="n">A_0</span><span class="p">,</span> <span class="n">Matrix</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">S</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">B</span><span class="p">])</span><span class="o">*</span><span class="n">B_0</span> <span class="o">+</span> <span class="n">Matrix</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">S</span><span class="p">(</span><span class="n">C</span><span class="p">)</span><span class="o">/</span><span class="n">B</span><span class="p">])</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="c"># TODO: pre-simplification: Not necessary but may simplify</span>
                <span class="c"># the equation.</span>

                <span class="k">return</span> <span class="n">Matrix</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="n">S</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">a</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]),</span> <span class="n">Matrix</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>


<div class="viewcode-block" id="find_DN"><a class="viewcode-back" href="../../../modules/solvers/diophantine.html#sympy.solvers.diophantine.find_DN">[docs]</a><span class="k">def</span> <span class="nf">find_DN</span><span class="p">(</span><span class="n">eq</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function returns a tuple, `(D, N)` of the simplified form,</span>
<span class="sd">    `x^2 - Dy^2 = N`, corresponding to the general quadratic,</span>
<span class="sd">    `ax^2 + bxy + cy^2 + dx + ey + f = 0`.</span>

<span class="sd">    Solving the general quadratic is then equivalent to solving the equation</span>
<span class="sd">    `X^2 - DY^2 = N` and transforming the solutions by using the transformation</span>
<span class="sd">    matrices returned by ``transformation_to_DN()``.</span>

<span class="sd">    Usage</span>
<span class="sd">    =====</span>

<span class="sd">    ``find_DN(eq)``: where ``eq`` is the quadratic to be transformed.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.abc import x, y</span>
<span class="sd">    &gt;&gt;&gt; from sympy.solvers.diophantine import find_DN</span>
<span class="sd">    &gt;&gt;&gt; find_DN(x**2 - 3*x*y - y**2 - 2*y + 1)</span>
<span class="sd">    (13, -884)</span>

<span class="sd">    Interpretation of the output is that we get `X^2 -13Y^2 = -884` after</span>
<span class="sd">    transforming `x^2 - 3xy - y^2 - 2y + 1` using the transformation returned</span>
<span class="sd">    by ``transformation_to_DN()``.</span>

<span class="sd">    See Also</span>
<span class="sd">    ========</span>

<span class="sd">    transformation_to_DN()</span>

<span class="sd">    References</span>
<span class="sd">    ==========</span>

<span class="sd">    .. [1] Solving the equation ax^2 + bxy + cy^2 + dx + ey + f = 0,</span>
<span class="sd">           John P.Robertson, May 8, 2003, Page 7 - 11.</span>
<span class="sd">           http://www.jpr2718.org/ax2p.pdf</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">var</span><span class="p">,</span> <span class="n">coeff</span><span class="p">,</span> <span class="n">diop_type</span> <span class="o">=</span> <span class="n">classify_diop</span><span class="p">(</span><span class="n">eq</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">diop_type</span> <span class="o">==</span> <span class="s">&quot;binary_quadratic&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_find_DN</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">coeff</span><span class="p">)</span>

</div>
<span class="k">def</span> <span class="nf">_find_DN</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">coeff</span><span class="p">):</span>

    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">var</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s">&quot;X, Y&quot;</span><span class="p">,</span> <span class="n">integer</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">A</span> <span class="p">,</span> <span class="n">B</span> <span class="o">=</span> <span class="n">_transformation_to_DN</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">coeff</span><span class="p">)</span>

    <span class="n">u</span> <span class="o">=</span> <span class="p">(</span><span class="n">A</span><span class="o">*</span><span class="n">Matrix</span><span class="p">([</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">])</span> <span class="o">+</span> <span class="n">B</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">v</span> <span class="o">=</span> <span class="p">(</span><span class="n">A</span><span class="o">*</span><span class="n">Matrix</span><span class="p">([</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">])</span> <span class="o">+</span> <span class="n">B</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">eq</span> <span class="o">=</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">coeff</span><span class="p">[</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="o">*</span><span class="n">y</span><span class="o">*</span><span class="n">coeff</span><span class="p">[</span><span class="n">x</span><span class="o">*</span><span class="n">y</span><span class="p">]</span> <span class="o">+</span> <span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">coeff</span><span class="p">[</span><span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="o">*</span><span class="n">coeff</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">+</span> <span class="n">y</span><span class="o">*</span><span class="n">coeff</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="o">+</span> <span class="n">coeff</span><span class="p">[</span><span class="n">Integer</span><span class="p">(</span><span class="mi">1</span><span class="p">)]</span>

    <span class="n">simplified</span> <span class="o">=</span> <span class="n">_mexpand</span><span class="p">(</span><span class="n">Subs</span><span class="p">(</span><span class="n">eq</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">))</span><span class="o">.</span><span class="n">doit</span><span class="p">())</span>

    <span class="n">coeff</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([</span><span class="nb">reversed</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">as_independent</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">]))</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">simplified</span><span class="o">.</span><span class="n">args</span><span class="p">])</span>

    <span class="k">for</span> <span class="n">term</span> <span class="ow">in</span> <span class="p">[</span><span class="n">X</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">Y</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">Integer</span><span class="p">(</span><span class="mi">1</span><span class="p">)]:</span>
        <span class="k">if</span> <span class="n">term</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">coeff</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">coeff</span><span class="p">[</span><span class="n">term</span><span class="p">]</span> <span class="o">=</span> <span class="n">Integer</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">return</span> <span class="o">-</span><span class="n">coeff</span><span class="p">[</span><span class="n">Y</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="n">coeff</span><span class="p">[</span><span class="n">X</span><span class="o">**</span><span class="mi">2</span><span class="p">],</span> <span class="o">-</span><span class="n">coeff</span><span class="p">[</span><span class="n">Integer</span><span class="p">(</span><span class="mi">1</span><span class="p">)]</span><span class="o">/</span><span class="n">coeff</span><span class="p">[</span><span class="n">X</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">check_param</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check if there is a number modulo ``a`` such that ``x`` and ``y`` are both</span>
<span class="sd">    integers. If exist, then find a parametric representation for ``x`` and</span>
<span class="sd">    ``y``.</span>

<span class="sd">    Here ``x`` and ``y`` are functions of ``t``.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">k</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s">&quot;k, m, n&quot;</span><span class="p">,</span> <span class="n">integer</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">Wild</span><span class="p">(</span><span class="s">&quot;p&quot;</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">Wild</span><span class="p">(</span><span class="s">&quot;q&quot;</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
    <span class="n">ok</span> <span class="o">=</span> <span class="bp">False</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>

        <span class="n">z_x</span> <span class="o">=</span> <span class="n">_mexpand</span><span class="p">(</span><span class="n">Subs</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">a</span><span class="o">*</span><span class="n">k</span> <span class="o">+</span> <span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">doit</span><span class="p">())</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">p</span><span class="o">*</span><span class="n">k</span> <span class="o">+</span> <span class="n">q</span><span class="p">)</span>
        <span class="n">z_y</span> <span class="o">=</span> <span class="n">_mexpand</span><span class="p">(</span><span class="n">Subs</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">a</span><span class="o">*</span><span class="n">k</span> <span class="o">+</span> <span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">doit</span><span class="p">())</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">p</span><span class="o">*</span><span class="n">k</span> <span class="o">+</span> <span class="n">q</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">z_x</span><span class="p">[</span><span class="n">p</span><span class="p">],</span> <span class="n">Integer</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">z_x</span><span class="p">[</span><span class="n">q</span><span class="p">],</span> <span class="n">Integer</span><span class="p">)</span> <span class="ow">and</span>
            <span class="nb">isinstance</span><span class="p">(</span><span class="n">z_y</span><span class="p">[</span><span class="n">p</span><span class="p">],</span> <span class="n">Integer</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">z_y</span><span class="p">[</span><span class="n">q</span><span class="p">],</span> <span class="n">Integer</span><span class="p">)):</span>
            <span class="n">ok</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">break</span>

    <span class="k">if</span> <span class="n">ok</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>

        <span class="n">x_param</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">p</span><span class="o">*</span><span class="n">t</span> <span class="o">+</span> <span class="n">q</span><span class="p">)</span>
        <span class="n">y_param</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">p</span><span class="o">*</span><span class="n">t</span> <span class="o">+</span> <span class="n">q</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">x_param</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">y_param</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">x_param</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">l1</span><span class="p">,</span> <span class="n">junk</span> <span class="o">=</span> <span class="n">Poly</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">clear_denoms</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">l1</span> <span class="o">=</span> <span class="mi">1</span>

            <span class="k">if</span> <span class="n">y_param</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">l2</span><span class="p">,</span> <span class="n">junk</span> <span class="o">=</span> <span class="n">Poly</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">clear_denoms</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">l2</span> <span class="o">=</span> <span class="mi">1</span>

            <span class="k">return</span> <span class="n">x</span><span class="o">*</span><span class="n">ilcm</span><span class="p">(</span><span class="n">l1</span><span class="p">,</span> <span class="n">l2</span><span class="p">),</span> <span class="n">y</span><span class="o">*</span><span class="n">ilcm</span><span class="p">(</span><span class="n">l1</span><span class="p">,</span> <span class="n">l2</span><span class="p">)</span>

        <span class="n">eq</span> <span class="o">=</span> <span class="n">S</span><span class="p">(</span><span class="n">m</span> <span class="o">-</span> <span class="n">x_param</span><span class="p">[</span><span class="n">q</span><span class="p">])</span><span class="o">/</span><span class="n">x_param</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">-</span> <span class="n">S</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">y_param</span><span class="p">[</span><span class="n">q</span><span class="p">])</span><span class="o">/</span><span class="n">y_param</span><span class="p">[</span><span class="n">p</span><span class="p">]</span>

        <span class="n">lcm_denom</span><span class="p">,</span> <span class="n">junk</span> <span class="o">=</span> <span class="n">Poly</span><span class="p">(</span><span class="n">eq</span><span class="p">)</span><span class="o">.</span><span class="n">clear_denoms</span><span class="p">()</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="n">eq</span> <span class="o">*</span> <span class="n">lcm_denom</span>

        <span class="k">return</span> <span class="n">diop_solve</span><span class="p">(</span><span class="n">eq</span><span class="p">,</span> <span class="n">t</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">diop_solve</span><span class="p">(</span><span class="n">eq</span><span class="p">,</span> <span class="n">t</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>


<div class="viewcode-block" id="diop_ternary_quadratic"><a class="viewcode-back" href="../../../modules/solvers/diophantine.html#sympy.solvers.diophantine.diop_ternary_quadratic">[docs]</a><span class="k">def</span> <span class="nf">diop_ternary_quadratic</span><span class="p">(</span><span class="n">eq</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Solves the general quadratic ternary form,</span>
<span class="sd">    `ax^2 + by^2 + cz^2 + fxy + gyz + hxz = 0`.</span>

<span class="sd">    Returns a tuple `(x, y, z)` which is a base solution for the above</span>
<span class="sd">    equation. If there are no solutions, `(None, None, None)` is returned.</span>

<span class="sd">    Usage</span>
<span class="sd">    =====</span>

<span class="sd">    ``diop_ternary_quadratic(eq)``: Return a tuple containing an basic solution</span>
<span class="sd">    to ``eq``.</span>

<span class="sd">    Details</span>
<span class="sd">    =======</span>

<span class="sd">    ``eq`` should be an homogeneous expression of degree two in three variables</span>
<span class="sd">    and it is assumed to be zero.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.abc import x, y, z</span>
<span class="sd">    &gt;&gt;&gt; from sympy.solvers.diophantine import diop_ternary_quadratic</span>
<span class="sd">    &gt;&gt;&gt; diop_ternary_quadratic(x**2 + 3*y**2 - z**2)</span>
<span class="sd">    (1, 0, 1)</span>
<span class="sd">    &gt;&gt;&gt; diop_ternary_quadratic(4*x**2 + 5*y**2 - z**2)</span>
<span class="sd">    (1, 0, 2)</span>
<span class="sd">    &gt;&gt;&gt; diop_ternary_quadratic(45*x**2 - 7*y**2 - 8*x*y - z**2)</span>
<span class="sd">    (28, 45, 105)</span>
<span class="sd">    &gt;&gt;&gt; diop_ternary_quadratic(x**2 - 49*y**2 - z**2 + 13*z*y -8*x*y)</span>
<span class="sd">    (9, 1, 5)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">var</span><span class="p">,</span> <span class="n">coeff</span><span class="p">,</span> <span class="n">diop_type</span> <span class="o">=</span> <span class="n">classify_diop</span><span class="p">(</span><span class="n">eq</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">diop_type</span> <span class="o">==</span> <span class="s">&quot;homogeneous_ternary_quadratic&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_diop_ternary_quadratic</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">coeff</span><span class="p">)</span>

</div>
<span class="k">def</span> <span class="nf">_diop_ternary_quadratic</span><span class="p">(</span><span class="n">_var</span><span class="p">,</span> <span class="n">coeff</span><span class="p">):</span>

    <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">_var</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>

    <span class="n">var</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">*</span><span class="mi">3</span>
    <span class="n">var</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">var</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">var</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">_var</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">_var</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">_var</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

    <span class="c"># Equations of the form B*x*y + C*z*x + E*y*z = 0 and At least two of the</span>
    <span class="c"># coefficients A, B, C are non-zero.</span>
    <span class="c"># There are infinitely many solutions for the equation.</span>
    <span class="c"># Ex: (0, 0, t), (0, t, 0), (t, 0, 0)</span>
    <span class="c"># Equation can be re-written as y*(B*x + E*z) = -C*x*z and we can find rather</span>
    <span class="c"># unobviuos solutions. Set y = -C and B*x + E*z = x*z. The latter can be solved by</span>
    <span class="c"># using methods for binary quadratic diophantine equations. Let&#39;s select the</span>
    <span class="c"># solution which minimizes |x| + |z|</span>

    <span class="k">if</span> <span class="n">coeff</span><span class="p">[</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">coeff</span><span class="p">[</span><span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">coeff</span><span class="p">[</span><span class="n">z</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">coeff</span><span class="p">[</span><span class="n">x</span><span class="o">*</span><span class="n">z</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">sols</span> <span class="o">=</span> <span class="n">diophantine</span><span class="p">(</span><span class="n">coeff</span><span class="p">[</span><span class="n">x</span><span class="o">*</span><span class="n">y</span><span class="p">]</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">coeff</span><span class="p">[</span><span class="n">y</span><span class="o">*</span><span class="n">z</span><span class="p">]</span><span class="o">*</span><span class="n">z</span> <span class="o">-</span> <span class="n">x</span><span class="o">*</span><span class="n">z</span><span class="p">)</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">sols</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
            <span class="n">min_sum</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="nb">abs</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

            <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">sols</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="nb">abs</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&lt;</span> <span class="n">min_sum</span><span class="p">:</span>
                    <span class="n">s</span> <span class="o">=</span> <span class="n">r</span>
                    <span class="n">min_sum</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="nb">abs</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

                <span class="n">x_0</span><span class="p">,</span> <span class="n">y_0</span><span class="p">,</span> <span class="n">z_0</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="n">coeff</span><span class="p">[</span><span class="n">x</span><span class="o">*</span><span class="n">z</span><span class="p">],</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">var</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">var</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">_var</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">_var</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">y_0</span><span class="p">,</span> <span class="n">x_0</span><span class="p">,</span> <span class="n">z_0</span> <span class="o">=</span> <span class="n">_diop_ternary_quadratic</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">coeff</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">simplified</span><span class="p">(</span><span class="n">x_0</span><span class="p">,</span> <span class="n">y_0</span><span class="p">,</span> <span class="n">z_0</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">coeff</span><span class="p">[</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c"># If the coefficient of x is zero change the variables</span>
        <span class="k">if</span> <span class="n">coeff</span><span class="p">[</span><span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">var</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">var</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">_var</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">_var</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">z_0</span><span class="p">,</span> <span class="n">y_0</span><span class="p">,</span> <span class="n">x_0</span> <span class="o">=</span> <span class="n">_diop_ternary_quadratic</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">coeff</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">var</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">var</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">_var</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">_var</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">y_0</span><span class="p">,</span> <span class="n">x_0</span><span class="p">,</span> <span class="n">z_0</span> <span class="o">=</span> <span class="n">_diop_ternary_quadratic</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">coeff</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">coeff</span><span class="p">[</span><span class="n">x</span><span class="o">*</span><span class="n">y</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">coeff</span><span class="p">[</span><span class="n">x</span><span class="o">*</span><span class="n">z</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c"># Apply the transformation x --&gt; X - (B*y + C*z)/(2*A)</span>
            <span class="n">A</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">B</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="n">x</span><span class="o">*</span><span class="n">y</span><span class="p">]</span>
            <span class="n">C</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="n">x</span><span class="o">*</span><span class="n">z</span><span class="p">]</span>
            <span class="n">D</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">E</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="n">y</span><span class="o">*</span><span class="n">z</span><span class="p">]</span>
            <span class="n">F</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="n">z</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span>

            <span class="n">_coeff</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

            <span class="n">_coeff</span><span class="p">[</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span><span class="o">*</span><span class="n">A</span><span class="o">**</span><span class="mi">2</span>
            <span class="n">_coeff</span><span class="p">[</span><span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span><span class="o">*</span><span class="n">A</span><span class="o">*</span><span class="n">D</span> <span class="o">-</span> <span class="n">B</span><span class="o">**</span><span class="mi">2</span>
            <span class="n">_coeff</span><span class="p">[</span><span class="n">z</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span><span class="o">*</span><span class="n">A</span><span class="o">*</span><span class="n">F</span> <span class="o">-</span> <span class="n">C</span><span class="o">**</span><span class="mi">2</span>
            <span class="n">_coeff</span><span class="p">[</span><span class="n">y</span><span class="o">*</span><span class="n">z</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span><span class="o">*</span><span class="n">A</span><span class="o">*</span><span class="n">E</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">B</span><span class="o">*</span><span class="n">C</span>
            <span class="n">_coeff</span><span class="p">[</span><span class="n">x</span><span class="o">*</span><span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">_coeff</span><span class="p">[</span><span class="n">x</span><span class="o">*</span><span class="n">z</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="n">X_0</span><span class="p">,</span> <span class="n">y_0</span><span class="p">,</span> <span class="n">z_0</span> <span class="o">=</span> <span class="n">_diop_ternary_quadratic</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">_coeff</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">X_0</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>

            <span class="n">l</span> <span class="o">=</span> <span class="p">(</span><span class="n">S</span><span class="p">(</span><span class="n">B</span><span class="o">*</span><span class="n">y_0</span> <span class="o">+</span> <span class="n">C</span><span class="o">*</span><span class="n">z_0</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">A</span><span class="p">))</span><span class="o">.</span><span class="n">q</span>
            <span class="n">x_0</span><span class="p">,</span> <span class="n">y_0</span><span class="p">,</span> <span class="n">z_0</span> <span class="o">=</span> <span class="n">X_0</span><span class="o">*</span><span class="n">l</span> <span class="o">-</span> <span class="p">(</span><span class="n">S</span><span class="p">(</span><span class="n">B</span><span class="o">*</span><span class="n">y_0</span> <span class="o">+</span> <span class="n">C</span><span class="o">*</span><span class="n">z_0</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">A</span><span class="p">))</span><span class="o">.</span><span class="n">p</span><span class="p">,</span> <span class="n">y_0</span><span class="o">*</span><span class="n">l</span><span class="p">,</span> <span class="n">z_0</span><span class="o">*</span><span class="n">l</span>

        <span class="k">elif</span> <span class="n">coeff</span><span class="p">[</span><span class="n">z</span><span class="o">*</span><span class="n">y</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">coeff</span><span class="p">[</span><span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">coeff</span><span class="p">[</span><span class="n">z</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="c"># Equations of the form A*x**2 + E*yz = 0.</span>
                    <span class="n">A</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span>
                    <span class="n">E</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="n">y</span><span class="o">*</span><span class="n">z</span><span class="p">]</span>

                    <span class="n">b</span> <span class="o">=</span> <span class="p">(</span><span class="n">S</span><span class="p">(</span><span class="o">-</span><span class="n">E</span><span class="p">)</span><span class="o">/</span><span class="n">A</span><span class="p">)</span><span class="o">.</span><span class="n">p</span>
                    <span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="n">S</span><span class="p">(</span><span class="o">-</span><span class="n">E</span><span class="p">)</span><span class="o">/</span><span class="n">A</span><span class="p">)</span><span class="o">.</span><span class="n">q</span>

                    <span class="n">x_0</span><span class="p">,</span> <span class="n">y_0</span><span class="p">,</span> <span class="n">z_0</span> <span class="o">=</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="c"># Ax**2 + E*y*z + F*z**2  = 0</span>
                    <span class="n">var</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">var</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">_var</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">_var</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">z_0</span><span class="p">,</span> <span class="n">y_0</span><span class="p">,</span> <span class="n">x_0</span> <span class="o">=</span> <span class="n">_diop_ternary_quadratic</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">coeff</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="c"># A*x**2 + D*y**2 + E*y*z + F*z**2 = 0, C may be zero</span>
                <span class="n">var</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">var</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">_var</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">_var</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">y_0</span><span class="p">,</span> <span class="n">x_0</span><span class="p">,</span> <span class="n">z_0</span> <span class="o">=</span> <span class="n">_diop_ternary_quadratic</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">coeff</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c"># Ax**2 + D*y**2 + F*z**2 = 0, C may be zero</span>
            <span class="n">x_0</span><span class="p">,</span> <span class="n">y_0</span><span class="p">,</span> <span class="n">z_0</span> <span class="o">=</span> <span class="n">_diop_ternary_quadratic_normal</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">coeff</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">simplified</span><span class="p">(</span><span class="n">x_0</span><span class="p">,</span> <span class="n">y_0</span><span class="p">,</span> <span class="n">z_0</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">transformation_to_normal</span><span class="p">(</span><span class="n">eq</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the transformation Matrix from general ternary quadratic equation</span>
<span class="sd">    `eq` to normal form.</span>

<span class="sd">    General form of the ternary quadratic equation is `ax^2 + by^2 cz^2 + dxy +</span>
<span class="sd">    eyz + fxz`. This function returns a 3X3 transformation Matrix which</span>
<span class="sd">    transforms the former equation to the form `ax^2 + by^2 + cz^2 = 0`. This</span>
<span class="sd">    is not used in solving ternary quadratics. Only implemented for the sake</span>
<span class="sd">    of completeness.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">var</span><span class="p">,</span> <span class="n">coeff</span><span class="p">,</span> <span class="n">diop_type</span> <span class="o">=</span> <span class="n">classify_diop</span><span class="p">(</span><span class="n">eq</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">diop_type</span> <span class="o">==</span> <span class="s">&quot;homogeneous_ternary_quadratic&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_transformation_to_normal</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">coeff</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_transformation_to_normal</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">coeff</span><span class="p">):</span>

    <span class="n">_var</span> <span class="o">=</span> <span class="p">[</span><span class="n">var</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">*</span><span class="mi">3</span>
    <span class="n">_var</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">_var</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">var</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">var</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

    <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">var</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">coeff</span><span class="p">[</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c"># If the coefficient of x is zero change the variables</span>
        <span class="k">if</span> <span class="n">coeff</span><span class="p">[</span><span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">_var</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">_var</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">var</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">var</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">T</span> <span class="o">=</span> <span class="n">_transformation_to_normal</span><span class="p">(</span><span class="n">_var</span><span class="p">,</span> <span class="n">coeff</span><span class="p">)</span>
            <span class="n">T</span><span class="o">.</span><span class="n">row_swap</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">T</span><span class="o">.</span><span class="n">col_swap</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">T</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">_var</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">_var</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">var</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">var</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">T</span> <span class="o">=</span> <span class="n">_transformation_to_normal</span><span class="p">(</span><span class="n">_var</span><span class="p">,</span> <span class="n">coeff</span><span class="p">)</span>
            <span class="n">T</span><span class="o">.</span><span class="n">row_swap</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">T</span><span class="o">.</span><span class="n">col_swap</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">T</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="c"># Apply the transformation x --&gt; X - (B*Y + C*Z)/(2*A)</span>
        <span class="k">if</span> <span class="n">coeff</span><span class="p">[</span><span class="n">x</span><span class="o">*</span><span class="n">y</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">coeff</span><span class="p">[</span><span class="n">x</span><span class="o">*</span><span class="n">z</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">A</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">B</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="n">x</span><span class="o">*</span><span class="n">y</span><span class="p">]</span>
            <span class="n">C</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="n">x</span><span class="o">*</span><span class="n">z</span><span class="p">]</span>
            <span class="n">D</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">E</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="n">y</span><span class="o">*</span><span class="n">z</span><span class="p">]</span>
            <span class="n">F</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="n">z</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span>

            <span class="n">_coeff</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

            <span class="n">_coeff</span><span class="p">[</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span><span class="o">*</span><span class="n">A</span><span class="o">**</span><span class="mi">2</span>
            <span class="n">_coeff</span><span class="p">[</span><span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span><span class="o">*</span><span class="n">A</span><span class="o">*</span><span class="n">D</span> <span class="o">-</span> <span class="n">B</span><span class="o">**</span><span class="mi">2</span>
            <span class="n">_coeff</span><span class="p">[</span><span class="n">z</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span><span class="o">*</span><span class="n">A</span><span class="o">*</span><span class="n">F</span> <span class="o">-</span> <span class="n">C</span><span class="o">**</span><span class="mi">2</span>
            <span class="n">_coeff</span><span class="p">[</span><span class="n">y</span><span class="o">*</span><span class="n">z</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span><span class="o">*</span><span class="n">A</span><span class="o">*</span><span class="n">E</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">B</span><span class="o">*</span><span class="n">C</span>
            <span class="n">_coeff</span><span class="p">[</span><span class="n">x</span><span class="o">*</span><span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">_coeff</span><span class="p">[</span><span class="n">x</span><span class="o">*</span><span class="n">z</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="n">T_0</span> <span class="o">=</span> <span class="n">_transformation_to_normal</span><span class="p">(</span><span class="n">_var</span><span class="p">,</span> <span class="n">_coeff</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">Matrix</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">S</span><span class="p">(</span><span class="o">-</span><span class="n">B</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">A</span><span class="p">),</span> <span class="n">S</span><span class="p">(</span><span class="o">-</span><span class="n">C</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">A</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">T_0</span>

        <span class="k">elif</span> <span class="n">coeff</span><span class="p">[</span><span class="n">y</span><span class="o">*</span><span class="n">z</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">coeff</span><span class="p">[</span><span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">coeff</span><span class="p">[</span><span class="n">z</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="c"># Equations of the form A*x**2 + E*yz = 0.</span>
                    <span class="c"># Apply transformation y -&gt; Y + Z ans z -&gt; Y - Z</span>
                    <span class="k">return</span> <span class="n">Matrix</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">])</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="c"># Ax**2 + E*y*z + F*z**2  = 0</span>
                    <span class="n">_var</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">_var</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">var</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">var</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">T</span> <span class="o">=</span> <span class="n">_transformtion_to_normal</span><span class="p">(</span><span class="n">_var</span><span class="p">,</span> <span class="n">coeff</span><span class="p">)</span>
                    <span class="n">T</span><span class="o">.</span><span class="n">row_swap</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
                    <span class="n">T</span><span class="o">.</span><span class="n">col_swap</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">T</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="c"># A*x**2 + D*y**2 + E*y*z + F*z**2 = 0, F may be zero</span>
                <span class="n">_var</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">_var</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">var</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">var</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">T</span> <span class="o">=</span> <span class="n">_transformation_to_normal</span><span class="p">(</span><span class="n">_var</span><span class="p">,</span> <span class="n">coeff</span><span class="p">)</span>
                <span class="n">T</span><span class="o">.</span><span class="n">row_swap</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">T</span><span class="o">.</span><span class="n">col_swap</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">T</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Matrix</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>


<div class="viewcode-block" id="simplified"><a class="viewcode-back" href="../../../modules/solvers/diophantine.html#sympy.solvers.diophantine.simplified">[docs]</a><span class="k">def</span> <span class="nf">simplified</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Simplify the solution `(x, y, z)`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">y</span> <span class="o">==</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">z</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>

    <span class="n">g</span> <span class="o">=</span> <span class="n">igcd</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">igcd</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">x</span> <span class="o">//</span> <span class="n">g</span><span class="p">,</span> <span class="n">y</span> <span class="o">//</span> <span class="n">g</span><span class="p">,</span> <span class="n">z</span> <span class="o">//</span> <span class="n">g</span>

</div>
<div class="viewcode-block" id="parametrize_ternary_quadratic"><a class="viewcode-back" href="../../../modules/solvers/diophantine.html#sympy.solvers.diophantine.parametrize_ternary_quadratic">[docs]</a><span class="k">def</span> <span class="nf">parametrize_ternary_quadratic</span><span class="p">(</span><span class="n">eq</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the parametrized general solution for the ternary quadratic</span>
<span class="sd">    equation ``eq`` which has the form</span>
<span class="sd">    `ax^2 + by^2 + cz^2 + fxy + gyz + hxz = 0`.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.abc import x, y, z</span>
<span class="sd">    &gt;&gt;&gt; from sympy.solvers.diophantine import parametrize_ternary_quadratic</span>
<span class="sd">    &gt;&gt;&gt; parametrize_ternary_quadratic(x**2 + y**2 - z**2)</span>
<span class="sd">    (2*p*q, p**2 - q**2, p**2 + q**2)</span>

<span class="sd">    Here `p` and `q` are two co-prime integers.</span>

<span class="sd">    &gt;&gt;&gt; parametrize_ternary_quadratic(3*x**2 + 2*y**2 - z**2 - 2*x*y + 5*y*z - 7*y*z)</span>
<span class="sd">    (2*p**2 - 2*p*q - q**2, 2*p**2 + 2*p*q - q**2, 2*p**2 - 2*p*q + 3*q**2)</span>
<span class="sd">    &gt;&gt;&gt; parametrize_ternary_quadratic(124*x**2 - 30*y**2 - 7729*z**2)</span>
<span class="sd">    (-1410*p**2 - 363263*q**2, 2700*p**2 + 30916*p*q - 695610*q**2, -60*p**2 + 5400*p*q + 15458*q**2)</span>

<span class="sd">    References</span>
<span class="sd">    ==========</span>

<span class="sd">    .. [1] The algorithmic resolution of Diophantine equations, Nigel P. Smart,</span>
<span class="sd">           London Mathematical Society Student Texts 41, Cambridge University</span>
<span class="sd">           Press, Cambridge, 1998.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">var</span><span class="p">,</span> <span class="n">coeff</span><span class="p">,</span> <span class="n">diop_type</span> <span class="o">=</span> <span class="n">classify_diop</span><span class="p">(</span><span class="n">eq</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">diop_type</span> <span class="o">==</span> <span class="s">&quot;homogeneous_ternary_quadratic&quot;</span><span class="p">:</span>
        <span class="n">x_0</span><span class="p">,</span> <span class="n">y_0</span><span class="p">,</span> <span class="n">z_0</span> <span class="o">=</span> <span class="n">_diop_ternary_quadratic</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">coeff</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">_parametrize_ternary_quadratic</span><span class="p">((</span><span class="n">x_0</span><span class="p">,</span> <span class="n">y_0</span><span class="p">,</span> <span class="n">z_0</span><span class="p">),</span> <span class="n">var</span><span class="p">,</span> <span class="n">coeff</span><span class="p">)</span>

</div>
<span class="k">def</span> <span class="nf">_parametrize_ternary_quadratic</span><span class="p">(</span><span class="n">solution</span><span class="p">,</span> <span class="n">_var</span><span class="p">,</span> <span class="n">coeff</span><span class="p">):</span>

    <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">_var</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>

    <span class="n">x_0</span><span class="p">,</span> <span class="n">y_0</span><span class="p">,</span> <span class="n">z_0</span> <span class="o">=</span> <span class="n">solution</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>

    <span class="n">v</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">*</span><span class="mi">3</span>
    <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">_var</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">_var</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">_var</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">x_0</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">x_0</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">y_0</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">z_p</span><span class="p">,</span> <span class="n">y_p</span><span class="p">,</span> <span class="n">x_p</span> <span class="o">=</span> <span class="n">_parametrize_ternary_quadratic</span><span class="p">((</span><span class="n">z_0</span><span class="p">,</span> <span class="n">y_0</span><span class="p">,</span> <span class="n">x_0</span><span class="p">),</span> <span class="n">v</span><span class="p">,</span> <span class="n">coeff</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">x_p</span><span class="p">,</span> <span class="n">y_p</span><span class="p">,</span> <span class="n">z_p</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">y_p</span><span class="p">,</span> <span class="n">x_p</span><span class="p">,</span> <span class="n">z_p</span> <span class="o">=</span> <span class="n">_parametrize_ternary_quadratic</span><span class="p">((</span><span class="n">y_0</span><span class="p">,</span> <span class="n">x_0</span><span class="p">,</span> <span class="n">z_0</span><span class="p">),</span> <span class="n">v</span><span class="p">,</span> <span class="n">coeff</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">x_p</span><span class="p">,</span> <span class="n">y_p</span><span class="p">,</span> <span class="n">z_p</span>

    <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">v</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">r</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">q</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s">&quot;r, p, q&quot;</span><span class="p">,</span> <span class="n">integer</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="n">eq</span> <span class="o">=</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">coeff</span><span class="p">[</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">coeff</span><span class="p">[</span><span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">z</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">coeff</span><span class="p">[</span><span class="n">z</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="o">*</span><span class="n">y</span><span class="o">*</span><span class="n">coeff</span><span class="p">[</span><span class="n">x</span><span class="o">*</span><span class="n">y</span><span class="p">]</span> <span class="o">+</span> <span class="n">y</span><span class="o">*</span><span class="n">z</span><span class="o">*</span><span class="n">coeff</span><span class="p">[</span><span class="n">y</span><span class="o">*</span><span class="n">z</span><span class="p">]</span> <span class="o">+</span> <span class="n">z</span><span class="o">*</span><span class="n">x</span><span class="o">*</span><span class="n">coeff</span><span class="p">[</span><span class="n">z</span><span class="o">*</span><span class="n">x</span><span class="p">]</span>
    <span class="n">eq_1</span> <span class="o">=</span> <span class="n">Subs</span><span class="p">(</span><span class="n">eq</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">),</span> <span class="p">(</span><span class="n">r</span><span class="o">*</span><span class="n">x_0</span><span class="p">,</span> <span class="n">r</span><span class="o">*</span><span class="n">y_0</span> <span class="o">+</span> <span class="n">p</span><span class="p">,</span> <span class="n">r</span><span class="o">*</span><span class="n">z_0</span> <span class="o">+</span> <span class="n">q</span><span class="p">))</span><span class="o">.</span><span class="n">doit</span><span class="p">()</span>
    <span class="n">eq_1</span> <span class="o">=</span> <span class="n">_mexpand</span><span class="p">(</span><span class="n">eq_1</span><span class="p">)</span>
    <span class="n">A</span><span class="p">,</span> <span class="n">B</span> <span class="o">=</span> <span class="n">eq_1</span><span class="o">.</span><span class="n">as_independent</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">as_Add</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>


    <span class="n">x</span> <span class="o">=</span> <span class="n">A</span><span class="o">*</span><span class="n">x_0</span>
    <span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="n">A</span><span class="o">*</span><span class="n">y_0</span> <span class="o">-</span> <span class="n">_mexpand</span><span class="p">(</span><span class="n">B</span><span class="o">/</span><span class="n">r</span><span class="o">*</span><span class="n">p</span><span class="p">))</span>
    <span class="n">z</span> <span class="o">=</span> <span class="p">(</span><span class="n">A</span><span class="o">*</span><span class="n">z_0</span> <span class="o">-</span> <span class="n">_mexpand</span><span class="p">(</span><span class="n">B</span><span class="o">/</span><span class="n">r</span><span class="o">*</span><span class="n">q</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span>


<div class="viewcode-block" id="diop_ternary_quadratic_normal"><a class="viewcode-back" href="../../../modules/solvers/diophantine.html#sympy.solvers.diophantine.diop_ternary_quadratic_normal">[docs]</a><span class="k">def</span> <span class="nf">diop_ternary_quadratic_normal</span><span class="p">(</span><span class="n">eq</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Solves the quadratic ternary diophantine equation,</span>
<span class="sd">    `ax^2 + by^2 + cz^2 = 0`.</span>

<span class="sd">    Here the coefficients `a`, `b`, and `c` should be non zero. Otherwise the</span>
<span class="sd">    equation will be a quadratic binary or univariate equation. If solvable,</span>
<span class="sd">    returns a tuple `(x, y, z)` that satisifes the given equation. If the</span>
<span class="sd">    equation does not have integer solutions, `(None, None, None)` is returned.</span>

<span class="sd">    Usage</span>
<span class="sd">    =====</span>

<span class="sd">    ``diop_ternary_quadratic_normal(eq)``: where ``eq`` is an equation of the form</span>
<span class="sd">    `ax^2 + by^2 + cz^2 = 0`.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.abc import x, y, z</span>
<span class="sd">    &gt;&gt;&gt; from sympy.solvers.diophantine import diop_ternary_quadratic_normal</span>
<span class="sd">    &gt;&gt;&gt; diop_ternary_quadratic_normal(x**2 + 3*y**2 - z**2)</span>
<span class="sd">    (1, 0, 1)</span>
<span class="sd">    &gt;&gt;&gt; diop_ternary_quadratic_normal(4*x**2 + 5*y**2 - z**2)</span>
<span class="sd">    (1, 0, 2)</span>
<span class="sd">    &gt;&gt;&gt; diop_ternary_quadratic_normal(34*x**2 - 3*y**2 - 301*z**2)</span>
<span class="sd">    (4, 9, 1)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">var</span><span class="p">,</span> <span class="n">coeff</span><span class="p">,</span> <span class="n">diop_type</span> <span class="o">=</span> <span class="n">classify_diop</span><span class="p">(</span><span class="n">eq</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">diop_type</span> <span class="o">==</span> <span class="s">&quot;homogeneous_ternary_quadratic&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_diop_ternary_quadratic_normal</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">coeff</span><span class="p">)</span>

</div>
<span class="k">def</span> <span class="nf">_diop_ternary_quadratic_normal</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">coeff</span><span class="p">):</span>

    <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">var</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>

    <span class="n">a</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="n">z</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">a</span><span class="o">*</span><span class="n">b</span><span class="o">*</span><span class="n">c</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Try factoring out you equation or using diophantine()&quot;</span><span class="p">)</span>

    <span class="n">g</span> <span class="o">=</span> <span class="n">igcd</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">igcd</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span>

    <span class="n">a</span> <span class="o">=</span> <span class="n">a</span> <span class="o">//</span> <span class="n">g</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">b</span> <span class="o">//</span> <span class="n">g</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">c</span> <span class="o">//</span> <span class="n">g</span>

    <span class="n">a_0</span> <span class="o">=</span> <span class="n">square_factor</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="n">b_0</span> <span class="o">=</span> <span class="n">square_factor</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
    <span class="n">c_0</span> <span class="o">=</span> <span class="n">square_factor</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>

    <span class="n">a_1</span> <span class="o">=</span> <span class="n">a</span> <span class="o">//</span> <span class="n">a_0</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">b_1</span> <span class="o">=</span> <span class="n">b</span> <span class="o">//</span> <span class="n">b_0</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">c_1</span> <span class="o">=</span> <span class="n">c</span> <span class="o">//</span> <span class="n">c_0</span><span class="o">**</span><span class="mi">2</span>

    <span class="n">a_2</span><span class="p">,</span> <span class="n">b_2</span><span class="p">,</span> <span class="n">c_2</span> <span class="o">=</span> <span class="n">pairwise_prime</span><span class="p">(</span><span class="n">a_1</span><span class="p">,</span> <span class="n">b_1</span><span class="p">,</span> <span class="n">c_1</span><span class="p">)</span>

    <span class="n">A</span> <span class="o">=</span> <span class="o">-</span><span class="n">a_2</span><span class="o">*</span><span class="n">c_2</span>
    <span class="n">B</span> <span class="o">=</span> <span class="o">-</span><span class="n">b_2</span><span class="o">*</span><span class="n">c_2</span>

    <span class="c"># If following two conditions are satisified then there are no solutions</span>
    <span class="k">if</span> <span class="n">A</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">B</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">sqrt_mod</span><span class="p">(</span><span class="o">-</span><span class="n">b_2</span><span class="o">*</span><span class="n">c_2</span><span class="p">,</span> <span class="n">a_2</span><span class="p">)</span> <span class="o">==</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">sqrt_mod</span><span class="p">(</span><span class="o">-</span><span class="n">c_2</span><span class="o">*</span><span class="n">a_2</span><span class="p">,</span> <span class="n">b_2</span><span class="p">)</span> <span class="o">==</span> <span class="bp">None</span> <span class="ow">or</span>
        <span class="n">sqrt_mod</span><span class="p">(</span><span class="o">-</span><span class="n">a_2</span><span class="o">*</span><span class="n">b_2</span><span class="p">,</span> <span class="n">c_2</span><span class="p">)</span> <span class="o">==</span> <span class="bp">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>

    <span class="n">z_0</span><span class="p">,</span> <span class="n">x_0</span><span class="p">,</span> <span class="n">y_0</span> <span class="o">=</span> <span class="n">descent</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">divisible</span><span class="p">(</span><span class="n">z_0</span><span class="p">,</span> <span class="n">c_2</span><span class="p">)</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">z_0</span> <span class="o">=</span> <span class="n">z_0</span> <span class="o">//</span> <span class="nb">abs</span><span class="p">(</span><span class="n">c_2</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">x_0</span> <span class="o">=</span> <span class="n">x_0</span><span class="o">*</span><span class="p">(</span><span class="n">S</span><span class="p">(</span><span class="n">z_0</span><span class="p">)</span><span class="o">/</span><span class="n">c_2</span><span class="p">)</span><span class="o">.</span><span class="n">q</span>
        <span class="n">y_0</span> <span class="o">=</span> <span class="n">y_0</span><span class="o">*</span><span class="p">(</span><span class="n">S</span><span class="p">(</span><span class="n">z_0</span><span class="p">)</span><span class="o">/</span><span class="n">c_2</span><span class="p">)</span><span class="o">.</span><span class="n">q</span>
        <span class="n">z_0</span> <span class="o">=</span> <span class="p">(</span><span class="n">S</span><span class="p">(</span><span class="n">z_0</span><span class="p">)</span><span class="o">/</span><span class="n">c_2</span><span class="p">)</span><span class="o">.</span><span class="n">p</span>

    <span class="n">x_0</span><span class="p">,</span> <span class="n">y_0</span><span class="p">,</span> <span class="n">z_0</span> <span class="o">=</span> <span class="n">simplified</span><span class="p">(</span><span class="n">x_0</span><span class="p">,</span> <span class="n">y_0</span><span class="p">,</span> <span class="n">z_0</span><span class="p">)</span>

    <span class="c"># Holzer reduction</span>
    <span class="k">if</span> <span class="n">sign</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">==</span> <span class="n">sign</span><span class="p">(</span><span class="n">b</span><span class="p">):</span>
        <span class="n">x_0</span><span class="p">,</span> <span class="n">y_0</span><span class="p">,</span> <span class="n">z_0</span> <span class="o">=</span> <span class="n">holzer</span><span class="p">(</span><span class="n">x_0</span><span class="p">,</span> <span class="n">y_0</span><span class="p">,</span> <span class="n">z_0</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">a_2</span><span class="p">),</span> <span class="nb">abs</span><span class="p">(</span><span class="n">b_2</span><span class="p">),</span> <span class="nb">abs</span><span class="p">(</span><span class="n">c_2</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">sign</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">==</span> <span class="n">sign</span><span class="p">(</span><span class="n">c</span><span class="p">):</span>
        <span class="n">x_0</span><span class="p">,</span> <span class="n">z_0</span><span class="p">,</span> <span class="n">y_0</span> <span class="o">=</span> <span class="n">holzer</span><span class="p">(</span><span class="n">x_0</span><span class="p">,</span> <span class="n">z_0</span><span class="p">,</span> <span class="n">y_0</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">a_2</span><span class="p">),</span> <span class="nb">abs</span><span class="p">(</span><span class="n">c_2</span><span class="p">),</span> <span class="nb">abs</span><span class="p">(</span><span class="n">b_2</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">y_0</span><span class="p">,</span> <span class="n">z_0</span><span class="p">,</span> <span class="n">x_0</span> <span class="o">=</span> <span class="n">holzer</span><span class="p">(</span><span class="n">y_0</span><span class="p">,</span> <span class="n">z_0</span><span class="p">,</span> <span class="n">x_0</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">b_2</span><span class="p">),</span> <span class="nb">abs</span><span class="p">(</span><span class="n">c_2</span><span class="p">),</span> <span class="nb">abs</span><span class="p">(</span><span class="n">a_2</span><span class="p">))</span>

    <span class="n">x_0</span> <span class="o">=</span> <span class="n">reconstruct</span><span class="p">(</span><span class="n">b_1</span><span class="p">,</span> <span class="n">c_1</span><span class="p">,</span> <span class="n">x_0</span><span class="p">)</span>
    <span class="n">y_0</span> <span class="o">=</span> <span class="n">reconstruct</span><span class="p">(</span><span class="n">a_1</span><span class="p">,</span> <span class="n">c_1</span><span class="p">,</span> <span class="n">y_0</span><span class="p">)</span>
    <span class="n">z_0</span> <span class="o">=</span> <span class="n">reconstruct</span><span class="p">(</span><span class="n">a_1</span><span class="p">,</span> <span class="n">b_1</span><span class="p">,</span> <span class="n">z_0</span><span class="p">)</span>

    <span class="n">l</span> <span class="o">=</span> <span class="n">ilcm</span><span class="p">(</span><span class="n">a_0</span><span class="p">,</span> <span class="n">ilcm</span><span class="p">(</span><span class="n">b_0</span><span class="p">,</span> <span class="n">c_0</span><span class="p">))</span>

    <span class="n">x_0</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x_0</span><span class="o">*</span><span class="n">l</span><span class="o">//</span><span class="n">a_0</span><span class="p">)</span>
    <span class="n">y_0</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">y_0</span><span class="o">*</span><span class="n">l</span><span class="o">//</span><span class="n">b_0</span><span class="p">)</span>
    <span class="n">z_0</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">z_0</span><span class="o">*</span><span class="n">l</span><span class="o">//</span><span class="n">c_0</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">simplified</span><span class="p">(</span><span class="n">x_0</span><span class="p">,</span> <span class="n">y_0</span><span class="p">,</span> <span class="n">z_0</span><span class="p">)</span>


<div class="viewcode-block" id="square_factor"><a class="viewcode-back" href="../../../modules/solvers/diophantine.html#sympy.solvers.diophantine.square_factor">[docs]</a><span class="k">def</span> <span class="nf">square_factor</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns an integer `c` s.t. `a = c^2k, \ c,k \in Z`. Here `k` is square</span>
<span class="sd">    free.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.solvers.diophantine import square_factor</span>
<span class="sd">    &gt;&gt;&gt; square_factor(24)</span>
<span class="sd">    2</span>
<span class="sd">    &gt;&gt;&gt; square_factor(36)</span>
<span class="sd">    6</span>
<span class="sd">    &gt;&gt;&gt; square_factor(1)</span>
<span class="sd">    1</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">factorint</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">a</span><span class="p">))</span>
    <span class="n">c</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">c</span> <span class="o">*</span> <span class="n">p</span><span class="o">**</span><span class="p">(</span><span class="n">e</span><span class="o">//</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">c</span>

</div>
<div class="viewcode-block" id="pairwise_prime"><a class="viewcode-back" href="../../../modules/solvers/diophantine.html#sympy.solvers.diophantine.pairwise_prime">[docs]</a><span class="k">def</span> <span class="nf">pairwise_prime</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Transform `ax^2 + by^2 + cz^2 = 0` into an equivalent equation</span>
<span class="sd">    `a&#39;x^2 + b&#39;y^2 + c&#39;z^2 = 0` where `a&#39;, b&#39;, c&#39;` are pairwise relatively</span>
<span class="sd">    prime.</span>

<span class="sd">    Returns a tuple containing `a&#39;, b&#39;, c&#39;`. `\gcd(a, b, c)` should equal `1`</span>
<span class="sd">    for this to work. The solutions for `ax^2 + by^2 + cz^2 = 0` can be</span>
<span class="sd">    recovered from the solutions of `a&#39;x^2 + b&#39;y^2 + c&#39;z^2 = 0`.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.solvers.diophantine import pairwise_prime</span>
<span class="sd">    &gt;&gt;&gt; pairwise_prime(6, 15, 10)</span>
<span class="sd">    (5, 2, 3)</span>

<span class="sd">    See Also</span>
<span class="sd">    ========</span>

<span class="sd">    make_prime(), reocnstruct()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">make_prime</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
    <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="n">make_prime</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
    <span class="n">c</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">make_prime</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span>

</div>
<div class="viewcode-block" id="make_prime"><a class="viewcode-back" href="../../../modules/solvers/diophantine.html#sympy.solvers.diophantine.make_prime">[docs]</a><span class="k">def</span> <span class="nf">make_prime</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Transform the equation `ax^2 + by^2 + cz^2 = 0` to an equivalent equation</span>
<span class="sd">    `a&#39;x^2 + b&#39;y^2 + c&#39;z^2 = 0` with `\gcd(a&#39;, b&#39;) = 1`.</span>

<span class="sd">    Returns a tuple `(a&#39;, b&#39;, c&#39;)` which satisfies above conditions. Note that</span>
<span class="sd">    in the returned tuple `\gcd(a&#39;, c&#39;)` and `\gcd(b&#39;, c&#39;)` can take any value.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.solvers.diophantine import make_prime</span>
<span class="sd">    &gt;&gt;&gt; make_prime(4, 2, 7)</span>
<span class="sd">    (2, 1, 14)</span>

<span class="sd">    See Also</span>
<span class="sd">    ========</span>

<span class="sd">    pairwaise_prime(), reconstruct()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">igcd</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">g</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">factorint</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">a</span> <span class="o">//</span> <span class="n">p</span><span class="o">**</span><span class="n">e</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">b</span> <span class="o">//</span> <span class="n">p</span><span class="o">**</span><span class="n">e</span>

            <span class="k">if</span> <span class="n">e</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">c</span> <span class="o">=</span> <span class="n">p</span><span class="o">*</span><span class="n">c</span>

    <span class="k">return</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span>

</div>
<div class="viewcode-block" id="reconstruct"><a class="viewcode-back" href="../../../modules/solvers/diophantine.html#sympy.solvers.diophantine.reconstruct">[docs]</a><span class="k">def</span> <span class="nf">reconstruct</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">z</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reconstruct the `z` value of an equivalent solution of `ax^2 + by^2 + cz^2`</span>
<span class="sd">    from the `z` value of a solution of a transformed version of the above</span>
<span class="sd">    equation.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">igcd</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">g</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">factorint</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">e</span> <span class="o">%</span><span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">z</span> <span class="o">=</span> <span class="n">z</span><span class="o">*</span><span class="n">p</span><span class="o">**</span><span class="p">(</span><span class="n">e</span><span class="o">//</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">z</span> <span class="o">=</span> <span class="n">z</span><span class="o">*</span><span class="n">p</span><span class="o">**</span><span class="p">((</span><span class="n">e</span><span class="o">//</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">z</span>

</div>
<div class="viewcode-block" id="ldescent"><a class="viewcode-back" href="../../../modules/solvers/diophantine.html#sympy.solvers.diophantine.ldescent">[docs]</a><span class="k">def</span> <span class="nf">ldescent</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Uses Lagrange&#39;s method to find a non trivial solution to</span>
<span class="sd">    `w^2 = Ax^2 + By^2`.</span>

<span class="sd">    Here, `A \\neq 0` and `B \\neq 0` and `A` and `B` are square free. Output a</span>
<span class="sd">    tuple `(w_0, x_0, y_0)` which is a solution to the above equation.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.solvers.diophantine import ldescent</span>
<span class="sd">    &gt;&gt;&gt; ldescent(1, 1) # w^2 = x^2 + y^2</span>
<span class="sd">    (1, 1, 0)</span>
<span class="sd">    &gt;&gt;&gt; ldescent(4, -7) # w^2 = 4x^2 - 7y^2</span>
<span class="sd">    (2, -1, 0)</span>

<span class="sd">    This means that `x = -1, y = 0` and `w = 2` is a solution to the equation</span>
<span class="sd">    `w^2 = 4x^2 - 7y^2`</span>

<span class="sd">    &gt;&gt;&gt; ldescent(5, -1) # w^2 = 5x^2 - y^2</span>
<span class="sd">    (2, 1, -1)</span>

<span class="sd">    References</span>
<span class="sd">    ==========</span>

<span class="sd">    .. [1] The algorithmic resolution of Diophantine equations, Nigel P. Smart,</span>
<span class="sd">           London Mathematical Society Student Texts 41, Cambridge University</span>
<span class="sd">           Press, Cambridge, 1998.</span>
<span class="sd">    .. [2] Efficient Solution of Rational Conices, J. E. Cremona and D. Rusin,</span>
<span class="sd">           Mathematics of Computation, Volume 00, Number 0.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">A</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">abs</span><span class="p">(</span><span class="n">B</span><span class="p">):</span>
        <span class="n">w</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="n">ldescent</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">A</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">w</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>

    <span class="k">if</span> <span class="n">A</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">One</span><span class="p">,</span> <span class="n">S</span><span class="o">.</span><span class="n">One</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">B</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">One</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">S</span><span class="o">.</span><span class="n">One</span><span class="p">)</span>

    <span class="n">r</span> <span class="o">=</span> <span class="n">sqrt_mod</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">)</span>

    <span class="n">Q</span> <span class="o">=</span> <span class="p">(</span><span class="n">r</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">A</span><span class="p">)</span> <span class="o">//</span> <span class="n">B</span>

    <span class="k">if</span> <span class="n">Q</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">B_0</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">d</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">div</span> <span class="o">=</span> <span class="n">divisors</span><span class="p">(</span><span class="n">Q</span><span class="p">)</span>
        <span class="n">B_0</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">div</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">Q</span><span class="p">)</span> <span class="o">//</span> <span class="n">i</span><span class="p">),</span> <span class="n">Integer</span><span class="p">):</span>
                <span class="n">B_0</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="n">sign</span><span class="p">(</span><span class="n">Q</span><span class="p">)</span><span class="o">*</span><span class="n">i</span><span class="p">,</span> <span class="n">sqrt</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">Q</span><span class="p">)</span> <span class="o">//</span> <span class="n">i</span><span class="p">)</span>
                <span class="k">break</span>

    <span class="k">if</span> <span class="n">B_0</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">W</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">ldescent</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B_0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">simplified</span><span class="p">((</span><span class="o">-</span><span class="n">A</span><span class="o">*</span><span class="n">X</span> <span class="o">+</span> <span class="n">r</span><span class="o">*</span><span class="n">W</span><span class="p">),</span> <span class="p">(</span><span class="n">r</span><span class="o">*</span><span class="n">X</span> <span class="o">-</span> <span class="n">W</span><span class="p">),</span> <span class="n">Y</span><span class="o">*</span><span class="p">(</span><span class="n">B_0</span><span class="o">*</span><span class="n">d</span><span class="p">))</span>
    <span class="c"># In this module Descent will always be called with inputs which have solutions.</span>

</div>
<div class="viewcode-block" id="descent"><a class="viewcode-back" href="../../../modules/solvers/diophantine.html#sympy.solvers.diophantine.descent">[docs]</a><span class="k">def</span> <span class="nf">descent</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Lagrange&#39;s `descent()` with lattice-reduction to find solutions to</span>
<span class="sd">    `x^2 = Ay^2 + Bz^2`.</span>

<span class="sd">    Here `A` and `B` should be square free and pairwise prime. Always should be</span>
<span class="sd">    called with suitable ``A`` and ``B`` so that the above equation has</span>
<span class="sd">    solutions.</span>

<span class="sd">    This is more faster than the normal Lagrange&#39;s descent algorithm because</span>
<span class="sd">    the gaussian reduction is used.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.solvers.diophantine import descent</span>
<span class="sd">    &gt;&gt;&gt; descent(3, 1) # x**2 = 3*y**2 + z**2</span>
<span class="sd">    (1, 0, 1)</span>

<span class="sd">    `(x, y, z) = (1, 0, 1)` is a solution to the above equation.</span>

<span class="sd">    &gt;&gt;&gt; descent(41, -113)</span>
<span class="sd">    (-16, -3, 1)</span>

<span class="sd">    References</span>
<span class="sd">    ==========</span>

<span class="sd">    .. [1] Efficient Solution of Rational Conices, J. E. Cremona and D. Rusin,</span>
<span class="sd">           Mathematics of Computation, Volume 00, Number 0.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">A</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">abs</span><span class="p">(</span><span class="n">B</span><span class="p">):</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">descent</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">A</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">y</span>

    <span class="k">if</span> <span class="n">B</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">A</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">B</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">B</span> <span class="o">==</span> <span class="o">-</span><span class="n">A</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">B</span> <span class="o">==</span> <span class="n">A</span><span class="p">:</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">descent</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">A</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">A</span><span class="o">*</span><span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

    <span class="n">w</span> <span class="o">=</span> <span class="n">sqrt_mod</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">)</span>
    <span class="n">x_0</span><span class="p">,</span> <span class="n">z_0</span> <span class="o">=</span> <span class="n">gaussian_reduce</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">)</span>

    <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="n">x_0</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">A</span><span class="o">*</span><span class="n">z_0</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">//</span> <span class="n">B</span>
    <span class="n">t_2</span> <span class="o">=</span> <span class="n">square_factor</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
    <span class="n">t_1</span> <span class="o">=</span> <span class="n">t</span> <span class="o">//</span> <span class="n">t_2</span><span class="o">**</span><span class="mi">2</span>

    <span class="n">x_1</span><span class="p">,</span> <span class="n">z_1</span><span class="p">,</span> <span class="n">y_1</span> <span class="o">=</span> <span class="n">descent</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">t_1</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">simplified</span><span class="p">(</span><span class="n">x_0</span><span class="o">*</span><span class="n">x_1</span> <span class="o">+</span> <span class="n">A</span><span class="o">*</span><span class="n">z_0</span><span class="o">*</span><span class="n">z_1</span><span class="p">,</span> <span class="n">z_0</span><span class="o">*</span><span class="n">x_1</span> <span class="o">+</span> <span class="n">x_0</span><span class="o">*</span><span class="n">z_1</span><span class="p">,</span> <span class="n">t_1</span><span class="o">*</span><span class="n">t_2</span><span class="o">*</span><span class="n">y_1</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="gaussian_reduce"><a class="viewcode-back" href="../../../modules/solvers/diophantine.html#sympy.solvers.diophantine.gaussian_reduce">[docs]</a><span class="k">def</span> <span class="nf">gaussian_reduce</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns a reduced solution `(x, z)` to the congruence</span>
<span class="sd">    `X^2 - aZ^2 \equiv 0 \ (mod \ b)` so that `x^2 + |a|z^2` is minimal.</span>

<span class="sd">    Details</span>
<span class="sd">    =======</span>

<span class="sd">    Here ``w`` is a solution of the congruence `x^2 \equiv a \ (mod \ b)`</span>

<span class="sd">    References</span>
<span class="sd">    ==========</span>

<span class="sd">    .. [1] Gaussian lattice Reduction [online]. Available:</span>
<span class="sd">        http://home.ie.cuhk.edu.hk/~wkshum/wordpress/?p=404</span>
<span class="sd">    .. [2] Efficient Solution of Rational Conices, J. E. Cremona and D. Rusin,</span>
<span class="sd">        Mathematics of Computation, Volume 00, Number 0.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">u</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">v</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">dot</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">v</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">norm</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">norm</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="n">u</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">v</span><span class="p">,</span> <span class="n">u</span>

    <span class="k">while</span> <span class="n">norm</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">norm</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="n">k</span> <span class="o">=</span> <span class="n">dot</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="o">//</span> <span class="n">dot</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
        <span class="n">u</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">v</span><span class="p">,</span> <span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span> <span class="n">k</span><span class="o">*</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span> <span class="n">k</span><span class="o">*</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="n">u</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">v</span><span class="p">,</span> <span class="n">u</span>

    <span class="k">if</span> <span class="n">dot</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">dot</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span> <span class="ow">or</span> <span class="n">norm</span><span class="p">((</span><span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">w</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">norm</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">v</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">c</span> <span class="o">=</span> <span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">w</span> <span class="o">+</span> <span class="n">b</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

</div>
<span class="k">def</span> <span class="nf">dot</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns a special dot product of the vectors `u = (u_{1}, u_{2})` and</span>
<span class="sd">    `v = (v_{1}, v_{2})` which is defined in order to reduce solution of</span>
<span class="sd">    the congruence equation `X^2 - aZ^2 \equiv 0 \ (mod \ b)`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">u_1</span><span class="p">,</span> <span class="n">u_2</span> <span class="o">=</span> <span class="n">u</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">v_1</span><span class="p">,</span> <span class="n">v_2</span> <span class="o">=</span> <span class="n">v</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">w</span><span class="o">*</span><span class="n">u_1</span> <span class="o">+</span> <span class="n">b</span><span class="o">*</span><span class="n">u_2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">w</span><span class="o">*</span><span class="n">v_1</span> <span class="o">+</span> <span class="n">b</span><span class="o">*</span><span class="n">v_2</span><span class="p">)</span> <span class="o">+</span> <span class="nb">abs</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">*</span><span class="n">u_1</span><span class="o">*</span><span class="n">v_1</span>


<span class="k">def</span> <span class="nf">norm</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the norm of the vector `u = (u_{1}, u_{2})` under the dot product</span>
<span class="sd">    defined by `u \cdot v = (wu_{1} + bu_{2})(w*v_{1} + bv_{2}) + |a|*u_{1}*v_{1}`</span>
<span class="sd">    where `u = (u_{1}, u_{2})` and `v = (v_{1}, v_{2})`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">u_1</span><span class="p">,</span> <span class="n">u_2</span> <span class="o">=</span> <span class="n">u</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">dot</span><span class="p">((</span><span class="n">u_1</span><span class="p">,</span> <span class="n">u_2</span><span class="p">),</span> <span class="p">(</span><span class="n">u_1</span><span class="p">,</span> <span class="n">u_2</span><span class="p">),</span> <span class="n">w</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>


<div class="viewcode-block" id="holzer"><a class="viewcode-back" href="../../../modules/solvers/diophantine.html#sympy.solvers.diophantine.holzer">[docs]</a><span class="k">def</span> <span class="nf">holzer</span><span class="p">(</span><span class="n">x_0</span><span class="p">,</span> <span class="n">y_0</span><span class="p">,</span> <span class="n">z_0</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Simplify the solution `(x_{0}, y_{0}, z_{0})` of the equation</span>
<span class="sd">    `ax^2 + by^2 = cz^2` with `a, b, c &gt; 0` and `z_{0}^2 \geq \mid ab \mid` to</span>
<span class="sd">    a new reduced solution `(x, y, z)` such that `z^2 \leq \mid ab \mid`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">while</span> <span class="n">z_0</span> <span class="o">&gt;</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="n">b</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">c</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">k</span> <span class="o">=</span> <span class="n">c</span> <span class="o">//</span> <span class="mi">2</span>
            <span class="n">u_0</span><span class="p">,</span> <span class="n">v_0</span> <span class="o">=</span> <span class="n">base_solution_linear</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">y_0</span><span class="p">,</span> <span class="o">-</span><span class="n">x_0</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">k</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">c</span>
            <span class="n">u_0</span><span class="p">,</span> <span class="n">v_0</span> <span class="o">=</span> <span class="n">base_solution_linear</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">y_0</span><span class="p">,</span> <span class="o">-</span><span class="n">x_0</span><span class="p">)</span>

        <span class="n">w</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="n">u_0</span><span class="o">*</span><span class="n">x_0</span> <span class="o">+</span> <span class="n">b</span><span class="o">*</span><span class="n">v_0</span><span class="o">*</span><span class="n">y_0</span><span class="p">)</span> <span class="o">//</span> <span class="p">(</span><span class="n">c</span><span class="o">*</span><span class="n">z_0</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">c</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">w</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">!=</span> <span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="n">u_0</span> <span class="o">+</span> <span class="n">b</span><span class="o">*</span><span class="n">v_0</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">w</span> <span class="o">=</span> <span class="n">w</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">x_0</span><span class="o">*</span><span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="n">u_0</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">b</span><span class="o">*</span><span class="n">v_0</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">c</span><span class="o">*</span><span class="n">w</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">u_0</span><span class="o">*</span><span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="n">u_0</span><span class="o">*</span><span class="n">x_0</span> <span class="o">+</span> <span class="n">b</span><span class="o">*</span><span class="n">v_0</span><span class="o">*</span><span class="n">y_0</span> <span class="o">+</span> <span class="n">c</span><span class="o">*</span><span class="n">w</span><span class="o">*</span><span class="n">z_0</span><span class="p">))</span> <span class="o">//</span> <span class="n">k</span>
        <span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="n">y_0</span><span class="o">*</span><span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="n">u_0</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">b</span><span class="o">*</span><span class="n">v_0</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">c</span><span class="o">*</span><span class="n">w</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">v_0</span><span class="o">*</span><span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="n">u_0</span><span class="o">*</span><span class="n">x_0</span> <span class="o">+</span> <span class="n">b</span><span class="o">*</span><span class="n">v_0</span><span class="o">*</span><span class="n">y_0</span> <span class="o">+</span> <span class="n">c</span><span class="o">*</span><span class="n">w</span><span class="o">*</span><span class="n">z_0</span><span class="p">))</span> <span class="o">//</span> <span class="n">k</span>
        <span class="n">z</span> <span class="o">=</span> <span class="p">(</span><span class="n">z_0</span><span class="o">*</span><span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="n">u_0</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">b</span><span class="o">*</span><span class="n">v_0</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">c</span><span class="o">*</span><span class="n">w</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">w</span><span class="o">*</span><span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="n">u_0</span><span class="o">*</span><span class="n">x_0</span> <span class="o">+</span> <span class="n">b</span><span class="o">*</span><span class="n">v_0</span><span class="o">*</span><span class="n">y_0</span> <span class="o">+</span> <span class="n">c</span><span class="o">*</span><span class="n">w</span><span class="o">*</span><span class="n">z_0</span><span class="p">))</span> <span class="o">//</span> <span class="n">k</span>

        <span class="n">x_0</span><span class="p">,</span> <span class="n">y_0</span><span class="p">,</span> <span class="n">z_0</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span>

    <span class="k">return</span> <span class="n">x_0</span><span class="p">,</span> <span class="n">y_0</span><span class="p">,</span> <span class="n">z_0</span>

</div>
<div class="viewcode-block" id="diop_general_pythagorean"><a class="viewcode-back" href="../../../modules/solvers/diophantine.html#sympy.solvers.diophantine.diop_general_pythagorean">[docs]</a><span class="k">def</span> <span class="nf">diop_general_pythagorean</span><span class="p">(</span><span class="n">eq</span><span class="p">,</span> <span class="n">param</span><span class="o">=</span><span class="n">symbols</span><span class="p">(</span><span class="s">&quot;m&quot;</span><span class="p">,</span> <span class="n">integer</span><span class="o">=</span><span class="bp">True</span><span class="p">)):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Solves the general pythagorean equation,</span>
<span class="sd">    `a_{1}^2x_{1}^2 + a_{2}^2x_{2}^2 + . . . + a_{n}^2x_{n}^2 - a_{n + 1}^2x_{n + 1}^2 = 0`.</span>

<span class="sd">    Returns a tuple which contains a parametrized solution to the equation,</span>
<span class="sd">    sorted in the same order as the input variables.</span>

<span class="sd">    Usage</span>
<span class="sd">    =====</span>

<span class="sd">    ``diop_general_pythagorean(eq, param)``: where ``eq`` is a general</span>
<span class="sd">    pythagorean equation which is assumed to be zero and ``param`` is the base</span>
<span class="sd">    parameter used to construct other parameters by subscripting.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.solvers.diophantine import diop_general_pythagorean</span>
<span class="sd">    &gt;&gt;&gt; from sympy.abc import a, b, c, d, e</span>
<span class="sd">    &gt;&gt;&gt; diop_general_pythagorean(a**2 + b**2 + c**2 - d**2)</span>
<span class="sd">    (m1**2 + m2**2 - m3**2, 2*m1*m3, 2*m2*m3, m1**2 + m2**2 + m3**2)</span>
<span class="sd">    &gt;&gt;&gt; diop_general_pythagorean(9*a**2 - 4*b**2 + 16*c**2 + 25*d**2 + e**2)</span>
<span class="sd">    (10*m1**2  + 10*m2**2  + 10*m3**2 - 10*m4**2, 15*m1**2  + 15*m2**2  + 15*m3**2  + 15*m4**2, 15*m1*m4, 12*m2*m4, 60*m3*m4)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">var</span><span class="p">,</span> <span class="n">coeff</span><span class="p">,</span> <span class="n">diop_type</span>  <span class="o">=</span> <span class="n">classify_diop</span><span class="p">(</span><span class="n">eq</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">diop_type</span> <span class="o">==</span> <span class="s">&quot;general_pythagorean&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_diop_general_pythagorean</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">coeff</span><span class="p">,</span> <span class="n">param</span><span class="p">)</span>

</div>
<span class="k">def</span> <span class="nf">_diop_general_pythagorean</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">coeff</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>

    <span class="k">if</span> <span class="n">sign</span><span class="p">(</span><span class="n">coeff</span><span class="p">[</span><span class="n">var</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">])</span> <span class="o">+</span> <span class="n">sign</span><span class="p">(</span><span class="n">coeff</span><span class="p">[</span><span class="n">var</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">])</span> <span class="o">+</span> <span class="n">sign</span><span class="p">(</span><span class="n">coeff</span><span class="p">[</span><span class="n">var</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">coeff</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">coeff</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">*</span> <span class="o">-</span><span class="mi">1</span>

    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>
    <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">var</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">sign</span><span class="p">(</span><span class="n">coeff</span><span class="p">[</span><span class="n">v</span><span class="o">**</span><span class="mi">2</span><span class="p">])</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">i</span>

    <span class="n">m</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;1:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">integer</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">l</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">ith</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">for</span> <span class="n">m_i</span> <span class="ow">in</span> <span class="n">m</span><span class="p">:</span>
        <span class="n">ith</span> <span class="o">=</span> <span class="n">ith</span> <span class="o">+</span> <span class="n">m_i</span><span class="o">**</span><span class="mi">2</span>

    <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ith</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">m</span><span class="p">[</span><span class="n">n</span> <span class="o">-</span> <span class="mi">2</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">2</span><span class="p">):</span>
        <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">m</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">m</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>

    <span class="n">sol</span> <span class="o">=</span> <span class="n">l</span><span class="p">[:</span><span class="n">index</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">ith</span><span class="p">]</span> <span class="o">+</span> <span class="n">l</span><span class="p">[</span><span class="n">index</span><span class="p">:]</span>

    <span class="n">lcm</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">var</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">index</span> <span class="ow">or</span> <span class="p">(</span><span class="n">index</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">index</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">lcm</span> <span class="o">=</span> <span class="n">ilcm</span><span class="p">(</span><span class="n">lcm</span><span class="p">,</span> <span class="n">sqrt</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">coeff</span><span class="p">[</span><span class="n">v</span><span class="o">**</span><span class="mi">2</span><span class="p">])))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lcm</span> <span class="o">=</span> <span class="n">ilcm</span><span class="p">(</span><span class="n">lcm</span><span class="p">,</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">coeff</span><span class="p">[</span><span class="n">v</span><span class="o">**</span><span class="mi">2</span><span class="p">])</span> <span class="k">if</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">coeff</span><span class="p">[</span><span class="n">v</span><span class="o">**</span><span class="mi">2</span><span class="p">])</span> <span class="o">%</span> <span class="mi">2</span> <span class="k">else</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">coeff</span><span class="p">[</span><span class="n">v</span><span class="o">**</span><span class="mi">2</span><span class="p">])</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">var</span><span class="p">):</span>
        <span class="n">sol</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">lcm</span><span class="o">*</span><span class="n">sol</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">/</span> <span class="n">sqrt</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">coeff</span><span class="p">[</span><span class="n">v</span><span class="o">**</span><span class="mi">2</span><span class="p">]))</span>

    <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">sol</span><span class="p">)</span>


<div class="viewcode-block" id="diop_general_sum_of_squares"><a class="viewcode-back" href="../../../modules/solvers/diophantine.html#sympy.solvers.diophantine.diop_general_sum_of_squares">[docs]</a><span class="k">def</span> <span class="nf">diop_general_sum_of_squares</span><span class="p">(</span><span class="n">eq</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Solves the equation `x_{1}^2 + x_{2}^2 + . . . + x_{n}^2 - k = 0`.</span>

<span class="sd">    Returns at most ``limit`` number of solutions. Currently there is no way to</span>
<span class="sd">    set ``limit`` using higher level API&#39;s like ``diophantine()`` or</span>
<span class="sd">    ``diop_solve()`` but that will be fixed soon.</span>

<span class="sd">    Usage</span>
<span class="sd">    =====</span>

<span class="sd">    ``general_sum_of_squares(eq, limit)`` : Here ``eq`` is an expression which</span>
<span class="sd">    is assumed to be zero. Also, ``eq`` should be in the form,</span>
<span class="sd">    `x_{1}^2 + x_{2}^2 + . . . + x_{n}^2 - k = 0`. At most ``limit`` number of</span>
<span class="sd">    solutions are returned.</span>

<span class="sd">    Details</span>
<span class="sd">    =======</span>

<span class="sd">    When `n = 3` if `k = 4^a(8m + 7)` for some `a, m \in Z` then there will be</span>
<span class="sd">    no solutions. Refer [1]_ for more details.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.solvers.diophantine import diop_general_sum_of_squares</span>
<span class="sd">    &gt;&gt;&gt; from sympy.abc import a, b, c, d, e, f</span>
<span class="sd">    &gt;&gt;&gt; diop_general_sum_of_squares(a**2 + b**2 + c**2 + d**2 + e**2 - 2345)</span>
<span class="sd">    set([(0, 48, 5, 4, 0)])</span>

<span class="sd">    Reference</span>
<span class="sd">    =========</span>

<span class="sd">    .. [1] Representing an Integer as a sum of three squares, [online],</span>
<span class="sd">        Available:</span>
<span class="sd">        http://www.proofwiki.org/wiki/Integer_as_Sum_of_Three_Squares</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">var</span><span class="p">,</span> <span class="n">coeff</span><span class="p">,</span> <span class="n">diop_type</span> <span class="o">=</span> <span class="n">classify_diop</span><span class="p">(</span><span class="n">eq</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">diop_type</span> <span class="o">==</span> <span class="s">&quot;general_sum_of_squares&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_diop_general_sum_of_squares</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">coeff</span><span class="p">,</span> <span class="n">limit</span><span class="p">)</span>

</div>
<span class="k">def</span> <span class="nf">_diop_general_sum_of_squares</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">coeff</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>

    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>
    <span class="n">k</span> <span class="o">=</span> <span class="o">-</span><span class="nb">int</span><span class="p">(</span><span class="n">coeff</span><span class="p">[</span><span class="n">Integer</span><span class="p">(</span><span class="mi">1</span><span class="p">)])</span>
    <span class="n">s</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>

    <span class="k">if</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">set</span><span class="p">([])</span>

    <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">s</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">sum_of_three_squares</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
        <span class="n">s</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">sum_of_four_squares</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>

        <span class="n">m</span> <span class="o">=</span> <span class="n">n</span> <span class="o">//</span> <span class="mi">4</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">partition</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">limit</span><span class="p">):</span>

            <span class="n">soln</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">l</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
                <span class="k">break</span>

            <span class="k">for</span> <span class="n">n_i</span> <span class="ow">in</span> <span class="n">l</span><span class="p">:</span>
                <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="n">sum_of_four_squares</span><span class="p">(</span><span class="n">n_i</span><span class="p">)</span>
                <span class="n">soln</span> <span class="o">=</span> <span class="n">soln</span> <span class="o">+</span> <span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">]</span>

            <span class="n">soln</span> <span class="o">=</span> <span class="n">soln</span> <span class="o">+</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span> <span class="o">%</span> <span class="mi">4</span><span class="p">)</span>

            <span class="n">s</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">soln</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">s</span>


<span class="c">## Functions below this comment can be more suitably grouped under an Additive number theory module</span>
<span class="c">## rather than the Diophantine equation module.</span>


<div class="viewcode-block" id="partition"><a class="viewcode-back" href="../../../modules/solvers/diophantine.html#sympy.solvers.diophantine.partition">[docs]</a><span class="k">def</span> <span class="nf">partition</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">zeros</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns a generator that can be used to generate partitions of an integer</span>
<span class="sd">    `n`.</span>

<span class="sd">    A partition of `n` is a set of positive integers which add upto `n`. For</span>
<span class="sd">    example, partitions of 3 are 3 , 1 + 2, 1 + 1+ 1. A partition is returned</span>
<span class="sd">    as a tuple. If ``k`` equals None, then all possible partitions are returned</span>
<span class="sd">    irrespective of their size, otherwise only the partitions of size ``k`` are</span>
<span class="sd">    returned. If there are no partions of `n` with size `k` then an empty tuple</span>
<span class="sd">    is returned. If the ``zero`` parameter is set to True then a suitable</span>
<span class="sd">    number of zeros are added at the end of every partition of size less than</span>
<span class="sd">    ``k``.</span>

<span class="sd">    ``zero`` parameter is considered only if ``k`` is not None. When the</span>
<span class="sd">    partitions are over, the last `next()` call throws the ``StopIteration``</span>
<span class="sd">    exception, so this function should always be used inside a try - except</span>
<span class="sd">    block.</span>

<span class="sd">    Details</span>
<span class="sd">    =======</span>

<span class="sd">    ``partition(n, k)``: Here ``n`` is a positive integer and ``k`` is the size</span>
<span class="sd">    of the partition which is also positive integer.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.solvers.diophantine import partition</span>
<span class="sd">    &gt;&gt;&gt; f = partition(5)</span>
<span class="sd">    &gt;&gt;&gt; next(f)</span>
<span class="sd">    (1, 1, 1, 1, 1)</span>
<span class="sd">    &gt;&gt;&gt; next(f)</span>
<span class="sd">    (1, 1, 1, 2)</span>
<span class="sd">    &gt;&gt;&gt; g = partition(5, 3)</span>
<span class="sd">    &gt;&gt;&gt; next(g)</span>
<span class="sd">    (3, 1, 1)</span>
<span class="sd">    &gt;&gt;&gt; next(g)</span>
<span class="sd">    (2, 2, 1)</span>

<span class="sd">    Reference</span>
<span class="sd">    =========</span>

<span class="sd">    .. [1] Generating Integer Partitions, [online],</span>
<span class="sd">        Available: http://homepages.ed.ac.uk/jkellehe/partitions.php</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">yield</span> <span class="nb">tuple</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">k</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">yield</span> <span class="nb">tuple</span><span class="p">()</span>

        <span class="k">elif</span> <span class="n">k</span> <span class="o">&gt;</span> <span class="n">n</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">zeros</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">partition</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
                        <span class="k">yield</span> <span class="p">(</span><span class="n">t</span><span class="p">,)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">0</span><span class="p">,)</span> <span class="o">*</span> <span class="p">(</span><span class="n">k</span> <span class="o">-</span> <span class="n">i</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">yield</span> <span class="nb">tuple</span><span class="p">()</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">k</span><span class="p">)]</span>
            <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">n</span> <span class="o">-</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span>

            <span class="k">yield</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>

            <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">while</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">n</span> <span class="o">//</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>

                <span class="k">while</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">i</span> <span class="ow">and</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="n">k</span><span class="p">:</span>
                    <span class="n">a</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
                    <span class="n">a</span><span class="p">[</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>

                    <span class="k">yield</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>

                    <span class="n">j</span> <span class="o">=</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span>

                <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>

            <span class="k">if</span> <span class="n">zeros</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">partition</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
                        <span class="k">yield</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">0</span><span class="p">,)</span> <span class="o">*</span> <span class="p">(</span><span class="n">k</span> <span class="o">-</span> <span class="n">m</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
        <span class="n">l</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span>

        <span class="k">while</span> <span class="n">l</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">l</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">l</span> <span class="o">-=</span> <span class="mi">1</span>

            <span class="k">while</span> <span class="mi">2</span><span class="o">*</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="n">y</span><span class="p">:</span>
                <span class="n">a</span><span class="p">[</span><span class="n">l</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
                <span class="n">y</span> <span class="o">-=</span> <span class="n">x</span>
                <span class="n">l</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="n">m</span> <span class="o">=</span> <span class="n">l</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">while</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="n">y</span><span class="p">:</span>
                <span class="n">a</span><span class="p">[</span><span class="n">l</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
                <span class="n">a</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span>
                <span class="k">yield</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">a</span><span class="p">[:</span><span class="n">l</span> <span class="o">+</span> <span class="mi">2</span><span class="p">])</span>
                <span class="n">x</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">y</span> <span class="o">-=</span> <span class="mi">1</span>

            <span class="n">a</span><span class="p">[</span><span class="n">l</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="k">yield</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">a</span><span class="p">[:</span><span class="n">l</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>

</div>
<div class="viewcode-block" id="prime_as_sum_of_two_squares"><a class="viewcode-back" href="../../../modules/solvers/diophantine.html#sympy.solvers.diophantine.prime_as_sum_of_two_squares">[docs]</a><span class="k">def</span> <span class="nf">prime_as_sum_of_two_squares</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Represent a prime `p` which is congruent to 1 mod 4, as a sum of two</span>
<span class="sd">    squares.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.solvers.diophantine import prime_as_sum_of_two_squares</span>
<span class="sd">    &gt;&gt;&gt; prime_as_sum_of_two_squares(5)</span>
<span class="sd">    (2, 1)</span>

<span class="sd">    Reference</span>
<span class="sd">    =========</span>

<span class="sd">    .. [1] Representing a number as a sum of four squares, [online],</span>
<span class="sd">        Available: http://www.schorn.ch/howto.html</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">p</span> <span class="o">%</span> <span class="mi">8</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
        <span class="n">b</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">b</span> <span class="o">=</span> <span class="mi">3</span>

        <span class="k">while</span> <span class="nb">pow</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">nextprime</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>

    <span class="n">b</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">4</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">p</span>

    <span class="k">while</span> <span class="n">b</span><span class="o">**</span><span class="mi">2</span> <span class="o">&gt;</span> <span class="n">p</span><span class="p">:</span>
        <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span> <span class="o">%</span> <span class="n">b</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span> <span class="o">%</span> <span class="n">b</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="sum_of_three_squares"><a class="viewcode-back" href="../../../modules/solvers/diophantine.html#sympy.solvers.diophantine.sum_of_three_squares">[docs]</a><span class="k">def</span> <span class="nf">sum_of_three_squares</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns a 3-tuple `(a, b, c)` such that `a^2 + b^2 + c^2 = n` and</span>
<span class="sd">    `a, b, c \geq 0`.</span>

<span class="sd">    Returns (None, None, None) if `n = 4^a(8m + 7)` for some `a, m \in Z`. See</span>
<span class="sd">    [1]_ for more details.</span>

<span class="sd">    Usage</span>
<span class="sd">    =====</span>

<span class="sd">    ``sum_of_three_squares(n)``: Here ``n`` is a non-negative integer.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.solvers.diophantine import sum_of_three_squares</span>
<span class="sd">    &gt;&gt;&gt; sum_of_three_squares(44542)</span>
<span class="sd">    (207, 37, 18)</span>

<span class="sd">    References</span>
<span class="sd">    ==========</span>

<span class="sd">    .. [1] Representing a number as a sum of three squares, [online],</span>
<span class="sd">        Available: http://www.schorn.ch/howto.html</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">special</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">2</span><span class="p">:(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">3</span><span class="p">:(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">10</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">34</span><span class="p">:</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="mi">58</span><span class="p">:(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
        <span class="mi">85</span><span class="p">:(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">130</span><span class="p">:(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">214</span><span class="p">:(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">13</span><span class="p">),</span> <span class="mi">226</span><span class="p">:(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span> <span class="mi">370</span><span class="p">:(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span>
        <span class="mi">526</span><span class="p">:(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">21</span><span class="p">),</span> <span class="mi">706</span><span class="p">:(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">16</span><span class="p">),</span> <span class="mi">730</span><span class="p">:(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">27</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">1414</span><span class="p">:(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">33</span><span class="p">),</span> <span class="mi">1906</span><span class="p">:(</span><span class="mi">13</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">36</span><span class="p">),</span>
        <span class="mi">2986</span><span class="p">:</span> <span class="p">(</span><span class="mi">21</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">39</span><span class="p">),</span> <span class="mi">9634</span><span class="p">:</span> <span class="p">(</span><span class="mi">56</span><span class="p">,</span> <span class="mi">57</span><span class="p">,</span> <span class="mi">57</span><span class="p">)}</span>

    <span class="n">v</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">while</span> <span class="n">n</span> <span class="o">%</span> <span class="mi">4</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">v</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">n</span> <span class="o">//</span> <span class="mi">4</span>

    <span class="k">if</span> <span class="n">n</span> <span class="o">%</span> <span class="mi">8</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">special</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">special</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
        <span class="k">return</span> <span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="n">v</span><span class="o">*</span><span class="n">x</span><span class="p">,</span> <span class="mi">2</span><span class="o">**</span><span class="n">v</span><span class="o">*</span><span class="n">y</span><span class="p">,</span> <span class="mi">2</span><span class="o">**</span><span class="n">v</span><span class="o">*</span><span class="n">z</span><span class="p">)</span>

    <span class="n">l</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sqrt</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="n">l</span><span class="o">**</span><span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="n">v</span><span class="o">*</span><span class="n">l</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="n">x</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="k">if</span> <span class="n">n</span> <span class="o">%</span> <span class="mi">8</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">l</span> <span class="o">=</span> <span class="n">l</span> <span class="k">if</span> <span class="n">l</span> <span class="o">%</span> <span class="mi">2</span> <span class="k">else</span> <span class="n">l</span> <span class="o">-</span> <span class="mi">1</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">isprime</span><span class="p">((</span><span class="n">n</span> <span class="o">-</span> <span class="n">i</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">):</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">i</span>
                <span class="k">break</span>

        <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">prime_as_sum_of_two_squares</span><span class="p">((</span><span class="n">n</span> <span class="o">-</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="n">v</span><span class="o">*</span><span class="n">x</span><span class="p">,</span> <span class="mi">2</span><span class="o">**</span><span class="n">v</span><span class="o">*</span><span class="p">(</span><span class="n">y</span> <span class="o">+</span> <span class="n">z</span><span class="p">),</span> <span class="mi">2</span><span class="o">**</span><span class="n">v</span><span class="o">*</span><span class="nb">abs</span><span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">z</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">n</span> <span class="o">%</span> <span class="mi">8</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">or</span> <span class="n">n</span> <span class="o">%</span> <span class="mi">8</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
        <span class="n">l</span> <span class="o">=</span> <span class="n">l</span> <span class="k">if</span> <span class="n">l</span> <span class="o">%</span> <span class="mi">2</span> <span class="k">else</span> <span class="n">l</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">l</span> <span class="o">=</span> <span class="n">l</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">l</span> <span class="o">%</span> <span class="mi">2</span> <span class="k">else</span> <span class="n">l</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">isprime</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">i</span><span class="o">**</span><span class="mi">2</span><span class="p">):</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">i</span>
            <span class="k">break</span>

    <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">prime_as_sum_of_two_squares</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="n">v</span><span class="o">*</span><span class="n">x</span><span class="p">,</span> <span class="mi">2</span><span class="o">**</span><span class="n">v</span><span class="o">*</span><span class="n">y</span><span class="p">,</span> <span class="mi">2</span><span class="o">**</span><span class="n">v</span><span class="o">*</span><span class="n">z</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="sum_of_four_squares"><a class="viewcode-back" href="../../../modules/solvers/diophantine.html#sympy.solvers.diophantine.sum_of_four_squares">[docs]</a><span class="k">def</span> <span class="nf">sum_of_four_squares</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns a 4-tuple `(a, b, c, d)` such that `a^2 + b^2 + c^2 + d^2 = n`.</span>

<span class="sd">    Here `a, b, c, d \geq 0`.</span>

<span class="sd">    Usage</span>
<span class="sd">    =====</span>

<span class="sd">    ``sum_of_four_squares(n)``: Here ``n`` is a non-negative integer.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.solvers.diophantine import sum_of_four_squares</span>
<span class="sd">    &gt;&gt;&gt; sum_of_four_squares(3456)</span>
<span class="sd">    (8, 48, 32, 8)</span>
<span class="sd">    &gt;&gt;&gt; sum_of_four_squares(1294585930293)</span>
<span class="sd">    (0, 1137796, 2161, 1234)</span>

<span class="sd">    References</span>
<span class="sd">    ==========</span>

<span class="sd">    .. [1] Representing a number as a sum of four squares, [online],</span>
<span class="sd">        Available: http://www.schorn.ch/howto.html</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="n">v</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="n">n</span> <span class="o">%</span> <span class="mi">4</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">v</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">n</span> <span class="o">//</span> <span class="mi">4</span>

    <span class="k">if</span> <span class="n">n</span> <span class="o">%</span> <span class="mi">8</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>
        <span class="n">d</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">4</span>
    <span class="k">elif</span> <span class="n">n</span> <span class="o">%</span> <span class="mi">8</span> <span class="o">==</span> <span class="mi">6</span> <span class="ow">or</span> <span class="n">n</span> <span class="o">%</span> <span class="mi">8</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">d</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">d</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">sum_of_three_squares</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="n">v</span><span class="o">*</span><span class="n">d</span><span class="p">,</span> <span class="mi">2</span><span class="o">**</span><span class="n">v</span><span class="o">*</span><span class="n">x</span><span class="p">,</span> <span class="mi">2</span><span class="o">**</span><span class="n">v</span><span class="o">*</span><span class="n">y</span><span class="p">,</span> <span class="mi">2</span><span class="o">**</span><span class="n">v</span><span class="o">*</span><span class="n">z</span><span class="p">)</span>

</div>
<span class="k">def</span> <span class="nf">power_representation</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">zeros</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns a generator for finding k-tuples `(n_{1}, n_{2}, . . . n_{k})` such</span>
<span class="sd">    that `n = n_{1}^p + n_{2}^p + . . . n_{k}^p`.</span>

<span class="sd">    Here `n` is a non-negative integer. StopIteration exception is raised after</span>
<span class="sd">    all the solutions are generated, so should always be used within a try-</span>
<span class="sd">    catch block.</span>

<span class="sd">    Usage</span>
<span class="sd">    =====</span>

<span class="sd">    ``power_representation(n, p, k, zeros)``: Represent number ``n`` as a sum</span>
<span class="sd">    of ``k``, ``p``th powers. If ``zeros`` is true, then the solutions will</span>
<span class="sd">    contain zeros.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.solvers.diophantine import power_representation</span>
<span class="sd">    &gt;&gt;&gt; f = power_representation(1729, 3, 2) # Represent 1729 as a sum of two cubes</span>
<span class="sd">    &gt;&gt;&gt; next(f)</span>
<span class="sd">    (12, 1)</span>
<span class="sd">    &gt;&gt;&gt; next(f)</span>
<span class="sd">    (10, 9)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">p</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Expected: n &gt; 0 and k &gt;= 1 and p &gt;= 1&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">perfect_power</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
            <span class="k">yield</span> <span class="p">(</span><span class="n">perfect_power</span><span class="p">(</span><span class="n">n</span><span class="p">)[</span><span class="mi">0</span><span class="p">],)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">yield</span> <span class="nb">tuple</span><span class="p">()</span>

    <span class="k">elif</span> <span class="n">p</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">partition</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">zeros</span><span class="p">):</span>
            <span class="k">yield</span> <span class="n">t</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">l</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">integer_nthroot</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">p</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">pow_rep_recursive</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="p">[],</span> <span class="n">p</span><span class="p">):</span>
                <span class="k">yield</span> <span class="n">t</span>

        <span class="k">if</span> <span class="n">zeros</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">pow_rep_recursive</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="p">[],</span> <span class="n">p</span><span class="p">):</span>
                    <span class="k">yield</span> <span class="n">t</span> <span class="o">+</span> <span class="p">(</span><span class="mi">0</span><span class="p">,)</span> <span class="o">*</span> <span class="p">(</span><span class="n">k</span> <span class="o">-</span> <span class="n">i</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">pow_rep_recursive</span><span class="p">(</span><span class="n">n_i</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">n_remaining</span><span class="p">,</span> <span class="n">terms</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>

    <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">n_remaining</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">yield</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">terms</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">n_i</span> <span class="o">&gt;=</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">k</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">n_remaining</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">n_i</span><span class="o">**</span><span class="n">p</span> <span class="o">&lt;=</span> <span class="n">n_remaining</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">pow_rep_recursive</span><span class="p">(</span><span class="n">n_i</span><span class="p">,</span> <span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n_remaining</span> <span class="o">-</span> <span class="n">n_i</span><span class="o">**</span><span class="n">p</span><span class="p">,</span> <span class="n">terms</span> <span class="o">+</span> <span class="p">[</span><span class="n">n_i</span><span class="p">],</span> <span class="n">p</span><span class="p">):</span>
                    <span class="k">yield</span> <span class="n">t</span>

            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">pow_rep_recursive</span><span class="p">(</span><span class="n">n_i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">n_remaining</span><span class="p">,</span> <span class="n">terms</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
                <span class="k">yield</span> <span class="n">t</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/sympylogo.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">SymPy 0.7.5-git documentation</a> &raquo;</li>
          <li><a href="../../index.html" >Module code</a> &raquo;</li>
          <li><a href="../../sympy.html" >sympy</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2014 SymPy Development Team.
      Last updated on Jun 24, 2014.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.1.
    </div>
  </body>
</html>