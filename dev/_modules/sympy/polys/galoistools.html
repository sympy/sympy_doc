

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>sympy.polys.galoistools &mdash; SymPy 0.7.3 documentation</title>
    
    <link rel="stylesheet" href="../../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="http://live.sympy.org/static/live-core.css" type="text/css" />
    <link rel="stylesheet" href="http://live.sympy.org/static/live-autocomplete.css" type="text/css" />
    <link rel="stylesheet" href="http://live.sympy.org/static/live-sphinx.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '0.7.3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://c328740.ssl.cf1.rackcdn.com/mathjax/latest/MathJax.js?config=TeX-AMS_HTML-full"></script>
    <script type="text/javascript" src="http://live.sympy.org/static/utilities.js"></script>
    <script type="text/javascript" src="http://live.sympy.org/static/external/classy.js"></script>
    <script type="text/javascript" src="http://live.sympy.org/static/live-core.js"></script>
    <script type="text/javascript" src="http://live.sympy.org/static/live-autocomplete.js"></script>
    <script type="text/javascript" src="http://live.sympy.org/static/live-sphinx.js"></script>
    <script type="text/javascript" src="../../../_static/sidebar.js"></script>
    <link rel="shortcut icon" href="../../../_static/SymPy-Favicon.ico"/>
    <link rel="top" title="SymPy 0.7.3 documentation" href="../../../index.html" />
    <link rel="up" title="sympy" href="../../sympy.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../../../np-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">SymPy 0.7.3 documentation</a> &raquo;</li>
          <li><a href="../../index.html" >Module code</a> &raquo;</li>
          <li><a href="../../sympy.html" accesskey="U">sympy</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for sympy.polys.galoistools</h1><div class="highlight"><pre>
<span class="sd">&quot;&quot;&quot;Dense univariate polynomials with coefficients in Galois fields. &quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span><span class="p">,</span> <span class="n">division</span>

<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">uniform</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">ceil</span> <span class="k">as</span> <span class="n">_ceil</span><span class="p">,</span> <span class="n">sqrt</span> <span class="k">as</span> <span class="n">_sqrt</span>

<span class="kn">from</span> <span class="nn">sympy.core.compatibility</span> <span class="kn">import</span> <span class="n">SYMPY_INTS</span><span class="p">,</span> <span class="nb">xrange</span>
<span class="kn">from</span> <span class="nn">sympy.core.mul</span> <span class="kn">import</span> <span class="n">prod</span>
<span class="kn">from</span> <span class="nn">sympy.polys.polyutils</span> <span class="kn">import</span> <span class="n">_sort_factors</span>
<span class="kn">from</span> <span class="nn">sympy.polys.polyconfig</span> <span class="kn">import</span> <span class="n">query</span>
<span class="kn">from</span> <span class="nn">sympy.polys.polyerrors</span> <span class="kn">import</span> <span class="n">ExactQuotientFailed</span>

<span class="kn">from</span> <span class="nn">sympy.ntheory</span> <span class="kn">import</span> <span class="n">factorint</span>

<div class="viewcode-block" id="gf_crt"><a class="viewcode-back" href="../../../modules/polys/internals.html#sympy.polys.galoistools.gf_crt">[docs]</a><span class="k">def</span> <span class="nf">gf_crt</span><span class="p">(</span><span class="n">U</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">K</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Chinese Remainder Theorem.</span>

<span class="sd">    Given a set of integer residues ``u_0,...,u_n`` and a set of</span>
<span class="sd">    co-prime integer moduli ``m_0,...,m_n``, returns an integer</span>
<span class="sd">    ``u``, such that ``u = u_i mod m_i`` for ``i = ``0,...,n``.</span>

<span class="sd">    As an example consider a set of residues ``U = [49, 76, 65]``</span>
<span class="sd">    and a set of moduli ``M = [99, 97, 95]``. Then we have::</span>

<span class="sd">       &gt;&gt;&gt; from sympy.polys.domains import ZZ</span>
<span class="sd">       &gt;&gt;&gt; from sympy.polys.galoistools import gf_crt</span>
<span class="sd">       &gt;&gt;&gt; from sympy.ntheory.modular import solve_congruence</span>

<span class="sd">       &gt;&gt;&gt; gf_crt([49, 76, 65], [99, 97, 95], ZZ)</span>
<span class="sd">       639985</span>

<span class="sd">    This is the correct result because::</span>

<span class="sd">       &gt;&gt;&gt; [639985 % m for m in [99, 97, 95]]</span>
<span class="sd">       [49, 76, 65]</span>

<span class="sd">    Note: this is a low-level routine with no error checking.</span>

<span class="sd">    See Also</span>
<span class="sd">    ========</span>

<span class="sd">    sympy.ntheory.modular.crt : a higher level crt routine</span>
<span class="sd">    sympy.ntheory.modular.solve_congruence</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">prod</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">K</span><span class="o">.</span><span class="n">one</span><span class="p">)</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">K</span><span class="o">.</span><span class="n">zero</span>

    <span class="k">for</span> <span class="n">u</span><span class="p">,</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">U</span><span class="p">,</span> <span class="n">M</span><span class="p">):</span>
        <span class="n">e</span> <span class="o">=</span> <span class="n">p</span> <span class="o">//</span> <span class="n">m</span>
        <span class="n">s</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">K</span><span class="o">.</span><span class="n">gcdex</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
        <span class="n">v</span> <span class="o">+=</span> <span class="n">e</span><span class="o">*</span><span class="p">(</span><span class="n">u</span><span class="o">*</span><span class="n">s</span> <span class="o">%</span> <span class="n">m</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">v</span> <span class="o">%</span> <span class="n">p</span>

</div>
<div class="viewcode-block" id="gf_crt1"><a class="viewcode-back" href="../../../modules/polys/internals.html#sympy.polys.galoistools.gf_crt1">[docs]</a><span class="k">def</span> <span class="nf">gf_crt1</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">K</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    First part of the Chinese Remainder Theorem.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.polys.domains import ZZ</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.galoistools import gf_crt1</span>

<span class="sd">    &gt;&gt;&gt; gf_crt1([99, 97, 95], ZZ)</span>
<span class="sd">    (912285, [9215, 9405, 9603], [62, 24, 12])</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">E</span><span class="p">,</span> <span class="n">S</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">prod</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">K</span><span class="o">.</span><span class="n">one</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">M</span><span class="p">:</span>
        <span class="n">E</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span> <span class="o">//</span> <span class="n">m</span><span class="p">)</span>
        <span class="n">S</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">K</span><span class="o">.</span><span class="n">gcdex</span><span class="p">(</span><span class="n">E</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">m</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">%</span> <span class="n">m</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">p</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">S</span>

</div>
<div class="viewcode-block" id="gf_crt2"><a class="viewcode-back" href="../../../modules/polys/internals.html#sympy.polys.galoistools.gf_crt2">[docs]</a><span class="k">def</span> <span class="nf">gf_crt2</span><span class="p">(</span><span class="n">U</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">K</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Second part of the Chinese Remainder Theorem.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.polys.domains import ZZ</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.galoistools import gf_crt2</span>

<span class="sd">    &gt;&gt;&gt; U = [49, 76, 65]</span>
<span class="sd">    &gt;&gt;&gt; M = [99, 97, 95]</span>
<span class="sd">    &gt;&gt;&gt; p = 912285</span>
<span class="sd">    &gt;&gt;&gt; E = [9215, 9405, 9603]</span>
<span class="sd">    &gt;&gt;&gt; S = [62, 24, 12]</span>

<span class="sd">    &gt;&gt;&gt; gf_crt2(U, M, p, E, S, ZZ)</span>
<span class="sd">    639985</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">K</span><span class="o">.</span><span class="n">zero</span>

    <span class="k">for</span> <span class="n">u</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">U</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">S</span><span class="p">):</span>
        <span class="n">v</span> <span class="o">+=</span> <span class="n">e</span><span class="o">*</span><span class="p">(</span><span class="n">u</span><span class="o">*</span><span class="n">s</span> <span class="o">%</span> <span class="n">m</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">v</span> <span class="o">%</span> <span class="n">p</span>

</div>
<div class="viewcode-block" id="gf_int"><a class="viewcode-back" href="../../../modules/polys/internals.html#sympy.polys.galoistools.gf_int">[docs]</a><span class="k">def</span> <span class="nf">gf_int</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Coerce ``a mod p`` to an integer in the range ``[-p/2, p/2]``.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.polys.galoistools import gf_int</span>

<span class="sd">    &gt;&gt;&gt; gf_int(2, 7)</span>
<span class="sd">    2</span>
<span class="sd">    &gt;&gt;&gt; gf_int(5, 7)</span>
<span class="sd">    -2</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">a</span> <span class="o">&lt;=</span> <span class="n">p</span> <span class="o">//</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">a</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">a</span> <span class="o">-</span> <span class="n">p</span>

</div>
<div class="viewcode-block" id="gf_degree"><a class="viewcode-back" href="../../../modules/polys/internals.html#sympy.polys.galoistools.gf_degree">[docs]</a><span class="k">def</span> <span class="nf">gf_degree</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the leading degree of ``f``.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.polys.galoistools import gf_degree</span>

<span class="sd">    &gt;&gt;&gt; gf_degree([1, 1, 2, 0])</span>
<span class="sd">    3</span>
<span class="sd">    &gt;&gt;&gt; gf_degree([])</span>
<span class="sd">    -1</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

</div>
<div class="viewcode-block" id="gf_LC"><a class="viewcode-back" href="../../../modules/polys/internals.html#sympy.polys.galoistools.gf_LC">[docs]</a><span class="k">def</span> <span class="nf">gf_LC</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">K</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the leading coefficient of ``f``.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.polys.domains import ZZ</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.galoistools import gf_LC</span>

<span class="sd">    &gt;&gt;&gt; gf_LC([3, 0, 1], ZZ)</span>
<span class="sd">    3</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">K</span><span class="o">.</span><span class="n">zero</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

</div>
<div class="viewcode-block" id="gf_TC"><a class="viewcode-back" href="../../../modules/polys/internals.html#sympy.polys.galoistools.gf_TC">[docs]</a><span class="k">def</span> <span class="nf">gf_TC</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">K</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the trailing coefficient of ``f``.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.polys.domains import ZZ</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.galoistools import gf_TC</span>

<span class="sd">    &gt;&gt;&gt; gf_TC([3, 0, 1], ZZ)</span>
<span class="sd">    1</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">K</span><span class="o">.</span><span class="n">zero</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">f</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

</div>
<div class="viewcode-block" id="gf_strip"><a class="viewcode-back" href="../../../modules/polys/internals.html#sympy.polys.galoistools.gf_strip">[docs]</a><span class="k">def</span> <span class="nf">gf_strip</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Remove leading zeros from ``f``.</span>


<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.polys.galoistools import gf_strip</span>

<span class="sd">    &gt;&gt;&gt; gf_strip([0, 0, 0, 3, 0, 1])</span>
<span class="sd">    [3, 0, 1]</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">f</span> <span class="ow">or</span> <span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
        <span class="k">return</span> <span class="n">f</span>

    <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">for</span> <span class="n">coeff</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">coeff</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">k</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="n">f</span><span class="p">[</span><span class="n">k</span><span class="p">:]</span>

</div>
<div class="viewcode-block" id="gf_trunc"><a class="viewcode-back" href="../../../modules/polys/internals.html#sympy.polys.galoistools.gf_trunc">[docs]</a><span class="k">def</span> <span class="nf">gf_trunc</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reduce all coefficients modulo ``p``.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.polys.galoistools import gf_trunc</span>

<span class="sd">    &gt;&gt;&gt; gf_trunc([7, -2, 3], 5)</span>
<span class="sd">    [2, 3, 3]</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">gf_strip</span><span class="p">([</span> <span class="n">a</span> <span class="o">%</span> <span class="n">p</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">f</span> <span class="p">])</span>

</div>
<div class="viewcode-block" id="gf_normal"><a class="viewcode-back" href="../../../modules/polys/internals.html#sympy.polys.galoistools.gf_normal">[docs]</a><span class="k">def</span> <span class="nf">gf_normal</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Normalize all coefficients in ``K``.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.polys.domains import ZZ</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.galoistools import gf_normal</span>

<span class="sd">    &gt;&gt;&gt; gf_normal([5, 10, 21, -3], 5, ZZ)</span>
<span class="sd">    [1, 2]</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">gf_trunc</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="n">f</span><span class="p">)),</span> <span class="n">p</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="gf_from_dict"><a class="viewcode-back" href="../../../modules/polys/internals.html#sympy.polys.galoistools.gf_from_dict">[docs]</a><span class="k">def</span> <span class="nf">gf_from_dict</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a ``GF(p)[x]`` polynomial from a dict.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.polys.domains import ZZ</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.galoistools import gf_from_dict</span>

<span class="sd">    &gt;&gt;&gt; gf_from_dict({10: ZZ(4), 4: ZZ(33), 0: ZZ(-1)}, 5, ZZ)</span>
<span class="sd">    [4, 0, 0, 0, 0, 0, 3, 0, 0, 0, 4]</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">SYMPY_INTS</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">h</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">K</span><span class="o">.</span><span class="n">zero</span><span class="p">)</span> <span class="o">%</span> <span class="n">p</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="p">(</span><span class="n">n</span><span class="p">,)</span> <span class="o">=</span> <span class="n">n</span>

        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">h</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">get</span><span class="p">((</span><span class="n">k</span><span class="p">,),</span> <span class="n">K</span><span class="o">.</span><span class="n">zero</span><span class="p">)</span> <span class="o">%</span> <span class="n">p</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">gf_trunc</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="gf_to_dict"><a class="viewcode-back" href="../../../modules/polys/internals.html#sympy.polys.galoistools.gf_to_dict">[docs]</a><span class="k">def</span> <span class="nf">gf_to_dict</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">symmetric</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert a ``GF(p)[x]`` polynomial to a dict.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.polys.galoistools import gf_to_dict</span>

<span class="sd">    &gt;&gt;&gt; gf_to_dict([4, 0, 0, 0, 0, 0, 3, 0, 0, 0, 4], 5)</span>
<span class="sd">    {0: -1, 4: -2, 10: -1}</span>
<span class="sd">    &gt;&gt;&gt; gf_to_dict([4, 0, 0, 0, 0, 0, 3, 0, 0, 0, 4], 5, symmetric=False)</span>
<span class="sd">    {0: 4, 4: 3, 10: 4}</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n</span><span class="p">,</span> <span class="n">result</span> <span class="o">=</span> <span class="n">gf_degree</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> <span class="p">{}</span>

    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">symmetric</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">gf_int</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="n">n</span> <span class="o">-</span> <span class="n">k</span><span class="p">],</span> <span class="n">p</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="n">n</span> <span class="o">-</span> <span class="n">k</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">a</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span>

    <span class="k">return</span> <span class="n">result</span>

</div>
<div class="viewcode-block" id="gf_from_int_poly"><a class="viewcode-back" href="../../../modules/polys/internals.html#sympy.polys.galoistools.gf_from_int_poly">[docs]</a><span class="k">def</span> <span class="nf">gf_from_int_poly</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a ``GF(p)[x]`` polynomial from ``Z[x]``.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.polys.domains import ZZ</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.galoistools import gf_from_int_poly</span>

<span class="sd">    &gt;&gt;&gt; gf_from_int_poly([7, -2, 3], 5)</span>
<span class="sd">    [2, 3, 3]</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">gf_trunc</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="gf_to_int_poly"><a class="viewcode-back" href="../../../modules/polys/internals.html#sympy.polys.galoistools.gf_to_int_poly">[docs]</a><span class="k">def</span> <span class="nf">gf_to_int_poly</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">symmetric</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert a ``GF(p)[x]`` polynomial to ``Z[x]``.</span>


<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.polys.galoistools import gf_to_int_poly</span>

<span class="sd">    &gt;&gt;&gt; gf_to_int_poly([2, 3, 3], 5)</span>
<span class="sd">    [2, -2, -2]</span>
<span class="sd">    &gt;&gt;&gt; gf_to_int_poly([2, 3, 3], 5, symmetric=False)</span>
<span class="sd">    [2, 3, 3]</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">symmetric</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span> <span class="n">gf_int</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">f</span> <span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">f</span>

</div>
<div class="viewcode-block" id="gf_neg"><a class="viewcode-back" href="../../../modules/polys/internals.html#sympy.polys.galoistools.gf_neg">[docs]</a><span class="k">def</span> <span class="nf">gf_neg</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Negate a polynomial in ``GF(p)[x]``.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.polys.domains import ZZ</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.galoistools import gf_neg</span>

<span class="sd">    &gt;&gt;&gt; gf_neg([3, 2, 1, 0], 5, ZZ)</span>
<span class="sd">    [2, 3, 4, 0]</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">[</span> <span class="o">-</span><span class="n">coeff</span> <span class="o">%</span> <span class="n">p</span> <span class="k">for</span> <span class="n">coeff</span> <span class="ow">in</span> <span class="n">f</span> <span class="p">]</span>

</div>
<div class="viewcode-block" id="gf_add_ground"><a class="viewcode-back" href="../../../modules/polys/internals.html#sympy.polys.galoistools.gf_add_ground">[docs]</a><span class="k">def</span> <span class="nf">gf_add_ground</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute ``f + a`` where ``f`` in ``GF(p)[x]`` and ``a`` in ``GF(p)``.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.polys.domains import ZZ</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.galoistools import gf_add_ground</span>

<span class="sd">    &gt;&gt;&gt; gf_add_ground([3, 2, 4], 2, 5, ZZ)</span>
<span class="sd">    [3, 2, 1]</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">a</span> <span class="o">%</span> <span class="n">p</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">a</span><span class="p">)</span> <span class="o">%</span> <span class="n">p</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">f</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">a</span><span class="p">]</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">a</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">a</span><span class="p">]</span>

</div>
<div class="viewcode-block" id="gf_sub_ground"><a class="viewcode-back" href="../../../modules/polys/internals.html#sympy.polys.galoistools.gf_sub_ground">[docs]</a><span class="k">def</span> <span class="nf">gf_sub_ground</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute ``f - a`` where ``f`` in ``GF(p)[x]`` and ``a`` in ``GF(p)``.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.polys.domains import ZZ</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.galoistools import gf_sub_ground</span>

<span class="sd">    &gt;&gt;&gt; gf_sub_ground([3, 2, 4], 2, 5, ZZ)</span>
<span class="sd">    [3, 2, 2]</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">a</span> <span class="o">=</span> <span class="o">-</span><span class="n">a</span> <span class="o">%</span> <span class="n">p</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">a</span><span class="p">)</span> <span class="o">%</span> <span class="n">p</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">f</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">a</span><span class="p">]</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">a</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">a</span><span class="p">]</span>

</div>
<div class="viewcode-block" id="gf_mul_ground"><a class="viewcode-back" href="../../../modules/polys/internals.html#sympy.polys.galoistools.gf_mul_ground">[docs]</a><span class="k">def</span> <span class="nf">gf_mul_ground</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute ``f * a`` where ``f`` in ``GF(p)[x]`` and ``a`` in ``GF(p)``.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.polys.domains import ZZ</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.galoistools import gf_mul_ground</span>

<span class="sd">    &gt;&gt;&gt; gf_mul_ground([3, 2, 4], 2, 5, ZZ)</span>
<span class="sd">    [1, 4, 3]</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">a</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span> <span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="n">b</span><span class="p">)</span> <span class="o">%</span> <span class="n">p</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">f</span> <span class="p">]</span>

</div>
<div class="viewcode-block" id="gf_quo_ground"><a class="viewcode-back" href="../../../modules/polys/internals.html#sympy.polys.galoistools.gf_quo_ground">[docs]</a><span class="k">def</span> <span class="nf">gf_quo_ground</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute ``f/a`` where ``f`` in ``GF(p)[x]`` and ``a`` in ``GF(p)``.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.polys.domains import ZZ</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.galoistools import gf_quo_ground</span>

<span class="sd">    &gt;&gt;&gt; gf_quo_ground(ZZ.map([3, 2, 4]), ZZ(2), 5, ZZ)</span>
<span class="sd">    [4, 1, 2]</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">gf_mul_ground</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">K</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">p</span><span class="p">),</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="gf_add"><a class="viewcode-back" href="../../../modules/polys/internals.html#sympy.polys.galoistools.gf_add">[docs]</a><span class="k">def</span> <span class="nf">gf_add</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add polynomials in ``GF(p)[x]``.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.polys.domains import ZZ</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.galoistools import gf_add</span>

<span class="sd">    &gt;&gt;&gt; gf_add([3, 2, 4], [2, 2, 2], 5, ZZ)</span>
<span class="sd">    [4, 1]</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">g</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">g</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">f</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">gf_degree</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="n">dg</span> <span class="o">=</span> <span class="n">gf_degree</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">df</span> <span class="o">==</span> <span class="n">dg</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">gf_strip</span><span class="p">([</span> <span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span> <span class="o">%</span> <span class="n">p</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">)</span> <span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">k</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">df</span> <span class="o">-</span> <span class="n">dg</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">df</span> <span class="o">&gt;</span> <span class="n">dg</span><span class="p">:</span>
            <span class="n">h</span><span class="p">,</span> <span class="n">f</span> <span class="o">=</span> <span class="n">f</span><span class="p">[:</span><span class="n">k</span><span class="p">],</span> <span class="n">f</span><span class="p">[</span><span class="n">k</span><span class="p">:]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">h</span><span class="p">,</span> <span class="n">g</span> <span class="o">=</span> <span class="n">g</span><span class="p">[:</span><span class="n">k</span><span class="p">],</span> <span class="n">g</span><span class="p">[</span><span class="n">k</span><span class="p">:]</span>

        <span class="k">return</span> <span class="n">h</span> <span class="o">+</span> <span class="p">[</span> <span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span> <span class="o">%</span> <span class="n">p</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">)</span> <span class="p">]</span>

</div>
<div class="viewcode-block" id="gf_sub"><a class="viewcode-back" href="../../../modules/polys/internals.html#sympy.polys.galoistools.gf_sub">[docs]</a><span class="k">def</span> <span class="nf">gf_sub</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Subtract polynomials in ``GF(p)[x]``.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.polys.domains import ZZ</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.galoistools import gf_sub</span>

<span class="sd">    &gt;&gt;&gt; gf_sub([3, 2, 4], [2, 2, 2], 5, ZZ)</span>
<span class="sd">    [1, 0, 2]</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">g</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">f</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">gf_neg</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">gf_degree</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="n">dg</span> <span class="o">=</span> <span class="n">gf_degree</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">df</span> <span class="o">==</span> <span class="n">dg</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">gf_strip</span><span class="p">([</span> <span class="p">(</span><span class="n">a</span> <span class="o">-</span> <span class="n">b</span><span class="p">)</span> <span class="o">%</span> <span class="n">p</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">)</span> <span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">k</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">df</span> <span class="o">-</span> <span class="n">dg</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">df</span> <span class="o">&gt;</span> <span class="n">dg</span><span class="p">:</span>
            <span class="n">h</span><span class="p">,</span> <span class="n">f</span> <span class="o">=</span> <span class="n">f</span><span class="p">[:</span><span class="n">k</span><span class="p">],</span> <span class="n">f</span><span class="p">[</span><span class="n">k</span><span class="p">:]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">h</span><span class="p">,</span> <span class="n">g</span> <span class="o">=</span> <span class="n">gf_neg</span><span class="p">(</span><span class="n">g</span><span class="p">[:</span><span class="n">k</span><span class="p">],</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">),</span> <span class="n">g</span><span class="p">[</span><span class="n">k</span><span class="p">:]</span>

        <span class="k">return</span> <span class="n">h</span> <span class="o">+</span> <span class="p">[</span> <span class="p">(</span><span class="n">a</span> <span class="o">-</span> <span class="n">b</span><span class="p">)</span> <span class="o">%</span> <span class="n">p</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">)</span> <span class="p">]</span>

</div>
<div class="viewcode-block" id="gf_mul"><a class="viewcode-back" href="../../../modules/polys/internals.html#sympy.polys.galoistools.gf_mul">[docs]</a><span class="k">def</span> <span class="nf">gf_mul</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Multiply polynomials in ``GF(p)[x]``.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.polys.domains import ZZ</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.galoistools import gf_mul</span>

<span class="sd">    &gt;&gt;&gt; gf_mul([3, 2, 4], [2, 2, 2], 5, ZZ)</span>
<span class="sd">    [1, 0, 3, 2, 3]</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">gf_degree</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="n">dg</span> <span class="o">=</span> <span class="n">gf_degree</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>

    <span class="n">dh</span> <span class="o">=</span> <span class="n">df</span> <span class="o">+</span> <span class="n">dg</span>
    <span class="n">h</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">dh</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">dh</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">coeff</span> <span class="o">=</span> <span class="n">K</span><span class="o">.</span><span class="n">zero</span>

        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span> <span class="o">-</span> <span class="n">dg</span><span class="p">),</span> <span class="nb">min</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">df</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">coeff</span> <span class="o">+=</span> <span class="n">f</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">g</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="n">j</span><span class="p">]</span>

        <span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">coeff</span> <span class="o">%</span> <span class="n">p</span>

    <span class="k">return</span> <span class="n">gf_strip</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="gf_sqr"><a class="viewcode-back" href="../../../modules/polys/internals.html#sympy.polys.galoistools.gf_sqr">[docs]</a><span class="k">def</span> <span class="nf">gf_sqr</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Square polynomials in ``GF(p)[x]``.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.polys.domains import ZZ</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.galoistools import gf_sqr</span>

<span class="sd">    &gt;&gt;&gt; gf_sqr([3, 2, 4], 5, ZZ)</span>
<span class="sd">    [4, 2, 3, 1, 1]</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">gf_degree</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

    <span class="n">dh</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">df</span>
    <span class="n">h</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">dh</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">dh</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">coeff</span> <span class="o">=</span> <span class="n">K</span><span class="o">.</span><span class="n">zero</span>

        <span class="n">jmin</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span> <span class="o">-</span> <span class="n">df</span><span class="p">)</span>
        <span class="n">jmax</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">df</span><span class="p">)</span>

        <span class="n">n</span> <span class="o">=</span> <span class="n">jmax</span> <span class="o">-</span> <span class="n">jmin</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="n">jmax</span> <span class="o">=</span> <span class="n">jmin</span> <span class="o">+</span> <span class="n">n</span> <span class="o">//</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span>

        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">jmin</span><span class="p">,</span> <span class="n">jmax</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">coeff</span> <span class="o">+=</span> <span class="n">f</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">f</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="n">j</span><span class="p">]</span>

        <span class="n">coeff</span> <span class="o">+=</span> <span class="n">coeff</span>

        <span class="k">if</span> <span class="n">n</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">elem</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="n">jmax</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">coeff</span> <span class="o">+=</span> <span class="n">elem</span><span class="o">**</span><span class="mi">2</span>

        <span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">coeff</span> <span class="o">%</span> <span class="n">p</span>

    <span class="k">return</span> <span class="n">gf_strip</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="gf_add_mul"><a class="viewcode-back" href="../../../modules/polys/internals.html#sympy.polys.galoistools.gf_add_mul">[docs]</a><span class="k">def</span> <span class="nf">gf_add_mul</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns ``f + g*h`` where ``f``, ``g``, ``h`` in ``GF(p)[x]``.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.polys.domains import ZZ</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.galoistools import gf_add_mul</span>
<span class="sd">    &gt;&gt;&gt; gf_add_mul([3, 2, 4], [2, 2, 2], [1, 4], 5, ZZ)</span>
<span class="sd">    [2, 3, 2, 2]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">gf_add</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">gf_mul</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">),</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="gf_sub_mul"><a class="viewcode-back" href="../../../modules/polys/internals.html#sympy.polys.galoistools.gf_sub_mul">[docs]</a><span class="k">def</span> <span class="nf">gf_sub_mul</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute ``f - g*h`` where ``f``, ``g``, ``h`` in ``GF(p)[x]``.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.polys.domains import ZZ</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.galoistools import gf_sub_mul</span>

<span class="sd">    &gt;&gt;&gt; gf_sub_mul([3, 2, 4], [2, 2, 2], [1, 4], 5, ZZ)</span>
<span class="sd">    [3, 3, 2, 1]</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">gf_sub</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">gf_mul</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">),</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="gf_expand"><a class="viewcode-back" href="../../../modules/polys/internals.html#sympy.polys.galoistools.gf_expand">[docs]</a><span class="k">def</span> <span class="nf">gf_expand</span><span class="p">(</span><span class="n">F</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Expand results of :func:`factor` in ``GF(p)[x]``.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.polys.domains import ZZ</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.galoistools import gf_expand</span>

<span class="sd">    &gt;&gt;&gt; gf_expand([([3, 2, 4], 1), ([2, 2], 2), ([3, 1], 3)], 5, ZZ)</span>
<span class="sd">    [4, 3, 0, 3, 0, 1, 4, 1]</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">F</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">tuple</span><span class="p">:</span>
        <span class="n">lc</span><span class="p">,</span> <span class="n">F</span> <span class="o">=</span> <span class="n">F</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">lc</span> <span class="o">=</span> <span class="n">K</span><span class="o">.</span><span class="n">one</span>

    <span class="n">g</span> <span class="o">=</span> <span class="p">[</span><span class="n">lc</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">f</span><span class="p">,</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">F</span><span class="p">:</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">gf_pow</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">gf_mul</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">g</span>

</div>
<div class="viewcode-block" id="gf_div"><a class="viewcode-back" href="../../../modules/polys/internals.html#sympy.polys.galoistools.gf_div">[docs]</a><span class="k">def</span> <span class="nf">gf_div</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Division with remainder in ``GF(p)[x]``.</span>

<span class="sd">    Given univariate polynomials ``f`` and ``g`` with coefficients in a</span>
<span class="sd">    finite field with ``p`` elements, returns polynomials ``q`` and ``r``</span>
<span class="sd">    (quotient and remainder) such that ``f = q*g + r``.</span>

<span class="sd">    Consider polynomials ``x**3 + x + 1`` and ``x**2 + x`` in GF(2)::</span>

<span class="sd">       &gt;&gt;&gt; from sympy.polys.domains import ZZ</span>
<span class="sd">       &gt;&gt;&gt; from sympy.polys.galoistools import gf_div, gf_add_mul</span>

<span class="sd">       &gt;&gt;&gt; gf_div(ZZ.map([1, 0, 1, 1]), ZZ.map([1, 1, 0]), 2, ZZ)</span>
<span class="sd">       ([1, 1], [1])</span>

<span class="sd">    As result we obtained quotient ``x + 1`` and remainder ``1``, thus::</span>

<span class="sd">       &gt;&gt;&gt; gf_add_mul(ZZ.map([1]), ZZ.map([1, 1]), ZZ.map([1, 1, 0]), 2, ZZ)</span>
<span class="sd">       [1, 0, 1, 1]</span>

<span class="sd">    References</span>
<span class="sd">    ==========</span>

<span class="sd">    1. [Monagan93]_</span>
<span class="sd">    2. [Gathen99]_</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">gf_degree</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="n">dg</span> <span class="o">=</span> <span class="n">gf_degree</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">g</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ZeroDivisionError</span><span class="p">(</span><span class="s">&quot;polynomial division&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">df</span> <span class="o">&lt;</span> <span class="n">dg</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[],</span> <span class="n">f</span>

    <span class="n">inv</span> <span class="o">=</span> <span class="n">K</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="n">g</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p</span><span class="p">)</span>

    <span class="n">h</span><span class="p">,</span> <span class="n">dq</span><span class="p">,</span> <span class="n">dr</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> <span class="n">df</span> <span class="o">-</span> <span class="n">dg</span><span class="p">,</span> <span class="n">dg</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">df</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">coeff</span> <span class="o">=</span> <span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">dg</span> <span class="o">-</span> <span class="n">i</span><span class="p">),</span> <span class="nb">min</span><span class="p">(</span><span class="n">df</span> <span class="o">-</span> <span class="n">i</span><span class="p">,</span> <span class="n">dr</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">coeff</span> <span class="o">-=</span> <span class="n">h</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">j</span> <span class="o">-</span> <span class="n">dg</span><span class="p">]</span> <span class="o">*</span> <span class="n">g</span><span class="p">[</span><span class="n">dg</span> <span class="o">-</span> <span class="n">j</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">dq</span><span class="p">:</span>
            <span class="n">coeff</span> <span class="o">*=</span> <span class="n">inv</span>

        <span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">coeff</span> <span class="o">%</span> <span class="n">p</span>

    <span class="k">return</span> <span class="n">h</span><span class="p">[:</span><span class="n">dq</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="n">gf_strip</span><span class="p">(</span><span class="n">h</span><span class="p">[</span><span class="n">dq</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:])</span>

</div>
<div class="viewcode-block" id="gf_rem"><a class="viewcode-back" href="../../../modules/polys/internals.html#sympy.polys.galoistools.gf_rem">[docs]</a><span class="k">def</span> <span class="nf">gf_rem</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute polynomial remainder in ``GF(p)[x]``.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.polys.domains import ZZ</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.galoistools import gf_rem</span>

<span class="sd">    &gt;&gt;&gt; gf_rem(ZZ.map([1, 0, 1, 1]), ZZ.map([1, 1, 0]), 2, ZZ)</span>
<span class="sd">    [1]</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">gf_div</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

</div>
<div class="viewcode-block" id="gf_quo"><a class="viewcode-back" href="../../../modules/polys/internals.html#sympy.polys.galoistools.gf_quo">[docs]</a><span class="k">def</span> <span class="nf">gf_quo</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute exact quotient in ``GF(p)[x]``.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.polys.domains import ZZ</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.galoistools import gf_quo</span>

<span class="sd">    &gt;&gt;&gt; gf_quo(ZZ.map([1, 0, 1, 1]), ZZ.map([1, 1, 0]), 2, ZZ)</span>
<span class="sd">    [1, 1]</span>
<span class="sd">    &gt;&gt;&gt; gf_quo(ZZ.map([1, 0, 3, 2, 3]), ZZ.map([2, 2, 2]), 5, ZZ)</span>
<span class="sd">    [3, 2, 4]</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">gf_degree</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="n">dg</span> <span class="o">=</span> <span class="n">gf_degree</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">g</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ZeroDivisionError</span><span class="p">(</span><span class="s">&quot;polynomial division&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">df</span> <span class="o">&lt;</span> <span class="n">dg</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="n">inv</span> <span class="o">=</span> <span class="n">K</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="n">g</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p</span><span class="p">)</span>

    <span class="n">h</span><span class="p">,</span> <span class="n">dq</span><span class="p">,</span> <span class="n">dr</span> <span class="o">=</span> <span class="n">f</span><span class="p">[:],</span> <span class="n">df</span> <span class="o">-</span> <span class="n">dg</span><span class="p">,</span> <span class="n">dg</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">dq</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">coeff</span> <span class="o">=</span> <span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">dg</span> <span class="o">-</span> <span class="n">i</span><span class="p">),</span> <span class="nb">min</span><span class="p">(</span><span class="n">df</span> <span class="o">-</span> <span class="n">i</span><span class="p">,</span> <span class="n">dr</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">coeff</span> <span class="o">-=</span> <span class="n">h</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">j</span> <span class="o">-</span> <span class="n">dg</span><span class="p">]</span> <span class="o">*</span> <span class="n">g</span><span class="p">[</span><span class="n">dg</span> <span class="o">-</span> <span class="n">j</span><span class="p">]</span>

        <span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">coeff</span> <span class="o">*</span> <span class="n">inv</span><span class="p">)</span> <span class="o">%</span> <span class="n">p</span>

    <span class="k">return</span> <span class="n">h</span><span class="p">[:</span><span class="n">dq</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>

</div>
<div class="viewcode-block" id="gf_exquo"><a class="viewcode-back" href="../../../modules/polys/internals.html#sympy.polys.galoistools.gf_exquo">[docs]</a><span class="k">def</span> <span class="nf">gf_exquo</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute polynomial quotient in ``GF(p)[x]``.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.polys.domains import ZZ</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.galoistools import gf_exquo</span>

<span class="sd">    &gt;&gt;&gt; gf_exquo(ZZ.map([1, 0, 3, 2, 3]), ZZ.map([2, 2, 2]), 5, ZZ)</span>
<span class="sd">    [3, 2, 4]</span>

<span class="sd">    &gt;&gt;&gt; gf_exquo(ZZ.map([1, 0, 1, 1]), ZZ.map([1, 1, 0]), 2, ZZ)</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    ExactQuotientFailed: [1, 1, 0] does not divide [1, 0, 1, 1]</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">q</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="n">gf_div</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">r</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">q</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ExactQuotientFailed</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="gf_lshift"><a class="viewcode-back" href="../../../modules/polys/internals.html#sympy.polys.galoistools.gf_lshift">[docs]</a><span class="k">def</span> <span class="nf">gf_lshift</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">K</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Efficiently multiply ``f`` by ``x**n``.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.polys.domains import ZZ</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.galoistools import gf_lshift</span>

<span class="sd">    &gt;&gt;&gt; gf_lshift([3, 2, 4], 4, ZZ)</span>
<span class="sd">    [3, 2, 4, 0, 0, 0, 0]</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">f</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">f</span> <span class="o">+</span> <span class="p">[</span><span class="n">K</span><span class="o">.</span><span class="n">zero</span><span class="p">]</span><span class="o">*</span><span class="n">n</span>

</div>
<div class="viewcode-block" id="gf_rshift"><a class="viewcode-back" href="../../../modules/polys/internals.html#sympy.polys.galoistools.gf_rshift">[docs]</a><span class="k">def</span> <span class="nf">gf_rshift</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">K</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Efficiently divide ``f`` by ``x**n``.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.polys.domains import ZZ</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.galoistools import gf_rshift</span>

<span class="sd">    &gt;&gt;&gt; gf_rshift([1, 2, 3, 4, 0], 3, ZZ)</span>
<span class="sd">    ([1, 2], [3, 4, 0])</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">n</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">f</span><span class="p">,</span> <span class="p">[]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">f</span><span class="p">[:</span><span class="o">-</span><span class="n">n</span><span class="p">],</span> <span class="n">f</span><span class="p">[</span><span class="o">-</span><span class="n">n</span><span class="p">:]</span>

</div>
<div class="viewcode-block" id="gf_pow"><a class="viewcode-back" href="../../../modules/polys/internals.html#sympy.polys.galoistools.gf_pow">[docs]</a><span class="k">def</span> <span class="nf">gf_pow</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute ``f**n`` in ``GF(p)[x]`` using repeated squaring.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.polys.domains import ZZ</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.galoistools import gf_pow</span>

<span class="sd">    &gt;&gt;&gt; gf_pow([3, 2, 4], 3, 5, ZZ)</span>
<span class="sd">    [2, 4, 4, 2, 2, 1, 4]</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">n</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">K</span><span class="o">.</span><span class="n">one</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">f</span>
    <span class="k">elif</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">gf_sqr</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>

    <span class="n">h</span> <span class="o">=</span> <span class="p">[</span><span class="n">K</span><span class="o">.</span><span class="n">one</span><span class="p">]</span>

    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">h</span> <span class="o">=</span> <span class="n">gf_mul</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>
            <span class="n">n</span> <span class="o">-=</span> <span class="mi">1</span>

        <span class="n">n</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">n</span><span class="p">:</span>
            <span class="k">break</span>

        <span class="n">f</span> <span class="o">=</span> <span class="n">gf_sqr</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">h</span>
</div>
<span class="k">def</span> <span class="nf">gf_frobenius_monomial_base</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    return the list of ``x**(i*p) mod g in Z_p`` for ``i = 0, .., n - 1``</span>
<span class="sd">    where ``n = gf_degree(g)``</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.polys.domains import ZZ</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.galoistools import gf_frobenius_monomial_base</span>
<span class="sd">    &gt;&gt;&gt; g = ZZ.map([1, 0, 2, 1])</span>
<span class="sd">    &gt;&gt;&gt; gf_frobenius_monomial_base(g, 5, ZZ)</span>
<span class="sd">    [[1], [4, 4, 2], [1, 2]]</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">gf_degree</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[]</span>
    <span class="n">b</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">n</span>
    <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">p</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
            <span class="n">mon</span> <span class="o">=</span> <span class="n">gf_lshift</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>
            <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">gf_rem</span><span class="p">(</span><span class="n">mon</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">gf_pow_mod</span><span class="p">([</span><span class="n">K</span><span class="o">.</span><span class="n">one</span><span class="p">,</span> <span class="n">K</span><span class="o">.</span><span class="n">zero</span><span class="p">],</span> <span class="n">p</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
            <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">gf_mul</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>
            <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">gf_rem</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">g</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">b</span>

<span class="k">def</span> <span class="nf">gf_frobenius_map</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    compute gf_pow_mod(f, p, g, p, K) using the Frobenius map</span>

<span class="sd">    Parameters</span>
<span class="sd">    ==========</span>

<span class="sd">    f, g : polynomials in ``GF(p)[x]``</span>
<span class="sd">    b : frobenius monomial base</span>
<span class="sd">    p : prime number</span>
<span class="sd">    K : domain</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.polys.domains import ZZ</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.galoistools import gf_frobenius_monomial_base, gf_frobenius_map</span>
<span class="sd">    &gt;&gt;&gt; f = ZZ.map([2, 1 , 0, 1])</span>
<span class="sd">    &gt;&gt;&gt; g = ZZ.map([1, 0, 2, 1])</span>
<span class="sd">    &gt;&gt;&gt; p = 5</span>
<span class="sd">    &gt;&gt;&gt; b = gf_frobenius_monomial_base(g, p, ZZ)</span>
<span class="sd">    &gt;&gt;&gt; r = gf_frobenius_map(f, g, b, p, ZZ)</span>
<span class="sd">    &gt;&gt;&gt; gf_frobenius_map(f, g, b, p, ZZ)</span>
<span class="sd">    [4, 0, 3]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">gf_degree</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">gf_degree</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">m</span><span class="p">:</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">gf_rem</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[]</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">gf_degree</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="n">sf</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">gf_mul_ground</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">f</span><span class="p">[</span><span class="n">n</span> <span class="o">-</span> <span class="n">i</span><span class="p">],</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>
        <span class="n">sf</span> <span class="o">=</span> <span class="n">gf_add</span><span class="p">(</span><span class="n">sf</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">sf</span>

<span class="k">def</span> <span class="nf">_gf_pow_pnm1d2</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    utility function for ``gf_edf_zassenhaus``</span>
<span class="sd">    Compute ``f**((p**n - 1) // 2)`` in ``GF(p)[x]/(g)``</span>
<span class="sd">    ``f**((p**n - 1) // 2) = (f*f**p*...*f**(p**n - 1))**((p - 1) // 2)``</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">gf_rem</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>
    <span class="n">h</span> <span class="o">=</span> <span class="n">f</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">f</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">gf_frobenius_map</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">gf_mul</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">gf_rem</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>

    <span class="n">res</span> <span class="o">=</span> <span class="n">gf_pow_mod</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">res</span>

<div class="viewcode-block" id="gf_pow_mod"><a class="viewcode-back" href="../../../modules/polys/internals.html#sympy.polys.galoistools.gf_pow_mod">[docs]</a><span class="k">def</span> <span class="nf">gf_pow_mod</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute ``f**n`` in ``GF(p)[x]/(g)`` using repeated squaring.</span>

<span class="sd">    Given polynomials ``f`` and ``g`` in ``GF(p)[x]`` and a non-negative</span>
<span class="sd">    integer ``n``, efficiently computes ``f**n (mod g)`` i.e. the remainder</span>
<span class="sd">    of ``f**n`` from division by ``g``, using the repeated squaring algorithm.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.polys.domains import ZZ</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.galoistools import gf_pow_mod</span>

<span class="sd">    &gt;&gt;&gt; gf_pow_mod(ZZ.map([3, 2, 4]), 3, ZZ.map([1, 1]), 5, ZZ)</span>
<span class="sd">    []</span>

<span class="sd">    References</span>
<span class="sd">    ==========</span>

<span class="sd">    1. [Gathen99]_</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">n</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">K</span><span class="o">.</span><span class="n">one</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">gf_rem</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">gf_rem</span><span class="p">(</span><span class="n">gf_sqr</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">),</span> <span class="n">g</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>

    <span class="n">h</span> <span class="o">=</span> <span class="p">[</span><span class="n">K</span><span class="o">.</span><span class="n">one</span><span class="p">]</span>

    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">h</span> <span class="o">=</span> <span class="n">gf_mul</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>
            <span class="n">h</span> <span class="o">=</span> <span class="n">gf_rem</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>
            <span class="n">n</span> <span class="o">-=</span> <span class="mi">1</span>

        <span class="n">n</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">n</span><span class="p">:</span>
            <span class="k">break</span>

        <span class="n">f</span> <span class="o">=</span> <span class="n">gf_sqr</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">gf_rem</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">h</span>

</div>
<div class="viewcode-block" id="gf_gcd"><a class="viewcode-back" href="../../../modules/polys/internals.html#sympy.polys.galoistools.gf_gcd">[docs]</a><span class="k">def</span> <span class="nf">gf_gcd</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Euclidean Algorithm in ``GF(p)[x]``.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.polys.domains import ZZ</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.galoistools import gf_gcd</span>

<span class="sd">    &gt;&gt;&gt; gf_gcd(ZZ.map([3, 2, 4]), ZZ.map([2, 2, 3]), 5, ZZ)</span>
<span class="sd">    [1, 3]</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">while</span> <span class="n">g</span><span class="p">:</span>
        <span class="n">f</span><span class="p">,</span> <span class="n">g</span> <span class="o">=</span> <span class="n">g</span><span class="p">,</span> <span class="n">gf_rem</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">gf_monic</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

</div>
<div class="viewcode-block" id="gf_lcm"><a class="viewcode-back" href="../../../modules/polys/internals.html#sympy.polys.galoistools.gf_lcm">[docs]</a><span class="k">def</span> <span class="nf">gf_lcm</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute polynomial LCM in ``GF(p)[x]``.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.polys.domains import ZZ</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.galoistools import gf_lcm</span>

<span class="sd">    &gt;&gt;&gt; gf_lcm(ZZ.map([3, 2, 4]), ZZ.map([2, 2, 3]), 5, ZZ)</span>
<span class="sd">    [1, 2, 0, 4]</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">f</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">g</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="n">h</span> <span class="o">=</span> <span class="n">gf_quo</span><span class="p">(</span><span class="n">gf_mul</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">),</span>
               <span class="n">gf_gcd</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">),</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">gf_monic</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

</div>
<div class="viewcode-block" id="gf_cofactors"><a class="viewcode-back" href="../../../modules/polys/internals.html#sympy.polys.galoistools.gf_cofactors">[docs]</a><span class="k">def</span> <span class="nf">gf_cofactors</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute polynomial GCD and cofactors in ``GF(p)[x]``.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.polys.domains import ZZ</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.galoistools import gf_cofactors</span>

<span class="sd">    &gt;&gt;&gt; gf_cofactors(ZZ.map([3, 2, 4]), ZZ.map([2, 2, 3]), 5, ZZ)</span>
<span class="sd">    ([1, 3], [3, 3], [2, 1])</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">f</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">g</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">([],</span> <span class="p">[],</span> <span class="p">[])</span>

    <span class="n">h</span> <span class="o">=</span> <span class="n">gf_gcd</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">gf_quo</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">),</span>
            <span class="n">gf_quo</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="gf_gcdex"><a class="viewcode-back" href="../../../modules/polys/internals.html#sympy.polys.galoistools.gf_gcdex">[docs]</a><span class="k">def</span> <span class="nf">gf_gcdex</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extended Euclidean Algorithm in ``GF(p)[x]``.</span>

<span class="sd">    Given polynomials ``f`` and ``g`` in ``GF(p)[x]``, computes polynomials</span>
<span class="sd">    ``s``, ``t`` and ``h``, such that ``h = gcd(f, g)`` and ``s*f + t*g = h``.</span>
<span class="sd">    The typical application of EEA is solving polynomial diophantine equations.</span>

<span class="sd">    Consider polynomials ``f = (x + 7) (x + 1)``, ``g = (x + 7) (x**2 + 1)``</span>
<span class="sd">    in ``GF(11)[x]``. Application of Extended Euclidean Algorithm gives::</span>

<span class="sd">       &gt;&gt;&gt; from sympy.polys.domains import ZZ</span>
<span class="sd">       &gt;&gt;&gt; from sympy.polys.galoistools import gf_gcdex, gf_mul, gf_add</span>

<span class="sd">       &gt;&gt;&gt; s, t, g = gf_gcdex(ZZ.map([1, 8, 7]), ZZ.map([1, 7, 1, 7]), 11, ZZ)</span>
<span class="sd">       &gt;&gt;&gt; s, t, g</span>
<span class="sd">       ([5, 6], [6], [1, 7])</span>

<span class="sd">    As result we obtained polynomials ``s = 5*x + 6`` and ``t = 6``, and</span>
<span class="sd">    additionally ``gcd(f, g) = x + 7``. This is correct because::</span>

<span class="sd">       &gt;&gt;&gt; S = gf_mul(s, ZZ.map([1, 8, 7]), 11, ZZ)</span>
<span class="sd">       &gt;&gt;&gt; T = gf_mul(t, ZZ.map([1, 7, 1, 7]), 11, ZZ)</span>

<span class="sd">       &gt;&gt;&gt; gf_add(S, T, 11, ZZ) == [1, 7]</span>
<span class="sd">       True</span>

<span class="sd">    References</span>
<span class="sd">    ==========</span>

<span class="sd">    1. [Gathen99]_</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">f</span> <span class="ow">or</span> <span class="n">g</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">K</span><span class="o">.</span><span class="n">one</span><span class="p">],</span> <span class="p">[],</span> <span class="p">[]</span>

    <span class="n">p0</span><span class="p">,</span> <span class="n">r0</span> <span class="o">=</span> <span class="n">gf_monic</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>
    <span class="n">p1</span><span class="p">,</span> <span class="n">r1</span> <span class="o">=</span> <span class="n">gf_monic</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[],</span> <span class="p">[</span><span class="n">K</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p</span><span class="p">)],</span> <span class="n">r1</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">g</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">K</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="n">p0</span><span class="p">,</span> <span class="n">p</span><span class="p">)],</span> <span class="p">[],</span> <span class="n">r0</span>

    <span class="n">s0</span><span class="p">,</span> <span class="n">s1</span> <span class="o">=</span> <span class="p">[</span><span class="n">K</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="n">p0</span><span class="p">,</span> <span class="n">p</span><span class="p">)],</span> <span class="p">[]</span>
    <span class="n">t0</span><span class="p">,</span> <span class="n">t1</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[</span><span class="n">K</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p</span><span class="p">)]</span>

    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">Q</span><span class="p">,</span> <span class="n">R</span> <span class="o">=</span> <span class="n">gf_div</span><span class="p">(</span><span class="n">r0</span><span class="p">,</span> <span class="n">r1</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">R</span><span class="p">:</span>
            <span class="k">break</span>

        <span class="p">(</span><span class="n">lc</span><span class="p">,</span> <span class="n">r1</span><span class="p">),</span> <span class="n">r0</span> <span class="o">=</span> <span class="n">gf_monic</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">),</span> <span class="n">r1</span>

        <span class="n">inv</span> <span class="o">=</span> <span class="n">K</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="n">lc</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>

        <span class="n">s</span> <span class="o">=</span> <span class="n">gf_sub_mul</span><span class="p">(</span><span class="n">s0</span><span class="p">,</span> <span class="n">s1</span><span class="p">,</span> <span class="n">Q</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">gf_sub_mul</span><span class="p">(</span><span class="n">t0</span><span class="p">,</span> <span class="n">t1</span><span class="p">,</span> <span class="n">Q</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>

        <span class="n">s1</span><span class="p">,</span> <span class="n">s0</span> <span class="o">=</span> <span class="n">gf_mul_ground</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">inv</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">),</span> <span class="n">s1</span>
        <span class="n">t1</span><span class="p">,</span> <span class="n">t0</span> <span class="o">=</span> <span class="n">gf_mul_ground</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">inv</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">),</span> <span class="n">t1</span>

    <span class="k">return</span> <span class="n">s1</span><span class="p">,</span> <span class="n">t1</span><span class="p">,</span> <span class="n">r1</span>

</div>
<div class="viewcode-block" id="gf_monic"><a class="viewcode-back" href="../../../modules/polys/internals.html#sympy.polys.galoistools.gf_monic">[docs]</a><span class="k">def</span> <span class="nf">gf_monic</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute LC and a monic polynomial in ``GF(p)[x]``.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.polys.domains import ZZ</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.galoistools import gf_monic</span>

<span class="sd">    &gt;&gt;&gt; gf_monic(ZZ.map([3, 2, 4]), 5, ZZ)</span>
<span class="sd">    (3, [1, 4, 3])</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">K</span><span class="o">.</span><span class="n">zero</span><span class="p">,</span> <span class="p">[]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">lc</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">K</span><span class="o">.</span><span class="n">is_one</span><span class="p">(</span><span class="n">lc</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">lc</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">lc</span><span class="p">,</span> <span class="n">gf_quo_ground</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">lc</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="gf_diff"><a class="viewcode-back" href="../../../modules/polys/internals.html#sympy.polys.galoistools.gf_diff">[docs]</a><span class="k">def</span> <span class="nf">gf_diff</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Differentiate polynomial in ``GF(p)[x]``.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.polys.domains import ZZ</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.galoistools import gf_diff</span>

<span class="sd">    &gt;&gt;&gt; gf_diff([3, 2, 4], 5, ZZ)</span>
<span class="sd">    [1, 2]</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">gf_degree</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

    <span class="n">h</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="p">[</span><span class="n">K</span><span class="o">.</span><span class="n">zero</span><span class="p">]</span><span class="o">*</span><span class="n">df</span><span class="p">,</span> <span class="n">df</span>

    <span class="k">for</span> <span class="n">coeff</span> <span class="ow">in</span> <span class="n">f</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
        <span class="n">coeff</span> <span class="o">*=</span> <span class="n">K</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="n">coeff</span> <span class="o">%=</span> <span class="n">p</span>

        <span class="k">if</span> <span class="n">coeff</span><span class="p">:</span>
            <span class="n">h</span><span class="p">[</span><span class="n">df</span> <span class="o">-</span> <span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">coeff</span>

        <span class="n">n</span> <span class="o">-=</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="n">gf_strip</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="gf_eval"><a class="viewcode-back" href="../../../modules/polys/internals.html#sympy.polys.galoistools.gf_eval">[docs]</a><span class="k">def</span> <span class="nf">gf_eval</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Evaluate ``f(a)`` in ``GF(p)`` using Horner scheme.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.polys.domains import ZZ</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.galoistools import gf_eval</span>

<span class="sd">    &gt;&gt;&gt; gf_eval([3, 2, 4], 2, 5, ZZ)</span>
<span class="sd">    0</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">K</span><span class="o">.</span><span class="n">zero</span>

    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">*=</span> <span class="n">a</span>
        <span class="n">result</span> <span class="o">+=</span> <span class="n">c</span>
        <span class="n">result</span> <span class="o">%=</span> <span class="n">p</span>

    <span class="k">return</span> <span class="n">result</span>

</div>
<div class="viewcode-block" id="gf_multi_eval"><a class="viewcode-back" href="../../../modules/polys/internals.html#sympy.polys.galoistools.gf_multi_eval">[docs]</a><span class="k">def</span> <span class="nf">gf_multi_eval</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Evaluate ``f(a)`` for ``a`` in ``[a_1, ..., a_n]``.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.polys.domains import ZZ</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.galoistools import gf_multi_eval</span>

<span class="sd">    &gt;&gt;&gt; gf_multi_eval([3, 2, 4], [0, 1, 2, 3, 4], 5, ZZ)</span>
<span class="sd">    [4, 4, 0, 2, 0]</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">[</span> <span class="n">gf_eval</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">A</span> <span class="p">]</span>

</div>
<div class="viewcode-block" id="gf_compose"><a class="viewcode-back" href="../../../modules/polys/internals.html#sympy.polys.galoistools.gf_compose">[docs]</a><span class="k">def</span> <span class="nf">gf_compose</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute polynomial composition ``f(g)`` in ``GF(p)[x]``.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.polys.domains import ZZ</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.galoistools import gf_compose</span>

<span class="sd">    &gt;&gt;&gt; gf_compose([3, 2, 4], [2, 2, 2], 5, ZZ)</span>
<span class="sd">    [2, 4, 0, 3, 0]</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">g</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">gf_strip</span><span class="p">([</span><span class="n">gf_eval</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">gf_LC</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">K</span><span class="p">),</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)])</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="n">h</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>

    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">gf_mul</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">gf_add_ground</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">h</span>

</div>
<div class="viewcode-block" id="gf_compose_mod"><a class="viewcode-back" href="../../../modules/polys/internals.html#sympy.polys.galoistools.gf_compose_mod">[docs]</a><span class="k">def</span> <span class="nf">gf_compose_mod</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute polynomial composition ``g(h)`` in ``GF(p)[x]/(f)``.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.polys.domains import ZZ</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.galoistools import gf_compose_mod</span>

<span class="sd">    &gt;&gt;&gt; gf_compose_mod(ZZ.map([3, 2, 4]), ZZ.map([2, 2, 2]), ZZ.map([4, 3]), 5, ZZ)</span>
<span class="sd">    [4]</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">g</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="n">comp</span> <span class="o">=</span> <span class="p">[</span><span class="n">g</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>

    <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">g</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
        <span class="n">comp</span> <span class="o">=</span> <span class="n">gf_mul</span><span class="p">(</span><span class="n">comp</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>
        <span class="n">comp</span> <span class="o">=</span> <span class="n">gf_add_ground</span><span class="p">(</span><span class="n">comp</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>
        <span class="n">comp</span> <span class="o">=</span> <span class="n">gf_rem</span><span class="p">(</span><span class="n">comp</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">comp</span>

</div>
<div class="viewcode-block" id="gf_trace_map"><a class="viewcode-back" href="../../../modules/polys/internals.html#sympy.polys.galoistools.gf_trace_map">[docs]</a><span class="k">def</span> <span class="nf">gf_trace_map</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute polynomial trace map in ``GF(p)[x]/(f)``.</span>

<span class="sd">    Given a polynomial ``f`` in ``GF(p)[x]``, polynomials ``a``, ``b``,</span>
<span class="sd">    ``c`` in the quotient ring ``GF(p)[x]/(f)`` such that ``b = c**t</span>
<span class="sd">    (mod f)`` for some positive power ``t`` of ``p``, and a positive</span>
<span class="sd">    integer ``n``, returns a mapping::</span>

<span class="sd">       a -&gt; a**t**n, a + a**t + a**t**2 + ... + a**t**n (mod f)</span>

<span class="sd">    In factorization context, ``b = x**p mod f`` and ``c = x mod f``.</span>
<span class="sd">    This way we can efficiently compute trace polynomials in equal</span>
<span class="sd">    degree factorization routine, much faster than with other methods,</span>
<span class="sd">    like iterated Frobenius algorithm, for large degrees.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.polys.domains import ZZ</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.galoistools import gf_trace_map</span>

<span class="sd">    &gt;&gt;&gt; gf_trace_map([1, 2], [4, 4], [1, 1], 4, [3, 2, 4], 5, ZZ)</span>
<span class="sd">    ([1, 3], [1, 3])</span>

<span class="sd">    References</span>
<span class="sd">    ==========</span>

<span class="sd">    1. [Gathen92]_</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">gf_compose_mod</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">b</span>

    <span class="k">if</span> <span class="n">n</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">U</span> <span class="o">=</span> <span class="n">gf_add</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>
        <span class="n">V</span> <span class="o">=</span> <span class="n">b</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">U</span> <span class="o">=</span> <span class="n">a</span>
        <span class="n">V</span> <span class="o">=</span> <span class="n">c</span>

    <span class="n">n</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span>

    <span class="k">while</span> <span class="n">n</span><span class="p">:</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">gf_add</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">gf_compose_mod</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">),</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">gf_compose_mod</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">n</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">U</span> <span class="o">=</span> <span class="n">gf_add</span><span class="p">(</span><span class="n">U</span><span class="p">,</span> <span class="n">gf_compose_mod</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">),</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>
            <span class="n">V</span> <span class="o">=</span> <span class="n">gf_compose_mod</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>

        <span class="n">n</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="n">gf_compose_mod</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">),</span> <span class="n">U</span>
</div>
<span class="k">def</span> <span class="nf">_gf_trace_map</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    utility for ``gf_edf_shoup``</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">gf_rem</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>
    <span class="n">h</span> <span class="o">=</span> <span class="n">f</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">f</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">gf_frobenius_map</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">gf_add</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">gf_rem</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">r</span>


<div class="viewcode-block" id="gf_random"><a class="viewcode-back" href="../../../modules/polys/internals.html#sympy.polys.galoistools.gf_random">[docs]</a><span class="k">def</span> <span class="nf">gf_random</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate a random polynomial in ``GF(p)[x]`` of degree ``n``.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.polys.domains import ZZ</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.galoistools import gf_random</span>
<span class="sd">    &gt;&gt;&gt; gf_random(10, 5, ZZ) #doctest: +SKIP</span>
<span class="sd">    [1, 2, 3, 2, 1, 1, 1, 2, 0, 4, 2]</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">K</span><span class="o">.</span><span class="n">one</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span> <span class="n">K</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">p</span><span class="p">)))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="p">]</span>

</div>
<div class="viewcode-block" id="gf_irreducible"><a class="viewcode-back" href="../../../modules/polys/internals.html#sympy.polys.galoistools.gf_irreducible">[docs]</a><span class="k">def</span> <span class="nf">gf_irreducible</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate random irreducible polynomial of degree ``n`` in ``GF(p)[x]``.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.polys.domains import ZZ</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.galoistools import gf_irreducible</span>
<span class="sd">    &gt;&gt;&gt; gf_irreducible(10, 5, ZZ) #doctest: +SKIP</span>
<span class="sd">    [1, 4, 2, 2, 3, 2, 4, 1, 4, 0, 4]</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">gf_random</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">gf_irreducible_p</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">f</span>

</div>
<span class="k">def</span> <span class="nf">gf_irred_p_ben_or</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Ben-Or&#39;s polynomial irreducibility test over finite fields.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.polys.domains import ZZ</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.galoistools import gf_irred_p_ben_or</span>

<span class="sd">    &gt;&gt;&gt; gf_irred_p_ben_or(ZZ.map([1, 4, 2, 2, 3, 2, 4, 1, 4, 0, 4]), 5, ZZ)</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; gf_irred_p_ben_or(ZZ.map([3, 2, 4]), 5, ZZ)</span>
<span class="sd">    False</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">gf_degree</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">True</span>

    <span class="n">_</span><span class="p">,</span> <span class="n">f</span> <span class="o">=</span> <span class="n">gf_monic</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">:</span>
        <span class="n">H</span> <span class="o">=</span> <span class="n">h</span> <span class="o">=</span> <span class="n">gf_pow_mod</span><span class="p">([</span><span class="n">K</span><span class="o">.</span><span class="n">one</span><span class="p">,</span> <span class="n">K</span><span class="o">.</span><span class="n">zero</span><span class="p">],</span> <span class="n">p</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="o">//</span><span class="mi">2</span><span class="p">):</span>
            <span class="n">g</span> <span class="o">=</span> <span class="n">gf_sub</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="p">[</span><span class="n">K</span><span class="o">.</span><span class="n">one</span><span class="p">,</span> <span class="n">K</span><span class="o">.</span><span class="n">zero</span><span class="p">],</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">gf_gcd</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span> <span class="o">==</span> <span class="p">[</span><span class="n">K</span><span class="o">.</span><span class="n">one</span><span class="p">]:</span>
                <span class="n">h</span> <span class="o">=</span> <span class="n">gf_compose_mod</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">gf_frobenius_monomial_base</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>
        <span class="n">H</span> <span class="o">=</span> <span class="n">h</span> <span class="o">=</span> <span class="n">gf_frobenius_map</span><span class="p">([</span><span class="n">K</span><span class="o">.</span><span class="n">one</span><span class="p">,</span> <span class="n">K</span><span class="o">.</span><span class="n">zero</span><span class="p">],</span> <span class="n">f</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="o">//</span><span class="mi">2</span><span class="p">):</span>
            <span class="n">g</span> <span class="o">=</span> <span class="n">gf_sub</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="p">[</span><span class="n">K</span><span class="o">.</span><span class="n">one</span><span class="p">,</span> <span class="n">K</span><span class="o">.</span><span class="n">zero</span><span class="p">],</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">gf_gcd</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span> <span class="o">==</span> <span class="p">[</span><span class="n">K</span><span class="o">.</span><span class="n">one</span><span class="p">]:</span>
                <span class="n">h</span> <span class="o">=</span> <span class="n">gf_frobenius_map</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">False</span>

    <span class="k">return</span> <span class="bp">True</span>


<span class="k">def</span> <span class="nf">gf_irred_p_rabin</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Rabin&#39;s polynomial irreducibility test over finite fields.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.polys.domains import ZZ</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.galoistools import gf_irred_p_rabin</span>

<span class="sd">    &gt;&gt;&gt; gf_irred_p_rabin(ZZ.map([1, 4, 2, 2, 3, 2, 4, 1, 4, 0, 4]), 5, ZZ)</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; gf_irred_p_rabin(ZZ.map([3, 2, 4]), 5, ZZ)</span>
<span class="sd">    False</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">gf_degree</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">True</span>

    <span class="n">_</span><span class="p">,</span> <span class="n">f</span> <span class="o">=</span> <span class="n">gf_monic</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>

    <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="n">K</span><span class="o">.</span><span class="n">one</span><span class="p">,</span> <span class="n">K</span><span class="o">.</span><span class="n">zero</span><span class="p">]</span>

    <span class="n">indices</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span> <span class="n">n</span><span class="o">//</span><span class="n">d</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">factorint</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="p">])</span>

    <span class="n">b</span> <span class="o">=</span> <span class="n">gf_frobenius_monomial_base</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>
    <span class="n">h</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">:</span>
            <span class="n">g</span> <span class="o">=</span> <span class="n">gf_sub</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">gf_gcd</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span> <span class="o">!=</span> <span class="p">[</span><span class="n">K</span><span class="o">.</span><span class="n">one</span><span class="p">]:</span>
                <span class="k">return</span> <span class="bp">False</span>

        <span class="n">h</span> <span class="o">=</span> <span class="n">gf_frobenius_map</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">h</span> <span class="o">==</span> <span class="n">x</span>

<span class="n">_irred_methods</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&#39;ben-or&#39;</span><span class="p">:</span> <span class="n">gf_irred_p_ben_or</span><span class="p">,</span>
    <span class="s">&#39;rabin&#39;</span><span class="p">:</span> <span class="n">gf_irred_p_rabin</span><span class="p">,</span>
<span class="p">}</span>


<div class="viewcode-block" id="gf_irreducible_p"><a class="viewcode-back" href="../../../modules/polys/internals.html#sympy.polys.galoistools.gf_irreducible_p">[docs]</a><span class="k">def</span> <span class="nf">gf_irreducible_p</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Test irreducibility of a polynomial ``f`` in ``GF(p)[x]``.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.polys.domains import ZZ</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.galoistools import gf_irreducible_p</span>

<span class="sd">    &gt;&gt;&gt; gf_irreducible_p(ZZ.map([1, 4, 2, 2, 3, 2, 4, 1, 4, 0, 4]), 5, ZZ)</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; gf_irreducible_p(ZZ.map([3, 2, 4]), 5, ZZ)</span>
<span class="sd">    False</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">method</span> <span class="o">=</span> <span class="n">query</span><span class="p">(</span><span class="s">&#39;GF_IRRED_METHOD&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">method</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">irred</span> <span class="o">=</span> <span class="n">_irred_methods</span><span class="p">[</span><span class="n">method</span><span class="p">](</span><span class="n">f</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">irred</span> <span class="o">=</span> <span class="n">gf_irred_p_rabin</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">irred</span>

</div>
<div class="viewcode-block" id="gf_sqf_p"><a class="viewcode-back" href="../../../modules/polys/internals.html#sympy.polys.galoistools.gf_sqf_p">[docs]</a><span class="k">def</span> <span class="nf">gf_sqf_p</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return ``True`` if ``f`` is square-free in ``GF(p)[x]``.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.polys.domains import ZZ</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.galoistools import gf_sqf_p</span>

<span class="sd">    &gt;&gt;&gt; gf_sqf_p(ZZ.map([3, 2, 4]), 5, ZZ)</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; gf_sqf_p(ZZ.map([2, 4, 4, 2, 2, 1, 4]), 5, ZZ)</span>
<span class="sd">    False</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">f</span> <span class="o">=</span> <span class="n">gf_monic</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">gf_gcd</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">gf_diff</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">),</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span> <span class="o">==</span> <span class="p">[</span><span class="n">K</span><span class="o">.</span><span class="n">one</span><span class="p">]</span>

</div>
<div class="viewcode-block" id="gf_sqf_part"><a class="viewcode-back" href="../../../modules/polys/internals.html#sympy.polys.galoistools.gf_sqf_part">[docs]</a><span class="k">def</span> <span class="nf">gf_sqf_part</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return square-free part of a ``GF(p)[x]`` polynomial.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.polys.domains import ZZ</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.galoistools import gf_sqf_part</span>

<span class="sd">    &gt;&gt;&gt; gf_sqf_part(ZZ.map([1, 1, 3, 0, 1, 0, 2, 2, 1]), 5, ZZ)</span>
<span class="sd">    [1, 4, 3]</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">sqf</span> <span class="o">=</span> <span class="n">gf_sqf_list</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>

    <span class="n">g</span> <span class="o">=</span> <span class="p">[</span><span class="n">K</span><span class="o">.</span><span class="n">one</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">f</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">sqf</span><span class="p">:</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">gf_mul</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">g</span>

</div>
<div class="viewcode-block" id="gf_sqf_list"><a class="viewcode-back" href="../../../modules/polys/internals.html#sympy.polys.galoistools.gf_sqf_list">[docs]</a><span class="k">def</span> <span class="nf">gf_sqf_list</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="nb">all</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the square-free decomposition of a ``GF(p)[x]`` polynomial.</span>

<span class="sd">    Given a polynomial ``f`` in ``GF(p)[x]``, returns the leading coefficient</span>
<span class="sd">    of ``f`` and a square-free decomposition ``f_1**e_1 f_2**e_2 ... f_k**e_k``</span>
<span class="sd">    such that all ``f_i`` are monic polynomials and ``(f_i, f_j)`` for ``i != j``</span>
<span class="sd">    are co-prime and ``e_1 ... e_k`` are given in increasing order. All trivial</span>
<span class="sd">    terms (i.e. ``f_i = 1``) aren&#39;t included in the output.</span>

<span class="sd">    Consider polynomial ``f = x**11 + 1`` over ``GF(11)[x]``::</span>

<span class="sd">       &gt;&gt;&gt; from sympy.polys.domains import ZZ</span>

<span class="sd">       &gt;&gt;&gt; from sympy.polys.galoistools import (</span>
<span class="sd">       ...     gf_from_dict, gf_diff, gf_sqf_list, gf_pow,</span>
<span class="sd">       ... )</span>
<span class="sd">       ... # doctest: +NORMALIZE_WHITESPACE</span>

<span class="sd">       &gt;&gt;&gt; f = gf_from_dict({11: ZZ(1), 0: ZZ(1)}, 11, ZZ)</span>

<span class="sd">    Note that ``f&#39;(x) = 0``::</span>

<span class="sd">       &gt;&gt;&gt; gf_diff(f, 11, ZZ)</span>
<span class="sd">       []</span>

<span class="sd">    This phenomenon doesn&#39;t happen in characteristic zero. However we can</span>
<span class="sd">    still compute square-free decomposition of ``f`` using ``gf_sqf()``::</span>

<span class="sd">       &gt;&gt;&gt; gf_sqf_list(f, 11, ZZ)</span>
<span class="sd">       (1, [([1, 1], 11)])</span>

<span class="sd">    We obtained factorization ``f = (x + 1)**11``. This is correct because::</span>

<span class="sd">       &gt;&gt;&gt; gf_pow([1, 1], 11, 11, ZZ) == f</span>
<span class="sd">       True</span>

<span class="sd">    References</span>
<span class="sd">    ==========</span>

<span class="sd">    1. [Geddes92]_</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n</span><span class="p">,</span> <span class="n">sqf</span><span class="p">,</span> <span class="n">factors</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="p">[],</span> <span class="nb">int</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

    <span class="n">lc</span><span class="p">,</span> <span class="n">f</span> <span class="o">=</span> <span class="n">gf_monic</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">gf_degree</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">lc</span><span class="p">,</span> <span class="p">[]</span>

    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">F</span> <span class="o">=</span> <span class="n">gf_diff</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">F</span> <span class="o">!=</span> <span class="p">[]:</span>
            <span class="n">g</span> <span class="o">=</span> <span class="n">gf_gcd</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">F</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>
            <span class="n">h</span> <span class="o">=</span> <span class="n">gf_quo</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>

            <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>

            <span class="k">while</span> <span class="n">h</span> <span class="o">!=</span> <span class="p">[</span><span class="n">K</span><span class="o">.</span><span class="n">one</span><span class="p">]:</span>
                <span class="n">G</span> <span class="o">=</span> <span class="n">gf_gcd</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>
                <span class="n">H</span> <span class="o">=</span> <span class="n">gf_quo</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">gf_degree</span><span class="p">(</span><span class="n">H</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">factors</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">H</span><span class="p">,</span> <span class="n">i</span><span class="o">*</span><span class="n">n</span><span class="p">))</span>

                <span class="n">g</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">i</span> <span class="o">=</span> <span class="n">gf_quo</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">),</span> <span class="n">G</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>

            <span class="k">if</span> <span class="n">g</span> <span class="o">==</span> <span class="p">[</span><span class="n">K</span><span class="o">.</span><span class="n">one</span><span class="p">]:</span>
                <span class="n">sqf</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">f</span> <span class="o">=</span> <span class="n">g</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">sqf</span><span class="p">:</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">gf_degree</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="o">//</span> <span class="n">r</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="n">r</span><span class="p">]</span>

            <span class="n">f</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="n">f</span><span class="p">[:</span><span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="n">n</span><span class="o">*</span><span class="n">r</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">break</span>

    <span class="k">if</span> <span class="nb">all</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;&#39;all=True&#39; is not supported yet&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">lc</span><span class="p">,</span> <span class="n">factors</span>

</div>
<div class="viewcode-block" id="gf_Qmatrix"><a class="viewcode-back" href="../../../modules/polys/internals.html#sympy.polys.galoistools.gf_Qmatrix">[docs]</a><span class="k">def</span> <span class="nf">gf_Qmatrix</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate Berlekamp&#39;s ``Q`` matrix.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.polys.domains import ZZ</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.galoistools import gf_Qmatrix</span>

<span class="sd">    &gt;&gt;&gt; gf_Qmatrix([3, 2, 4], 5, ZZ)</span>
<span class="sd">    [[1, 0],</span>
<span class="sd">     [3, 4]]</span>

<span class="sd">    &gt;&gt;&gt; gf_Qmatrix([1, 0, 0, 0, 1], 5, ZZ)</span>
<span class="sd">    [[1, 0, 0, 0],</span>
<span class="sd">     [0, 4, 0, 0],</span>
<span class="sd">     [0, 0, 1, 0],</span>
<span class="sd">     [0, 0, 0, 4]]</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="n">gf_degree</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

    <span class="n">q</span> <span class="o">=</span> <span class="p">[</span><span class="n">K</span><span class="o">.</span><span class="n">one</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">K</span><span class="o">.</span><span class="n">zero</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">Q</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">q</span><span class="p">)]</span> <span class="o">+</span> <span class="p">[[]]</span><span class="o">*</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">r</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">qq</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="p">[(</span><span class="o">-</span><span class="n">q</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">f</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">%</span> <span class="n">p</span><span class="p">],</span> <span class="n">q</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
            <span class="n">qq</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">q</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">c</span><span class="o">*</span><span class="n">f</span><span class="p">[</span><span class="o">-</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span> <span class="o">%</span> <span class="n">p</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">i</span> <span class="o">%</span> <span class="n">r</span><span class="p">):</span>
            <span class="n">Q</span><span class="p">[</span><span class="n">i</span><span class="o">//</span><span class="n">r</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">qq</span><span class="p">)</span>

        <span class="n">q</span> <span class="o">=</span> <span class="n">qq</span>

    <span class="k">return</span> <span class="n">Q</span>

</div>
<div class="viewcode-block" id="gf_Qbasis"><a class="viewcode-back" href="../../../modules/polys/internals.html#sympy.polys.galoistools.gf_Qbasis">[docs]</a><span class="k">def</span> <span class="nf">gf_Qbasis</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute a basis of the kernel of ``Q``.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.polys.domains import ZZ</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.galoistools import gf_Qmatrix, gf_Qbasis</span>

<span class="sd">    &gt;&gt;&gt; gf_Qbasis(gf_Qmatrix([1, 0, 0, 0, 1], 5, ZZ), 5, ZZ)</span>
<span class="sd">    [[1, 0, 0, 0], [0, 0, 1, 0]]</span>

<span class="sd">    &gt;&gt;&gt; gf_Qbasis(gf_Qmatrix([3, 2, 4], 5, ZZ), 5, ZZ)</span>
<span class="sd">    [[1, 0]]</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">Q</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="p">[</span> <span class="nb">list</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">Q</span> <span class="p">],</span> <span class="nb">len</span><span class="p">(</span><span class="n">Q</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="n">Q</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">Q</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">K</span><span class="o">.</span><span class="n">one</span><span class="p">)</span> <span class="o">%</span> <span class="n">p</span>

    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">Q</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">i</span><span class="p">]:</span>
                <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">continue</span>

        <span class="n">inv</span> <span class="o">=</span> <span class="n">K</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="n">Q</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">p</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
            <span class="n">Q</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">Q</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">inv</span><span class="p">)</span> <span class="o">%</span> <span class="n">p</span>

        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">Q</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">]</span>
            <span class="n">Q</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">Q</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
            <span class="n">Q</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">t</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">k</span><span class="p">:</span>
                <span class="n">q</span> <span class="o">=</span> <span class="n">Q</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>

                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
                    <span class="n">Q</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">Q</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">Q</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">]</span><span class="o">*</span><span class="n">q</span><span class="p">)</span> <span class="o">%</span> <span class="n">p</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">j</span><span class="p">:</span>
                <span class="n">Q</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">K</span><span class="o">.</span><span class="n">one</span> <span class="o">-</span> <span class="n">Q</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span> <span class="o">%</span> <span class="n">p</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">Q</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">Q</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span> <span class="o">%</span> <span class="n">p</span>

    <span class="n">basis</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">Q</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">q</span><span class="p">):</span>
            <span class="n">basis</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">basis</span>

</div>
<div class="viewcode-block" id="gf_berlekamp"><a class="viewcode-back" href="../../../modules/polys/internals.html#sympy.polys.galoistools.gf_berlekamp">[docs]</a><span class="k">def</span> <span class="nf">gf_berlekamp</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Factor a square-free ``f`` in ``GF(p)[x]`` for small ``p``.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.polys.domains import ZZ</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.galoistools import gf_berlekamp</span>

<span class="sd">    &gt;&gt;&gt; gf_berlekamp([1, 0, 0, 0, 1], 5, ZZ)</span>
<span class="sd">    [[1, 0, 2], [1, 0, 3]]</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">Q</span> <span class="o">=</span> <span class="n">gf_Qmatrix</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>
    <span class="n">V</span> <span class="o">=</span> <span class="n">gf_Qbasis</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">V</span><span class="p">):</span>
        <span class="n">V</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">gf_strip</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">v</span><span class="p">)))</span>

    <span class="n">factors</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">V</span><span class="p">)):</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">factors</span><span class="p">):</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">K</span><span class="o">.</span><span class="n">zero</span>

            <span class="k">while</span> <span class="n">s</span> <span class="o">&lt;</span> <span class="n">p</span><span class="p">:</span>
                <span class="n">g</span> <span class="o">=</span> <span class="n">gf_sub_ground</span><span class="p">(</span><span class="n">V</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">s</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>
                <span class="n">h</span> <span class="o">=</span> <span class="n">gf_gcd</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">h</span> <span class="o">!=</span> <span class="p">[</span><span class="n">K</span><span class="o">.</span><span class="n">one</span><span class="p">]</span> <span class="ow">and</span> <span class="n">h</span> <span class="o">!=</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">factors</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

                    <span class="n">f</span> <span class="o">=</span> <span class="n">gf_quo</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>
                    <span class="n">factors</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">f</span><span class="p">,</span> <span class="n">h</span><span class="p">])</span>

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">factors</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">V</span><span class="p">):</span>
                    <span class="k">return</span> <span class="n">_sort_factors</span><span class="p">(</span><span class="n">factors</span><span class="p">,</span> <span class="n">multiple</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

                <span class="n">s</span> <span class="o">+=</span> <span class="n">K</span><span class="o">.</span><span class="n">one</span>

    <span class="k">return</span> <span class="n">_sort_factors</span><span class="p">(</span><span class="n">factors</span><span class="p">,</span> <span class="n">multiple</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

</div>
<span class="k">def</span> <span class="nf">gf_ddf_zassenhaus</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Cantor-Zassenhaus: Deterministic Distinct Degree Factorization</span>

<span class="sd">    Given a monic square-free polynomial ``f`` in ``GF(p)[x]``, computes</span>
<span class="sd">    partial distinct degree factorization ``f_1 ... f_d`` of ``f`` where</span>
<span class="sd">    ``deg(f_i) != deg(f_j)`` for ``i != j``. The result is returned as a</span>
<span class="sd">    list of pairs ``(f_i, e_i)`` where ``deg(f_i) &gt; 0`` and ``e_i &gt; 0``</span>
<span class="sd">    is an argument to the equal degree factorization routine.</span>

<span class="sd">    Consider the polynomial ``x**15 - 1`` in ``GF(11)[x]``::</span>

<span class="sd">       &gt;&gt;&gt; from sympy.polys.domains import ZZ</span>
<span class="sd">       &gt;&gt;&gt; from sympy.polys.galoistools import gf_from_dict</span>

<span class="sd">       &gt;&gt;&gt; f = gf_from_dict({15: ZZ(1), 0: ZZ(-1)}, 11, ZZ)</span>

<span class="sd">    Distinct degree factorization gives::</span>

<span class="sd">       &gt;&gt;&gt; from sympy.polys.galoistools import gf_ddf_zassenhaus</span>

<span class="sd">       &gt;&gt;&gt; gf_ddf_zassenhaus(f, 11, ZZ)</span>
<span class="sd">       [([1, 0, 0, 0, 0, 10], 1), ([1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1], 2)]</span>

<span class="sd">    which means ``x**15 - 1 = (x**5 - 1) (x**10 + x**5 + 1)``. To obtain</span>
<span class="sd">    factorization into irreducibles, use equal degree factorization</span>
<span class="sd">    procedure (EDF) with each of the factors.</span>

<span class="sd">    References</span>
<span class="sd">    ==========</span>

<span class="sd">    1. [Gathen99]_</span>
<span class="sd">    2. [Geddes92]_</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">i</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">factors</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="n">K</span><span class="o">.</span><span class="n">one</span><span class="p">,</span> <span class="n">K</span><span class="o">.</span><span class="n">zero</span><span class="p">],</span> <span class="p">[]</span>

    <span class="n">b</span> <span class="o">=</span> <span class="n">gf_frobenius_monomial_base</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>
    <span class="k">while</span> <span class="mi">2</span><span class="o">*</span><span class="n">i</span> <span class="o">&lt;=</span> <span class="n">gf_degree</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">gf_frobenius_map</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">gf_gcd</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">gf_sub</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="p">[</span><span class="n">K</span><span class="o">.</span><span class="n">one</span><span class="p">,</span> <span class="n">K</span><span class="o">.</span><span class="n">zero</span><span class="p">],</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">),</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">h</span> <span class="o">!=</span> <span class="p">[</span><span class="n">K</span><span class="o">.</span><span class="n">one</span><span class="p">]:</span>
            <span class="n">factors</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">h</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>

            <span class="n">f</span> <span class="o">=</span> <span class="n">gf_quo</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>
            <span class="n">g</span> <span class="o">=</span> <span class="n">gf_rem</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">gf_frobenius_monomial_base</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>

        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="n">f</span> <span class="o">!=</span> <span class="p">[</span><span class="n">K</span><span class="o">.</span><span class="n">one</span><span class="p">]:</span>
        <span class="k">return</span> <span class="n">factors</span> <span class="o">+</span> <span class="p">[(</span><span class="n">f</span><span class="p">,</span> <span class="n">gf_degree</span><span class="p">(</span><span class="n">f</span><span class="p">))]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">factors</span>


<span class="k">def</span> <span class="nf">gf_edf_zassenhaus</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Cantor-Zassenhaus: Probabilistic Equal Degree Factorization</span>

<span class="sd">    Given a monic square-free polynomial ``f`` in ``GF(p)[x]`` and</span>
<span class="sd">    an integer ``n``, such that ``n`` divides ``deg(f)``, returns all</span>
<span class="sd">    irreducible factors ``f_1,...,f_d`` of ``f``, each of degree ``n``.</span>
<span class="sd">    EDF procedure gives complete factorization over Galois fields.</span>

<span class="sd">    Consider the square-free polynomial ``f = x**3 + x**2 + x + 1`` in</span>
<span class="sd">    ``GF(5)[x]``. Let&#39;s compute its irreducible factors of degree one::</span>

<span class="sd">       &gt;&gt;&gt; from sympy.polys.domains import ZZ</span>
<span class="sd">       &gt;&gt;&gt; from sympy.polys.galoistools import gf_edf_zassenhaus</span>

<span class="sd">       &gt;&gt;&gt; gf_edf_zassenhaus([1,1,1,1], 1, 5, ZZ)</span>
<span class="sd">       [[1, 1], [1, 2], [1, 3]]</span>

<span class="sd">    References</span>
<span class="sd">    ==========</span>

<span class="sd">    1. [Gathen99]_</span>
<span class="sd">    2. [Geddes92]_</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">factors</span><span class="p">,</span> <span class="n">q</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span><span class="p">],</span> <span class="nb">int</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">gf_degree</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">n</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">factors</span>

    <span class="n">N</span> <span class="o">=</span> <span class="n">gf_degree</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="o">//</span> <span class="n">n</span>
    <span class="k">if</span> <span class="n">p</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">gf_frobenius_monomial_base</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>

    <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">factors</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">N</span><span class="p">:</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">gf_random</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">p</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">h</span> <span class="o">=</span> <span class="n">r</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">**</span><span class="p">(</span><span class="n">n</span><span class="o">*</span><span class="n">N</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)):</span>
                <span class="n">r</span> <span class="o">=</span> <span class="n">gf_pow_mod</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>
                <span class="n">h</span> <span class="o">=</span> <span class="n">gf_add</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>

            <span class="n">g</span> <span class="o">=</span> <span class="n">gf_gcd</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">h</span> <span class="o">=</span> <span class="n">_gf_pow_pnm1d2</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>
            <span class="n">g</span> <span class="o">=</span> <span class="n">gf_gcd</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">gf_sub_ground</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">K</span><span class="o">.</span><span class="n">one</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">),</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">g</span> <span class="o">!=</span> <span class="p">[</span><span class="n">K</span><span class="o">.</span><span class="n">one</span><span class="p">]</span> <span class="ow">and</span> <span class="n">g</span> <span class="o">!=</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">factors</span> <span class="o">=</span> <span class="n">gf_edf_zassenhaus</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span> \
                <span class="o">+</span> <span class="n">gf_edf_zassenhaus</span><span class="p">(</span><span class="n">gf_quo</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">),</span> <span class="n">n</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">_sort_factors</span><span class="p">(</span><span class="n">factors</span><span class="p">,</span> <span class="n">multiple</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">gf_ddf_shoup</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Kaltofen-Shoup: Deterministic Distinct Degree Factorization</span>

<span class="sd">    Given a monic square-free polynomial ``f`` in ``GF(p)[x]``, computes</span>
<span class="sd">    partial distinct degree factorization ``f_1,...,f_d`` of ``f`` where</span>
<span class="sd">    ``deg(f_i) != deg(f_j)`` for ``i != j``. The result is returned as a</span>
<span class="sd">    list of pairs ``(f_i, e_i)`` where ``deg(f_i) &gt; 0`` and ``e_i &gt; 0``</span>
<span class="sd">    is an argument to the equal degree factorization routine.</span>

<span class="sd">    This algorithm is an improved version of Zassenhaus algorithm for</span>
<span class="sd">    large ``deg(f)`` and modulus ``p`` (especially for ``deg(f) ~ lg(p)``).</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.polys.domains import ZZ</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.galoistools import gf_ddf_shoup, gf_from_dict</span>

<span class="sd">    &gt;&gt;&gt; f = gf_from_dict({6: ZZ(1), 5: ZZ(-1), 4: ZZ(1), 3: ZZ(1), 1: ZZ(-1)}, 3, ZZ)</span>

<span class="sd">    &gt;&gt;&gt; gf_ddf_shoup(f, 3, ZZ)</span>
<span class="sd">    [([1, 1, 0], 1), ([1, 1, 0, 1, 2], 2)]</span>

<span class="sd">    References</span>
<span class="sd">    ==========</span>

<span class="sd">    1. [Kaltofen98]_</span>
<span class="sd">    2. [Shoup95]_</span>
<span class="sd">    3. [Gathen92]_</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">gf_degree</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="n">k</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">_ceil</span><span class="p">(</span><span class="n">_sqrt</span><span class="p">(</span><span class="n">n</span><span class="o">//</span><span class="mi">2</span><span class="p">)))</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">gf_frobenius_monomial_base</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>
    <span class="n">h</span> <span class="o">=</span> <span class="n">gf_frobenius_map</span><span class="p">([</span><span class="n">K</span><span class="o">.</span><span class="n">one</span><span class="p">,</span> <span class="n">K</span><span class="o">.</span><span class="n">zero</span><span class="p">],</span> <span class="n">f</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>
    <span class="c"># U[i] = x**(p**i)</span>
    <span class="n">U</span> <span class="o">=</span> <span class="p">[[</span><span class="n">K</span><span class="o">.</span><span class="n">one</span><span class="p">,</span> <span class="n">K</span><span class="o">.</span><span class="n">zero</span><span class="p">],</span> <span class="n">h</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">K</span><span class="o">.</span><span class="n">zero</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">U</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">gf_frobenius_map</span><span class="p">(</span><span class="n">U</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">f</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>

    <span class="n">h</span><span class="p">,</span> <span class="n">U</span> <span class="o">=</span> <span class="n">U</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">U</span><span class="p">[:</span><span class="n">k</span><span class="p">]</span>
    <span class="c"># V[i] = x**(p**(k*(i+1)))</span>
    <span class="n">V</span> <span class="o">=</span> <span class="p">[</span><span class="n">h</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">K</span><span class="o">.</span><span class="n">zero</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="n">V</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">gf_compose_mod</span><span class="p">(</span><span class="n">V</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">h</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>

    <span class="n">factors</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">V</span><span class="p">):</span>
        <span class="n">h</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="p">[</span><span class="n">K</span><span class="o">.</span><span class="n">one</span><span class="p">],</span> <span class="n">k</span> <span class="o">-</span> <span class="mi">1</span>

        <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">U</span><span class="p">:</span>
            <span class="n">g</span> <span class="o">=</span> <span class="n">gf_sub</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>
            <span class="n">h</span> <span class="o">=</span> <span class="n">gf_mul</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>
            <span class="n">h</span> <span class="o">=</span> <span class="n">gf_rem</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>

        <span class="n">g</span> <span class="o">=</span> <span class="n">gf_gcd</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">gf_quo</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">U</span><span class="p">):</span>
            <span class="n">h</span> <span class="o">=</span> <span class="n">gf_sub</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>
            <span class="n">F</span> <span class="o">=</span> <span class="n">gf_gcd</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">F</span> <span class="o">!=</span> <span class="p">[</span><span class="n">K</span><span class="o">.</span><span class="n">one</span><span class="p">]:</span>
                <span class="n">factors</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">F</span><span class="p">,</span> <span class="n">k</span><span class="o">*</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">j</span><span class="p">))</span>

            <span class="n">g</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="n">gf_quo</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">F</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">),</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="n">f</span> <span class="o">!=</span> <span class="p">[</span><span class="n">K</span><span class="o">.</span><span class="n">one</span><span class="p">]:</span>
        <span class="n">factors</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">f</span><span class="p">,</span> <span class="n">gf_degree</span><span class="p">(</span><span class="n">f</span><span class="p">)))</span>

    <span class="k">return</span> <span class="n">factors</span>

<span class="k">def</span> <span class="nf">gf_edf_shoup</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Gathen-Shoup: Probabilistic Equal Degree Factorization</span>

<span class="sd">    Given a monic square-free polynomial ``f`` in ``GF(p)[x]`` and integer</span>
<span class="sd">    ``n`` such that ``n`` divides ``deg(f)``, returns all irreducible factors</span>
<span class="sd">    ``f_1,...,f_d`` of ``f``, each of degree ``n``. This is a complete</span>
<span class="sd">    factorization over Galois fields.</span>

<span class="sd">    This algorithm is an improved version of Zassenhaus algorithm for</span>
<span class="sd">    large ``deg(f)`` and modulus ``p`` (especially for ``deg(f) ~ lg(p)``).</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.polys.domains import ZZ</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.galoistools import gf_edf_shoup</span>

<span class="sd">    &gt;&gt;&gt; gf_edf_shoup(ZZ.map([1, 2837, 2277]), 1, 2917, ZZ)</span>
<span class="sd">    [[1, 852], [1, 1985]]</span>

<span class="sd">    References</span>
<span class="sd">    ==========</span>

<span class="sd">    1. [Shoup91]_</span>
<span class="sd">    2. [Gathen92]_</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">N</span><span class="p">,</span> <span class="n">q</span> <span class="o">=</span> <span class="n">gf_degree</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">N</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">N</span> <span class="o">&lt;=</span> <span class="n">n</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">f</span><span class="p">]</span>

    <span class="n">factors</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span><span class="p">],</span> <span class="p">[</span><span class="n">K</span><span class="o">.</span><span class="n">one</span><span class="p">,</span> <span class="n">K</span><span class="o">.</span><span class="n">zero</span><span class="p">]</span>

    <span class="n">r</span> <span class="o">=</span> <span class="n">gf_random</span><span class="p">(</span><span class="n">N</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">p</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">gf_pow_mod</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>
        <span class="n">H</span> <span class="o">=</span> <span class="n">gf_trace_map</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">h1</span> <span class="o">=</span> <span class="n">gf_gcd</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>
        <span class="n">h2</span> <span class="o">=</span> <span class="n">gf_quo</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">h1</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>

        <span class="n">factors</span> <span class="o">=</span> <span class="n">gf_edf_shoup</span><span class="p">(</span><span class="n">h1</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span> \
            <span class="o">+</span> <span class="n">gf_edf_shoup</span><span class="p">(</span><span class="n">h2</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">gf_frobenius_monomial_base</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>
        <span class="n">H</span> <span class="o">=</span> <span class="n">_gf_trace_map</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">gf_pow_mod</span><span class="p">(</span><span class="n">H</span><span class="p">,</span> <span class="p">(</span><span class="n">q</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>

        <span class="n">h1</span> <span class="o">=</span> <span class="n">gf_gcd</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>
        <span class="n">h2</span> <span class="o">=</span> <span class="n">gf_gcd</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">gf_sub_ground</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">K</span><span class="o">.</span><span class="n">one</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">),</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>
        <span class="n">h3</span> <span class="o">=</span> <span class="n">gf_quo</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">gf_mul</span><span class="p">(</span><span class="n">h1</span><span class="p">,</span> <span class="n">h2</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">),</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>

        <span class="n">factors</span> <span class="o">=</span> <span class="n">gf_edf_shoup</span><span class="p">(</span><span class="n">h1</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span> \
            <span class="o">+</span> <span class="n">gf_edf_shoup</span><span class="p">(</span><span class="n">h2</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span> \
            <span class="o">+</span> <span class="n">gf_edf_shoup</span><span class="p">(</span><span class="n">h3</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">_sort_factors</span><span class="p">(</span><span class="n">factors</span><span class="p">,</span> <span class="n">multiple</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>


<div class="viewcode-block" id="gf_zassenhaus"><a class="viewcode-back" href="../../../modules/polys/internals.html#sympy.polys.galoistools.gf_zassenhaus">[docs]</a><span class="k">def</span> <span class="nf">gf_zassenhaus</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Factor a square-free ``f`` in ``GF(p)[x]`` for medium ``p``.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.polys.domains import ZZ</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.galoistools import gf_zassenhaus</span>

<span class="sd">    &gt;&gt;&gt; gf_zassenhaus(ZZ.map([1, 4, 3]), 5, ZZ)</span>
<span class="sd">    [[1, 1], [1, 3]]</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">factors</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">factor</span><span class="p">,</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">gf_ddf_zassenhaus</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">):</span>
        <span class="n">factors</span> <span class="o">+=</span> <span class="n">gf_edf_zassenhaus</span><span class="p">(</span><span class="n">factor</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">_sort_factors</span><span class="p">(</span><span class="n">factors</span><span class="p">,</span> <span class="n">multiple</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="gf_shoup"><a class="viewcode-back" href="../../../modules/polys/internals.html#sympy.polys.galoistools.gf_shoup">[docs]</a><span class="k">def</span> <span class="nf">gf_shoup</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Factor a square-free ``f`` in ``GF(p)[x]`` for large ``p``.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.polys.domains import ZZ</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.galoistools import gf_shoup</span>

<span class="sd">    &gt;&gt;&gt; gf_shoup(ZZ.map([1, 4, 3]), 5, ZZ)</span>
<span class="sd">    [[1, 1], [1, 3]]</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">factors</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">factor</span><span class="p">,</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">gf_ddf_shoup</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">):</span>
        <span class="n">factors</span> <span class="o">+=</span> <span class="n">gf_edf_shoup</span><span class="p">(</span><span class="n">factor</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">_sort_factors</span><span class="p">(</span><span class="n">factors</span><span class="p">,</span> <span class="n">multiple</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</div>
<span class="n">_factor_methods</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&#39;berlekamp&#39;</span><span class="p">:</span> <span class="n">gf_berlekamp</span><span class="p">,</span>  <span class="c"># ``p`` : small</span>
    <span class="s">&#39;zassenhaus&#39;</span><span class="p">:</span> <span class="n">gf_zassenhaus</span><span class="p">,</span>  <span class="c"># ``p`` : medium</span>
    <span class="s">&#39;shoup&#39;</span><span class="p">:</span> <span class="n">gf_shoup</span><span class="p">,</span>      <span class="c"># ``p`` : large</span>
<span class="p">}</span>


<div class="viewcode-block" id="gf_factor_sqf"><a class="viewcode-back" href="../../../modules/polys/internals.html#sympy.polys.galoistools.gf_factor_sqf">[docs]</a><span class="k">def</span> <span class="nf">gf_factor_sqf</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Factor a square-free polynomial ``f`` in ``GF(p)[x]``.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.polys.domains import ZZ</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.galoistools import gf_factor_sqf</span>

<span class="sd">    &gt;&gt;&gt; gf_factor_sqf(ZZ.map([3, 2, 4]), 5, ZZ)</span>
<span class="sd">    (3, [[1, 1], [1, 3]])</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">lc</span><span class="p">,</span> <span class="n">f</span> <span class="o">=</span> <span class="n">gf_monic</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">gf_degree</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">lc</span><span class="p">,</span> <span class="p">[]</span>

    <span class="n">method</span> <span class="o">=</span> <span class="n">method</span> <span class="ow">or</span> <span class="n">query</span><span class="p">(</span><span class="s">&#39;GF_FACTOR_METHOD&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">method</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">factors</span> <span class="o">=</span> <span class="n">_factor_methods</span><span class="p">[</span><span class="n">method</span><span class="p">](</span><span class="n">f</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">factors</span> <span class="o">=</span> <span class="n">gf_zassenhaus</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">lc</span><span class="p">,</span> <span class="n">factors</span>

</div>
<div class="viewcode-block" id="gf_factor"><a class="viewcode-back" href="../../../modules/polys/internals.html#sympy.polys.galoistools.gf_factor">[docs]</a><span class="k">def</span> <span class="nf">gf_factor</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Factor (non square-free) polynomials in ``GF(p)[x]``.</span>

<span class="sd">    Given a possibly non square-free polynomial ``f`` in ``GF(p)[x]``,</span>
<span class="sd">    returns its complete factorization into irreducibles::</span>

<span class="sd">                 f_1(x)**e_1 f_2(x)**e_2 ... f_d(x)**e_d</span>

<span class="sd">    where each ``f_i`` is a monic polynomial and ``gcd(f_i, f_j) == 1``,</span>
<span class="sd">    for ``i != j``.  The result is given as a tuple consisting of the</span>
<span class="sd">    leading coefficient of ``f`` and a list of factors of ``f`` with</span>
<span class="sd">    their multiplicities.</span>

<span class="sd">    The algorithm proceeds by first computing square-free decomposition</span>
<span class="sd">    of ``f`` and then iteratively factoring each of square-free factors.</span>

<span class="sd">    Consider a non square-free polynomial ``f = (7*x + 1) (x + 2)**2`` in</span>
<span class="sd">    ``GF(11)[x]``. We obtain its factorization into irreducibles as follows::</span>

<span class="sd">       &gt;&gt;&gt; from sympy.polys.domains import ZZ</span>
<span class="sd">       &gt;&gt;&gt; from sympy.polys.galoistools import gf_factor</span>

<span class="sd">       &gt;&gt;&gt; gf_factor(ZZ.map([5, 2, 7, 2]), 11, ZZ)</span>
<span class="sd">       (5, [([1, 2], 1), ([1, 8], 2)])</span>

<span class="sd">    We arrived with factorization ``f = 5 (x + 2) (x + 8)**2``. We didn&#39;t</span>
<span class="sd">    recover the exact form of the input polynomial because we requested to</span>
<span class="sd">    get monic factors of ``f`` and its leading coefficient separately.</span>

<span class="sd">    Square-free factors of ``f`` can be factored into irreducibles over</span>
<span class="sd">    ``GF(p)`` using three very different methods:</span>

<span class="sd">    Berlekamp</span>
<span class="sd">        efficient for very small values of ``p`` (usually ``p &lt; 25``)</span>
<span class="sd">    Cantor-Zassenhaus</span>
<span class="sd">        efficient on average input and with &quot;typical&quot; ``p``</span>
<span class="sd">    Shoup-Kaltofen-Gathen</span>
<span class="sd">        efficient with very large inputs and modulus</span>

<span class="sd">    If you want to use a specific factorization method, instead of the default</span>
<span class="sd">    one, set ``GF_FACTOR_METHOD`` with one of ``berlekamp``, ``zassenhaus`` or</span>
<span class="sd">    ``shoup`` values.</span>

<span class="sd">    References</span>
<span class="sd">    ==========</span>

<span class="sd">    1. [Gathen99]_</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">lc</span><span class="p">,</span> <span class="n">f</span> <span class="o">=</span> <span class="n">gf_monic</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">gf_degree</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">lc</span><span class="p">,</span> <span class="p">[]</span>

    <span class="n">factors</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">g</span><span class="p">,</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">gf_sqf_list</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)[</span><span class="mi">1</span><span class="p">]:</span>
        <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">gf_factor_sqf</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">K</span><span class="p">)[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">factors</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">h</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">lc</span><span class="p">,</span> <span class="n">_sort_factors</span><span class="p">(</span><span class="n">factors</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="gf_value"><a class="viewcode-back" href="../../../modules/polys/internals.html#sympy.polys.galoistools.gf_value">[docs]</a><span class="k">def</span> <span class="nf">gf_value</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Value of polynomial &#39;f&#39; at &#39;a&#39; in field R.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.polys.galoistools import gf_value</span>

<span class="sd">    &gt;&gt;&gt; gf_value([1, 7, 2, 4], 11)</span>
<span class="sd">    2204</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">*=</span> <span class="n">a</span>
        <span class="n">result</span> <span class="o">+=</span> <span class="n">c</span>
    <span class="k">return</span> <span class="n">result</span>

</div>
<span class="k">def</span> <span class="nf">linear_congruence</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the values of x satisfying a*x congruent b mod(m)</span>

<span class="sd">    Here m is positive integer and a, b are natural numbers.</span>
<span class="sd">    This function returns only those values of x which are distinct mod(m).</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.polys.galoistools import linear_congruence</span>

<span class="sd">    &gt;&gt;&gt; linear_congruence(3, 12, 15)</span>
<span class="sd">    [4, 9, 14]</span>

<span class="sd">    There are 3 solutions distinct mod(15) since gcd(a, m) = gcd(3, 15) = 3.</span>

<span class="sd">    **Reference**</span>
<span class="sd">    1) Wikipedia http://en.wikipedia.org/wiki/Linear_congruence_theorem</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">sympy.polys.polytools</span> <span class="kn">import</span> <span class="n">gcdex</span>
    <span class="k">if</span> <span class="n">a</span> <span class="o">%</span> <span class="n">m</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">b</span> <span class="o">%</span> <span class="n">m</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">m</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>
    <span class="n">r</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">g</span> <span class="o">=</span> <span class="n">gcdex</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">b</span> <span class="o">%</span> <span class="n">g</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[]</span>
    <span class="k">return</span> <span class="p">[(</span><span class="n">r</span> <span class="o">*</span> <span class="n">b</span> <span class="o">//</span> <span class="n">g</span> <span class="o">+</span> <span class="n">t</span> <span class="o">*</span> <span class="n">m</span> <span class="o">//</span> <span class="n">g</span><span class="p">)</span> <span class="o">%</span> <span class="n">m</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">g</span><span class="p">)]</span>


<span class="k">def</span> <span class="nf">_raise_mod_power</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">f</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Used in gf_csolve to generate solutions of f(x) cong 0 mod(p**(s + 1))</span>
<span class="sd">    from the solutions of f(x) cong 0 mod(p**s).</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.polys.galoistools import _raise_mod_power</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.galoistools import csolve_prime</span>

<span class="sd">    These is the solutions of f(x) = x**2 + x + 7 cong 0 mod(3)</span>

<span class="sd">    &gt;&gt;&gt; f = [1, 1, 7]</span>
<span class="sd">    &gt;&gt;&gt; csolve_prime(f, 3)</span>
<span class="sd">    [1]</span>
<span class="sd">    &gt;&gt;&gt; [ i for i in range(3) if not (i**2 + i + 7) % 3]</span>
<span class="sd">    [1]</span>

<span class="sd">    The solutions of f(x) cong 0 mod(9) are constructed from the</span>
<span class="sd">    values returned from _raise_mod_power:</span>

<span class="sd">    &gt;&gt;&gt; x, s, p = 1, 1, 3</span>
<span class="sd">    &gt;&gt;&gt; V = _raise_mod_power(x, s, p, f)</span>
<span class="sd">    &gt;&gt;&gt; [x + v * p**s for v in V]</span>
<span class="sd">    [1, 4, 7]</span>

<span class="sd">    And these are confirmed with the following:</span>

<span class="sd">    &gt;&gt;&gt; [ i for i in range(3**2) if not (i**2 + i + 7) % 3**2]</span>
<span class="sd">    [1, 4, 7]</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">sympy.polys.domains</span> <span class="kn">import</span> <span class="n">ZZ</span>
    <span class="n">f_f</span> <span class="o">=</span> <span class="n">gf_diff</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">ZZ</span><span class="p">)</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="n">gf_value</span><span class="p">(</span><span class="n">f_f</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
    <span class="n">beta</span> <span class="o">=</span> <span class="o">-</span> <span class="n">gf_value</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="o">//</span> <span class="n">p</span><span class="o">**</span><span class="n">s</span>
    <span class="k">return</span> <span class="n">linear_congruence</span><span class="p">(</span><span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">csolve_prime</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">e</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Solutions of f(x) congruent 0 mod(p**e).</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.polys.galoistools import csolve_prime</span>

<span class="sd">    &gt;&gt;&gt; csolve_prime([1, 1, 7], 3, 1)</span>
<span class="sd">    [1]</span>
<span class="sd">    &gt;&gt;&gt; csolve_prime([1, 1, 7], 3, 2)</span>
<span class="sd">    [1, 4, 7]</span>

<span class="sd">    Solutions [7, 4, 1] (mod 3**2) are generated by ``_raise_mod_power()``</span>
<span class="sd">    from solution [1] (mod 3).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">sympy.polys.domains</span> <span class="kn">import</span> <span class="n">ZZ</span>
    <span class="n">X1</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">if</span> <span class="n">gf_eval</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">ZZ</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">e</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">X1</span>
    <span class="n">X</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">S</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">X1</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">X1</span><span class="p">)))</span>
    <span class="k">while</span> <span class="n">S</span><span class="p">:</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="n">S</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">s</span> <span class="o">==</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">X</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">s1</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">ps</span> <span class="o">=</span> <span class="n">p</span><span class="o">**</span><span class="n">s</span>
            <span class="n">S</span><span class="o">.</span><span class="n">extend</span><span class="p">([(</span><span class="n">x</span> <span class="o">+</span> <span class="n">v</span><span class="o">*</span><span class="n">ps</span><span class="p">,</span> <span class="n">s1</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">_raise_mod_power</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">f</span><span class="p">)])</span>
    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>


<div class="viewcode-block" id="gf_csolve"><a class="viewcode-back" href="../../../modules/polys/internals.html#sympy.polys.galoistools.gf_csolve">[docs]</a><span class="k">def</span> <span class="nf">gf_csolve</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    To solve f(x) congruent 0 mod(n).</span>

<span class="sd">    n is divided into canonical factors and f(x) cong 0 mod(p**e) will be</span>
<span class="sd">    solved for each factor. Applying the Chinese Remainder Theorem to the</span>
<span class="sd">    results returns the final answers.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    Solve [1, 1, 7] congruent 0 mod(189):</span>

<span class="sd">    &gt;&gt;&gt; from sympy.polys.galoistools import gf_csolve</span>
<span class="sd">    &gt;&gt;&gt; gf_csolve([1, 1, 7], 189)</span>
<span class="sd">    [13, 49, 76, 112, 139, 175]</span>

<span class="sd">    References</span>
<span class="sd">    ==========</span>

<span class="sd">    [1] &#39;An introduction to the Theory of Numbers&#39; 5th Edition by Ivan Niven,</span>
<span class="sd">        Zuckerman and Montgomery.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">sympy.polys.domains</span> <span class="kn">import</span> <span class="n">ZZ</span>
    <span class="n">P</span> <span class="o">=</span> <span class="n">factorint</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="n">X</span> <span class="o">=</span> <span class="p">[</span><span class="n">csolve_prime</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">P</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>
    <span class="n">pools</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="n">X</span><span class="p">))</span>
    <span class="n">perms</span> <span class="o">=</span> <span class="p">[[]]</span>
    <span class="k">for</span> <span class="n">pool</span> <span class="ow">in</span> <span class="n">pools</span><span class="p">:</span>
        <span class="n">perms</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="o">+</span> <span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">perms</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">pool</span><span class="p">]</span>
    <span class="n">dist_factors</span> <span class="o">=</span> <span class="p">[</span><span class="nb">pow</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">P</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>
    <span class="k">return</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">gf_crt</span><span class="p">(</span><span class="n">per</span><span class="p">,</span> <span class="n">dist_factors</span><span class="p">,</span> <span class="n">ZZ</span><span class="p">)</span> <span class="k">for</span> <span class="n">per</span> <span class="ow">in</span> <span class="n">perms</span><span class="p">])</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/sympylogo.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../../../np-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">SymPy 0.7.3 documentation</a> &raquo;</li>
          <li><a href="../../index.html" >Module code</a> &raquo;</li>
          <li><a href="../../sympy.html" >sympy</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013 SymPy Development Team.
      Last updated on Aug 04, 2013.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>