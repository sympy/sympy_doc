
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>sympy.integrals.intpoly &#8212; SymPy 1.1.2.dev documentation</title>
    <link rel="stylesheet" href="../../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="http://live.sympy.org/static/live-core.css" type="text/css" />
    <link rel="stylesheet" href="http://live.sympy.org/static/live-autocomplete.css" type="text/css" />
    <link rel="stylesheet" href="http://live.sympy.org/static/live-sphinx.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '1.1.2.dev',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML-full"></script>
    <script type="text/javascript" src="http://live.sympy.org/static/utilities.js"></script>
    <script type="text/javascript" src="http://live.sympy.org/static/external/classy.js"></script>
    <script type="text/javascript" src="http://live.sympy.org/static/live-core.js"></script>
    <script type="text/javascript" src="http://live.sympy.org/static/live-autocomplete.js"></script>
    <script type="text/javascript" src="http://live.sympy.org/static/live-sphinx.js"></script>
    <link rel="shortcut icon" href="../../../_static/sympy-notailtext-favicon.ico"/>
    <link href="http://docs.sympy.org/latest/_modules/sympy/integrals/intpoly.html" rel="canonical" />
    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
  </head>
  <body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">SymPy 1.1.2.dev documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for sympy.integrals.intpoly</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Module to implement integration of uni/bivariate polynomials over</span>
<span class="sd">2D Polytopes and uni/bi/trivariate polynomials over 3D Polytopes.</span>

<span class="sd">Uses evaluation techniques as described in Chin et al. (2015) [1].</span>


<span class="sd">References</span>
<span class="sd">===========</span>
<span class="sd">[1] : Chin, Eric B., Jean B. Lasserre, and N. Sukumar. &quot;Numerical integration</span>
<span class="sd">of homogeneous functions on convex and nonconvex polygons and polyhedra.&quot;</span>
<span class="sd">Computational Mechanics 56.6 (2015): 967-981</span>

<span class="sd">PDF link : http://dilbert.engr.ucdavis.edu/~suku/quadrature/cls-integration.pdf</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">print_function</span><span class="p">,</span> <span class="n">division</span>

<span class="kn">from</span> <span class="nn">functools</span> <span class="k">import</span> <span class="n">cmp_to_key</span>

<span class="kn">from</span> <span class="nn">sympy.core</span> <span class="k">import</span> <span class="n">S</span><span class="p">,</span> <span class="n">diff</span><span class="p">,</span> <span class="n">Expr</span><span class="p">,</span> <span class="n">Symbol</span>
<span class="kn">from</span> <span class="nn">sympy.simplify.simplify</span> <span class="k">import</span> <span class="n">nsimplify</span>
<span class="kn">from</span> <span class="nn">sympy.geometry</span> <span class="k">import</span> <span class="n">Segment2D</span><span class="p">,</span> <span class="n">Polygon</span><span class="p">,</span> <span class="n">Point</span><span class="p">,</span> <span class="n">Point2D</span>
<span class="kn">from</span> <span class="nn">sympy.abc</span> <span class="k">import</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span>

<span class="kn">from</span> <span class="nn">sympy.polys.polytools</span> <span class="k">import</span> <span class="n">LC</span><span class="p">,</span> <span class="n">gcd_list</span><span class="p">,</span> <span class="n">degree_list</span>


<div class="viewcode-block" id="polytope_integrate"><a class="viewcode-back" href="../../../modules/integrals/integrals.html#sympy.integrals.intpoly.polytope_integrate">[docs]</a><span class="k">def</span> <span class="nf">polytope_integrate</span><span class="p">(</span><span class="n">poly</span><span class="p">,</span> <span class="n">expr</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Integrates polynomials over 2/3-Polytopes.</span>

<span class="sd">    This function accepts the polytope in `poly` and the function in `expr`</span>
<span class="sd">    (uni/bi/trivariate polynomials are implemented) and returns</span>
<span class="sd">    the exact integral of `expr` over `poly`.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ==========</span>

<span class="sd">    poly : The input Polygon.</span>

<span class="sd">    expr : The input polynomial.</span>

<span class="sd">    clockwise : Binary value to sort input points of 2-Polytope clockwise.(Optional)</span>

<span class="sd">    max_degree : The maximum degree of any monomial of the input polynomial.(Optional)</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.abc import x, y</span>
<span class="sd">    &gt;&gt;&gt; from sympy.geometry.polygon import Polygon</span>
<span class="sd">    &gt;&gt;&gt; from sympy.geometry.point import Point</span>
<span class="sd">    &gt;&gt;&gt; from sympy.integrals.intpoly import polytope_integrate</span>
<span class="sd">    &gt;&gt;&gt; polygon = Polygon(Point(0,0), Point(0,1), Point(1,1), Point(1,0))</span>
<span class="sd">    &gt;&gt;&gt; polys = [1, x, y, x*y, x**2*y, x*y**2]</span>
<span class="sd">    &gt;&gt;&gt; expr = x*y</span>
<span class="sd">    &gt;&gt;&gt; polytope_integrate(polygon, expr)</span>
<span class="sd">    1/4</span>
<span class="sd">    &gt;&gt;&gt; polytope_integrate(polygon, polys, max_degree=3)</span>
<span class="sd">    {1: 1, x: 1/2, y: 1/2, x*y: 1/4, x*y**2: 1/6, x**2*y: 1/6}</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">clockwise</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;clockwise&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">max_degree</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;max_degree&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">clockwise</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">poly</span><span class="p">,</span> <span class="n">Polygon</span><span class="p">):</span>
            <span class="n">poly</span> <span class="o">=</span> <span class="n">point_sort</span><span class="p">(</span><span class="n">poly</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;clockwise=True works for only 2-Polytope&quot;</span>
                            <span class="s2">&quot;V-representation input&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">poly</span><span class="p">,</span> <span class="n">Polygon</span><span class="p">):</span>
        <span class="c1"># For Vertex Representation(2D case)</span>
        <span class="n">hp_params</span> <span class="o">=</span> <span class="n">hyperplane_parameters</span><span class="p">(</span><span class="n">poly</span><span class="p">)</span>
        <span class="n">facets</span> <span class="o">=</span> <span class="n">poly</span><span class="o">.</span><span class="n">sides</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">poly</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="c1"># For Hyperplane Representation(2D case)</span>
        <span class="n">plen</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">poly</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">poly</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">intersections</span> <span class="o">=</span> <span class="p">[</span><span class="n">intersection</span><span class="p">(</span><span class="n">poly</span><span class="p">[(</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">plen</span><span class="p">],</span> <span class="n">poly</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                                          <span class="s2">&quot;plane2D&quot;</span><span class="p">)</span>
                             <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">plen</span><span class="p">)]</span>
            <span class="n">hp_params</span> <span class="o">=</span> <span class="n">poly</span>
            <span class="n">lints</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">intersections</span><span class="p">)</span>
            <span class="n">facets</span> <span class="o">=</span> <span class="p">[</span><span class="n">Segment2D</span><span class="p">(</span><span class="n">intersections</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                                <span class="n">intersections</span><span class="p">[(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">lints</span><span class="p">])</span>
                      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">lints</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Integration for H-representation 3D&quot;</span>
                                      <span class="s2">&quot;case not implemented yet.&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># For Vertex Representation(3D case)</span>
        <span class="n">vertices</span> <span class="o">=</span> <span class="n">poly</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">facets</span> <span class="o">=</span> <span class="n">poly</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="n">hp_params</span> <span class="o">=</span> <span class="n">hyperplane_parameters</span><span class="p">(</span><span class="n">facets</span><span class="p">,</span> <span class="n">vertices</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">max_degree</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">expr</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Input expression be must&#39;</span>
                                <span class="s1">&#39;be a valid SymPy expression&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">main_integrate3d</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">facets</span><span class="p">,</span> <span class="n">vertices</span><span class="p">,</span> <span class="n">hp_params</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">max_degree</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="n">expr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Input polynomials must be list of expressions&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">hp_params</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">result_dict</span> <span class="o">=</span> <span class="n">main_integrate3d</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">facets</span><span class="p">,</span> <span class="n">vertices</span><span class="p">,</span> <span class="n">hp_params</span><span class="p">,</span>
                                           <span class="n">max_degree</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">result_dict</span> <span class="o">=</span> <span class="n">main_integrate</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">facets</span><span class="p">,</span> <span class="n">hp_params</span><span class="p">,</span> <span class="n">max_degree</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">expr</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">result_dict</span>

        <span class="k">for</span> <span class="n">poly</span> <span class="ow">in</span> <span class="n">expr</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">poly</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">poly</span> <span class="ow">is</span> <span class="n">S</span><span class="o">.</span><span class="n">Zero</span><span class="p">:</span>
                    <span class="n">result</span><span class="p">[</span><span class="n">S</span><span class="o">.</span><span class="n">Zero</span><span class="p">]</span> <span class="o">=</span> <span class="n">S</span><span class="o">.</span><span class="n">Zero</span>
                    <span class="k">continue</span>
                <span class="n">integral_value</span> <span class="o">=</span> <span class="n">S</span><span class="o">.</span><span class="n">Zero</span>
                <span class="n">monoms</span> <span class="o">=</span> <span class="n">decompose</span><span class="p">(</span><span class="n">poly</span><span class="p">,</span> <span class="n">separate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">monom</span> <span class="ow">in</span> <span class="n">monoms</span><span class="p">:</span>
                    <span class="n">monom</span> <span class="o">=</span> <span class="n">nsimplify</span><span class="p">(</span><span class="n">monom</span><span class="p">)</span>
                    <span class="n">coeff</span><span class="p">,</span> <span class="n">m</span> <span class="o">=</span> <span class="n">strip</span><span class="p">(</span><span class="n">monom</span><span class="p">)</span>
                    <span class="n">integral_value</span> <span class="o">+=</span> <span class="n">result_dict</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">*</span> <span class="n">coeff</span>
                <span class="n">result</span><span class="p">[</span><span class="n">poly</span><span class="p">]</span> <span class="o">=</span> <span class="n">integral_value</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">if</span> <span class="n">expr</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Input expression be must&#39;</span>
                        <span class="s1">&#39;be a valid SymPy expression&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">main_integrate</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">facets</span><span class="p">,</span> <span class="n">hp_params</span><span class="p">)</span></div>


<span class="k">def</span> <span class="nf">strip</span><span class="p">(</span><span class="n">monom</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">monom</span> <span class="o">==</span> <span class="n">S</span><span class="o">.</span><span class="n">Zero</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
    <span class="k">elif</span> <span class="n">monom</span><span class="o">.</span><span class="n">is_number</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">monom</span><span class="p">,</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">coeff</span> <span class="o">=</span> <span class="n">LC</span><span class="p">(</span><span class="n">monom</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">coeff</span><span class="p">,</span> <span class="n">S</span><span class="p">(</span><span class="n">monom</span><span class="p">)</span> <span class="o">/</span> <span class="n">coeff</span>


<span class="k">def</span> <span class="nf">main_integrate3d</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">facets</span><span class="p">,</span> <span class="n">vertices</span><span class="p">,</span> <span class="n">hp_params</span><span class="p">,</span> <span class="n">max_degree</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function to translate the problem of integrating uni/bi/tri-variate</span>
<span class="sd">    polynomials over a 3-Polytope to integrating over its faces.</span>
<span class="sd">    This is done using Generalized Stokes&#39; Theorem and Euler&#39;s Theorem.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ===========</span>

<span class="sd">    expr : The input polynomial</span>
<span class="sd">    facets : Faces of the 3-Polytope(expressed as indices of `vertices`)</span>
<span class="sd">    vertices : Vertices that constitute the Polytope</span>
<span class="sd">    hp_params : Hyperplane Parameters of the facets</span>

<span class="sd">    Optional Parameters</span>
<span class="sd">    -------------------</span>
<span class="sd">    max_degree : Max degree of constituent monomial in given list of polynomial</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.abc import x, y</span>
<span class="sd">    &gt;&gt;&gt; from sympy.integrals.intpoly import main_integrate3d, \</span>
<span class="sd">    hyperplane_parameters</span>
<span class="sd">    &gt;&gt;&gt; cube = [[(0, 0, 0), (0, 0, 5), (0, 5, 0), (0, 5, 5), (5, 0, 0),\</span>
<span class="sd">                (5, 0, 5), (5, 5, 0), (5, 5, 5)],\</span>
<span class="sd">                [2, 6, 7, 3], [3, 7, 5, 1], [7, 6, 4, 5], [1, 5, 4, 0],\</span>
<span class="sd">                [3, 1, 0, 2], [0, 4, 6, 2]]</span>
<span class="sd">    &gt;&gt;&gt; vertices = cube[0]</span>
<span class="sd">    &gt;&gt;&gt; faces = cube[1:]</span>
<span class="sd">    &gt;&gt;&gt; hp_params = hyperplane_parameters(faces, vertices)</span>
<span class="sd">    &gt;&gt;&gt; main_integrate3d(1, faces, vertices, hp_params)</span>
<span class="sd">    -125</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">dims</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>
    <span class="n">dim_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dims</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">max_degree</span><span class="p">:</span>
        <span class="n">grad_terms</span> <span class="o">=</span> <span class="n">gradient_terms</span><span class="p">(</span><span class="n">max_degree</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">flat_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">term</span> <span class="k">for</span> <span class="n">z_terms</span> <span class="ow">in</span> <span class="n">grad_terms</span>
                     <span class="k">for</span> <span class="n">x_term</span> <span class="ow">in</span> <span class="n">z_terms</span>
                     <span class="k">for</span> <span class="n">term</span> <span class="ow">in</span> <span class="n">x_term</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">term</span> <span class="ow">in</span> <span class="n">flat_list</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="n">term</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">for</span> <span class="n">facet_count</span><span class="p">,</span> <span class="n">hp</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">hp_params</span><span class="p">):</span>
            <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">hp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">hp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">x0</span> <span class="o">=</span> <span class="n">vertices</span><span class="p">[</span><span class="n">facets</span><span class="p">[</span><span class="n">facet_count</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>

            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">monom</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">flat_list</span><span class="p">):</span>
                <span class="c1">#  Every monomial is a tuple :</span>
                <span class="c1">#  (term, x_degree, y_degree, z_degree, value over boundary)</span>
                <span class="n">expr</span><span class="p">,</span> <span class="n">x_d</span><span class="p">,</span> <span class="n">y_d</span><span class="p">,</span> <span class="n">z_d</span><span class="p">,</span> <span class="n">z_index</span><span class="p">,</span> <span class="n">y_index</span><span class="p">,</span> <span class="n">x_index</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">monom</span>
                <span class="n">degree</span> <span class="o">=</span> <span class="n">x_d</span> <span class="o">+</span> <span class="n">y_d</span> <span class="o">+</span> <span class="n">z_d</span>
                <span class="k">if</span> <span class="n">b</span> <span class="ow">is</span> <span class="n">S</span><span class="o">.</span><span class="n">Zero</span><span class="p">:</span>
                    <span class="n">value_over_face</span> <span class="o">=</span> <span class="n">S</span><span class="o">.</span><span class="n">Zero</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">value_over_face</span> <span class="o">=</span> \
                        <span class="n">integration_reduction_dynamic</span><span class="p">(</span><span class="n">facets</span><span class="p">,</span> <span class="n">facet_count</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span>
                                                      <span class="n">b</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">degree</span><span class="p">,</span> <span class="n">dims</span><span class="p">,</span>
                                                      <span class="n">x_index</span><span class="p">,</span> <span class="n">y_index</span><span class="p">,</span>
                                                      <span class="n">z_index</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">grad_terms</span><span class="p">,</span>
                                                      <span class="n">i</span><span class="p">,</span> <span class="n">vertices</span><span class="p">,</span> <span class="n">hp</span><span class="p">)</span>
                <span class="n">monom</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="n">value_over_face</span>
                <span class="n">result</span><span class="p">[</span><span class="n">expr</span><span class="p">]</span> <span class="o">+=</span> <span class="n">value_over_face</span> <span class="o">*</span> \
                    <span class="p">(</span><span class="n">b</span> <span class="o">/</span> <span class="n">norm</span><span class="p">(</span><span class="n">a</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">dim_length</span> <span class="o">+</span> <span class="n">x_d</span> <span class="o">+</span> <span class="n">y_d</span> <span class="o">+</span> <span class="n">z_d</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">integral_value</span> <span class="o">=</span> <span class="n">S</span><span class="o">.</span><span class="n">Zero</span>
        <span class="n">polynomials</span> <span class="o">=</span> <span class="n">decompose</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">deg</span> <span class="ow">in</span> <span class="n">polynomials</span><span class="p">:</span>
            <span class="n">poly_contribute</span> <span class="o">=</span> <span class="n">S</span><span class="o">.</span><span class="n">Zero</span>
            <span class="n">facet_count</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">facet</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">facets</span><span class="p">):</span>
                <span class="n">hp</span> <span class="o">=</span> <span class="n">hp_params</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">hp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">S</span><span class="o">.</span><span class="n">Zero</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">pi</span> <span class="o">=</span> <span class="n">polygon_integrate</span><span class="p">(</span><span class="n">facet</span><span class="p">,</span> <span class="n">hp</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">facets</span><span class="p">,</span> <span class="n">vertices</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">deg</span><span class="p">)</span>
                <span class="n">poly_contribute</span> <span class="o">+=</span> <span class="n">pi</span> <span class="o">*</span>\
                    <span class="p">(</span><span class="n">hp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">norm</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">hp</span><span class="p">[</span><span class="mi">0</span><span class="p">])))</span>
                <span class="n">facet_count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">poly_contribute</span> <span class="o">/=</span> <span class="p">(</span><span class="n">dim_length</span> <span class="o">+</span> <span class="n">deg</span><span class="p">)</span>
            <span class="n">integral_value</span> <span class="o">+=</span> <span class="n">poly_contribute</span>
    <span class="k">return</span> <span class="n">integral_value</span>


<span class="k">def</span> <span class="nf">main_integrate</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">facets</span><span class="p">,</span> <span class="n">hp_params</span><span class="p">,</span> <span class="n">max_degree</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function to translate the problem of integrating univariate/bivariate</span>
<span class="sd">    polynomials over a 2-Polytope to integrating over its boundary facets.</span>
<span class="sd">    This is done using Generalized Stokes&#39;s Theorem and Euler&#39;s Theorem.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ===========</span>
<span class="sd">    expr : The input polynomial</span>
<span class="sd">    facets : Facets(Line Segments) of the 2-Polytope</span>
<span class="sd">    hp_params : Hyperplane Parameters of the facets</span>

<span class="sd">    Optional Parameters:</span>
<span class="sd">    --------------------</span>
<span class="sd">    max_degree : The maximum degree of any monomial of the input polynomial.</span>

<span class="sd">    &gt;&gt;&gt; from sympy.abc import x, y</span>
<span class="sd">    &gt;&gt;&gt; from sympy.integrals.intpoly import main_integrate,\</span>
<span class="sd">    hyperplane_parameters</span>
<span class="sd">    &gt;&gt;&gt; from sympy.geometry.polygon import Polygon</span>
<span class="sd">    &gt;&gt;&gt; from sympy.geometry.point import Point</span>
<span class="sd">    &gt;&gt;&gt; triangle = Polygon(Point(0, 3), Point(5, 3), Point(1, 1))</span>
<span class="sd">    &gt;&gt;&gt; facets = triangle.sides</span>
<span class="sd">    &gt;&gt;&gt; hp_params = hyperplane_parameters(triangle)</span>
<span class="sd">    &gt;&gt;&gt; main_integrate(x**2 + y**2, facets, hp_params)</span>
<span class="sd">    325/6</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dims</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="n">dim_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dims</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">integral_value</span> <span class="o">=</span> <span class="n">S</span><span class="o">.</span><span class="n">Zero</span>

    <span class="k">if</span> <span class="n">max_degree</span><span class="p">:</span>
        <span class="n">grad_terms</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]]</span> <span class="o">+</span> <span class="n">gradient_terms</span><span class="p">(</span><span class="n">max_degree</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">facet_count</span><span class="p">,</span> <span class="n">hp</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">hp_params</span><span class="p">):</span>
            <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">hp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">hp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">x0</span> <span class="o">=</span> <span class="n">facets</span><span class="p">[</span><span class="n">facet_count</span><span class="p">]</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">monom</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">grad_terms</span><span class="p">):</span>
                <span class="c1">#  Every monomial is a tuple :</span>
                <span class="c1">#  (term, x_degree, y_degree, value over boundary)</span>
                <span class="n">m</span><span class="p">,</span> <span class="n">x_d</span><span class="p">,</span> <span class="n">y_d</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">monom</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="n">degree</span> <span class="o">=</span> <span class="n">S</span><span class="o">.</span><span class="n">Zero</span>
                <span class="k">if</span> <span class="n">b</span> <span class="ow">is</span> <span class="n">S</span><span class="o">.</span><span class="n">Zero</span><span class="p">:</span>
                    <span class="n">value_over_boundary</span> <span class="o">=</span> <span class="n">S</span><span class="o">.</span><span class="n">Zero</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">degree</span> <span class="o">=</span> <span class="n">x_d</span> <span class="o">+</span> <span class="n">y_d</span>
                    <span class="n">value_over_boundary</span> <span class="o">=</span> \
                        <span class="n">integration_reduction_dynamic</span><span class="p">(</span><span class="n">facets</span><span class="p">,</span> <span class="n">facet_count</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span>
                                                      <span class="n">b</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">degree</span><span class="p">,</span> <span class="n">dims</span><span class="p">,</span> <span class="n">x_d</span><span class="p">,</span>
                                                      <span class="n">y_d</span><span class="p">,</span> <span class="n">max_degree</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span>
                                                      <span class="n">grad_terms</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
                <span class="n">monom</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">value_over_boundary</span>
                <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">result</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">+=</span> <span class="n">value_over_boundary</span> <span class="o">*</span> \
                                        <span class="p">(</span><span class="n">b</span> <span class="o">/</span> <span class="n">norm</span><span class="p">(</span><span class="n">a</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">dim_length</span> <span class="o">+</span> <span class="n">degree</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">result</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="n">value_over_boundary</span> <span class="o">*</span> \
                                <span class="p">(</span><span class="n">b</span> <span class="o">/</span> <span class="n">norm</span><span class="p">(</span><span class="n">a</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">dim_length</span> <span class="o">+</span> <span class="n">degree</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">polynomials</span> <span class="o">=</span> <span class="n">decompose</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">deg</span> <span class="ow">in</span> <span class="n">polynomials</span><span class="p">:</span>
            <span class="n">poly_contribute</span> <span class="o">=</span> <span class="n">S</span><span class="o">.</span><span class="n">Zero</span>
            <span class="n">facet_count</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">hp</span> <span class="ow">in</span> <span class="n">hp_params</span><span class="p">:</span>
                <span class="n">value_over_boundary</span> <span class="o">=</span> <span class="n">integration_reduction</span><span class="p">(</span><span class="n">facets</span><span class="p">,</span>
                                                            <span class="n">facet_count</span><span class="p">,</span>
                                                            <span class="n">hp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">hp</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                                            <span class="n">polynomials</span><span class="p">[</span><span class="n">deg</span><span class="p">],</span>
                                                            <span class="n">dims</span><span class="p">,</span> <span class="n">deg</span><span class="p">)</span>
                <span class="n">poly_contribute</span> <span class="o">+=</span> <span class="n">value_over_boundary</span> <span class="o">*</span> <span class="p">(</span><span class="n">hp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">norm</span><span class="p">(</span><span class="n">hp</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                <span class="n">facet_count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">poly_contribute</span> <span class="o">/=</span> <span class="p">(</span><span class="n">dim_length</span> <span class="o">+</span> <span class="n">deg</span><span class="p">)</span>
            <span class="n">integral_value</span> <span class="o">+=</span> <span class="n">poly_contribute</span>
    <span class="k">return</span> <span class="n">integral_value</span>


<span class="k">def</span> <span class="nf">polygon_integrate</span><span class="p">(</span><span class="n">facet</span><span class="p">,</span> <span class="n">hp_param</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">facets</span><span class="p">,</span> <span class="n">vertices</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">degree</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Helper function to integrate the input uni/bi/trivariate polynomial</span>
<span class="sd">    over a certain face of the 3-Polytope.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ===========</span>

<span class="sd">    facet : Particular face of the 3-Polytope over which `expr` is integrated</span>
<span class="sd">    index : The index of `facet` in `facets`</span>
<span class="sd">    facets : Faces of the 3-Polytope(expressed as indices of `vertices`)</span>
<span class="sd">    vertices : Vertices that constitute the facet</span>
<span class="sd">    expr : The input polynomial</span>
<span class="sd">    degree : Degree of `expr`</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.abc import x, y</span>
<span class="sd">    &gt;&gt;&gt; from sympy.integrals.intpoly import polygon_integrate</span>
<span class="sd">    &gt;&gt;&gt; cube = [[(0, 0, 0), (0, 0, 5), (0, 5, 0), (0, 5, 5), (5, 0, 0),\</span>
<span class="sd">                 (5, 0, 5), (5, 5, 0), (5, 5, 5)],\</span>
<span class="sd">                 [2, 6, 7, 3], [3, 7, 5, 1], [7, 6, 4, 5], [1, 5, 4, 0],\</span>
<span class="sd">                 [3, 1, 0, 2], [0, 4, 6, 2]]</span>
<span class="sd">    &gt;&gt;&gt; facet = cube[1]</span>
<span class="sd">    &gt;&gt;&gt; facets = cube[1:]</span>
<span class="sd">    &gt;&gt;&gt; vertices = cube[0]</span>
<span class="sd">    &gt;&gt;&gt; polygon_integrate(facet, [(0, 1, 0), 5], 0, facets, vertices, 1, 0)</span>
<span class="sd">    -25</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">expr</span> <span class="o">=</span> <span class="n">S</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">expr</span> <span class="o">==</span> <span class="n">S</span><span class="o">.</span><span class="n">Zero</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">S</span><span class="o">.</span><span class="n">Zero</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">S</span><span class="o">.</span><span class="n">Zero</span>
    <span class="n">x0</span> <span class="o">=</span> <span class="n">vertices</span><span class="p">[</span><span class="n">facet</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">facet</span><span class="p">)):</span>
        <span class="n">side</span> <span class="o">=</span> <span class="p">(</span><span class="n">vertices</span><span class="p">[</span><span class="n">facet</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span> <span class="n">vertices</span><span class="p">[</span><span class="n">facet</span><span class="p">[(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">facet</span><span class="p">)]])</span>
        <span class="n">result</span> <span class="o">+=</span> <span class="n">distance_to_side</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">side</span><span class="p">,</span> <span class="n">hp_param</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span>\
            <span class="n">lineseg_integrate</span><span class="p">(</span><span class="n">facet</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">side</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">degree</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">expr</span><span class="o">.</span><span class="n">is_number</span><span class="p">:</span>
        <span class="n">expr</span> <span class="o">=</span> <span class="n">diff</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="n">x0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">diff</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="o">*</span> <span class="n">x0</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span>\
            <span class="n">diff</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span> <span class="o">*</span> <span class="n">x0</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">result</span> <span class="o">+=</span> <span class="n">polygon_integrate</span><span class="p">(</span><span class="n">facet</span><span class="p">,</span> <span class="n">hp_param</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">facets</span><span class="p">,</span> <span class="n">vertices</span><span class="p">,</span>
                                    <span class="n">expr</span><span class="p">,</span> <span class="n">degree</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">/=</span> <span class="p">(</span><span class="n">degree</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>


<span class="k">def</span> <span class="nf">distance_to_side</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">line_seg</span><span class="p">,</span> <span class="n">A</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Helper function to compute the signed distance between given 3D point</span>
<span class="sd">    and a line segment.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ===========</span>

<span class="sd">    point : 3D Point</span>
<span class="sd">    line_seg : Line Segment</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.integrals.intpoly import distance_to_side</span>
<span class="sd">    &gt;&gt;&gt; point = (0, 0, 0)</span>
<span class="sd">    &gt;&gt;&gt; distance_to_side(point, [(0, 0, 1), (0, 1, 0)], (1, 0, 0))</span>
<span class="sd">    -sqrt(2)/2</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span> <span class="o">=</span> <span class="n">line_seg</span>
    <span class="n">rev_normal</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">S</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">/</span><span class="n">norm</span><span class="p">(</span><span class="n">A</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">A</span><span class="p">]</span>
    <span class="n">vector</span> <span class="o">=</span> <span class="p">[</span><span class="n">x2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">x1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)]</span>
    <span class="n">vector</span> <span class="o">=</span> <span class="p">[</span><span class="n">vector</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="n">norm</span><span class="p">(</span><span class="n">vector</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)]</span>

    <span class="n">n_side</span> <span class="o">=</span> <span class="n">cross_product</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">rev_normal</span><span class="p">,</span> <span class="n">vector</span><span class="p">)</span>
    <span class="n">vectorx0</span> <span class="o">=</span> <span class="p">[</span><span class="n">line_seg</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">point</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)]</span>
    <span class="n">dot_product</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">vectorx0</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_side</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)])</span>

    <span class="k">return</span> <span class="n">dot_product</span>


<span class="k">def</span> <span class="nf">lineseg_integrate</span><span class="p">(</span><span class="n">polygon</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">line_seg</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">degree</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Helper function to compute the line integral of `expr` over `line_seg`</span>

<span class="sd">    Parameters</span>
<span class="sd">    ===========</span>

<span class="sd">    polygon : Face of a 3-Polytope</span>
<span class="sd">    index : index of line_seg in polygon</span>
<span class="sd">    line_seg : Line Segment</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.integrals.intpoly import lineseg_integrate</span>
<span class="sd">    &gt;&gt;&gt; polygon = [(0, 5, 0), (5, 5, 0), (5, 5, 5), (0, 5, 5)]</span>
<span class="sd">    &gt;&gt;&gt; line_seg = [(0, 5, 0), (5, 5, 0)]</span>
<span class="sd">    &gt;&gt;&gt; lineseg_integrate(polygon, 0, line_seg, 1, 0)</span>
<span class="sd">    5</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">expr</span> <span class="o">==</span> <span class="n">S</span><span class="o">.</span><span class="n">Zero</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">S</span><span class="o">.</span><span class="n">Zero</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">S</span><span class="o">.</span><span class="n">Zero</span>
    <span class="n">x0</span> <span class="o">=</span> <span class="n">line_seg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">distance</span> <span class="o">=</span> <span class="n">norm</span><span class="p">(</span><span class="nb">tuple</span><span class="p">([</span><span class="n">line_seg</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">line_seg</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span>
                           <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)]))</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">Expr</span><span class="p">):</span>
        <span class="n">expr_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">x</span><span class="p">:</span> <span class="n">line_seg</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                     <span class="n">y</span><span class="p">:</span> <span class="n">line_seg</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
                     <span class="n">z</span><span class="p">:</span> <span class="n">line_seg</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]}</span>
        <span class="n">result</span> <span class="o">+=</span> <span class="n">distance</span> <span class="o">*</span> <span class="n">expr</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">expr_dict</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">+=</span> <span class="n">distance</span> <span class="o">*</span> <span class="n">expr</span>

    <span class="n">expr</span> <span class="o">=</span> <span class="n">diff</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="n">x0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">diff</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="o">*</span> <span class="n">x0</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span>\
        <span class="n">diff</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span> <span class="o">*</span> <span class="n">x0</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

    <span class="n">result</span> <span class="o">+=</span> <span class="n">lineseg_integrate</span><span class="p">(</span><span class="n">polygon</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">line_seg</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">degree</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">/=</span> <span class="p">(</span><span class="n">degree</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>


<span class="k">def</span> <span class="nf">integration_reduction</span><span class="p">(</span><span class="n">facets</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">dims</span><span class="p">,</span> <span class="n">degree</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Helper method for main_integrate. Returns the value of the input</span>
<span class="sd">    expression evaluated over the polytope facet referenced by a given index.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ===========</span>

<span class="sd">    facets : List of facets of the polytope.</span>
<span class="sd">    index : Index referencing the facet to integrate the expression over.</span>
<span class="sd">    a : Hyperplane parameter denoting direction.</span>
<span class="sd">    b : Hyperplane parameter denoting distance.</span>
<span class="sd">    expr : The expression to integrate over the facet.</span>
<span class="sd">    dims : List of symbols denoting axes.</span>
<span class="sd">    degree : Degree of the homogeneous polynomial.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.abc import x, y</span>
<span class="sd">    &gt;&gt;&gt; from sympy.integrals.intpoly import integration_reduction,\</span>
<span class="sd">    hyperplane_parameters</span>
<span class="sd">    &gt;&gt;&gt; from sympy.geometry.point import Point</span>
<span class="sd">    &gt;&gt;&gt; from sympy.geometry.polygon import Polygon</span>
<span class="sd">    &gt;&gt;&gt; triangle = Polygon(Point(0, 3), Point(5, 3), Point(1, 1))</span>
<span class="sd">    &gt;&gt;&gt; facets = triangle.sides</span>
<span class="sd">    &gt;&gt;&gt; a, b = hyperplane_parameters(triangle)[0]</span>
<span class="sd">    &gt;&gt;&gt; integration_reduction(facets, 0, a, b, 1, (x, y), 0)</span>
<span class="sd">    5</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">expr</span> <span class="o">==</span> <span class="n">S</span><span class="o">.</span><span class="n">Zero</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">expr</span>

    <span class="n">value</span> <span class="o">=</span> <span class="n">S</span><span class="o">.</span><span class="n">Zero</span>
    <span class="n">x0</span> <span class="o">=</span> <span class="n">facets</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">m</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">facets</span><span class="p">)</span>
    <span class="n">gens</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

    <span class="n">inner_product</span> <span class="o">=</span> <span class="n">diff</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">gens</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="n">x0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">diff</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">gens</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">x0</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">inner_product</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">value</span> <span class="o">+=</span> <span class="n">integration_reduction</span><span class="p">(</span><span class="n">facets</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span>
                                       <span class="n">inner_product</span><span class="p">,</span> <span class="n">dims</span><span class="p">,</span> <span class="n">degree</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

    <span class="n">value</span> <span class="o">+=</span> <span class="n">left_integral2D</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">facets</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">gens</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">value</span><span class="o">/</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dims</span><span class="p">)</span> <span class="o">+</span> <span class="n">degree</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">left_integral2D</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">facets</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">gens</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Computes the left integral of Eq 10 in Chin et al.</span>
<span class="sd">    For the 2D case, the integral is just an evaluation of the polynomial</span>
<span class="sd">    at the intersection of two facets which is multiplied by the distance</span>
<span class="sd">    between the first point of facet and that intersection.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ===========</span>

<span class="sd">    m : No. of hyperplanes.</span>
<span class="sd">    index : Index of facet to find intersections with.</span>
<span class="sd">    facets : List of facets(Line Segments in 2D case).</span>
<span class="sd">    x0 : First point on facet referenced by index.</span>
<span class="sd">    expr : Input polynomial</span>
<span class="sd">    gens : Generators which generate the polynomial</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.abc import x, y</span>
<span class="sd">    &gt;&gt;&gt; from sympy.integrals.intpoly import left_integral2D</span>
<span class="sd">    &gt;&gt;&gt; from sympy.geometry.point import Point</span>
<span class="sd">    &gt;&gt;&gt; from sympy.geometry.polygon import Polygon</span>
<span class="sd">    &gt;&gt;&gt; triangle = Polygon(Point(0, 3), Point(5, 3), Point(1, 1))</span>
<span class="sd">    &gt;&gt;&gt; facets = triangle.sides</span>
<span class="sd">    &gt;&gt;&gt; left_integral2D(3, 0, facets, facets[0].points[0], 1, (x, y))</span>
<span class="sd">    5</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">S</span><span class="o">.</span><span class="n">Zero</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
        <span class="n">intersect</span> <span class="o">=</span> <span class="p">()</span>
        <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="p">(</span><span class="n">index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">m</span> <span class="ow">or</span> <span class="n">j</span> <span class="o">==</span> <span class="p">(</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">m</span><span class="p">:</span>
            <span class="n">intersect</span> <span class="o">=</span> <span class="n">intersection</span><span class="p">(</span><span class="n">facets</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">facets</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="s2">&quot;segment2D&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">intersect</span><span class="p">:</span>
            <span class="n">distance_origin</span> <span class="o">=</span> <span class="n">norm</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">x</span> <span class="o">-</span> <span class="n">y</span><span class="p">,</span>
                                             <span class="n">intersect</span><span class="p">,</span> <span class="n">x0</span><span class="p">)))</span>
            <span class="k">if</span> <span class="n">is_vertex</span><span class="p">(</span><span class="n">intersect</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">Expr</span><span class="p">):</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">gens</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                        <span class="n">expr_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">gens</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">intersect</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                     <span class="n">gens</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">intersect</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                     <span class="n">gens</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">intersect</span><span class="p">[</span><span class="mi">2</span><span class="p">]}</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">expr_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">gens</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">intersect</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                     <span class="n">gens</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">intersect</span><span class="p">[</span><span class="mi">1</span><span class="p">]}</span>
                    <span class="n">value</span> <span class="o">+=</span> <span class="n">distance_origin</span> <span class="o">*</span> <span class="n">expr</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">expr_dict</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">+=</span> <span class="n">distance_origin</span> <span class="o">*</span> <span class="n">expr</span>
    <span class="k">return</span> <span class="n">value</span>


<span class="k">def</span> <span class="nf">integration_reduction_dynamic</span><span class="p">(</span><span class="n">facets</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">degree</span><span class="p">,</span> <span class="n">dims</span><span class="p">,</span>
                                  <span class="n">x_index</span><span class="p">,</span> <span class="n">y_index</span><span class="p">,</span> <span class="n">max_index</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span>
                                  <span class="n">monomial_values</span><span class="p">,</span> <span class="n">monom_index</span><span class="p">,</span> <span class="n">vertices</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                  <span class="n">hp_param</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;The same integration_reduction function which uses a dynamic</span>
<span class="sd">    programming approach to compute terms by using the values of the integral</span>
<span class="sd">    of previously computed terms.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ===========</span>

<span class="sd">    facets : Facets of the Polytope</span>
<span class="sd">    index : Index of facet to find intersections with.(Used in left_integral())</span>
<span class="sd">    a, b : Hyperplane parameters</span>
<span class="sd">    expr : Input monomial</span>
<span class="sd">    degree : Total degree of `expr`</span>
<span class="sd">    dims : Tuple denoting axes variables</span>
<span class="sd">    x_index : Exponent of &#39;x&#39; in expr</span>
<span class="sd">    y_index : Exponent of &#39;y&#39; in expr</span>
<span class="sd">    max_index : Maximum exponent of any monomial in monomial_values</span>
<span class="sd">    x0 : First point on facets[index]</span>
<span class="sd">    monomial_values : List of monomial values constituting the polynomial</span>
<span class="sd">    monom_index : Index of monomial whose integration is being found.</span>

<span class="sd">    Optional Parameters</span>
<span class="sd">    -------------------</span>
<span class="sd">    vertices : Coordinates of vertices constituting the 3-Polytope</span>
<span class="sd">    hp_param : Hyperplane Parameter of the face of the facets[index]</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.abc import x, y</span>
<span class="sd">    &gt;&gt;&gt; from sympy.integrals.intpoly import integration_reduction_dynamic,\</span>
<span class="sd">    hyperplane_parameters, gradient_terms</span>
<span class="sd">    &gt;&gt;&gt; from sympy.geometry.point import Point</span>
<span class="sd">    &gt;&gt;&gt; from sympy.geometry.polygon import Polygon</span>
<span class="sd">    &gt;&gt;&gt; triangle = Polygon(Point(0, 3), Point(5, 3), Point(1, 1))</span>
<span class="sd">    &gt;&gt;&gt; facets = triangle.sides</span>
<span class="sd">    &gt;&gt;&gt; a, b = hyperplane_parameters(triangle)[0]</span>
<span class="sd">    &gt;&gt;&gt; x0 = facets[0].points[0]</span>
<span class="sd">    &gt;&gt;&gt; monomial_values = [[0, 0, 0, 0], [1, 0, 0, 5],\</span>
<span class="sd">                           [y, 0, 1, 15], [x, 1, 0, None]]</span>
<span class="sd">    &gt;&gt;&gt; integration_reduction_dynamic(facets, 0, a, b, x, 1, (x, y), 1, 0, 1,\</span>
<span class="sd">                                      x0, monomial_values, 3)</span>
<span class="sd">    25/2</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">S</span><span class="o">.</span><span class="n">Zero</span>
    <span class="n">m</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">facets</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">expr</span> <span class="o">==</span> <span class="n">S</span><span class="o">.</span><span class="n">Zero</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">expr</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dims</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">expr</span><span class="o">.</span><span class="n">is_number</span><span class="p">:</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">x_degree</span><span class="p">,</span> <span class="n">y_degree</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">monomial_values</span><span class="p">[</span><span class="n">monom_index</span><span class="p">]</span>
            <span class="n">x_index</span> <span class="o">=</span> <span class="n">monom_index</span> <span class="o">-</span> <span class="n">max_index</span> <span class="o">+</span> \
                <span class="n">x_index</span> <span class="o">-</span> <span class="mi">2</span> <span class="k">if</span> <span class="n">x_degree</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
            <span class="n">y_index</span> <span class="o">=</span> <span class="n">monom_index</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">y_degree</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
            <span class="n">x_value</span><span class="p">,</span> <span class="n">y_value</span> <span class="o">=</span>\
                <span class="n">monomial_values</span><span class="p">[</span><span class="n">x_index</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="n">monomial_values</span><span class="p">[</span><span class="n">y_index</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>

            <span class="n">value</span> <span class="o">+=</span> <span class="n">x_degree</span> <span class="o">*</span> <span class="n">x_value</span> <span class="o">*</span> <span class="n">x0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">y_degree</span> <span class="o">*</span> <span class="n">y_value</span> <span class="o">*</span> <span class="n">x0</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">value</span> <span class="o">+=</span> <span class="n">left_integral2D</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">facets</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">dims</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># For 3D use case the max_index contains the z_degree of the term</span>
        <span class="n">z_index</span> <span class="o">=</span> <span class="n">max_index</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">expr</span><span class="o">.</span><span class="n">is_number</span><span class="p">:</span>
            <span class="n">x_degree</span><span class="p">,</span> <span class="n">y_degree</span><span class="p">,</span> <span class="n">z_degree</span> <span class="o">=</span> <span class="n">y_index</span><span class="p">,</span>\
                                           <span class="n">z_index</span> <span class="o">-</span> <span class="n">x_index</span> <span class="o">-</span> <span class="n">y_index</span><span class="p">,</span> <span class="n">x_index</span>
            <span class="n">x_value</span> <span class="o">=</span> <span class="n">monomial_values</span><span class="p">[</span><span class="n">z_index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="n">y_index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="n">x_index</span><span class="p">][</span><span class="mi">7</span><span class="p">]</span>\
                <span class="k">if</span> <span class="n">x_degree</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
            <span class="n">y_value</span> <span class="o">=</span> <span class="n">monomial_values</span><span class="p">[</span><span class="n">z_index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="n">y_index</span><span class="p">][</span><span class="n">x_index</span><span class="p">][</span><span class="mi">7</span><span class="p">]</span>\
                <span class="k">if</span> <span class="n">y_degree</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
            <span class="n">z_value</span> <span class="o">=</span> <span class="n">monomial_values</span><span class="p">[</span><span class="n">z_index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="n">y_index</span><span class="p">][</span><span class="n">x_index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">7</span><span class="p">]</span>\
                <span class="k">if</span> <span class="n">z_degree</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>

            <span class="n">value</span> <span class="o">+=</span> <span class="n">x_degree</span> <span class="o">*</span> <span class="n">x_value</span> <span class="o">*</span> <span class="n">x0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">y_degree</span> <span class="o">*</span> <span class="n">y_value</span> <span class="o">*</span> <span class="n">x0</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> \
                <span class="o">+</span> <span class="n">z_degree</span> <span class="o">*</span> <span class="n">z_value</span> <span class="o">*</span> <span class="n">x0</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

        <span class="n">value</span> <span class="o">+=</span> <span class="n">left_integral3D</span><span class="p">(</span><span class="n">facets</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span>
                                 <span class="n">vertices</span><span class="p">,</span> <span class="n">hp_param</span><span class="p">,</span> <span class="n">degree</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">value</span> <span class="o">/</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dims</span><span class="p">)</span> <span class="o">+</span> <span class="n">degree</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">left_integral3D</span><span class="p">(</span><span class="n">facets</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">vertices</span><span class="p">,</span> <span class="n">hp_param</span><span class="p">,</span> <span class="n">degree</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Computes the left integral of Eq 10 in Chin et al.</span>
<span class="sd">    For the 3D case, this is the sum of the integral values over constituting</span>
<span class="sd">    line segments of the face (which is accessed by facets[index]) multiplied</span>
<span class="sd">    by the distance between the first point of facet and that line segment.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ===========</span>
<span class="sd">    facets : List of faces of the 3-Polytope.</span>
<span class="sd">    index : Index of face over which integral is to be calculated.</span>
<span class="sd">    expr : Input polynomial</span>
<span class="sd">    vertices : List of vertices that constitute the 3-Polytope</span>
<span class="sd">    hp_param : The hyperplane parameters of the face</span>
<span class="sd">    degree : Degree of the expr</span>

<span class="sd">    &gt;&gt;&gt; from sympy.abc import x, y</span>
<span class="sd">    &gt;&gt;&gt; from sympy.integrals.intpoly import left_integral3D</span>
<span class="sd">    &gt;&gt;&gt; cube = [[(0, 0, 0), (0, 0, 5), (0, 5, 0), (0, 5, 5), (5, 0, 0),\</span>
<span class="sd">                 (5, 0, 5), (5, 5, 0), (5, 5, 5)],\</span>
<span class="sd">                 [2, 6, 7, 3], [3, 7, 5, 1], [7, 6, 4, 5], [1, 5, 4, 0],\</span>
<span class="sd">                 [3, 1, 0, 2], [0, 4, 6, 2]]</span>
<span class="sd">    &gt;&gt;&gt; facets = cube[1:]</span>
<span class="sd">    &gt;&gt;&gt; vertices = cube[0]</span>
<span class="sd">    &gt;&gt;&gt; left_integral3D(facets, 3, 1, vertices, ([0, -1, 0], -5), 0)</span>
<span class="sd">    -50</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">S</span><span class="o">.</span><span class="n">Zero</span>
    <span class="n">facet</span> <span class="o">=</span> <span class="n">facets</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
    <span class="n">x0</span> <span class="o">=</span> <span class="n">vertices</span><span class="p">[</span><span class="n">facet</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">facet</span><span class="p">)):</span>
        <span class="n">side</span> <span class="o">=</span> <span class="p">(</span><span class="n">vertices</span><span class="p">[</span><span class="n">facet</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span> <span class="n">vertices</span><span class="p">[</span><span class="n">facet</span><span class="p">[(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">facet</span><span class="p">)]])</span>
        <span class="n">value</span> <span class="o">+=</span> <span class="n">distance_to_side</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">side</span><span class="p">,</span> <span class="n">hp_param</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> \
            <span class="n">lineseg_integrate</span><span class="p">(</span><span class="n">facet</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">side</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">degree</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">value</span>


<span class="k">def</span> <span class="nf">gradient_terms</span><span class="p">(</span><span class="n">binomial_power</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">no_of_gens</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns a list of all the possible monomials between</span>
<span class="sd">    0 and y**binomial_power for 2D case and z**binomial_power</span>
<span class="sd">    for 3D case.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ===========</span>

<span class="sd">    binomial_power : Power upto which terms are generated.</span>
<span class="sd">    no_of_gens : Denotes whether terms are being generated for 2D or 3D case.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.abc import x, y</span>
<span class="sd">    &gt;&gt;&gt; from sympy.integrals.intpoly import gradient_terms</span>
<span class="sd">    &gt;&gt;&gt; gradient_terms(2)</span>
<span class="sd">    [[1, 0, 0, 0], [y, 0, 1, 0], [y**2, 0, 2, 0], [x, 1, 0, 0],</span>
<span class="sd">    [x*y, 1, 1, 0], [x**2, 2, 0, 0]]</span>
<span class="sd">    &gt;&gt;&gt; gradient_terms(2, 3)</span>
<span class="sd">    [[[[1, 0, 0, 0, 0, 0, 0, 0]]], [[[y, 0, 1, 0, 1, 0, 0, 0],</span>
<span class="sd">    [z, 0, 0, 1, 1, 0, 1, 0]], [[x, 1, 0, 0, 1, 1, 0, 0]]],</span>
<span class="sd">    [[[y**2, 0, 2, 0, 2, 0, 0, 0], [y*z, 0, 1, 1, 2, 0, 1, 0],</span>
<span class="sd">    [z**2, 0, 0, 2, 2, 0, 2, 0]], [[x*y, 1, 1, 0, 2, 1, 0, 0],</span>
<span class="sd">    [x*z, 1, 0, 1, 2, 1, 1, 0]], [[x**2, 2, 0, 0, 2, 2, 0, 0]]]]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">no_of_gens</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">terms</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="nb">int</span><span class="p">((</span><span class="n">binomial_power</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">binomial_power</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">x_count</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">binomial_power</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">y_count</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">binomial_power</span> <span class="o">-</span> <span class="n">x_count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">terms</span><span class="p">[</span><span class="n">count</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">**</span><span class="n">x_count</span><span class="o">*</span><span class="n">y</span><span class="o">**</span><span class="n">y_count</span><span class="p">,</span>
                                <span class="n">x_count</span><span class="p">,</span> <span class="n">y_count</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
                <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">terms</span> <span class="o">=</span> <span class="p">[[[[</span><span class="n">x</span> <span class="o">**</span> <span class="n">x_count</span> <span class="o">*</span> <span class="n">y</span> <span class="o">**</span> <span class="n">y_count</span> <span class="o">*</span>
                    <span class="n">z</span> <span class="o">**</span> <span class="p">(</span><span class="n">z_count</span> <span class="o">-</span> <span class="n">y_count</span> <span class="o">-</span> <span class="n">x_count</span><span class="p">),</span>
                    <span class="n">x_count</span><span class="p">,</span> <span class="n">y_count</span><span class="p">,</span> <span class="n">z_count</span> <span class="o">-</span> <span class="n">y_count</span> <span class="o">-</span> <span class="n">x_count</span><span class="p">,</span>
                    <span class="n">z_count</span><span class="p">,</span> <span class="n">x_count</span><span class="p">,</span> <span class="n">z_count</span> <span class="o">-</span> <span class="n">y_count</span> <span class="o">-</span> <span class="n">x_count</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
                 <span class="k">for</span> <span class="n">y_count</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">z_count</span> <span class="o">-</span> <span class="n">x_count</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)]</span>
                 <span class="k">for</span> <span class="n">x_count</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">z_count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
                 <span class="k">for</span> <span class="n">z_count</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">binomial_power</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
    <span class="k">return</span> <span class="n">terms</span>


<span class="k">def</span> <span class="nf">hyperplane_parameters</span><span class="p">(</span><span class="n">poly</span><span class="p">,</span> <span class="n">vertices</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A helper function to return the hyperplane parameters</span>
<span class="sd">    of which the facets of the polytope are a part of.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ==========</span>
<span class="sd">    poly : The input 2/3-Polytope</span>
<span class="sd">    vertices :  Vertex indices of 3-Polytope</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.geometry.point import Point</span>
<span class="sd">    &gt;&gt;&gt; from sympy.geometry.polygon import Polygon</span>
<span class="sd">    &gt;&gt;&gt; from sympy.integrals.intpoly import hyperplane_parameters</span>
<span class="sd">    &gt;&gt;&gt; hyperplane_parameters(Polygon(Point(0, 3), Point(5, 3), Point(1, 1)))</span>
<span class="sd">    [((0, 1), 3), ((1, -2), -1), ((-2, -1), -3)]</span>
<span class="sd">    &gt;&gt;&gt; cube = [[(0, 0, 0), (0, 0, 5), (0, 5, 0), (0, 5, 5), (5, 0, 0),\</span>
<span class="sd">                (5, 0, 5), (5, 5, 0), (5, 5, 5)],\</span>
<span class="sd">                [2, 6, 7, 3], [3, 7, 5, 1], [7, 6, 4, 5], [1, 5, 4, 0],\</span>
<span class="sd">                [3, 1, 0, 2], [0, 4, 6, 2]]</span>
<span class="sd">    &gt;&gt;&gt; hyperplane_parameters(cube[1:], cube[0])</span>
<span class="sd">    [([0, -1, 0], -5), ([0, 0, -1], -5), ([-1, 0, 0], -5),</span>
<span class="sd">    ([0, 1, 0], 0), ([1, 0, 0], 0), ([0, 0, 1], 0)]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">poly</span><span class="p">,</span> <span class="n">Polygon</span><span class="p">):</span>
        <span class="n">vertices</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">poly</span><span class="o">.</span><span class="n">vertices</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="n">poly</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>  <span class="c1"># Close the polygon</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vertices</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vertices</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">v1</span> <span class="o">=</span> <span class="n">vertices</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">v2</span> <span class="o">=</span> <span class="n">vertices</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>

            <span class="n">a1</span> <span class="o">=</span> <span class="n">v1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">v2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">a2</span> <span class="o">=</span> <span class="n">v2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">v1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">v2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">v1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">v2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">v1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="n">factor</span> <span class="o">=</span> <span class="n">gcd_list</span><span class="p">([</span><span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">,</span> <span class="n">b</span><span class="p">])</span>

            <span class="n">b</span> <span class="o">=</span> <span class="n">S</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">/</span> <span class="n">factor</span>
            <span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="n">S</span><span class="p">(</span><span class="n">a1</span><span class="p">)</span> <span class="o">/</span> <span class="n">factor</span><span class="p">,</span> <span class="n">S</span><span class="p">(</span><span class="n">a2</span><span class="p">)</span> <span class="o">/</span> <span class="n">factor</span><span class="p">)</span>
            <span class="n">params</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">poly</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">polygon</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">poly</span><span class="p">):</span>
            <span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">v3</span> <span class="o">=</span> <span class="p">[</span><span class="n">vertices</span><span class="p">[</span><span class="n">vertex</span><span class="p">]</span> <span class="k">for</span> <span class="n">vertex</span> <span class="ow">in</span> <span class="n">polygon</span><span class="p">[:</span><span class="mi">3</span><span class="p">]]</span>
            <span class="n">normal</span> <span class="o">=</span> <span class="n">cross_product</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">v3</span><span class="p">)</span>
            <span class="n">b</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">normal</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">v1</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)])</span>
            <span class="n">fac</span> <span class="o">=</span> <span class="n">gcd_list</span><span class="p">(</span><span class="n">normal</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">fac</span> <span class="ow">is</span> <span class="n">S</span><span class="o">.</span><span class="n">Zero</span><span class="p">:</span>
                <span class="n">fac</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">normal</span> <span class="o">=</span> <span class="p">[</span><span class="n">j</span> <span class="o">/</span> <span class="n">fac</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">normal</span><span class="p">]</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">b</span> <span class="o">/</span> <span class="n">fac</span>
            <span class="n">params</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">normal</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">params</span>


<span class="k">def</span> <span class="nf">cross_product</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">v3</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns the cross-product of vectors (v2 - v1) and (v3 - v1)</span>
<span class="sd">    That is : (v2 - v1) X (v3 - v1)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">v2</span> <span class="o">=</span> <span class="p">[</span><span class="n">v2</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">v1</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)]</span>
    <span class="n">v3</span> <span class="o">=</span> <span class="p">[</span><span class="n">v3</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">v1</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)]</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">v3</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">v2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">v3</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">v2</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
            <span class="n">v3</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">v2</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">v3</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">v2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">v3</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">v2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">v3</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">v2</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>


<span class="k">def</span> <span class="nf">best_origin</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">lineseg</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Helper method for polytope_integrate. Currently not used in the main</span>
<span class="sd">    algorithm.</span>
<span class="sd">    Returns a point on the lineseg whose vector inner product with the</span>
<span class="sd">    divergence of `expr` yields an expression with the least maximum</span>
<span class="sd">    total power.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ==========</span>

<span class="sd">    a : Hyperplane parameter denoting direction.</span>
<span class="sd">    b : Hyperplane parameter denoting distance.</span>
<span class="sd">    lineseg : Line segment on which to find the origin.</span>
<span class="sd">    expr : The expression which determines the best point.</span>

<span class="sd">    Algorithm(currently works only for 2D use case)</span>
<span class="sd">    ===============================================</span>

<span class="sd">    1 &gt; Firstly, check for edge cases. Here that would refer to vertical</span>
<span class="sd">        or horizontal lines.</span>

<span class="sd">    2 &gt; If input expression is a polynomial containing more than one generator</span>
<span class="sd">        then find out the total power of each of the generators.</span>

<span class="sd">        x**2 + 3 + x*y + x**4*y**5 ---&gt; {x: 7, y: 6}</span>

<span class="sd">        If expression is a constant value then pick the first boundary point</span>
<span class="sd">        of the line segment.</span>

<span class="sd">    3 &gt; First check if a point exists on the line segment where the value of</span>
<span class="sd">        the highest power generator becomes 0. If not check if the value of</span>
<span class="sd">        the next highest becomes 0. If none becomes 0 within line segment</span>
<span class="sd">        constraints then pick the first boundary point of the line segment.</span>
<span class="sd">        Actually, any point lying on the segment can be picked as best origin</span>
<span class="sd">        in the last case.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.integrals.intpoly import best_origin</span>
<span class="sd">    &gt;&gt;&gt; from sympy.abc import x, y</span>
<span class="sd">    &gt;&gt;&gt; from sympy.geometry.line import Segment2D</span>
<span class="sd">    &gt;&gt;&gt; from sympy.geometry.point import Point</span>
<span class="sd">    &gt;&gt;&gt; l = Segment2D(Point(0, 3), Point(1, 1))</span>
<span class="sd">    &gt;&gt;&gt; expr = x**3*y**7</span>
<span class="sd">    &gt;&gt;&gt; best_origin((2, 1), 3, l, expr)</span>
<span class="sd">    (0, 3.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">a1</span><span class="p">,</span> <span class="n">b1</span> <span class="o">=</span> <span class="n">lineseg</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">x_axis_cut</span><span class="p">(</span><span class="n">ls</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the point where the input line segment</span>
<span class="sd">        intersects the x-axis.</span>
<span class="sd">        Parameters:</span>
<span class="sd">        ===========</span>
<span class="sd">        ls : Line segment</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">p</span><span class="p">,</span> <span class="n">q</span> <span class="o">=</span> <span class="n">ls</span><span class="o">.</span><span class="n">points</span>
        <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">y</span> <span class="o">==</span> <span class="n">S</span><span class="o">.</span><span class="n">Zero</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">q</span><span class="o">.</span><span class="n">y</span> <span class="o">==</span> <span class="n">S</span><span class="o">.</span><span class="n">Zero</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">p</span><span class="o">.</span><span class="n">y</span><span class="o">/</span><span class="n">q</span><span class="o">.</span><span class="n">y</span> <span class="o">&lt;</span> <span class="n">S</span><span class="o">.</span><span class="n">Zero</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">p</span><span class="o">.</span><span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">q</span><span class="o">.</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">p</span><span class="o">.</span><span class="n">y</span><span class="p">)</span> <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">S</span><span class="o">.</span><span class="n">Zero</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">()</span>

    <span class="k">def</span> <span class="nf">y_axis_cut</span><span class="p">(</span><span class="n">ls</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the point where the input line segment</span>
<span class="sd">        intersects the y-axis.</span>
<span class="sd">        Parameters:</span>
<span class="sd">        ===========</span>
<span class="sd">        ls : Line segment</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">p</span><span class="p">,</span> <span class="n">q</span> <span class="o">=</span> <span class="n">ls</span><span class="o">.</span><span class="n">points</span>
        <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">x</span> <span class="o">==</span> <span class="n">S</span><span class="o">.</span><span class="n">Zero</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">q</span><span class="o">.</span><span class="n">x</span> <span class="o">==</span> <span class="n">S</span><span class="o">.</span><span class="n">Zero</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">p</span><span class="o">.</span><span class="n">x</span><span class="o">/</span><span class="n">q</span><span class="o">.</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">S</span><span class="o">.</span><span class="n">Zero</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">S</span><span class="o">.</span><span class="n">Zero</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">x</span> <span class="o">*</span> <span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">q</span><span class="o">.</span><span class="n">y</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">p</span><span class="o">.</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="n">y</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">()</span>

    <span class="n">gens</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="n">power_gens</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">gens</span><span class="p">:</span>
        <span class="n">power_gens</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">S</span><span class="o">.</span><span class="n">Zero</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">gens</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="c1"># Special case for vertical and horizontal lines</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">gens</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">S</span><span class="o">.</span><span class="n">Zero</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">y_axis_cut</span><span class="p">(</span><span class="n">lineseg</span><span class="p">):</span>
                    <span class="k">return</span> <span class="n">S</span><span class="o">.</span><span class="n">Zero</span><span class="p">,</span> <span class="n">b</span><span class="o">/</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">a1</span><span class="p">,</span> <span class="n">b1</span>
            <span class="k">elif</span> <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">S</span><span class="o">.</span><span class="n">Zero</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">x_axis_cut</span><span class="p">(</span><span class="n">lineseg</span><span class="p">):</span>
                    <span class="k">return</span> <span class="n">b</span><span class="o">/</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">S</span><span class="o">.</span><span class="n">Zero</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">a1</span><span class="p">,</span> <span class="n">b1</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">Expr</span><span class="p">):</span>  <span class="c1"># Find the sum total of power of each</span>
            <span class="k">if</span> <span class="n">expr</span><span class="o">.</span><span class="n">is_Add</span><span class="p">:</span>         <span class="c1"># generator and store in a dictionary.</span>
                <span class="k">for</span> <span class="n">monomial</span> <span class="ow">in</span> <span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">monomial</span><span class="o">.</span><span class="n">is_Pow</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">monomial</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">gens</span><span class="p">:</span>
                            <span class="n">power_gens</span><span class="p">[</span><span class="n">monomial</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">+=</span> <span class="n">monomial</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">univariate</span> <span class="ow">in</span> <span class="n">monomial</span><span class="o">.</span><span class="n">args</span><span class="p">:</span>
                            <span class="n">term_type</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">univariate</span><span class="o">.</span><span class="n">args</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">term_type</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">univariate</span> <span class="ow">in</span> <span class="n">gens</span><span class="p">:</span>
                                <span class="n">power_gens</span><span class="p">[</span><span class="n">univariate</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                            <span class="k">elif</span> <span class="n">term_type</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">univariate</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">gens</span><span class="p">:</span>
                                <span class="n">power_gens</span><span class="p">[</span><span class="n">univariate</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">+=</span>\
                                           <span class="n">univariate</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">expr</span><span class="o">.</span><span class="n">is_Mul</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">term</span> <span class="ow">in</span> <span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">:</span>
                    <span class="n">term_type</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">term</span><span class="o">.</span><span class="n">args</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">term_type</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">term</span> <span class="ow">in</span> <span class="n">gens</span><span class="p">:</span>
                        <span class="n">power_gens</span><span class="p">[</span><span class="n">term</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">elif</span> <span class="n">term_type</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">term</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">gens</span><span class="p">:</span>
                        <span class="n">power_gens</span><span class="p">[</span><span class="n">term</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">+=</span> <span class="n">term</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">expr</span><span class="o">.</span><span class="n">is_Pow</span><span class="p">:</span>
                <span class="n">power_gens</span><span class="p">[</span><span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">expr</span><span class="o">.</span><span class="n">is_Symbol</span><span class="p">:</span>
                <span class="n">power_gens</span><span class="p">[</span><span class="n">expr</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># If `expr` is a constant take first vertex of the line segment.</span>
            <span class="k">return</span> <span class="n">a1</span><span class="p">,</span> <span class="n">b1</span>

        <span class="c1">#  TODO : This part is quite hacky. Should be made more robust with</span>
        <span class="c1">#  TODO : respect to symbol names and scalable w.r.t higher dimensions.</span>
        <span class="n">power_gens</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">power_gens</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">k</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="k">if</span> <span class="n">power_gens</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">power_gens</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">y_axis_cut</span><span class="p">(</span><span class="n">lineseg</span><span class="p">):</span>
                <span class="n">x0</span> <span class="o">=</span> <span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">Zero</span><span class="p">,</span> <span class="n">b</span> <span class="o">/</span> <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">x_axis_cut</span><span class="p">(</span><span class="n">lineseg</span><span class="p">):</span>
                <span class="n">x0</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span> <span class="o">/</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">S</span><span class="o">.</span><span class="n">Zero</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">x0</span> <span class="o">=</span> <span class="p">(</span><span class="n">a1</span><span class="p">,</span> <span class="n">b1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">x_axis_cut</span><span class="p">(</span><span class="n">lineseg</span><span class="p">):</span>
                <span class="n">x0</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span><span class="o">/</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">S</span><span class="o">.</span><span class="n">Zero</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">y_axis_cut</span><span class="p">(</span><span class="n">lineseg</span><span class="p">):</span>
                <span class="n">x0</span> <span class="o">=</span> <span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">Zero</span><span class="p">,</span> <span class="n">b</span><span class="o">/</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">x0</span> <span class="o">=</span> <span class="p">(</span><span class="n">a1</span><span class="p">,</span> <span class="n">b1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">x0</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span><span class="o">/</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">x0</span>


<span class="k">def</span> <span class="nf">decompose</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">separate</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Decomposes an input polynomial into homogeneous ones of</span>
<span class="sd">    smaller or equal degree.</span>
<span class="sd">    Returns a dictionary with keys as the degree of the smaller</span>
<span class="sd">    constituting polynomials. Values are the constituting polynomials.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ==========</span>
<span class="sd">    expr : Polynomial(SymPy expression)</span>

<span class="sd">    Optional Parameters :</span>
<span class="sd">    ---------------------</span>
<span class="sd">    separate : If True then simply return a list of the constituent monomials</span>
<span class="sd">               If not then break up the polynomial into constituent homogeneous</span>
<span class="sd">               polynomials.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.abc import x, y</span>
<span class="sd">    &gt;&gt;&gt; from sympy.integrals.intpoly import decompose</span>
<span class="sd">    &gt;&gt;&gt; decompose(x**2 + x*y + x + y + x**3*y**2 + y**5)</span>
<span class="sd">    {1: x + y, 2: x**2 + x*y, 5: x**3*y**2 + y**5}</span>
<span class="sd">    &gt;&gt;&gt; decompose(x**2 + x*y + x + y + x**3*y**2 + y**5, True)</span>
<span class="sd">    {x, x**2, y, y**5, x*y, x**3*y**2}</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">poly_dict</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">Expr</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">expr</span><span class="o">.</span><span class="n">is_number</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">expr</span><span class="o">.</span><span class="n">is_Symbol</span><span class="p">:</span>
            <span class="n">poly_dict</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">expr</span>
        <span class="k">elif</span> <span class="n">expr</span><span class="o">.</span><span class="n">is_Add</span><span class="p">:</span>
            <span class="n">symbols</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">atoms</span><span class="p">(</span><span class="n">Symbol</span><span class="p">)</span>
            <span class="n">degrees</span> <span class="o">=</span> <span class="p">[(</span><span class="nb">sum</span><span class="p">(</span><span class="n">degree_list</span><span class="p">(</span><span class="n">monom</span><span class="p">,</span> <span class="o">*</span><span class="n">symbols</span><span class="p">)),</span> <span class="n">monom</span><span class="p">)</span>
                       <span class="k">for</span> <span class="n">monom</span> <span class="ow">in</span> <span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">separate</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">{</span><span class="n">monom</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">monom</span> <span class="ow">in</span> <span class="n">degrees</span><span class="p">}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">monom</span> <span class="ow">in</span> <span class="n">degrees</span><span class="p">:</span>
                    <span class="n">degree</span><span class="p">,</span> <span class="n">term</span> <span class="o">=</span> <span class="n">monom</span>
                    <span class="k">if</span> <span class="n">poly_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">degree</span><span class="p">):</span>
                        <span class="n">poly_dict</span><span class="p">[</span><span class="n">degree</span><span class="p">]</span> <span class="o">+=</span> <span class="n">term</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">poly_dict</span><span class="p">[</span><span class="n">degree</span><span class="p">]</span> <span class="o">=</span> <span class="n">term</span>
        <span class="k">elif</span> <span class="n">expr</span><span class="o">.</span><span class="n">is_Pow</span><span class="p">:</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">degree</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">args</span>
            <span class="n">poly_dict</span><span class="p">[</span><span class="n">degree</span><span class="p">]</span> <span class="o">=</span> <span class="n">expr</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># Now expr can only be of `Mul` type</span>
            <span class="n">degree</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">term</span> <span class="ow">in</span> <span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">:</span>
                <span class="n">term_type</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">term</span><span class="o">.</span><span class="n">args</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">term_type</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">term</span><span class="o">.</span><span class="n">is_Symbol</span><span class="p">:</span>
                    <span class="n">degree</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">elif</span> <span class="n">term_type</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">degree</span> <span class="o">+=</span> <span class="n">term</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">poly_dict</span><span class="p">[</span><span class="n">degree</span><span class="p">]</span> <span class="o">=</span> <span class="n">expr</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">poly_dict</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">expr</span>

    <span class="k">if</span> <span class="n">separate</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">set</span><span class="p">(</span><span class="n">poly_dict</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">poly_dict</span>


<span class="k">def</span> <span class="nf">point_sort</span><span class="p">(</span><span class="n">poly</span><span class="p">,</span> <span class="n">normal</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">clockwise</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns the same polygon with points sorted in clockwise or</span>
<span class="sd">    anti-clockwise order.</span>

<span class="sd">    Note that it&#39;s necessary for input points to be sorted in some order</span>
<span class="sd">    (clockwise or anti-clockwise) for the integration algorithm to work.</span>
<span class="sd">    As a convention algorithm has been implemented keeping clockwise</span>
<span class="sd">    orientation in mind.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ==========</span>

<span class="sd">    poly: 2D or 3D Polygon</span>

<span class="sd">    Optional Parameters:</span>
<span class="sd">    ---------------------</span>

<span class="sd">    normal : The normal of the plane which the 3-Polytope is a part of.</span>
<span class="sd">    clockwise : Returns points sorted in clockwise order if True and</span>
<span class="sd">    anti-clockwise if False.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.integrals.intpoly import point_sort</span>
<span class="sd">    &gt;&gt;&gt; from sympy.geometry.point import Point</span>
<span class="sd">    &gt;&gt;&gt; point_sort([Point(0, 0), Point(1, 0), Point(1, 1)])</span>
<span class="sd">    [Point2D(1, 1), Point2D(1, 0), Point2D(0, 0)]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">poly</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">poly</span>

    <span class="n">order</span> <span class="o">=</span> <span class="n">S</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">clockwise</span> <span class="k">else</span> <span class="n">S</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">dim</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">poly</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">dim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">center</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">vertex</span><span class="p">:</span> <span class="n">vertex</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">poly</span><span class="p">))</span> <span class="o">/</span> <span class="n">n</span><span class="p">,</span>
                       <span class="nb">sum</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">vertex</span><span class="p">:</span> <span class="n">vertex</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">poly</span><span class="p">))</span> <span class="o">/</span> <span class="n">n</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">center</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">vertex</span><span class="p">:</span> <span class="n">vertex</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">poly</span><span class="p">))</span> <span class="o">/</span> <span class="n">n</span><span class="p">,</span>
                       <span class="nb">sum</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">vertex</span><span class="p">:</span> <span class="n">vertex</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">poly</span><span class="p">))</span> <span class="o">/</span> <span class="n">n</span><span class="p">,</span>
                       <span class="nb">sum</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">vertex</span><span class="p">:</span> <span class="n">vertex</span><span class="o">.</span><span class="n">z</span><span class="p">,</span> <span class="n">poly</span><span class="p">))</span> <span class="o">/</span> <span class="n">n</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">compare</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">center</span><span class="o">.</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="n">S</span><span class="o">.</span><span class="n">Zero</span> <span class="ow">and</span> <span class="n">b</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">center</span><span class="o">.</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">S</span><span class="o">.</span><span class="n">Zero</span><span class="p">:</span>
            <span class="k">return</span> <span class="o">-</span><span class="n">order</span>
        <span class="k">elif</span> <span class="n">a</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">center</span><span class="o">.</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">S</span><span class="o">.</span><span class="n">Zero</span> <span class="ow">and</span> <span class="n">b</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">center</span><span class="o">.</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="n">S</span><span class="o">.</span><span class="n">Zero</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">order</span>
        <span class="k">elif</span> <span class="n">a</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">center</span><span class="o">.</span><span class="n">x</span> <span class="o">==</span> <span class="n">S</span><span class="o">.</span><span class="n">Zero</span> <span class="ow">and</span> <span class="n">b</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">center</span><span class="o">.</span><span class="n">x</span> <span class="o">==</span> <span class="n">S</span><span class="o">.</span><span class="n">Zero</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">center</span><span class="o">.</span><span class="n">y</span> <span class="o">&gt;=</span> <span class="n">S</span><span class="o">.</span><span class="n">Zero</span> <span class="ow">or</span> <span class="n">b</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">center</span><span class="o">.</span><span class="n">y</span> <span class="o">&gt;=</span> <span class="n">S</span><span class="o">.</span><span class="n">Zero</span><span class="p">:</span>
                <span class="k">return</span> <span class="o">-</span><span class="n">order</span> <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">y</span> <span class="o">&gt;</span> <span class="n">b</span><span class="o">.</span><span class="n">y</span> <span class="k">else</span> <span class="n">order</span>
            <span class="k">return</span> <span class="o">-</span><span class="n">order</span> <span class="k">if</span> <span class="n">b</span><span class="o">.</span><span class="n">y</span> <span class="o">&gt;</span> <span class="n">a</span><span class="o">.</span><span class="n">y</span> <span class="k">else</span> <span class="n">order</span>

        <span class="n">det</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">center</span><span class="o">.</span><span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">center</span><span class="o">.</span><span class="n">y</span><span class="p">)</span> <span class="o">-</span>\
              <span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">center</span><span class="o">.</span><span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">center</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">det</span> <span class="o">&lt;</span> <span class="n">S</span><span class="o">.</span><span class="n">Zero</span><span class="p">:</span>
            <span class="k">return</span> <span class="o">-</span><span class="n">order</span>
        <span class="k">elif</span> <span class="n">det</span> <span class="o">&gt;</span> <span class="n">S</span><span class="o">.</span><span class="n">Zero</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">order</span>

        <span class="n">first</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">center</span><span class="o">.</span><span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">center</span><span class="o">.</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span>\
                <span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">center</span><span class="o">.</span><span class="n">y</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">center</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
        <span class="n">second</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">center</span><span class="o">.</span><span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">center</span><span class="o">.</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span>\
                 <span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">center</span><span class="o">.</span><span class="n">y</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">center</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">order</span> <span class="k">if</span> <span class="n">first</span> <span class="o">&gt;</span> <span class="n">second</span> <span class="k">else</span> <span class="n">order</span>

    <span class="k">def</span> <span class="nf">compare3d</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="n">det</span> <span class="o">=</span> <span class="n">cross_product</span><span class="p">(</span><span class="n">center</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
        <span class="n">dot_product</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">det</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">normal</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)])</span>
        <span class="k">if</span> <span class="n">dot_product</span> <span class="o">&lt;</span> <span class="n">S</span><span class="o">.</span><span class="n">Zero</span><span class="p">:</span>
            <span class="k">return</span> <span class="o">-</span><span class="n">order</span>
        <span class="k">elif</span> <span class="n">dot_product</span> <span class="o">&gt;</span> <span class="n">S</span><span class="o">.</span><span class="n">Zero</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">order</span>

    <span class="k">if</span> <span class="n">dim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">poly</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">cmp_to_key</span><span class="p">(</span><span class="n">compare</span><span class="p">))</span>
    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">poly</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">cmp_to_key</span><span class="p">(</span><span class="n">compare3d</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">norm</span><span class="p">(</span><span class="n">point</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns the Euclidean norm of a point from origin.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ==========</span>

<span class="sd">    point: This denotes a point in the dimension_al spac_e.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.integrals.intpoly import norm</span>
<span class="sd">    &gt;&gt;&gt; from sympy.geometry.point import Point</span>
<span class="sd">    &gt;&gt;&gt; norm(Point(2, 7))</span>
<span class="sd">    sqrt(53)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">half</span> <span class="o">=</span> <span class="n">S</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">([</span><span class="n">coord</span> <span class="o">**</span> <span class="mi">2</span> <span class="k">for</span> <span class="n">coord</span> <span class="ow">in</span> <span class="n">point</span><span class="p">])</span> <span class="o">**</span> <span class="n">half</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">Point</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">Point2D</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">point</span><span class="o">.</span><span class="n">x</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">point</span><span class="o">.</span><span class="n">y</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">**</span> <span class="n">half</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">point</span><span class="o">.</span><span class="n">x</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">point</span><span class="o">.</span><span class="n">y</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">point</span><span class="o">.</span><span class="n">z</span><span class="p">)</span> <span class="o">**</span> <span class="n">half</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">i</span><span class="o">**</span><span class="mi">2</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">point</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> <span class="o">**</span> <span class="n">half</span>


<span class="k">def</span> <span class="nf">intersection</span><span class="p">(</span><span class="n">geom_1</span><span class="p">,</span> <span class="n">geom_2</span><span class="p">,</span> <span class="n">intersection_type</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns intersection between geometric objects.</span>

<span class="sd">    Note that this function is meant for use in integration_reduction and</span>
<span class="sd">    at that point in the calling function the lines denoted by the segments</span>
<span class="sd">    surely intersect within segment boundaries. Coincident lines are taken</span>
<span class="sd">    to be non-intersecting. Also, the hyperplane intersection for 2D case is</span>
<span class="sd">    also implemented.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ==========</span>

<span class="sd">    geom_1, geom_2: The input line segments</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.integrals.intpoly import intersection</span>
<span class="sd">    &gt;&gt;&gt; from sympy.geometry.point import Point</span>
<span class="sd">    &gt;&gt;&gt; from sympy.geometry.line import Segment2D</span>
<span class="sd">    &gt;&gt;&gt; l1 = Segment2D(Point(1, 1), Point(3, 5))</span>
<span class="sd">    &gt;&gt;&gt; l2 = Segment2D(Point(2, 0), Point(2, 5))</span>
<span class="sd">    &gt;&gt;&gt; intersection(l1, l2, &quot;segment2D&quot;)</span>
<span class="sd">    (2, 3)</span>
<span class="sd">    &gt;&gt;&gt; p1 = ((-1, 0), 0)</span>
<span class="sd">    &gt;&gt;&gt; p2 = ((0, 1), 1)</span>
<span class="sd">    &gt;&gt;&gt; intersection(p1, p2, &quot;plane2D&quot;)</span>
<span class="sd">    (0, 1)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">intersection_type</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;segment&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">intersection_type</span> <span class="o">==</span> <span class="s2">&quot;segment2D&quot;</span><span class="p">:</span>
            <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">geom_1</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">geom_1</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">x3</span><span class="p">,</span> <span class="n">y3</span> <span class="o">=</span> <span class="n">geom_2</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">x4</span><span class="p">,</span> <span class="n">y4</span> <span class="o">=</span> <span class="n">geom_2</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">intersection_type</span> <span class="o">==</span> <span class="s2">&quot;segment3D&quot;</span><span class="p">:</span>
            <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">z1</span> <span class="o">=</span> <span class="n">geom_1</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">z2</span> <span class="o">=</span> <span class="n">geom_1</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">x3</span><span class="p">,</span> <span class="n">y3</span><span class="p">,</span> <span class="n">z3</span> <span class="o">=</span> <span class="n">geom_2</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">x4</span><span class="p">,</span> <span class="n">y4</span><span class="p">,</span> <span class="n">z4</span> <span class="o">=</span> <span class="n">geom_2</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">denom</span> <span class="o">=</span> <span class="p">(</span><span class="n">x1</span> <span class="o">-</span> <span class="n">x2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">y3</span> <span class="o">-</span> <span class="n">y4</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">y1</span> <span class="o">-</span> <span class="n">y2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">x3</span> <span class="o">-</span> <span class="n">x4</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">denom</span><span class="p">:</span>
            <span class="n">t1</span> <span class="o">=</span> <span class="n">x1</span> <span class="o">*</span> <span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span> <span class="o">*</span> <span class="n">x2</span>
            <span class="n">t2</span> <span class="o">=</span> <span class="n">x3</span> <span class="o">*</span> <span class="n">y4</span> <span class="o">-</span> <span class="n">x4</span> <span class="o">*</span> <span class="n">y3</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">S</span><span class="p">(</span><span class="n">t1</span> <span class="o">*</span> <span class="p">(</span><span class="n">x3</span> <span class="o">-</span> <span class="n">x4</span><span class="p">)</span> <span class="o">-</span> <span class="n">t2</span> <span class="o">*</span> <span class="p">(</span><span class="n">x1</span> <span class="o">-</span> <span class="n">x2</span><span class="p">))</span> <span class="o">/</span> <span class="n">denom</span><span class="p">,</span>
                    <span class="n">S</span><span class="p">(</span><span class="n">t1</span> <span class="o">*</span> <span class="p">(</span><span class="n">y3</span> <span class="o">-</span> <span class="n">y4</span><span class="p">)</span> <span class="o">-</span> <span class="n">t2</span> <span class="o">*</span> <span class="p">(</span><span class="n">y1</span> <span class="o">-</span> <span class="n">y2</span><span class="p">))</span> <span class="o">/</span> <span class="n">denom</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">intersection_type</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;plane&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">intersection_type</span> <span class="o">==</span> <span class="s2">&quot;plane2D&quot;</span><span class="p">:</span>  <span class="c1"># Intersection of hyperplanes</span>
            <span class="n">a1x</span><span class="p">,</span> <span class="n">a1y</span> <span class="o">=</span> <span class="n">geom_1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">a2x</span><span class="p">,</span> <span class="n">a2y</span> <span class="o">=</span> <span class="n">geom_2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">b1</span><span class="p">,</span> <span class="n">b2</span> <span class="o">=</span> <span class="n">geom_1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">geom_2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

            <span class="n">denom</span> <span class="o">=</span> <span class="n">a1x</span> <span class="o">*</span> <span class="n">a2y</span> <span class="o">-</span> <span class="n">a2x</span> <span class="o">*</span> <span class="n">a1y</span>
            <span class="k">if</span> <span class="n">denom</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">(</span><span class="n">S</span><span class="p">(</span><span class="n">b1</span> <span class="o">*</span> <span class="n">a2y</span> <span class="o">-</span> <span class="n">b2</span> <span class="o">*</span> <span class="n">a1y</span><span class="p">)</span> <span class="o">/</span> <span class="n">denom</span><span class="p">,</span>
                        <span class="n">S</span><span class="p">(</span><span class="n">b2</span> <span class="o">*</span> <span class="n">a1x</span> <span class="o">-</span> <span class="n">b1</span> <span class="o">*</span> <span class="n">a2x</span><span class="p">)</span> <span class="o">/</span> <span class="n">denom</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">is_vertex</span><span class="p">(</span><span class="n">ent</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;If the input entity is a vertex return True</span>
<span class="sd">    Parameter</span>
<span class="sd">    =========</span>

<span class="sd">    ent : Denotes a geometric entity representing a point</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.geometry.point import Point</span>
<span class="sd">    &gt;&gt;&gt; from sympy.integrals.intpoly import is_vertex</span>
<span class="sd">    &gt;&gt;&gt; is_vertex((2, 3))</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; is_vertex((2, 3, 6))</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; is_vertex(Point(2, 3))</span>
<span class="sd">    True</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ent</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ent</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]:</span>
            <span class="k">return</span> <span class="kc">True</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ent</span><span class="p">,</span> <span class="n">Point</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="kc">False</span>


<span class="k">def</span> <span class="nf">plot_polytope</span><span class="p">(</span><span class="n">poly</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Plots the 2D polytope using the functions written in plotting</span>
<span class="sd">    module which in turn uses matplotlib backend.</span>

<span class="sd">    Parameter</span>
<span class="sd">    =========</span>

<span class="sd">    poly: Denotes a 2-Polytope</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">sympy.plotting.plot</span> <span class="k">import</span> <span class="n">Plot</span><span class="p">,</span> <span class="n">List2DSeries</span>

    <span class="n">xl</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">vertex</span><span class="p">:</span> <span class="n">vertex</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">poly</span><span class="o">.</span><span class="n">vertices</span><span class="p">))</span>
    <span class="n">yl</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">vertex</span><span class="p">:</span> <span class="n">vertex</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">poly</span><span class="o">.</span><span class="n">vertices</span><span class="p">))</span>

    <span class="n">xl</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">poly</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>  <span class="c1"># Closing the polygon</span>
    <span class="n">yl</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">poly</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>

    <span class="n">l2ds</span> <span class="o">=</span> <span class="n">List2DSeries</span><span class="p">(</span><span class="n">xl</span><span class="p">,</span> <span class="n">yl</span><span class="p">)</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">Plot</span><span class="p">(</span><span class="n">l2ds</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="s1">&#39;label_axes=True&#39;</span><span class="p">)</span>
    <span class="n">p</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">plot_polynomial</span><span class="p">(</span><span class="n">expr</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Plots the polynomial using the functions written in</span>
<span class="sd">    plotting module which in turn uses matplotlib backend.</span>

<span class="sd">    Parameter</span>
<span class="sd">    =========</span>

<span class="sd">    expr: Denotes a polynomial(SymPy expression)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">sympy.plotting.plot</span> <span class="k">import</span> <span class="n">plot3d</span><span class="p">,</span> <span class="n">plot</span>
    <span class="n">gens</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">free_symbols</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">gens</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">plot3d</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plot</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/sympylogo.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">SymPy 1.1.2.dev documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2018 SymPy Development Team.
      Last updated on Jan 29, 2018.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.6.6.
    </div>
  </body>
</html>