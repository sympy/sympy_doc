<!doctype html>
<html class="no-js" lang="en">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />
<link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="Solve Equations" href="solving/index.html" /><link rel="prev" title="Symbolic and fuzzy booleans" href="booleans.html" />
        <link rel="canonical" href="https://docs.sympy.org/latest/guides/custom-functions.html" />

    <link rel="shortcut icon" href="../_static/sympy-notailtext-favicon.ico"/><!-- Generated with Sphinx 6.1.3 and Furo 2023.03.27 -->
        <title>Writing Custom Functions - SymPy 1.13.dev documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?digest=fad236701ea90a88636c2a8c73b44ae642ed2a53" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    
    


<style>
  body {
    --color-code-background: #eeffcc;
  --color-code-foreground: black;
  --color-brand-primary: #52833A;
  --color-brand-content: #307748;
  --color-sidebar-background: #3B5526;
  --color-sidebar-background-border: var(--color-background-primary);
  --color-sidebar-link-text: #FFFFFF;
  --color-sidebar-brand-text: var(--color-sidebar-link-text--top-level);
  --color-sidebar-link-text--top-level: #FFFFFF;
  --color-sidebar-item-background--hover: var(--color-brand-primary);
  --color-sidebar-item-expander-background--hover: var(--color-brand-primary);
  --color-link-underline--hover: var(--color-link);
  --color-api-keyword: #000000bd;
  --color-api-name: var(--color-brand-content);
  --color-api-pre-name: var(--color-brand-content);
  --api-font-size: var(--font-size--normal);
  --color-foreground-secondary: #53555B;
  --color-admonition-title-background--seealso: #CCCCCC;
  --color-admonition-title--seealso: black;
  --color-admonition-title-background--note: #CCCCCC;
  --color-admonition-title--note: black;
  --color-admonition-title-background--warning: var(--color-problematic);
  --color-admonition-title--warning: white;
  --admonition-font-size: var(--font-size--normal);
  --admonition-title-font-size: var(--font-size--normal);
  --color-code-background: hsl(80deg 100% 95%);
  --code-font-size: var(--font-size--small);
  --font-stack--monospace: DejaVu Sans Mono,"SFMono-Regular",Menlo,Consolas,Monaco,Liberation Mono,Lucida Console,monospace;;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --color-brand-primary: #33CB33;
  --color-brand-content: #1DBD1D;
  --color-sidebar-background: #3B5526;
  --color-sidebar-background-border: var(--color-background-primary);
  --color-sidebar-link-text: #FFFFFF;
  --color-sidebar-brand-text: var(--color-sidebar-link-text--top-level);
  --color-sidebar-link-text--top-level: #FFFFFF;
  --color-sidebar-item-background--hover: #52833A;
  --color-sidebar-item-expander-background--hover: #52833A;
  --color-link-underline--hover: var(--color-link);
  --color-api-keyword: #FFFFFFbd;
  --color-api-name: var(--color-brand-content);
  --color-api-pre-name: var(--color-brand-content);
  --api-font-size: var(--font-size--normal);
  --color-foreground-secondary: #9DA1AC;
  --color-admonition-title-background--seealso: #555555;
  --color-admonition-title--seealso: black;
  --color-admonition-title-background--note: #555555;
  --color-admonition-title--note: black;
  --color-admonition-title-background--warning: var(--color-problematic);
  --color-admonition-title--warning: white;
  --admonition-font-size: var(--font-size--normal);
  --admonition-title-font-size: var(--font-size--normal);
  --color-code-background: hsl(80deg 100% 95%);
  --code-font-size: var(--font-size--small);
  --font-stack--monospace: DejaVu Sans Mono,"SFMono-Regular",Menlo,Consolas,Monaco,Liberation Mono,Lucida Console,monospace;;
  --color-api-overall: #FFFFFF90;
  --color-api-paren: #FFFFFF90;
  --color-problematic: #B30000;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --color-brand-primary: #33CB33;
  --color-brand-content: #1DBD1D;
  --color-sidebar-background: #3B5526;
  --color-sidebar-background-border: var(--color-background-primary);
  --color-sidebar-link-text: #FFFFFF;
  --color-sidebar-brand-text: var(--color-sidebar-link-text--top-level);
  --color-sidebar-link-text--top-level: #FFFFFF;
  --color-sidebar-item-background--hover: #52833A;
  --color-sidebar-item-expander-background--hover: #52833A;
  --color-link-underline--hover: var(--color-link);
  --color-api-keyword: #FFFFFFbd;
  --color-api-name: var(--color-brand-content);
  --color-api-pre-name: var(--color-brand-content);
  --api-font-size: var(--font-size--normal);
  --color-foreground-secondary: #9DA1AC;
  --color-admonition-title-background--seealso: #555555;
  --color-admonition-title--seealso: black;
  --color-admonition-title-background--note: #555555;
  --color-admonition-title--note: black;
  --color-admonition-title-background--warning: var(--color-problematic);
  --color-admonition-title--warning: white;
  --admonition-font-size: var(--font-size--normal);
  --admonition-title-font-size: var(--font-size--normal);
  --color-code-background: hsl(80deg 100% 95%);
  --code-font-size: var(--font-size--small);
  --font-stack--monospace: DejaVu Sans Mono,"SFMono-Regular",Menlo,Consolas,Monaco,Liberation Mono,Lucida Console,monospace;;
  --color-api-overall: #FFFFFF90;
  --color-api-paren: #FFFFFF90;
  --color-problematic: #B30000;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">SymPy 1.13.dev documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><div class="sidebar-scroll"><a class="sidebar-brand" href="../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="../_static/sympylogo.png" alt="Logo"/>
  </div>
  
  <span class="sidebar-brand-text">SymPy 1.13.dev documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../install.html">Installation</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../tutorials/index.html">Tutorials</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../tutorials/intro-tutorial/index.html">Introductory Tutorial</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/intro-tutorial/preliminaries.html">Preliminaries</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/intro-tutorial/intro.html">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/intro-tutorial/gotchas.html">Gotchas</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../tutorials/intro-tutorial/features.html">SymPy Features</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/intro-tutorial/basic_operations.html">Basic Operations</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/intro-tutorial/printing.html">Printing</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/intro-tutorial/simplification.html">Simplification</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/intro-tutorial/calculus.html">Calculus</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/intro-tutorial/solvers.html">Solvers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/intro-tutorial/matrices.html">Matrices</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/intro-tutorial/manipulation.html">Advanced Expression Manipulation</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/intro-tutorial/next.html">What’s Next</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="index.html">How-to Guides</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="assumptions.html">Assumptions</a></li>
<li class="toctree-l2"><a class="reference internal" href="booleans.html">Symbolic and fuzzy booleans</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Writing Custom Functions</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="solving/index.html">Solve Equations</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="solving/solving-guidance.html">Solving Guidance</a></li>
<li class="toctree-l3"><a class="reference internal" href="solving/solve-equation-algebraically.html">Solve an Equation Algebraically</a></li>
<li class="toctree-l3"><a class="reference internal" href="solving/solve-system-of-equations-algebraically.html">Solve a System of Equations Algebraically</a></li>
<li class="toctree-l3"><a class="reference internal" href="solving/solve-numerically.html">Solve One or a System of Equations Numerically</a></li>
<li class="toctree-l3"><a class="reference internal" href="solving/solve-ode.html">Solve an Ordinary Differential Equation (ODE) Algebraically</a></li>
<li class="toctree-l3"><a class="reference internal" href="solving/find-roots-polynomial.html">Find the Roots of a Polynomial Algebraically or Numerically</a></li>
<li class="toctree-l3"><a class="reference internal" href="solving/solve-matrix-equation.html">Solve a Matrix Equation Algebraically</a></li>
<li class="toctree-l3"><a class="reference internal" href="solving/reduce-inequalities-algebraically.html">Reduce One or a System of Inequalities for a Single Variable Algebraically</a></li>
<li class="toctree-l3"><a class="reference internal" href="solving/solve-diophantine-equation.html">Solve a Diophantine Equation Algebraically</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../citing.html">Citing SymPy</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../explanation/index.html">Explanations</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../explanation/gotchas.html">Gotchas and Pitfalls</a></li>
<li class="toctree-l2"><a class="reference internal" href="../explanation/solve_output.html">Solve Output by Type</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../explanation/special_topics/index.html">SymPy Special Topics</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../explanation/special_topics/finite_diff_derivatives.html">Finite Difference Approximations to Derivatives</a></li>
<li class="toctree-l3"><a class="reference internal" href="../explanation/special_topics/classification.html">Classification of SymPy objects</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../explanation/active-deprecations.html">List of active deprecations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../explanation/glossary.html">Glossary</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../reference/index.html">API Reference</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../reference/public/basics/index.html">Basics</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" role="switch" type="checkbox"/><label for="toctree-checkbox-9"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../modules/assumptions/index.html">Assumptions</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" role="switch" type="checkbox"/><label for="toctree-checkbox-10"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../modules/assumptions/ask.html">Ask</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/assumptions/assume.html">Assume</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/assumptions/refine.html">Refine</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/assumptions/predicates.html">Predicates</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../modules/calculus/index.html">Calculus</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../modules/combinatorics/index.html">Combinatorics</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" role="switch" type="checkbox"/><label for="toctree-checkbox-11"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../modules/combinatorics/partitions.html">Partitions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/combinatorics/permutations.html">Permutations</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/combinatorics/perm_groups.html">Permutation Groups</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/combinatorics/polyhedron.html">Polyhedron</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/combinatorics/prufer.html">Prufer Sequences</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/combinatorics/subsets.html">Subsets</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/combinatorics/graycode.html">Gray Code</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/combinatorics/named_groups.html">Named Groups</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/combinatorics/galois.html">Galois Groups</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/combinatorics/group_numbers.html">Nilpotent, Abelian and Cyclic Numbers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/combinatorics/util.html">Utilities</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/combinatorics/group_constructs.html">Group constructors</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/combinatorics/testutil.html">Test Utilities</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/combinatorics/tensor_can.html">Tensor Canonicalization</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/combinatorics/fp_groups.html">Finitely Presented Groups</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/combinatorics/pc_groups.html">Polycyclic Groups</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../modules/functions/index.html">Functions</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" role="switch" type="checkbox"/><label for="toctree-checkbox-12"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../modules/functions/elementary.html">Elementary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/functions/combinatorial.html">Combinatorial</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/functions/combinatorial.html#enumeration">Enumeration</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/functions/special.html">Special</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../modules/integrals/index.html">Integrals</a><input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" role="switch" type="checkbox"/><label for="toctree-checkbox-13"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../modules/integrals/g-functions.html">Computing Integrals using Meijer G-Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/integrals/integrals.html">Integrals</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../modules/series/index.html">Series</a><input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" role="switch" type="checkbox"/><label for="toctree-checkbox-14"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../modules/series/series.html">Series Expansions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/series/sequences.html">Sequences</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/series/fourier.html">Fourier Series</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/series/formal.html">Formal Power Series</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/series/limitseq.html">Limits of Sequences</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../modules/simplify/index.html">Simplify</a><input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" role="switch" type="checkbox"/><label for="toctree-checkbox-15"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../modules/simplify/simplify.html">Simplify</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/simplify/hyperexpand.html">Hypergeometric Expansion</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/simplify/fu.html">Hongguang Fu’s Trigonometric Simplification</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../modules/solvers/index.html">Solvers</a><input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" role="switch" type="checkbox"/><label for="toctree-checkbox-16"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../modules/solvers/diophantine.html">Diophantine</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/solvers/inequalities.html">Inequality Solvers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/solvers/ode.html">ODE</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/solvers/pde.html">PDE</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/solvers/solvers.html">Solvers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/solvers/solveset.html">Solveset</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../modules/abc.html">abc</a></li>
<li class="toctree-l3"><a class="reference internal" href="../modules/algebras.html">Algebras</a></li>
<li class="toctree-l3"><a class="reference internal" href="../modules/concrete.html">Concrete</a></li>
<li class="toctree-l3"><a class="reference internal" href="../modules/core.html">Core</a></li>
<li class="toctree-l3"><a class="reference internal" href="../modules/discrete.html">Discrete</a></li>
<li class="toctree-l3"><a class="reference internal" href="../modules/evalf.html">Numerical Evaluation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../modules/numeric-computation.html">Numeric Computation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../modules/rewriting.html">Term Rewriting</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../reference/public/codegeneration/index.html">Code Generation</a><input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" role="switch" type="checkbox"/><label for="toctree-checkbox-17"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../modules/codegen.html">Code Generation</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../reference/public/logic/index.html">Logic</a><input class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" role="switch" type="checkbox"/><label for="toctree-checkbox-18"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../modules/logic.html">Logic</a></li>
<li class="toctree-l3"><a class="reference internal" href="../modules/sets.html">Sets</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../reference/public/matrices/index.html">Matrices</a><input class="toctree-checkbox" id="toctree-checkbox-19" name="toctree-checkbox-19" role="switch" type="checkbox"/><label for="toctree-checkbox-19"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../modules/matrices/index.html">Matrices</a><input class="toctree-checkbox" id="toctree-checkbox-20" name="toctree-checkbox-20" role="switch" type="checkbox"/><label for="toctree-checkbox-20"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../modules/matrices/matrices.html">Matrices (linear algebra)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/matrices/common.html">Common Matrices</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/matrices/dense.html">Dense Matrices</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/matrices/sparse.html">Sparse Matrices</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/matrices/sparsetools.html">Sparse Tools</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/matrices/immutablematrices.html">Immutable Matrices</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/matrices/expressions.html">Matrix Expressions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/matrices/normalforms.html">Matrix Normal Forms</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../modules/tensor/index.html">Tensor</a><input class="toctree-checkbox" id="toctree-checkbox-21" name="toctree-checkbox-21" role="switch" type="checkbox"/><label for="toctree-checkbox-21"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../modules/tensor/array.html">N-dim array</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/tensor/array_expressions.html">N-dim array expressions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/tensor/indexed.html">Indexed Objects</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/tensor/index_methods.html">Methods</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/tensor/tensor.html">Tensor</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/tensor/toperators.html">Tensor Operators</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../modules/vector/index.html">Vector</a><input class="toctree-checkbox" id="toctree-checkbox-22" name="toctree-checkbox-22" role="switch" type="checkbox"/><label for="toctree-checkbox-22"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../modules/vector/intro.html">Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/vector/basics.html">Basic Implementation details</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/vector/coordsys.html">More about Coordinate Systems</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/vector/fields.html">Scalar and Vector Field Functionality</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/vector/examples.html">General examples of usage</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/vector/vector_integration.html">Applications of Vector Integrals</a></li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../modules/vector/api/index.html">Vector API</a><input class="toctree-checkbox" id="toctree-checkbox-23" name="toctree-checkbox-23" role="switch" type="checkbox"/><label for="toctree-checkbox-23"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../modules/vector/api/classes.html">Essential Classes in sympy.vector (docstrings)</a></li>
<li class="toctree-l5"><a class="reference internal" href="../modules/vector/api/orienterclasses.html">Orienter classes (docstrings)</a></li>
<li class="toctree-l5"><a class="reference internal" href="../modules/vector/api/vectorfunctions.html">Essential Functions in sympy.vector (docstrings)</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../reference/public/numbertheory/index.html">Number Theory</a><input class="toctree-checkbox" id="toctree-checkbox-24" name="toctree-checkbox-24" role="switch" type="checkbox"/><label for="toctree-checkbox-24"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../modules/ntheory.html">Number Theory</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../reference/public/physics/index.html">Physics</a><input class="toctree-checkbox" id="toctree-checkbox-25" name="toctree-checkbox-25" role="switch" type="checkbox"/><label for="toctree-checkbox-25"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../modules/physics/hydrogen.html">Hydrogen Wavefunctions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../modules/physics/matrices.html">Matrices</a></li>
<li class="toctree-l3"><a class="reference internal" href="../modules/physics/paulialgebra.html">Pauli Algebra</a></li>
<li class="toctree-l3"><a class="reference internal" href="../modules/physics/qho_1d.html">Quantum Harmonic Oscillator in 1-D</a></li>
<li class="toctree-l3"><a class="reference internal" href="../modules/physics/sho.html">Quantum Harmonic Oscillator in 3-D</a></li>
<li class="toctree-l3"><a class="reference internal" href="../modules/physics/secondquant.html">Second Quantization</a></li>
<li class="toctree-l3"><a class="reference internal" href="../modules/physics/wigner.html">Wigner Symbols</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../modules/physics/units/index.html">Unit systems</a><input class="toctree-checkbox" id="toctree-checkbox-26" name="toctree-checkbox-26" role="switch" type="checkbox"/><label for="toctree-checkbox-26"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../modules/physics/units/philosophy.html">Philosophy behind unit systems</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/physics/units/examples.html">More examples</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/physics/units/dimensions.html">Dimensions and dimension systems</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/physics/units/prefixes.html">Unit prefixes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/physics/units/unitsystem.html">Units and unit systems</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/physics/units/quantities.html">Physical quantities</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../modules/physics/hep/index.html">High energy physics</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../modules/physics/vector/index.html">The Physics Vector Module</a><input class="toctree-checkbox" id="toctree-checkbox-27" name="toctree-checkbox-27" role="switch" type="checkbox"/><label for="toctree-checkbox-27"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../modules/physics/vector/vectors.html">Vector &amp; ReferenceFrame</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/physics/vector/kinematics.html">Vector: Kinematics</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/physics/vector/advanced.html">Potential Issues/Advanced Topics/Future Features in Physics/Vector Module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/physics/vector/fields.html">Scalar and Vector Field Functionality</a></li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../modules/physics/vector/api/index.html">Physics Vector API</a><input class="toctree-checkbox" id="toctree-checkbox-28" name="toctree-checkbox-28" role="switch" type="checkbox"/><label for="toctree-checkbox-28"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../modules/physics/vector/api/classes.html">Essential Classes</a></li>
<li class="toctree-l5"><a class="reference internal" href="../modules/physics/vector/api/kinematics.html">Kinematics (Docstrings)</a></li>
<li class="toctree-l5"><a class="reference internal" href="../modules/physics/vector/api/printing.html">Printing (Docstrings)</a></li>
<li class="toctree-l5"><a class="reference internal" href="../modules/physics/vector/api/functions.html">Essential Functions (Docstrings)</a></li>
<li class="toctree-l5"><a class="reference internal" href="../modules/physics/vector/api/fieldfunctions.html">Docstrings for basic field functions</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../modules/physics/mechanics/index.html">Classical Mechanics</a><input class="toctree-checkbox" id="toctree-checkbox-29" name="toctree-checkbox-29" role="switch" type="checkbox"/><label for="toctree-checkbox-29"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../modules/physics/mechanics/masses.html">Masses, Inertias, Particles and Rigid Bodies in Physics/Mechanics</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/physics/mechanics/kane.html">Kane’s Method in Physics/Mechanics</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/physics/mechanics/lagrange.html">Lagrange’s Method in Physics/Mechanics</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/physics/mechanics/joints.html">Joints Framework in Physics/Mechanics</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/physics/mechanics/symsystem.html">Symbolic Systems in Physics/Mechanics</a></li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../modules/physics/mechanics/linearize.html">Linearization in Physics/Mechanics</a><input class="toctree-checkbox" id="toctree-checkbox-30" name="toctree-checkbox-30" role="switch" type="checkbox"/><label for="toctree-checkbox-30"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../modules/physics/mechanics/examples/lin_pend_nonmin_example.html">Nonminimal Coordinates Pendulum</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../modules/physics/mechanics/examples.html">Examples for Physics/Mechanics</a><input class="toctree-checkbox" id="toctree-checkbox-31" name="toctree-checkbox-31" role="switch" type="checkbox"/><label for="toctree-checkbox-31"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5 has-children"><a class="reference internal" href="../modules/physics/mechanics/examples/rollingdisc_example.html">A rolling disc</a><input class="toctree-checkbox" id="toctree-checkbox-32" name="toctree-checkbox-32" role="switch" type="checkbox"/><label for="toctree-checkbox-32"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l6"><a class="reference internal" href="../modules/physics/mechanics/examples/rollingdisc_example_kane.html">A rolling disc, with Kane’s method</a></li>
<li class="toctree-l6"><a class="reference internal" href="../modules/physics/mechanics/examples/rollingdisc_example_kane_constraints.html">A rolling disc, with Kane’s method and constraint forces</a></li>
<li class="toctree-l6"><a class="reference internal" href="../modules/physics/mechanics/examples/rollingdisc_example_lagrange.html">A rolling disc using Lagrange’s Method</a></li>
</ul>
</li>
<li class="toctree-l5"><a class="reference internal" href="../modules/physics/mechanics/examples/bicycle_example.html">A bicycle</a></li>
<li class="toctree-l5"><a class="reference internal" href="../modules/physics/mechanics/examples/lin_pend_nonmin_example.html">Nonminimal Coordinates Pendulum</a></li>
<li class="toctree-l5"><a class="reference internal" href="../modules/physics/mechanics/examples/multi_degree_freedom_holonomic_system.html">Multi Degree of Freedom Holonomic System</a></li>
<li class="toctree-l5"><a class="reference internal" href="../modules/physics/mechanics/examples/four_bar_linkage_example.html">A four bar linkage</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../modules/physics/mechanics/advanced.html">Potential Issues/Advanced Topics/Future Features in Physics/Mechanics</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/physics/mechanics/reference.html">References for Physics/Mechanics</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/physics/mechanics/autolev_parser.html">Autolev Parser</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/physics/mechanics/sympy_mechanics_for_autolev_users.html">SymPy Mechanics for Autolev Users</a></li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../modules/physics/mechanics/api/index.html">Mechanics API Reference</a><input class="toctree-checkbox" id="toctree-checkbox-33" name="toctree-checkbox-33" role="switch" type="checkbox"/><label for="toctree-checkbox-33"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../modules/physics/mechanics/api/part_bod.html">Bodies, Inertias, Loads &amp; Other Functions (Docstrings)</a></li>
<li class="toctree-l5"><a class="reference internal" href="../modules/physics/mechanics/api/body.html">Body (Docstrings)</a></li>
<li class="toctree-l5"><a class="reference internal" href="../modules/physics/mechanics/api/kane_lagrange.html">Kane’s Method &amp; Lagrange’s Method (Docstrings)</a></li>
<li class="toctree-l5"><a class="reference internal" href="../modules/physics/mechanics/api/joint.html">Joints Framework (Docstrings)</a></li>
<li class="toctree-l5"><a class="reference internal" href="../modules/physics/mechanics/api/system.html">SymbolicSystem (Docstrings)</a></li>
<li class="toctree-l5"><a class="reference internal" href="../modules/physics/mechanics/api/linearize.html">Linearization (Docstrings)</a></li>
<li class="toctree-l5"><a class="reference internal" href="../modules/physics/mechanics/api/expr_manip.html">Expression Manipulation (Docstrings)</a></li>
<li class="toctree-l5"><a class="reference internal" href="../modules/physics/mechanics/api/printing.html">Printing (Docstrings)</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../modules/physics/quantum/index.html">Quantum Mechanics</a><input class="toctree-checkbox" id="toctree-checkbox-34" name="toctree-checkbox-34" role="switch" type="checkbox"/><label for="toctree-checkbox-34"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../modules/physics/quantum/anticommutator.html">Anticommutator</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/physics/quantum/cg.html">Clebsch-Gordan Coefficients</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/physics/quantum/commutator.html">Commutator</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/physics/quantum/constants.html">Constants</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/physics/quantum/dagger.html">Dagger</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/physics/quantum/innerproduct.html">Inner Product</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/physics/quantum/tensorproduct.html">Tensor Product</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/physics/quantum/cartesian.html">Cartesian Operators and States</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/physics/quantum/hilbert.html">Hilbert Space</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/physics/quantum/operator.html">Operator</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/physics/quantum/operatorset.html">Operator/State Helper Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/physics/quantum/qapply.html">Qapply</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/physics/quantum/represent.html">Represent</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/physics/quantum/spin.html">Spin</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/physics/quantum/state.html">State</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/physics/quantum/circuitplot.html">Circuit Plot</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/physics/quantum/gate.html">Gates</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/physics/quantum/grover.html">Grover’s Algorithm</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/physics/quantum/qft.html">QFT</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/physics/quantum/qubit.html">Qubit</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/physics/quantum/shor.html">Shor’s Algorithm</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/physics/quantum/piab.html">Particle in a Box</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../modules/physics/optics/index.html">Optics Module</a><input class="toctree-checkbox" id="toctree-checkbox-35" name="toctree-checkbox-35" role="switch" type="checkbox"/><label for="toctree-checkbox-35"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../modules/physics/optics/gaussopt.html">Gaussian Optics</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/physics/optics/medium.html">Medium</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/physics/optics/polarization.html">Polarization</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/physics/optics/utils.html">Utilities</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/physics/optics/waves.html">Waves</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../modules/physics/control/index.html">Control Module</a><input class="toctree-checkbox" id="toctree-checkbox-36" name="toctree-checkbox-36" role="switch" type="checkbox"/><label for="toctree-checkbox-36"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../modules/physics/control/control.html">Control</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/physics/control/lti.html">Control API</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/physics/control/control_plots.html">Control System Plots</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../modules/physics/continuum_mechanics/index.html">Continuum Mechanics</a><input class="toctree-checkbox" id="toctree-checkbox-37" name="toctree-checkbox-37" role="switch" type="checkbox"/><label for="toctree-checkbox-37"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../modules/physics/continuum_mechanics/beam.html">Beam (Docstrings)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/physics/continuum_mechanics/beam_problems.html">Solving Beam Bending Problems using Singularity Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/physics/continuum_mechanics/truss.html">Truss (Docstrings)</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../reference/public/utilities/index.html">Utilities</a><input class="toctree-checkbox" id="toctree-checkbox-38" name="toctree-checkbox-38" role="switch" type="checkbox"/><label for="toctree-checkbox-38"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../modules/testing/index.html">Testing</a><input class="toctree-checkbox" id="toctree-checkbox-39" name="toctree-checkbox-39" role="switch" type="checkbox"/><label for="toctree-checkbox-39"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../modules/testing/pytest.html">pytest</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/testing/randtest.html">Randomised Testing</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/testing/runtests.html">Run Tests</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../modules/utilities/index.html">Utilities</a><input class="toctree-checkbox" id="toctree-checkbox-40" name="toctree-checkbox-40" role="switch" type="checkbox"/><label for="toctree-checkbox-40"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../modules/utilities/autowrap.html">Autowrap Module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/utilities/codegen.html">Codegen</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/utilities/decorator.html">Decorator</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/utilities/enumerative.html">Enumerative</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/utilities/exceptions.html">Exceptions and Warnings</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/utilities/iterables.html">Iterables</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/utilities/lambdify.html">Lambdify</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/utilities/memoization.html">Memoization</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/utilities/misc.html">Miscellaneous</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/utilities/pkgdata.html">PKGDATA</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/utilities/source.html">Source Code Inspection</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/utilities/timeutils.html">Timing Utilities</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../modules/interactive.html">Interactive</a></li>
<li class="toctree-l3"><a class="reference internal" href="../modules/parsing.html">Parsing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../modules/printing.html">Printing</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../reference/public/topics/index.html">Topics</a><input class="toctree-checkbox" id="toctree-checkbox-41" name="toctree-checkbox-41" role="switch" type="checkbox"/><label for="toctree-checkbox-41"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../modules/geometry/index.html">Geometry</a><input class="toctree-checkbox" id="toctree-checkbox-42" name="toctree-checkbox-42" role="switch" type="checkbox"/><label for="toctree-checkbox-42"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../modules/geometry/entities.html">Entities</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/geometry/utils.html">Utils</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/geometry/points.html">Points</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/geometry/lines.html">Lines</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/geometry/curves.html">Curves</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/geometry/ellipses.html">Ellipses</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/geometry/polygons.html">Polygons</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/geometry/plane.html">Plane</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../modules/holonomic/index.html">Holonomic</a><input class="toctree-checkbox" id="toctree-checkbox-43" name="toctree-checkbox-43" role="switch" type="checkbox"/><label for="toctree-checkbox-43"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../modules/holonomic/about.html">About Holonomic Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/holonomic/represent.html">Representation of holonomic functions in SymPy</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/holonomic/operations.html">Operations on holonomic functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/holonomic/convert.html">Converting other representations to holonomic</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/holonomic/uses.html">Uses and Current limitations</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/holonomic/internal.html">Internal API</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../modules/liealgebras/index.html">Lie Algebra</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../modules/polys/index.html">Polynomial Manipulation</a><input class="toctree-checkbox" id="toctree-checkbox-44" name="toctree-checkbox-44" role="switch" type="checkbox"/><label for="toctree-checkbox-44"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../modules/polys/basics.html">Basic functionality of the module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/polys/wester.html">Examples from Wester’s Article</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/polys/reference.html">Polynomials Manipulation Module Reference</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/polys/agca.html">AGCA - Algebraic Geometry and Commutative Algebra Module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/polys/domainsintro.html">Introducing the Domains of the poly module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/polys/domainsref.html">Reference docs for the Poly Domains</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/polys/internals.html">Internals of the Polynomial Manipulation Module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/polys/ringseries.html">Series Manipulation using Polynomials</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/polys/literature.html">Literature</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/polys/solvers.html">Poly solvers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/polys/domainmatrix.html">Introducing the domainmatrix of the poly module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modules/polys/numberfields.html">Number Fields</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../modules/categories.html">Category Theory</a></li>
<li class="toctree-l3"><a class="reference internal" href="../modules/crypto.html">Cryptography</a></li>
<li class="toctree-l3"><a class="reference internal" href="../modules/diffgeom.html">Differential Geometry</a></li>
<li class="toctree-l3"><a class="reference internal" href="../modules/plotting.html">Plotting</a></li>
<li class="toctree-l3"><a class="reference internal" href="../modules/stats.html">Stats</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../contributing/index.html">Contributing</a><input class="toctree-checkbox" id="toctree-checkbox-45" name="toctree-checkbox-45" role="switch" type="checkbox"/><label for="toctree-checkbox-45"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../contributing/introduction-to-contributing.html">Introduction to Contributing</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../contributing/new-contributors-guide/index.html">Guide for New Contributors</a><input class="toctree-checkbox" id="toctree-checkbox-46" name="toctree-checkbox-46" role="switch" type="checkbox"/><label for="toctree-checkbox-46"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../contributing/new-contributors-guide/dev-setup.html">Setup Development Environment</a></li>
<li class="toctree-l3"><a class="reference internal" href="../contributing/new-contributors-guide/workflow-process.html">Development Workflow Process</a></li>
<li class="toctree-l3"><a class="reference internal" href="../contributing/new-contributors-guide/writing-tests.html">Writing Tests</a></li>
<li class="toctree-l3"><a class="reference internal" href="../contributing/new-contributors-guide/build-docs.html">Building the Documentation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../contributing/dependencies.html">Dependencies</a></li>
<li class="toctree-l2"><a class="reference internal" href="../contributing/debug.html">Debugging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../contributing/docstring.html">SymPy Docstrings Style Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../contributing/documentation-style-guide.html">Docstring Style Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../contributing/deprecations.html">Deprecation Policy</a></li>
</ul>
</li>
</ul>

</div><!-- Versions Menu. In order to work, there should be a file called versions.json one level up from the documentation listing the "dev" and "latest" version numbers, like
{
    "latest": "1.10",
    "dev": "1.11.dev"
}
-->
<div class="sidebar-tree sidebar-versions">
  <h5 class="versions-header">Documentation Version</h4>
</div>

<!-- Make sure jquery is loaded (we would put this as a separate .js, but it uses jinja templates in some of the variables) -->
<script src="../_static/jquery.js"></script>
<script>
  var versions_json_loc = "../../versions.json";

  function add_version_menu(json_loc) {
      var menu = document.createElement("ul");
      var thisversion = "dev"
      $.getJSON(json_loc, function(versions) {
          for (var key in versions) {
              if (key != "latest" && key != "dev") {
                  console.error("Invalid key in versions.json", key);
              } else {
                  var version = document.createElement("li")
                  version.className = "sidebar-versions-l1 sidebar-versions-" + key + "-l1";
                  if (key == thisversion){
                      version.className += " current-version";
                  }
                  var a = document.createElement("a");
                  a.className = "reference internal";
                  a.innerHTML = "SymPy " + versions[key] + " (" + key + " version)";
                  a.title = key + " version";
                  a.href = "https://docs.sympy.org/" + key + "/guides/custom-functions.html";
                  version.appendChild(a);
                  menu.appendChild(version);
              }
          }
      }).done(function() {
          console.log("versions.json read successfully");
      }).fail(function() {
          var version = document.createElement("li")
          version.className = "sidebar-versions-l1 sidebar-versions-latest-l1";
          var d = document.createElement("div");
          d.className = "versions-not-found"
          d.innerHTML = "Other Versions Not Found";
          d.title = "The version selection menu is only available for the documentation published on docs.sympy.org";
          version.appendChild(d);
          menu.appendChild(version);
          console.error("Could not read versions.json");
      }).always(function() {
          $(".sidebar-versions").append(menu)
      });
  };

  $( document ).ready( add_version_menu(versions_json_loc));
</script></div>
      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section class="tex2jax_ignore mathjax_ignore" id="writing-custom-functions">
<span id="custom-functions"></span><h1>Writing Custom Functions<a class="headerlink" href="#writing-custom-functions" title="Permalink to this heading">#</a></h1>
<!-- Note to contributors: if you update one of the examples in this guide, be
     sure to also update the complete example at the end. -->
<p>This guide will describe how to create custom function classes in SymPy.
Custom user defined functions use the same mechanisms as the <a class="reference internal" href="../modules/functions/index.html#functions"><span class="std std-ref">functions</span></a> that are included with SymPy such as the common <a class="reference internal" href="../modules/functions/elementary.html#elementary-functions"><span class="std std-ref">elementary functions</span></a> like <a class="reference internal" href="../modules/functions/elementary.html#sympy.functions.elementary.exponential.exp" title="sympy.functions.elementary.exponential.exp"><code class="xref py py-class docutils literal notranslate"><span class="pre">exp()</span></code></a> or <a class="reference internal" href="../modules/functions/elementary.html#sympy.functions.elementary.trigonometric.sin" title="sympy.functions.elementary.trigonometric.sin"><code class="xref py py-class docutils literal notranslate"><span class="pre">sin()</span></code></a>,
<a class="reference internal" href="../modules/functions/special.html#special-functions"><span class="std std-ref">special functions</span></a> like <a class="reference internal" href="../modules/functions/special.html#sympy.functions.special.gamma_functions.gamma" title="sympy.functions.special.gamma_functions.gamma"><code class="xref py py-class docutils literal notranslate"><span class="pre">gamma()</span></code></a> or
<a class="reference internal" href="../modules/functions/special.html#sympy.functions.special.error_functions.Si" title="sympy.functions.special.error_functions.Si"><code class="xref py py-class docutils literal notranslate"><span class="pre">Si()</span></code></a>, and <a class="reference internal" href="../modules/functions/combinatorial.html#combinatorial-functions"><span class="std std-ref">combinatorial functions</span></a>
and <a class="reference internal" href="../modules/ntheory.html#ntheory-module"><span class="std std-ref">number theory functions</span></a> like
<a class="reference internal" href="../modules/functions/combinatorial.html#sympy.functions.combinatorial.factorials.factorial" title="sympy.functions.combinatorial.factorials.factorial"><code class="xref py py-class docutils literal notranslate"><span class="pre">factorial()</span></code></a> or <a class="reference internal" href="../modules/ntheory.html#sympy.ntheory.generate.primepi" title="sympy.ntheory.generate.primepi"><code class="xref py py-func docutils literal notranslate"><span class="pre">primepi()</span></code></a>. Consequently, this guide serves
both as a guide to end users who want to define their own custom functions and
to SymPy developers wishing to extend the functions included with SymPy.</p>
<p>This guide describes how to define complex valued functions, that is functions
that map a subset of <span class="math notranslate nohighlight">\(\mathbb{C}^n\)</span> to <span class="math notranslate nohighlight">\(\mathbb{C}\)</span>. Functions that accept or
return other kinds of objects than complex numbers should subclass another
class, such as <a class="reference internal" href="../modules/logic.html#sympy.logic.boolalg.Boolean" title="sympy.logic.boolalg.Boolean"><code class="xref py py-class docutils literal notranslate"><span class="pre">Boolean</span></code></a>, <a class="reference internal" href="../modules/matrices/expressions.html#sympy.matrices.expressions.MatrixExpr" title="sympy.matrices.expressions.MatrixExpr"><code class="xref py py-class docutils literal notranslate"><span class="pre">MatrixExpr</span></code></a>, <a class="reference internal" href="../modules/core.html#sympy.core.expr.Expr" title="sympy.core.expr.Expr"><code class="xref py py-class docutils literal notranslate"><span class="pre">Expr</span></code></a>, or
<a class="reference internal" href="../modules/core.html#sympy.core.basic.Basic" title="sympy.core.basic.Basic"><code class="xref py py-class docutils literal notranslate"><span class="pre">Basic</span></code></a>. Some of what is written here will apply to general
<a class="reference internal" href="../modules/core.html#sympy.core.basic.Basic" title="sympy.core.basic.Basic"><code class="xref py py-class docutils literal notranslate"><span class="pre">Basic</span></code></a> or <a class="reference internal" href="../modules/core.html#sympy.core.expr.Expr" title="sympy.core.expr.Expr"><code class="xref py py-class docutils literal notranslate"><span class="pre">Expr</span></code></a> subclasses, but much of it only applies to
<a class="reference internal" href="../modules/core.html#sympy.core.function.Function" title="sympy.core.function.Function"><code class="xref py py-class docutils literal notranslate"><span class="pre">Function</span></code></a> subclasses.</p>
<section id="easy-cases-fully-symbolic-or-fully-evaluated">
<h2>Easy Cases: Fully Symbolic or Fully Evaluated<a class="headerlink" href="#easy-cases-fully-symbolic-or-fully-evaluated" title="Permalink to this heading">#</a></h2>
<p>Before digging into the more advanced functionality for custom functions, we
should mention two common cases, the case where the function is fully
symbolic, and the case where the function is fully evaluated. Both of these
cases have much simpler alternatives than the full mechanisms described in this
guide.</p>
<section id="the-fully-symbolic-case">
<span id="custom-functions-fully-symbolic"></span><h3>The Fully Symbolic Case<a class="headerlink" href="#the-fully-symbolic-case" title="Permalink to this heading">#</a></h3>
<p>If your function <code class="docutils literal notranslate"><span class="pre">f</span></code> has no mathematical properties you
want to define on it, and should never evaluate on any arguments, you can
create an undefined function using <code class="docutils literal notranslate"><span class="pre">Function('f')</span></code></p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sympy</span> <span class="kn">import</span> <span class="n">symbols</span><span class="p">,</span> <span class="n">Function</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">f</span> <span class="o">=</span> <span class="n">Function</span><span class="p">(</span><span class="s1">&#39;f&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="go">f(x)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">f</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="go">f(0)</span>
</pre></div>
</div>
<p>This is useful, for instance, when solving <a class="reference internal" href="../modules/solvers/ode.html#ode-docs"><span class="std std-ref">ODEs</span></a>.</p>
<p>This is also useful if you only wish to create a symbol that depends on
another symbol for the purposes of differentiation. By default, SymPy assumes
all symbols are independent of one another:</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sympy.abc</span> <span class="kn">import</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">y</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="go">0</span>
</pre></div>
</div>
<p>To make a symbol that depends on another symbol, you can use a function that
explicitly depends on that symbol.</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">y</span> <span class="o">=</span> <span class="n">Function</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">y</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="go">Derivative(y(x), x)</span>
</pre></div>
</div>
<p>If you want your function to have additional behavior, for example, to have a
custom derivative, or to evaluate on certain arguments, you should create a
custom <code class="docutils literal notranslate"><span class="pre">Function</span></code> subclass as <a class="reference internal" href="#custom-functions-function-subclass"><span class="std std-ref">described
below</span></a>. However, undefined functions do
support one additional feature, which is that assumptions can be defined on
them, using the same syntax as used by symbols. This defines the assumptions
of the output of the function, not the input (that is, it defines the
function’s range, not its domain).</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">g</span> <span class="o">=</span> <span class="n">Function</span><span class="p">(</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">real</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">g</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="go">g(x)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">g</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">is_real</span>
<span class="go">True</span>
</pre></div>
</div>
<p>To make a function’s assumptions depend on its input in some way, you should
create a custom <code class="docutils literal notranslate"><span class="pre">Function</span></code> subclass and define assumptions handlers as
<a class="reference internal" href="#custom-functions-assumptions"><span class="std std-ref">described below</span></a>.</p>
</section>
<section id="the-fully-evaluated-case">
<span id="custom-functions-fully-evaluated"></span><h3>The Fully Evaluated Case<a class="headerlink" href="#the-fully-evaluated-case" title="Permalink to this heading">#</a></h3>
<p>At the other end of the spectrum are functions that always evaluate to
something no matter what their inputs are. These functions are never left in
an unevaluated, symbolic form like <code class="docutils literal notranslate"><span class="pre">f(x)</span></code>.</p>
<p>In this case, you should use a normal Python function using the <code class="docutils literal notranslate"><span class="pre">def</span></code>
keyword:</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="mi">0</span>
<span class="gp">... </span>    <span class="k">else</span><span class="p">:</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span>
</pre></div>
</div>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">f</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="go">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">f</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="go">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="go">x + 1</span>
</pre></div>
</div>
<p>If you find yourself defining an <a class="reference internal" href="#custom-functions-eval"><span class="std std-ref"><code class="docutils literal notranslate"><span class="pre">eval()</span></code></span></a> method on a
<code class="docutils literal notranslate"><span class="pre">Function</span></code> subclass where you always return a value and never return <code class="docutils literal notranslate"><span class="pre">None</span></code>,
you should consider just using a normal Python function instead, as there is
no benefit to using a symbolic <code class="docutils literal notranslate"><span class="pre">Function</span></code> subclass in that case (see the
<a class="reference internal" href="#custom-functions-eval-best-practices"><span class="std std-ref">Best Practices for eval()</span></a> section below)</p>
<p>Note that in many cases, functions like these can be represented directly
using SymPy classes. For example, the above function can be represented
symbolically using <a class="reference internal" href="../modules/functions/elementary.html#sympy.functions.elementary.piecewise.Piecewise" title="sympy.functions.elementary.piecewise.Piecewise"><code class="xref py py-class docutils literal notranslate"><span class="pre">Piecewise</span></code></a>. The <code class="docutils literal notranslate"><span class="pre">Piecewise</span></code> expression can be
evaluated for specific values of <code class="docutils literal notranslate"><span class="pre">x</span></code> using <a class="reference internal" href="../modules/core.html#sympy.core.basic.Basic.subs" title="sympy.core.basic.Basic.subs"><code class="xref py py-meth docutils literal notranslate"><span class="pre">subs()</span></code></a>.</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sympy</span> <span class="kn">import</span> <span class="n">Piecewise</span><span class="p">,</span> <span class="n">Eq</span><span class="p">,</span> <span class="n">pprint</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">f</span> <span class="o">=</span> <span class="n">Piecewise</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="n">Eq</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="kc">True</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pprint</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">use_unicode</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="go">⎧  0    for x = 0</span>
<span class="go">⎨</span>
<span class="go">⎩x + 1  otherwise</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">f</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="go">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">f</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="go">2</span>
</pre></div>
</div>
<p>Fully symbolic representations like <code class="docutils literal notranslate"><span class="pre">Piecewise</span></code> have the advantage that they
accurately represent symbolic values. For example, in the above Python <code class="docutils literal notranslate"><span class="pre">def</span></code>
definition of <code class="docutils literal notranslate"><span class="pre">f</span></code>, <code class="docutils literal notranslate"><span class="pre">f(x)</span></code> implicitly assumes that <code class="docutils literal notranslate"><span class="pre">x</span></code> is nonzero. The
<code class="docutils literal notranslate"><span class="pre">Piecewise</span></code> version handles this case correctly and won’t evaluate to the <span class="math notranslate nohighlight">\(x
\neq 0\)</span> case unless <code class="docutils literal notranslate"><span class="pre">x</span></code> is known to not be zero.</p>
<p>Another option, if you want a function that not only evaluates, but always
evaluates to a numerical value, is to use <a class="reference internal" href="../modules/utilities/lambdify.html#sympy.utilities.lambdify.lambdify" title="sympy.utilities.lambdify.lambdify"><code class="xref py py-func docutils literal notranslate"><span class="pre">lambdify()</span></code></a>. This will
convert a SymPy expression into a function that can be evaluated using NumPy.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sympy</span> <span class="kn">import</span> <span class="n">lambdify</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">func</span> <span class="o">=</span> <span class="n">lambdify</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">Piecewise</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="n">Eq</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="kc">True</span><span class="p">)))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span> 
<span class="gp">&gt;&gt;&gt; </span><span class="n">func</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span> 
<span class="go">array([0., 2., 3., 4., 5.])</span>
</pre></div>
</div>
<p>Ultimately, the correct tool for the job depends on what you are doing and
what exact behavior you want.</p>
</section>
</section>
<section id="creating-a-custom-function">
<span id="custom-functions-function-subclass"></span><h2>Creating a Custom Function<a class="headerlink" href="#creating-a-custom-function" title="Permalink to this heading">#</a></h2>
<p>The first step to creating a custom function is to subclass
<a class="reference internal" href="../modules/core.html#sympy.core.function.Function" title="sympy.core.function.Function"><code class="xref py py-class docutils literal notranslate"><span class="pre">Function</span></code></a>. The name of the subclass will be the name of the
function. Different methods should then be defined on this subclass, depending
on what functionality you want to provide.</p>
<p>As a motivating example for this document, let’s create a custom function
class representing the <a class="reference external" href="https://en.wikipedia.org/wiki/Versine">versine
function</a>. Versine is a trigonometric
function which was used historically alongside some of the more familiar
trigonometric functions like sine and cosine. It is rarely used today. Versine
can be defined by the identity</p>
<div class="math-wrapper docutils container" id="custom-functions-versine-definition">
<div class="math notranslate nohighlight" id="custom-functions-versine-definition">
\[\operatorname{versin}(x) = 1 - \cos(x).\]</div>
</div>
<p>SymPy does not already include versine because it is used so rarely in modern
mathematics and because it is so easily defined in terms of the more familiar
cosine.</p>
<p>Let us start by subclassing <code class="docutils literal notranslate"><span class="pre">Function</span></code>.</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">versin</span><span class="p">(</span><span class="n">Function</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">pass</span>
</pre></div>
</div>
<p>At this point, <code class="docutils literal notranslate"><span class="pre">versin</span></code> has no behaviors defined on it. It is very similar to
the <a class="reference internal" href="#custom-functions-fully-symbolic"><span class="std std-ref">undefined functions</span></a> we discussed above.
Note that <code class="docutils literal notranslate"><span class="pre">versin</span></code> is a class, and <code class="docutils literal notranslate"><span class="pre">versin(x)</span></code> is an instance of this class.</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">versin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="go">versin(x)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">isinstance</span><span class="p">(</span><span class="n">versin</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">versin</span><span class="p">)</span>
<span class="go">True</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>All the methods described below are optional. They can be included if you want
to define the given behavior, but if they are omitted, SymPy will default to
leaving things unevaluated. For example, if you do not define
<a class="reference internal" href="#custom-functions-differentiation"><span class="std std-ref">differentiation</span></a>, <a class="reference internal" href="../modules/core.html#sympy.core.function.diff" title="sympy.core.function.diff"><code class="xref py py-func docutils literal notranslate"><span class="pre">diff()</span></code></a> will just
return an unevaluated <a class="reference internal" href="../modules/core.html#sympy.core.function.Derivative" title="sympy.core.function.Derivative"><code class="xref py py-class docutils literal notranslate"><span class="pre">Derivative</span></code></a>.</p>
</div>
<section id="defining-automatic-evaluation-with-eval">
<span id="custom-functions-eval"></span><h3>Defining Automatic Evaluation with <code class="docutils literal notranslate"><span class="pre">eval()</span></code><a class="headerlink" href="#defining-automatic-evaluation-with-eval" title="Permalink to this heading">#</a></h3>
<aside class="sidebar">
<p class="sidebar-title">Reminder</p>
<p>Remember that <code class="docutils literal notranslate"><span class="pre">eval()</span></code> should be defined with the <code class="docutils literal notranslate"><span class="pre">&#64;classmethod</span></code> decorator.</p>
</aside>
<p>The first and most common thing we might want to define on our custom function
is automatic evaluation, that is, the cases where it will return an actual
value instead of just remaining unevaluated as-is.</p>
<p>This is done by defining the class method <code class="docutils literal notranslate"><span class="pre">eval()</span></code>. <code class="docutils literal notranslate"><span class="pre">eval()</span></code> should take the
arguments of the function and return either a value or <code class="docutils literal notranslate"><span class="pre">None</span></code>. If it returns
<code class="docutils literal notranslate"><span class="pre">None</span></code>, the function will remain unevaluated in that case. This also serves to
define the signature of the function (by default, without an <code class="docutils literal notranslate"><span class="pre">eval()</span></code> method, a
<code class="docutils literal notranslate"><span class="pre">Function</span></code> subclass will accept any number of arguments).</p>
<p>For our function <code class="docutils literal notranslate"><span class="pre">versin</span></code>, we might recall that <span class="math notranslate nohighlight">\(\cos(n\pi) = (-1)^n\)</span> for
integer <span class="math notranslate nohighlight">\(n\)</span>, so <span class="math notranslate nohighlight">\(\operatorname{versin}(n\pi) = 1 - (-1)^n.\)</span> We can make
<code class="docutils literal notranslate"><span class="pre">versin</span></code> automatically evaluate to this value when passed an integer multiple
of <code class="docutils literal notranslate"><span class="pre">pi</span></code>:</p>
<div class="highlight-py notranslate" id="custom-functions-versin-eval-example"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sympy</span> <span class="kn">import</span> <span class="n">pi</span><span class="p">,</span> <span class="n">Integer</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">versin</span><span class="p">(</span><span class="n">Function</span><span class="p">):</span>
<span class="gp">... </span>   <span class="nd">@classmethod</span>
<span class="gp">... </span>   <span class="k">def</span> <span class="nf">eval</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<span class="gp">... </span>       <span class="c1"># If x is an integer multiple of pi, x/pi will cancel and be an Integer</span>
<span class="gp">... </span>       <span class="n">n</span> <span class="o">=</span> <span class="n">x</span><span class="o">/</span><span class="n">pi</span>
<span class="gp">... </span>       <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">Integer</span><span class="p">):</span>
<span class="gp">... </span>           <span class="k">return</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="n">n</span>
</pre></div>
</div>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">versin</span><span class="p">(</span><span class="n">pi</span><span class="p">)</span>
<span class="go">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">versin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="p">)</span>
<span class="go">0</span>
</pre></div>
</div>
<p>Here we make use of the fact that if a Python function does not explicitly
return a value, it automatically returns <code class="docutils literal notranslate"><span class="pre">None</span></code>. So in the cases where the <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">isinstance(n,</span> <span class="pre">Integer)</span></code> statement is not triggered, <code class="docutils literal notranslate"><span class="pre">eval()</span></code> returns <code class="docutils literal notranslate"><span class="pre">None</span></code>
and <code class="docutils literal notranslate"><span class="pre">versin</span></code> remains unevaluated.</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">versin</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">pi</span><span class="p">)</span>
<span class="go">versin(pi*x)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">Function</span></code> subclasses should not redefine <code class="docutils literal notranslate"><span class="pre">__new__</span></code> or <code class="docutils literal notranslate"><span class="pre">__init__</span></code>. If you want
to implement behavior that isn’t possible with <code class="docutils literal notranslate"><span class="pre">eval()</span></code>, it might make more
sense to subclass <a class="reference internal" href="../modules/core.html#sympy.core.expr.Expr" title="sympy.core.expr.Expr"><code class="xref py py-class docutils literal notranslate"><span class="pre">Expr</span></code></a> rather than <code class="docutils literal notranslate"><span class="pre">Function</span></code>.</p>
</div>
<p><code class="docutils literal notranslate"><span class="pre">eval()</span></code> can take any number of arguments, including an arbitrary number with
<code class="docutils literal notranslate"><span class="pre">*args</span></code> and optional keyword arguments. The <code class="docutils literal notranslate"><span class="pre">.args</span></code> of the function will
always be the arguments that were passed in by the user. For example</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">f</span><span class="p">(</span><span class="n">Function</span><span class="p">):</span>
<span class="gp">... </span>    <span class="nd">@classmethod</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">eval</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="kc">None</span>
</pre></div>
</div>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">f</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">args</span>
<span class="go">(1,)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">f</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">args</span>
<span class="go">(1, 2)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">f</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">args</span>
<span class="go">(1, 2, 3)</span>
</pre></div>
</div>
<p>Finally, note that automatic evaluation on floating-point inputs happens
automatically once <a class="reference internal" href="#custom-functions-evalf"><span class="std std-ref"><code class="docutils literal notranslate"><span class="pre">evalf()</span></code> is defined</span></a>, so you do
not need to handle it explicitly in <code class="docutils literal notranslate"><span class="pre">eval()</span></code>.</p>
<section id="best-practices-for-eval">
<span id="custom-functions-eval-best-practices"></span><h4>Best Practices for <code class="docutils literal notranslate"><span class="pre">eval()</span></code><a class="headerlink" href="#best-practices-for-eval" title="Permalink to this heading">#</a></h4>
<p>Certain antipatterns are common when defining <code class="docutils literal notranslate"><span class="pre">eval()</span></code> methods and should be
avoided.</p>
<ul>
<li><p><strong>Don’t just return an expression.</strong></p>
<p>In the above example, we might have been tempted to write</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sympy</span> <span class="kn">import</span> <span class="n">cos</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">versin</span><span class="p">(</span><span class="n">Function</span><span class="p">):</span>
<span class="gp">... </span>    <span class="nd">@classmethod</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">eval</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<span class="gp">... </span>        <span class="c1"># !! Not actually a good eval() method !!</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">cos</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
<p>However, this would make it so that <code class="docutils literal notranslate"><span class="pre">versin(x)</span></code> would <em>always</em> return <code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">-</span> <span class="pre">cos(x)</span></code>, regardless of what <code class="docutils literal notranslate"><span class="pre">x</span></code> is. If all you want is a quick shorthand to
<code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">-</span> <span class="pre">cos(x)</span></code>, that is fine, but would be much simpler and more explicit to
just <a class="reference internal" href="#custom-functions-fully-evaluated"><span class="std std-ref">use a Python function as described
above</span></a>. If we defined <code class="docutils literal notranslate"><span class="pre">versin</span></code> like this,
it would never actually be represented as <code class="docutils literal notranslate"><span class="pre">versin(x)</span></code>, and none of the other
behavior we define below would matter, because the other behaviors we are
going to define on the <code class="docutils literal notranslate"><span class="pre">versin</span></code> class only apply when the returned object is
actually a <code class="docutils literal notranslate"><span class="pre">versin</span></code> instance. So for example, <code class="docutils literal notranslate"><span class="pre">versin(x).diff(x)</span></code> would
actually just be <code class="docutils literal notranslate"><span class="pre">(1</span> <span class="pre">-</span> <span class="pre">cos(x)).diff(x)</span></code>, instead of calling <a class="reference internal" href="#custom-functions-differentiation"><span class="std std-ref">the <code class="docutils literal notranslate"><span class="pre">fdiff()</span></code>
method we define below</span></a>.</p>
<div class="admonition-key-point admonition">
<p class="admonition-title">Key Point</p>
<p><strong>The purpose of <code class="docutils literal notranslate"><span class="pre">eval()</span></code> is not to define what the function <em>is</em>,
mathematically, but rather to specify on what inputs it should automatically
evaluate.</strong> The mathematical definition of a function is determined through
the specification of various mathematical properties with the methods
outlined below, like <a class="reference internal" href="#custom-functions-evalf"><span class="std std-ref">numerical evaluation</span></a>,
<a class="reference internal" href="#custom-functions-differentiation"><span class="std std-ref">differentiation</span></a>, and so on.</p>
</div>
<p>If you find yourself doing this, you should think about what you actually
want to achieve. If you just want a shorthand function for an expression, it
will be simpler to just <a class="reference internal" href="#custom-functions-fully-evaluated"><span class="std std-ref">define a Python
function</span></a>. If you really do want a
symbolic function, think about when you want it to evaluate to something
else and when you want it to stay unevaluated. One option is to make your
function unevaluated in <code class="docutils literal notranslate"><span class="pre">eval()</span></code> and define a <a class="reference internal" href="#custom-functions-doit"><span class="std std-ref"><code class="docutils literal notranslate"><span class="pre">doit()</span></code>
method</span></a> to evaluate it.</p>
</li>
<li><p><strong>Avoid too much automatic evaluation.</strong></p>
<p>It is recommended to minimize what is evaluated automatically by <code class="docutils literal notranslate"><span class="pre">eval()</span></code>.
It is typically better to put more advanced simplifications in <a class="reference internal" href="#custom-functions-rewriting-and-simplification"><span class="std std-ref">other
methods</span></a>, like
<a class="reference internal" href="#custom-functions-doit"><span class="std std-ref"><code class="docutils literal notranslate"><span class="pre">doit()</span></code></span></a>. Remember that whatever you define for
automatic evaluation will <em>always</em> evaluate.<a class="footnote-reference brackets" href="#evaluate-footnote" id="id1" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a> As in the
previous point, if you evaluate every value, there is little point to even
having a symbolic function in the first place. For example, we might be
tempted to evaluate some trig identities on <code class="docutils literal notranslate"><span class="pre">versin</span></code> in <code class="docutils literal notranslate"><span class="pre">eval()</span></code>, but then
these identities would always evaluate, and it wouldn’t be possible to
represent one half of the identity.</p>
<p>One should also avoid doing anything in <code class="docutils literal notranslate"><span class="pre">eval()</span></code> that is slow to compute.
SymPy generally assumes that it is cheap to create expressions, and if this
is not true, it can lead to performance issues.</p>
<p>Finally, it is recommended to avoid performing automatic evaluation in
<code class="docutils literal notranslate"><span class="pre">eval()</span></code> based on assumptions. Instead, <code class="docutils literal notranslate"><span class="pre">eval()</span></code> should typically only
evaluate explicit numerical special values and return <code class="docutils literal notranslate"><span class="pre">None</span></code> for everything
else. You might have noticed in <a class="reference internal" href="#custom-functions-versin-eval-example"><span class="std std-ref">the example
above</span></a> that we used <code class="docutils literal notranslate"><span class="pre">isinstance(n,</span> <span class="pre">Integer)</span></code> instead of checking <code class="docutils literal notranslate"><span class="pre">n.is_integer</span></code> using the assumptions system.
We could have done that instead, which would make <code class="docutils literal notranslate"><span class="pre">versin(n*pi)</span></code> evaluate
even if <code class="docutils literal notranslate"><span class="pre">n</span> <span class="pre">=</span> <span class="pre">Symbol('n',</span> <span class="pre">integer=True)</span></code>. But this is a case where we might
not always want evaluation to happen, and if <code class="docutils literal notranslate"><span class="pre">n</span></code> is a more complicated
expression, <code class="docutils literal notranslate"><span class="pre">n.is_integer</span></code> might be more expensive to compute.</p>
<p>Let’s consider an example. Using the identity <span class="math notranslate nohighlight">\(\cos(x + y) = \cos(x)\cos(y) - \sin(x)\sin(y)\)</span>, we can derive the identity</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\operatorname{versin}(x + y) =
  \operatorname{versin}(x)\operatorname{versin}(y) -
  \operatorname{versin}(x) - \operatorname{versin}(y) - \sin(x)\sin(y) + 1.\]</div>
</div>
<p>Suppose we decided to automatically expand this in <code class="docutils literal notranslate"><span class="pre">eval()</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sympy</span> <span class="kn">import</span> <span class="n">Add</span><span class="p">,</span> <span class="n">sin</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">versin</span><span class="p">(</span><span class="n">Function</span><span class="p">):</span>
<span class="gp">... </span>    <span class="nd">@classmethod</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">eval</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<span class="gp">... </span>        <span class="c1"># !! Not actually a good eval() method !!</span>
<span class="gp">... </span>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">Add</span><span class="p">):</span>
<span class="gp">... </span>            <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">as_two_terms</span><span class="p">()</span>
<span class="gp">... </span>            <span class="k">return</span> <span class="p">(</span><span class="n">versin</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">*</span><span class="n">versin</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">-</span> <span class="n">versin</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">-</span> <span class="n">versin</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="gp">... </span>                    <span class="o">-</span> <span class="n">sin</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>This method recursively splits <code class="docutils literal notranslate"><span class="pre">Add</span></code> terms into two parts and applies the
above identity.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;x y z&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">versin</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="p">)</span>
<span class="go">-sin(x)*sin(y) + versin(x)*versin(y) - versin(x) - versin(y) + 1</span>
</pre></div>
</div>
<p>But now it’s impossible to represent <code class="docutils literal notranslate"><span class="pre">versin(x</span> <span class="pre">+</span> <span class="pre">y)</span></code> without it expanding.
This will affect other methods too. For example, suppose we define
<a class="reference internal" href="#custom-functions-differentiation"><span class="std std-ref">differentiation (see below)</span></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">versin</span><span class="p">(</span><span class="n">Function</span><span class="p">):</span>
<span class="gp">... </span>    <span class="nd">@classmethod</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">eval</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<span class="gp">... </span>        <span class="c1"># !! Not actually a good eval() method !!</span>
<span class="gp">... </span>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">Add</span><span class="p">):</span>
<span class="gp">... </span>            <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">as_two_terms</span><span class="p">()</span>
<span class="gp">... </span>            <span class="k">return</span> <span class="p">(</span><span class="n">versin</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">*</span><span class="n">versin</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">-</span> <span class="n">versin</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">-</span> <span class="n">versin</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="gp">... </span>                    <span class="o">-</span> <span class="n">sin</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">fdiff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">argindex</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="n">sin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
<p>We would expect <code class="docutils literal notranslate"><span class="pre">versin(x</span> <span class="pre">+</span> <span class="pre">y).diff(x)</span></code> to return <code class="docutils literal notranslate"><span class="pre">sin(x</span> <span class="pre">+</span> <span class="pre">y)</span></code>, and indeed,
if we hadn’t expanded this identity in <code class="docutils literal notranslate"><span class="pre">eval()</span></code>, <a class="reference internal" href="#custom-functions-differentiation-examples"><span class="std std-ref">it
would</span></a>. But with this version,
<code class="docutils literal notranslate"><span class="pre">versin(x</span> <span class="pre">+</span> <span class="pre">y)</span></code> gets automatically expanded before <code class="docutils literal notranslate"><span class="pre">diff()</span></code> gets called,
instead we get a more complicated expression:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">versin</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="go">sin(x)*versin(y) - sin(x) - sin(y)*cos(x)</span>
</pre></div>
</div>
<p>And things are even worse than that. Let’s try an <code class="docutils literal notranslate"><span class="pre">Add</span></code> with three terms:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">versin</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">y</span> <span class="o">+</span> <span class="n">z</span><span class="p">)</span>
<span class="go">(-sin(y)*sin(z) + versin(y)*versin(z) - versin(y) - versin(z) +</span>
<span class="go">1)*versin(x) - sin(x)*sin(y + z) + sin(y)*sin(z) - versin(x) -</span>
<span class="go">versin(y)*versin(z) + versin(y) + versin(z)</span>
</pre></div>
</div>
<p>We can see that things are getting out of control quite quickly. In fact,
<code class="docutils literal notranslate"><span class="pre">versin(Add(*symbols('x:100')))</span></code> (<code class="docutils literal notranslate"><span class="pre">versin()</span></code> on an <code class="docutils literal notranslate"><span class="pre">Add</span></code> with 100 terms)
takes over a second to evaluate, and that’s just to <em>create</em> the expression,
without even doing anything with it yet.</p>
<p>Identities like this are better left out of <code class="docutils literal notranslate"><span class="pre">eval</span></code> and implemented in other
methods instead (in the case of this identity,
<a class="reference internal" href="#custom-functions-expand"><span class="std std-ref"><code class="docutils literal notranslate"><span class="pre">expand_trig()</span></code></span></a>).</p>
</li>
<li><p><strong>When restricting the input domain: allow <code class="docutils literal notranslate"><span class="pre">None</span></code> input assumptions.</strong></p>
<p>Our example function <span class="math notranslate nohighlight">\(\operatorname{versin}(x)\)</span> is a function from
<span class="math notranslate nohighlight">\(\mathbb{C}\)</span> to <span class="math notranslate nohighlight">\(\mathbb{C}\)</span>, so it can accept any input. But suppose we had
a function that only made sense with certain inputs. As a second example,
let’s define a function <code class="docutils literal notranslate"><span class="pre">divides</span></code> as</p>
<div class="math-wrapper docutils container" id="custom-functions-divides-definition">
<div class="math notranslate nohighlight" id="custom-functions-divides-definition">
\[\begin{split}\operatorname{divides}(m, n) = \begin{cases} 1 &amp; \text{for}\: m \mid n \\
  0 &amp; \text{for}\: m\not\mid n  \end{cases}.\end{split}\]</div>
</div>
<p>That is, <code class="docutils literal notranslate"><span class="pre">divides(m,</span> <span class="pre">n)</span></code> will be <code class="docutils literal notranslate"><span class="pre">1</span></code> if <code class="docutils literal notranslate"><span class="pre">m</span></code> divides <code class="docutils literal notranslate"><span class="pre">n</span></code> and <code class="docutils literal notranslate"><span class="pre">0</span></code> otherwise.
<code class="docutils literal notranslate"><span class="pre">divides</span></code> clearly only makes sense if <code class="docutils literal notranslate"><span class="pre">m</span></code> and <code class="docutils literal notranslate"><span class="pre">n</span></code> are integers.</p>
<p>We might be tempted to define the <code class="docutils literal notranslate"><span class="pre">eval()</span></code> method for <code class="docutils literal notranslate"><span class="pre">divides</span></code> like this:</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">divides</span><span class="p">(</span><span class="n">Function</span><span class="p">):</span>
<span class="gp">... </span>    <span class="nd">@classmethod</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">eval</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
<span class="gp">... </span>        <span class="c1"># !! Not actually a good eval() method !!</span>
<span class="gp">...</span>
<span class="gp">... </span>        <span class="c1"># Evaluate for explicit integer m and n. This part is fine.</span>
<span class="gp">... </span>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">Integer</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">Integer</span><span class="p">):</span>
<span class="gp">... </span>            <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">n</span> <span class="o">%</span> <span class="n">m</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">... </span>        <span class="c1"># For symbolic arguments, require m and n to be integer.</span>
<span class="gp">... </span>        <span class="c1"># If we write the logic this way, we will run into trouble.</span>
<span class="gp">... </span>        <span class="k">if</span> <span class="ow">not</span> <span class="n">m</span><span class="o">.</span><span class="n">is_integer</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">n</span><span class="o">.</span><span class="n">is_integer</span><span class="p">:</span>
<span class="gp">... </span>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;m and n should be integers&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The problem here is that by using <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">not</span> <span class="pre">m.is_integer</span></code>, we are requiring
<code class="docutils literal notranslate"><span class="pre">m.is_integer</span></code> to be <code class="docutils literal notranslate"><span class="pre">True</span></code>. If it is <code class="docutils literal notranslate"><span class="pre">None</span></code>, it will fail (see the <a class="reference internal" href="booleans.html#booleans-guide"><span class="std std-ref">guide
on booleans and three-valued logic</span></a> for details on what it
means for an assumption to be <code class="docutils literal notranslate"><span class="pre">None</span></code>). This is problematic for two reasons.
Firstly, it forces the user to define assumptions on any input variable. If
the user omits them, it will fail:</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">n</span><span class="p">,</span> <span class="n">m</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;n m&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">is_integer</span><span class="p">)</span>
<span class="go">None</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">divides</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="gr">TypeError</span>: <span class="n">m and n should be integers</span>
</pre></div>
</div>
<p>Instead they have to write</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">n</span><span class="p">,</span> <span class="n">m</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;n m&#39;</span><span class="p">,</span> <span class="n">integer</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">divides</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<span class="go">divides(m, n)</span>
</pre></div>
</div>
<p>This may seem like an acceptable restriction, but there is a bigger problem.
Sometimes, SymPy’s assumptions system cannot deduce an assumption, even
though it is mathematically true. In this case, it will give <code class="docutils literal notranslate"><span class="pre">None</span></code> (<code class="docutils literal notranslate"><span class="pre">None</span></code>
means both “undefined” and “cannot compute” in SymPy’s assumptions). For
example</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># n and m are still defined as integer=True as above</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">divides</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="n">m</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">m</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="gr">TypeError</span>: <span class="n">m and n should be integers</span>
</pre></div>
</div>
<p>Here the expression <code class="docutils literal notranslate"><span class="pre">(m**2</span> <span class="pre">+</span> <span class="pre">m)/2</span></code> is always an integer, but SymPy’s
assumptions system is not able to deduce this:</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(((</span><span class="n">m</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">m</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">is_integer</span><span class="p">)</span>
<span class="go">None</span>
</pre></div>
</div>
<p>SymPy’s assumptions system is always improving, but there will always be
cases like this that it cannot deduce, due to the fundamental computational
complexity of the problem, and the fact that the general problem is
<a class="reference external" href="https://en.wikipedia.org/wiki/Hilbert%27s_tenth_problem">often</a>
<a class="reference external" href="https://en.wikipedia.org/wiki/Richardson%27s_theorem">undecidable</a>.</p>
<p>Consequently, one should always test <em>negated</em> assumptions for input
variables, that is, fail if the assumption is <code class="docutils literal notranslate"><span class="pre">False</span></code> but allow the
assumption to be <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p>
<div class="highlight-py notranslate" id="custom-functions-divides-eval"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">divides</span><span class="p">(</span><span class="n">Function</span><span class="p">):</span>
<span class="gp">... </span>    <span class="nd">@classmethod</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">eval</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
<span class="gp">... </span>        <span class="c1"># Evaluate for explicit integer m and n. This part is fine.</span>
<span class="gp">... </span>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">Integer</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">Integer</span><span class="p">):</span>
<span class="gp">... </span>            <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">n</span> <span class="o">%</span> <span class="n">m</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">... </span>        <span class="c1"># For symbolic arguments, require m and n to be integer.</span>
<span class="gp">... </span>        <span class="c1"># This is the better way to write this logic.</span>
<span class="gp">... </span>        <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">is_integer</span> <span class="ow">is</span> <span class="kc">False</span> <span class="ow">or</span> <span class="n">n</span><span class="o">.</span><span class="n">is_integer</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
<span class="gp">... </span>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;m and n should be integers&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>This still disallows non-integer inputs as desired:</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">divides</span><span class="p">(</span><span class="mf">1.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="gr">TypeError</span>: <span class="n">m and n should be integers</span>
</pre></div>
</div>
<p>But it does not fail in cases where the assumption is <code class="docutils literal notranslate"><span class="pre">None</span></code>:</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">divides</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="n">m</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">m</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
<span class="go">divides(2, m**2/2 + m/2)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">_</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="go">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">n</span><span class="p">,</span> <span class="n">m</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;n m&#39;</span><span class="p">)</span> <span class="c1"># Redefine n and m without the integer assumption</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">divides</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<span class="go">divides(m, n)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This rule of allowing <code class="docutils literal notranslate"><span class="pre">None</span></code> assumptions only applies to instances
where an exception would be raised, such as type checking an input domain.
In cases where simplifications or other operations are done, one should
treat a <code class="docutils literal notranslate"><span class="pre">None</span></code> assumption as meaning “can be either <code class="docutils literal notranslate"><span class="pre">True</span></code> or <code class="docutils literal notranslate"><span class="pre">False</span></code>” and
not perform an operation that might not be mathematically valid.</p>
</div>
</li>
</ul>
</section>
</section>
<section id="assumptions">
<span id="custom-functions-assumptions"></span><h3>Assumptions<a class="headerlink" href="#assumptions" title="Permalink to this heading">#</a></h3>
<p>The next thing you might want to define are the assumptions on our function.
The assumptions system allows defining what mathematical properties your
function has given its inputs, for example, “<span class="math notranslate nohighlight">\(f(x)\)</span> is <em>positive</em> when <span class="math notranslate nohighlight">\(x\)</span> is
<em>real</em>.”</p>
<p>The <a class="reference internal" href="assumptions.html#assumptions-guide"><span class="std std-ref">guide on the assumptions system</span></a> goes into the
assumptions system in great detail. It is recommended to read through that
guide first to understand what the different assumptions mean and how the
assumptions system works.</p>
<p>The simplest case is a function that always has a given assumption regardless
of its input. In this case, you can define <code class="docutils
literal notranslate"><span class="pre">is_<em>assumption</em></span></code> directly
on the class.</p>
<p>For example, our <a class="reference internal" href="#custom-functions-divides-definition"><span class="std std-ref">example <code class="docutils literal notranslate"><span class="pre">divides</span></code>
function</span></a> is always an integer, because
its value is always either 0 or 1:</p>
<aside class="sidebar">
<p class="sidebar-title">Note</p>
<p>From here on out in this guide, in the interest of space, we will omit the
previous method definitions in the examples unless they are needed for the
given example to work. There are <a class="reference internal" href="#custom-functions-complete-examples"><span class="std std-ref">complete
examples</span></a> at the end of this guide with
all the methods.</p>
</aside>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">divides</span><span class="p">(</span><span class="n">Function</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">is_integer</span> <span class="o">=</span> <span class="kc">True</span>
<span class="gp">... </span>    <span class="n">is_negative</span> <span class="o">=</span> <span class="kc">False</span>
</pre></div>
</div>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">divides</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span><span class="o">.</span><span class="n">is_integer</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">divides</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span><span class="o">.</span><span class="n">is_nonnegative</span>
<span class="go">True</span>
</pre></div>
</div>
<p>In general, however, the assumptions of a function depend on the assumptions
of its inputs. In this case, you should define an <code class="docutils literal notranslate"><span
class="pre">_eval_<em>assumption</em></span></code> method.</p>
<p>For our <a class="reference internal" href="#custom-functions-versine-definition"><span class="std std-ref"><span class="math notranslate nohighlight">\(\operatorname{versin}(x)\)</span>
example</span></a>, the function is always in <span class="math notranslate nohighlight">\([0,
2]\)</span> when <span class="math notranslate nohighlight">\(x\)</span> is real, and it is 0 exactly when <span class="math notranslate nohighlight">\(x\)</span> is an even multiple of
<span class="math notranslate nohighlight">\(\pi\)</span>. So <code class="docutils literal notranslate"><span class="pre">versin(x)</span></code> should be <em>nonnegative</em> whenever <code class="docutils literal notranslate"><span class="pre">x</span></code> is <em>real</em> and
<em>positive</em> whenever <code class="docutils literal notranslate"><span class="pre">x</span></code> is <em>real</em> and not an <em>even</em> multiple of π. Remember
that by default, a function’s domain is all of <span class="math notranslate nohighlight">\(\mathbb{C}\)</span>, and indeed
<code class="docutils literal notranslate"><span class="pre">versin(x)</span></code> makes perfect sense with non-real <code class="docutils literal notranslate"><span class="pre">x</span></code>.</p>
<p>To see if <code class="docutils literal notranslate"><span class="pre">x</span></code> is an even multiple of <code class="docutils literal notranslate"><span class="pre">pi</span></code>, we can use <a class="reference internal" href="../modules/core.html#sympy.core.expr.Expr.as_independent" title="sympy.core.expr.Expr.as_independent"><code class="xref py py-meth docutils literal notranslate"><span class="pre">as_independent()</span></code></a>
to match <code class="docutils literal notranslate"><span class="pre">x</span></code> structurally as <code class="docutils literal notranslate"><span class="pre">coeff*pi</span></code>. Pulling apart subexpressions
structurally like this in assumptions handlers is preferable to using
something like <code class="docutils literal notranslate"><span class="pre">(x/pi).is_even</span></code>, because that will create a new expression
<code class="docutils literal notranslate"><span class="pre">x/pi</span></code>. The creation of a new expression is much slower. Furthermore, whenever
an expression is created, the constructors that are called when creating the
expression will often themselves cause assumptions to be queried. If you are
not careful, this can lead to infinite recursion. So a good general rule for
assumptions handlers is, <strong>never create a new expression in an assumptions
handler</strong>. Always pull apart the args of the function using structural methods
like <code class="docutils literal notranslate"><span class="pre">as_independent</span></code>.</p>
<p>Note that <span class="math notranslate nohighlight">\(\operatorname{versin}(x)\)</span> can be
nonnegative for nonreal <span class="math notranslate nohighlight">\(x\)</span>, for example:</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sympy</span> <span class="kn">import</span> <span class="n">I</span>
<span class="gp">&gt;&gt;&gt; </span><span class="mi">1</span> <span class="o">-</span> <span class="n">cos</span><span class="p">(</span><span class="n">pi</span> <span class="o">+</span> <span class="n">I</span><span class="o">*</span><span class="n">pi</span><span class="p">)</span>
<span class="go">1 + cosh(pi)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">cos</span><span class="p">(</span><span class="n">pi</span> <span class="o">+</span> <span class="n">I</span><span class="o">*</span><span class="n">pi</span><span class="p">))</span><span class="o">.</span><span class="n">evalf</span><span class="p">()</span>
<span class="go">12.5919532755215</span>
</pre></div>
</div>
<p>So for the <code class="docutils literal notranslate"><span class="pre">_eval_is_nonnegative</span></code> handler, we want to return <code class="docutils literal notranslate"><span class="pre">True</span></code> if
<code class="docutils literal notranslate"><span class="pre">x.is_real</span></code> is <code class="docutils literal notranslate"><span class="pre">True</span></code> but <code class="docutils literal notranslate"><span class="pre">None</span></code> if <code class="docutils literal notranslate"><span class="pre">x.is_real</span></code> is either <code class="docutils literal notranslate"><span class="pre">False</span></code> or <code class="docutils literal notranslate"><span class="pre">None</span></code>.
It is left as an exercise to the reader to handle the cases for nonreal <code class="docutils literal notranslate"><span class="pre">x</span></code>
that make <code class="docutils literal notranslate"><span class="pre">versin(x)</span></code> nonnegative, using similar logic from the
<code class="docutils literal notranslate"><span class="pre">_eval_is_positive</span></code> handler.</p>
<p>In the assumptions handler methods, as in all methods, we can access the
arguments of the function using <code class="docutils literal notranslate"><span class="pre">self.args</span></code>.</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sympy.core.logic</span> <span class="kn">import</span> <span class="n">fuzzy_and</span><span class="p">,</span> <span class="n">fuzzy_not</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">versin</span><span class="p">(</span><span class="n">Function</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">_eval_is_nonnegative</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">... </span>        <span class="c1"># versin(x) is nonnegative if x is real</span>
<span class="gp">... </span>        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">... </span>        <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">is_real</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
<span class="gp">... </span>            <span class="k">return</span> <span class="kc">True</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">_eval_is_positive</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">... </span>        <span class="c1"># versin(x) is positive if x is real and not an even multiple of pi</span>
<span class="gp">... </span>        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">...</span>
<span class="gp">... </span>        <span class="c1"># x.as_independent(pi, as_Add=False) will split x as a Mul of the</span>
<span class="gp">... </span>        <span class="c1"># form coeff*pi</span>
<span class="gp">... </span>        <span class="n">coeff</span><span class="p">,</span> <span class="n">pi_</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">as_independent</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">as_Add</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">... </span>        <span class="c1"># If pi_ = pi, x = coeff*pi. Otherwise x is not (structurally) of</span>
<span class="gp">... </span>        <span class="c1"># the form coeff*pi.</span>
<span class="gp">... </span>        <span class="k">if</span> <span class="n">pi_</span> <span class="o">==</span> <span class="n">pi</span><span class="p">:</span>
<span class="gp">... </span>            <span class="k">return</span> <span class="n">fuzzy_and</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">is_real</span><span class="p">,</span> <span class="n">fuzzy_not</span><span class="p">(</span><span class="n">coeff</span><span class="o">.</span><span class="n">is_even</span><span class="p">)])</span>
<span class="gp">... </span>        <span class="k">elif</span> <span class="n">x</span><span class="o">.</span><span class="n">is_real</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
<span class="gp">... </span>            <span class="k">return</span> <span class="kc">False</span>
<span class="gp">... </span>        <span class="c1"># else: return None. We do not know for sure whether x is an even</span>
<span class="gp">... </span>        <span class="c1"># multiple of pi</span>
</pre></div>
</div>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">versin</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">is_nonnegative</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">versin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="p">)</span><span class="o">.</span><span class="n">is_positive</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">versin</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">pi</span><span class="p">)</span><span class="o">.</span><span class="n">is_positive</span>
<span class="go">True</span>
</pre></div>
</div>
<p>Note the use of <code class="docutils literal notranslate"><span class="pre">fuzzy_</span></code> functions in the more complicated
<code class="docutils literal notranslate"><span class="pre">_eval_is_positive()</span></code> handler, and the careful handling of the <code class="docutils literal notranslate"><span class="pre">if</span></code>/<code class="docutils literal notranslate"><span class="pre">elif</span></code>. It
is important when working with assumptions to always be careful about
<a class="reference internal" href="booleans.html#booleans-guide"><span class="std std-ref">handling three-valued logic correctly</span></a>. This ensures that the
method returns the correct answer when <code class="docutils literal notranslate"><span class="pre">x.is_real</span></code> or <code class="docutils literal notranslate"><span class="pre">coeff.is_even</span></code> are
<code class="docutils literal notranslate"><span class="pre">None</span></code>.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Never define <code class="docutils literal notranslate"><span
class="pre">is_<em>assumption</em></span></code> as a <code class="docutils literal notranslate"><span class="pre">&#64;property</span></code> method. Doing so
will break the automatic deduction of other assumptions. <code class="docutils
literal notranslate"><span class="pre">is_<em>assumption</em></span></code> should
only ever be defined as a class variable equal to <code class="docutils literal notranslate"><span class="pre">True</span></code> or <code class="docutils literal notranslate"><span class="pre">False</span></code>. If the
assumption depends on the <code class="docutils literal notranslate"><span class="pre">.args</span></code> of the function somehow, define the <code
class="docutils literal notranslate"><span
class="pre">_eval_<em>assumption</em></span></code> method.</p>
</div>
<p>In this example, it is not necessary to define <code class="docutils literal notranslate"><span class="pre">_eval_is_real()</span></code> because it is
deduced automatically from the other assumptions, since <code class="docutils literal notranslate"><span class="pre">nonnegative</span> <span class="pre">-&gt;</span> <span class="pre">real</span></code>.
In general, you should avoid defining assumptions that the assumptions system
can deduce automatically given its <a class="reference internal" href="assumptions.html#assumptions-guide-predicates"><span class="std std-ref">known
facts</span></a>.</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">versin</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">is_real</span>
<span class="go">True</span>
</pre></div>
</div>
<p>The assumptions system is often able to deduce more than you might think.
For example, from the above, it can deduce that <code class="docutils literal notranslate"><span class="pre">versin(2*n*pi)</span></code> is zero when
<code class="docutils literal notranslate"><span class="pre">n</span></code> is an integer.</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">n</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="n">integer</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">versin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">*</span><span class="n">pi</span><span class="p">)</span><span class="o">.</span><span class="n">is_zero</span>
<span class="go">True</span>
</pre></div>
</div>
<p>It’s always worth checking if the assumptions system can deduce something
automatically before manually coding it.</p>
<p>Finally, a word of warning: be very careful about correctness when coding
assumptions. Make sure to use the exact
<a class="reference internal" href="assumptions.html#assumptions-guide-predicates"><span class="std std-ref">definitions</span></a> of the various assumptions, and
always check that you’re handling <code class="docutils literal notranslate"><span class="pre">None</span></code> cases correctly with the fuzzy
three-valued logic functions. Incorrect or inconsistent assumptions can lead
to subtle bugs. It’s recommended to use unit tests to check all the various
cases whenever your function has a nontrivial assumption handler. All
functions defined in SymPy itself are required to be extensively tested.</p>
</section>
<section id="numerical-evaluation-with-evalf">
<span id="custom-functions-evalf"></span><h3>Numerical Evaluation with <code class="docutils literal notranslate"><span class="pre">evalf()</span></code><a class="headerlink" href="#numerical-evaluation-with-evalf" title="Permalink to this heading">#</a></h3>
<!-- TODO: this goes over the basics, but it might be useful to have a
     separate guide dedicated to numerical evaluation. -->
<p>Here we show how to define how a function should numerically evaluate to a
floating point <a class="reference internal" href="../modules/core.html#sympy.core.numbers.Float" title="sympy.core.numbers.Float"><code class="xref py py-class docutils literal notranslate"><span class="pre">Float</span></code></a> value, for instance, via <code class="docutils literal notranslate"><span class="pre">evalf()</span></code>.
Implementing numerical evaluation enables several behaviors in SymPy. For
example, once <code class="docutils literal notranslate"><span class="pre">evalf()</span></code> is defined, you can plot your function, and things
like inequalities can evaluate to explicit values.</p>
<p>If your function has the same name as a function in
<a class="reference external" href="https://mpmath.org/doc/current/">mpmath</a>, which is the case for most
functions included with SymPy, numerical evaluation will happen automatically
and you do not need to do anything.</p>
<p>If this is not the case, numerical evaluation can be specified by defining the
method <code class="docutils literal notranslate"><span class="pre">_eval_evalf(self,</span> <span class="pre">prec)</span></code>, where <code class="docutils literal notranslate"><span class="pre">prec</span></code> is the binary precision of the
input. The method should return the expression evaluated to the given
precision, or <code class="docutils literal notranslate"><span class="pre">None</span></code> if this is not possible.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">prec</span></code> argument to <code class="docutils literal notranslate"><span class="pre">_eval_evalf()</span></code> is the <em>binary</em> precision, that is, the
number of bits in the floating-point representation. This differs from the
first argument to the <code class="docutils literal notranslate"><span class="pre">evalf()</span></code> method, which is the <em>decimal</em> precision, or
<code class="docutils literal notranslate"><span class="pre">dps</span></code>. For example, the default binary precision of <code class="docutils literal notranslate"><span class="pre">Float</span></code> is 53,
corresponding to a decimal precision of 15. Therefore, if your <code class="docutils literal notranslate"><span class="pre">_eval_evalf()</span></code>
method recursively calls evalf on another expression, it should call
<code class="docutils literal notranslate"><span class="pre">expr._eval_evalf(prec)</span></code> rather than <code class="docutils literal notranslate"><span class="pre">expr.evalf(prec)</span></code>, as the latter will
incorrectly use <code class="docutils literal notranslate"><span class="pre">prec</span></code> as the decimal precision.</p>
</div>
<p>We can define numerical evaluation for <a class="reference internal" href="#custom-functions-versine-definition"><span class="std std-ref">our example <span class="math notranslate nohighlight">\(\operatorname{versin}(x)\)</span>
function</span></a> by recursively evaluating
<span class="math notranslate nohighlight">\(2\sin^2\left(\frac{x}{2}\right)\)</span>, which is a more numerically stable way of writing <span class="math notranslate nohighlight">\(1 -
\cos(x)\)</span>.</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sympy</span> <span class="kn">import</span> <span class="n">sin</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">versin</span><span class="p">(</span><span class="n">Function</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">_eval_evalf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prec</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">_eval_evalf</span><span class="p">(</span><span class="n">prec</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">versin</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">evalf</span><span class="p">()</span>
<span class="go">0.459697694131860</span>
</pre></div>
</div>
<p>Once <code class="docutils literal notranslate"><span class="pre">_eval_evalf()</span></code> is defined, this enables the automatic evaluation of
floating-point inputs. It is not required to implement this manually in
<a class="reference internal" href="#custom-functions-eval"><span class="std std-ref"><code class="docutils literal notranslate"><span class="pre">eval()</span></code></span></a>.</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">versin</span><span class="p">(</span><span class="mf">1.</span><span class="p">)</span>
<span class="go">0.459697694131860</span>
</pre></div>
</div>
<!-- TODO: Mention _should_evalf() here? Seems like something most people
     shouldn't mess with. -->
<p>Note that <code class="docutils literal notranslate"><span class="pre">evalf()</span></code> may be passed any expression, not just one that can be
evaluated numerically. In this case, it is expected that the numerical parts
of an expression will be evaluated. A general pattern to follow is to
recursively call <code class="docutils literal notranslate"><span class="pre">_eval_evalf(prec)</span></code> on the arguments of the function.</p>
<p>Whenever possible, it’s best to reuse the evalf functionality defined in
existing SymPy functions. However, in some cases it will be necessary to use
mpmath directly.</p>
</section>
<section id="rewriting-and-simplification">
<span id="custom-functions-rewriting-and-simplification"></span><h3>Rewriting and Simplification<a class="headerlink" href="#rewriting-and-simplification" title="Permalink to this heading">#</a></h3>
<p>Various simplification functions and methods allow specifying their behavior
on custom subclasses. Not every function in SymPy has such hooks. See the
documentation of each individual function for details.</p>
<section id="rewrite">
<span id="custom-functions-rewrite"></span><h4><code class="docutils literal notranslate"><span class="pre">rewrite()</span></code><a class="headerlink" href="#rewrite" title="Permalink to this heading">#</a></h4>
<p>The <a class="reference internal" href="../modules/core.html#sympy.core.basic.Basic.rewrite" title="sympy.core.basic.Basic.rewrite"><code class="xref py py-meth docutils literal notranslate"><span class="pre">rewrite()</span></code></a> method allows rewriting an expression in terms of a
specific function or rule. For example,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">rewrite</span><span class="p">(</span><span class="n">cos</span><span class="p">)</span>
<span class="go">cos(x - pi/2)</span>
</pre></div>
</div>
<p>To implement rewriting, define a method <code class="docutils literal notranslate"><span class="pre">_eval_rewrite(self,</span> <span class="pre">rule,</span> <span class="pre">args,</span> <span class="pre">**hints)</span></code>, where</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">rule</span></code> is the <em>rule</em> passed to the <code class="docutils literal notranslate"><span class="pre">rewrite()</span></code> method. Typically <code class="docutils literal notranslate"><span class="pre">rule</span></code> will
be the class of the object to be rewritten to, although for more complex
rewrites, it can be anything. Each object that defines <code class="docutils literal notranslate"><span class="pre">_eval_rewrite()</span></code>
defines what rule(s) it supports. Many SymPy functions rewrite to common
classes, like <code class="docutils literal notranslate"><span class="pre">expr.rewrite(Add)</span></code>, to perform simplifications or other
computations.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">args</span></code> are the arguments of the function to be used for rewriting. This
should be used instead of <code class="docutils literal notranslate"><span class="pre">self.args</span></code> because any recursive expressions in
the args will be rewritten in <code class="docutils literal notranslate"><span class="pre">args</span></code> (assuming the caller used
<code class="docutils literal notranslate"><span class="pre">rewrite(deep=True)</span></code>, which is the default).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">**hints</span></code> are additional keyword arguments which may be used to specify the
behavior of the rewrite. Unknown hints should be ignored as they may be
passed to other <code class="docutils literal notranslate"><span class="pre">_eval_rewrite()</span></code> methods. If you recursively call rewrite,
you should pass the <code class="docutils literal notranslate"><span class="pre">**hints</span></code> through.</p></li>
</ul>
<p>The method should return a rewritten expression, using <code class="docutils literal notranslate"><span class="pre">args</span></code> as the
arguments to the function, or <code class="docutils literal notranslate"><span class="pre">None</span></code> if the expression should be unchanged.</p>
<p>For our <a class="reference internal" href="#custom-functions-versine-definition"><span class="std std-ref"><code class="docutils literal notranslate"><span class="pre">versin</span></code> example</span></a>, an obvious
rewrite we can implement is rewriting <code class="docutils literal notranslate"><span class="pre">versin(x)</span></code> as <code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">-</span> <span class="pre">cos(x)</span></code>:</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">versin</span><span class="p">(</span><span class="n">Function</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">_eval_rewrite</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rule</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">hints</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">if</span> <span class="n">rule</span> <span class="o">==</span> <span class="n">cos</span><span class="p">:</span>
<span class="gp">... </span>            <span class="k">return</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">cos</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">versin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">rewrite</span><span class="p">(</span><span class="n">cos</span><span class="p">)</span>
<span class="go">1 - cos(x)</span>
</pre></div>
</div>
<p>Once we’ve defined this, <a class="reference internal" href="../modules/simplify/simplify.html#sympy.simplify.simplify.simplify" title="sympy.simplify.simplify.simplify"><code class="xref py py-func docutils literal notranslate"><span class="pre">simplify()</span></code></a> is now able to simplify some
expressions containing <code class="docutils literal notranslate"><span class="pre">versin</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sympy</span> <span class="kn">import</span> <span class="n">simplify</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">simplify</span><span class="p">(</span><span class="n">versin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">cos</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="go">1</span>
</pre></div>
</div>
<!--

TODO: simplify() can be customized with _eval_simplify(), but it isn't very
powerful right now (see https://github.com/sympy/sympy/issues/19281). Most
users are better off just defining rewrite(), doit(), and/or expand().

#### Simplify

-->
</section>
<section id="doit">
<span id="custom-functions-doit"></span><h4><code class="docutils literal notranslate"><span class="pre">doit()</span></code><a class="headerlink" href="#doit" title="Permalink to this heading">#</a></h4>
<p>The <a class="reference internal" href="../modules/core.html#sympy.core.basic.Basic.doit" title="sympy.core.basic.Basic.doit"><code class="xref py py-meth docutils literal notranslate"><span class="pre">doit()</span></code></a> method is used to evaluate
“unevaluated” functions. To define <code class="docutils literal notranslate"><span class="pre">doit()</span></code> implement <code class="docutils literal notranslate"><span class="pre">doit(self,</span> <span class="pre">deep=True,</span> <span class="pre">**hints)</span></code>. If <code class="docutils literal notranslate"><span class="pre">deep=True</span></code>, <code class="docutils literal notranslate"><span class="pre">doit()</span></code> should recursively call <code class="docutils literal notranslate"><span class="pre">doit()</span></code> on the
arguments. <code class="docutils literal notranslate"><span class="pre">**hints</span></code> will be any other keyword arguments passed to the user,
which should be passed to any recursive calls to <code class="docutils literal notranslate"><span class="pre">doit()</span></code>. You can use <code class="docutils literal notranslate"><span class="pre">hints</span></code>
to allow the user to specify specific behavior for <code class="docutils literal notranslate"><span class="pre">doit()</span></code>.</p>
<p>The typical usage of <code class="docutils literal notranslate"><span class="pre">doit()</span></code> in custom <code class="docutils literal notranslate"><span class="pre">Function</span></code> subclasses is to perform more
advanced evaluation which is not performed in <a class="reference internal" href="#custom-functions-eval"><span class="std std-ref"><code class="docutils literal notranslate"><span class="pre">eval()</span></code></span></a>.</p>
<p>For example, for our <a class="reference internal" href="#custom-functions-divides-definition"><span class="std std-ref"><code class="docutils literal notranslate"><span class="pre">divides</span></code> example</span></a>,
there are several instances that could be simplified using some identities.
For example, we defined <code class="docutils literal notranslate"><span class="pre">eval()</span></code> to evaluate on explicit integers, but we might
also want to evaluate examples like <code class="docutils literal notranslate"><span class="pre">divides(k,</span> <span class="pre">k*n)</span></code> where the divisibility
is symbolically true. One of the <a class="reference internal" href="#custom-functions-eval-best-practices"><span class="std std-ref">best practices for
<code class="docutils literal notranslate"><span class="pre">eval()</span></code></span></a> is to avoid too much automatic
evaluation. Automatically evaluating in this case might be considered too
much, as it would make use of the assumptions system, which could be
expensive. Furthermore, we might want to be able to represent <code class="docutils literal notranslate"><span class="pre">divides(k,</span> <span class="pre">k*n)</span></code> without it always evaluating.</p>
<p>The solution is to implement these more advanced evaluations in <code class="docutils literal notranslate"><span class="pre">doit()</span></code>. That
way, we can explicitly perform them by calling <code class="docutils literal notranslate"><span class="pre">expr.doit()</span></code>, but they won’t
happen by default. An example <code class="docutils literal notranslate"><span class="pre">doit()</span></code> for <code class="docutils literal notranslate"><span class="pre">divides</span></code> that performs this
simplification (along with the <a class="reference internal" href="#custom-functions-divides-eval"><span class="std std-ref">above definition of
<code class="docutils literal notranslate"><span class="pre">eval()</span></code></span></a>) might look like this:</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If  <code class="docutils literal notranslate"><span class="pre">doit()</span></code> returns a Python <code class="docutils literal notranslate"><span class="pre">int</span></code> literal, convert it to an <code class="docutils literal notranslate"><span class="pre">Integer</span></code> so
that the returned object is a SymPy type.</p>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sympy</span> <span class="kn">import</span> <span class="n">Integer</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">divides</span><span class="p">(</span><span class="n">Function</span><span class="p">):</span>
<span class="gp">... </span>    <span class="c1"># Define evaluation on basic inputs, as well as type checking that the</span>
<span class="gp">... </span>    <span class="c1"># inputs are not nonintegral.</span>
<span class="gp">... </span>    <span class="nd">@classmethod</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">eval</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
<span class="gp">... </span>        <span class="c1"># Evaluate for explicit integer m and n.</span>
<span class="gp">... </span>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">Integer</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">Integer</span><span class="p">):</span>
<span class="gp">... </span>            <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">n</span> <span class="o">%</span> <span class="n">m</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">... </span>        <span class="c1"># For symbolic arguments, require m and n to be integer.</span>
<span class="gp">... </span>        <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">is_integer</span> <span class="ow">is</span> <span class="kc">False</span> <span class="ow">or</span> <span class="n">n</span><span class="o">.</span><span class="n">is_integer</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
<span class="gp">... </span>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;m and n should be integers&quot;</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="c1"># Define doit() as further evaluation on symbolic arguments using</span>
<span class="gp">... </span>    <span class="c1"># assumptions.</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">doit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deep</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">hints</span><span class="p">):</span>
<span class="gp">... </span>        <span class="n">m</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span>
<span class="gp">... </span>        <span class="c1"># Recursively call doit() on the args whenever deep=True.</span>
<span class="gp">... </span>        <span class="c1"># Be sure to pass deep=True and **hints through here.</span>
<span class="gp">... </span>        <span class="k">if</span> <span class="n">deep</span><span class="p">:</span>
<span class="gp">... </span>           <span class="n">m</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">doit</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="n">deep</span><span class="p">,</span> <span class="o">**</span><span class="n">hints</span><span class="p">),</span> <span class="n">n</span><span class="o">.</span><span class="n">doit</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="n">deep</span><span class="p">,</span> <span class="o">**</span><span class="n">hints</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">... </span>        <span class="c1"># divides(m, n) is 1 iff n/m is an integer. Note that m and n are</span>
<span class="gp">... </span>        <span class="c1"># already assumed to be integers because of the logic in eval().</span>
<span class="gp">... </span>        <span class="n">isint</span> <span class="o">=</span> <span class="p">(</span><span class="n">n</span><span class="o">/</span><span class="n">m</span><span class="p">)</span><span class="o">.</span><span class="n">is_integer</span>
<span class="gp">... </span>        <span class="k">if</span> <span class="n">isint</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
<span class="gp">... </span>            <span class="k">return</span> <span class="n">Integer</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">... </span>        <span class="k">elif</span> <span class="n">isint</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
<span class="gp">... </span>            <span class="k">return</span> <span class="n">Integer</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="gp">... </span>        <span class="k">else</span><span class="p">:</span>
<span class="gp">... </span>            <span class="k">return</span> <span class="n">divides</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
</pre></div>
</div>
<p>(Note that this uses the
<a class="reference external" href="https://en.wikipedia.org/wiki/Divisor#Definition">convention</a> that <span class="math notranslate nohighlight">\(k \mid 0\)</span>
for all <span class="math notranslate nohighlight">\(k\)</span> so that we do not need to check if <code class="docutils literal notranslate"><span class="pre">m</span></code> or <code class="docutils literal notranslate"><span class="pre">n</span></code> are nonzero. If we
used a different convention we would need to check if <code class="docutils literal notranslate"><span class="pre">m.is_zero</span></code> and
<code class="docutils literal notranslate"><span class="pre">n.is_zero</span></code> before performing the simplification.)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;n m k&#39;</span><span class="p">,</span> <span class="n">integer</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">divides</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">k</span><span class="o">*</span><span class="n">n</span><span class="p">)</span>
<span class="go">divides(k, k*n)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">divides</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">k</span><span class="o">*</span><span class="n">n</span><span class="p">)</span><span class="o">.</span><span class="n">doit</span><span class="p">()</span>
<span class="go">1</span>
</pre></div>
</div>
<p>Another common way to implement <code class="docutils literal notranslate"><span class="pre">doit()</span></code> is for it to always return another
expression. This effectively treats the function as an “unevaluated” form of
another expression.</p>
<p id="custom-functions-fma-definition">For example, let’s define a function for <a class="reference external" href="https://en.wikipedia.org/w/index.php?title=Fused_multiply_add">fused
multiply-add</a>:
<span class="math notranslate nohighlight">\(\operatorname{FMA}(x, y, z) = xy + z\)</span>. It may be useful to express this
function as a distinct function, e.g., for the purposes of code generation,
but it would also be useful in some contexts to “evaluate” <code class="docutils literal notranslate"><span class="pre">FMA(x,</span> <span class="pre">y,</span> <span class="pre">z)</span></code> to
<code class="docutils literal notranslate"><span class="pre">x*y</span> <span class="pre">+</span> <span class="pre">z</span></code> so that it can properly simplify with other expressions.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sympy</span> <span class="kn">import</span> <span class="n">Number</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">FMA</span><span class="p">(</span><span class="n">Function</span><span class="p">):</span>
<span class="gp">... </span><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="gp">... </span><span class="sd">    FMA(x, y, z) = x*y + z</span>
<span class="gp">... </span><span class="sd">    &quot;&quot;&quot;</span>
<span class="gp">... </span>    <span class="nd">@classmethod</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">eval</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">):</span>
<span class="gp">... </span>        <span class="c1"># Number is the base class of Integer, Rational, and Float</span>
<span class="gp">... </span>        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">Number</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">]):</span>
<span class="gp">... </span>           <span class="k">return</span> <span class="n">x</span><span class="o">*</span><span class="n">y</span> <span class="o">+</span> <span class="n">z</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">doit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">hints</span><span class="p">):</span>
<span class="gp">... </span>        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span>
<span class="gp">... </span>        <span class="c1"># Recursively call doit() on the args whenever deep=True.</span>
<span class="gp">... </span>        <span class="c1"># Be sure to pass deep=True and **hints through here.</span>
<span class="gp">... </span>        <span class="k">if</span> <span class="n">deep</span><span class="p">:</span>
<span class="gp">... </span>            <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">doit</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="n">deep</span><span class="p">,</span> <span class="o">**</span><span class="n">hints</span><span class="p">)</span>
<span class="gp">... </span>            <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">doit</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="n">deep</span><span class="p">,</span> <span class="o">**</span><span class="n">hints</span><span class="p">)</span>
<span class="gp">... </span>            <span class="n">z</span> <span class="o">=</span> <span class="n">z</span><span class="o">.</span><span class="n">doit</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="n">deep</span><span class="p">,</span> <span class="o">**</span><span class="n">hints</span><span class="p">)</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="n">x</span><span class="o">*</span><span class="n">y</span> <span class="o">+</span> <span class="n">z</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;x y z&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">FMA</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>
<span class="go">FMA(x, y, z)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">FMA</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span><span class="o">.</span><span class="n">doit</span><span class="p">()</span>
<span class="go">x*y + z</span>
</pre></div>
</div>
<p>Most custom functions will not want to define <code class="docutils literal notranslate"><span class="pre">doit()</span></code> in this way. However,
this can provide a happy medium between having a function that always
evaluates and a function that never evaluates, producing a function that
doesn’t evaluate by default but can be evaluated on demand (see the
<a class="reference internal" href="#custom-functions-eval-best-practices"><span class="std std-ref">discussion above</span></a>).</p>
</section>
<section id="expand">
<span id="custom-functions-expand"></span><h4><code class="docutils literal notranslate"><span class="pre">expand()</span></code><a class="headerlink" href="#expand" title="Permalink to this heading">#</a></h4>
<p>The <a class="reference internal" href="../modules/core.html#sympy.core.function.expand" title="sympy.core.function.expand"><code class="xref py py-func docutils literal notranslate"><span class="pre">expand()</span></code></a> function “expands” an expression in various ways. It is
actually a wrapper around several sub-expansion hints. Each function
corresponds to a hint to the <code class="docutils literal notranslate"><span class="pre">expand()</span></code> function/method. A specific expand
<em>hint</em> can be defined in a custom function by defining <code class="docutils
literal notranslate"><span class="pre">_eval_expand_<em>hint</em>(self,
**hints)</span></code>. See the documentation of <a class="reference internal" href="../modules/core.html#sympy.core.function.expand" title="sympy.core.function.expand"><code class="xref py py-func docutils literal notranslate"><span class="pre">expand()</span></code></a> for details
on which hints are defined and the documentation for each specific <code
class="docutils literal notranslate"><span
class="pre">expand_<em>hint</em>()</span></code> function (e.g.,
<a class="reference internal" href="../modules/core.html#sympy.core.function.expand_trig" title="sympy.core.function.expand_trig"><code class="xref py py-func docutils literal notranslate"><span class="pre">expand_trig()</span></code></a>) for details on what each hint is designed to do.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">**hints</span></code> keyword arguments are additional hints that may be passed to the
expand function to specify additional behavior (these are separate from the
predefined <em>hints</em> described in the previous paragraph). Unknown hints should
be ignored as they may apply to other functions’ custom <code class="docutils literal notranslate"><span class="pre">expand()</span></code> methods. A
common hint to define is <code class="docutils literal notranslate"><span class="pre">force</span></code>, where <code class="docutils literal notranslate"><span class="pre">force=True</span></code> would force an expansion
that might not be mathematically valid for all the given input assumptions.
For example, <code class="docutils literal notranslate"><span class="pre">expand_log(log(x*y),</span> <span class="pre">force=True)</span></code> produces <code class="docutils literal notranslate"><span class="pre">log(x)</span> <span class="pre">+</span> <span class="pre">log(y)</span></code>
even though this identity is not true for all complex <code class="docutils literal notranslate"><span class="pre">x</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code> (typically
<code class="docutils literal notranslate"><span class="pre">force=False</span></code> is the default).</p>
<p>Note that <code class="docutils literal notranslate"><span class="pre">expand()</span></code> automatically takes care of recursively expanding
expressions using its own <code class="docutils literal notranslate"><span class="pre">deep</span></code> flag, so <code class="docutils literal notranslate"><span class="pre">_eval_expand_*</span></code> methods should not
recursively call expand on the arguments of the function.</p>
<p>For our <a class="reference internal" href="#custom-functions-versine-definition"><span class="std std-ref"><code class="docutils literal notranslate"><span class="pre">versin</span></code> example</span></a>, we can define
rudimentary <code class="docutils literal notranslate"><span class="pre">trig</span></code> expansion by defining an <code class="docutils literal notranslate"><span class="pre">_eval_expand_trig</span></code> method,
which recursively calls <code class="docutils literal notranslate"><span class="pre">expand_trig()</span></code> on <code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">-</span> <span class="pre">cos(x)</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sympy</span> <span class="kn">import</span> <span class="n">expand_trig</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">y</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">versin</span><span class="p">(</span><span class="n">Function</span><span class="p">):</span>
<span class="gp">... </span>   <span class="k">def</span> <span class="nf">_eval_expand_trig</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">hints</span><span class="p">):</span>
<span class="gp">... </span>       <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">... </span>       <span class="k">return</span> <span class="n">expand_trig</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">cos</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">versin</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="n">trig</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="go">sin(x)*sin(y) - cos(x)*cos(y) + 1</span>
</pre></div>
</div>
<p>A more sophisticated implementation might attempt to rewrite the result of
<code class="docutils literal notranslate"><span class="pre">expand_trig(1</span> <span class="pre">-</span> <span class="pre">cos(x))</span></code> back into <code class="docutils literal notranslate"><span class="pre">versin</span></code> functions. This is left as an
exercise for the reader.</p>
</section>
</section>
<section id="differentiation">
<span id="custom-functions-differentiation"></span><h3>Differentiation<a class="headerlink" href="#differentiation" title="Permalink to this heading">#</a></h3>
<p>To define differentiation via <a class="reference internal" href="../modules/core.html#sympy.core.function.diff" title="sympy.core.function.diff"><code class="xref py py-func docutils literal notranslate"><span class="pre">diff()</span></code></a>, define a method <code class="docutils literal notranslate"><span class="pre">fdiff(self,</span> <span class="pre">argindex)</span></code>. <code class="docutils literal notranslate"><span class="pre">fdiff()</span></code> should return the derivative of the function, without
considering the chain rule, with respect to the <code class="docutils literal notranslate"><span class="pre">argindex</span></code>-th variable.
<code class="docutils literal notranslate"><span class="pre">argindex</span></code> is indexed starting at <code class="docutils literal notranslate"><span class="pre">1</span></code>.</p>
<p>That is, <code class="docutils literal notranslate"><span class="pre">f(x1,</span> <span class="pre">...,</span> <span class="pre">xi,</span> <span class="pre">...,</span> <span class="pre">xn).fdiff(i)</span></code> should return <span class="math notranslate nohighlight">\(\frac{d}{d x_i}
f(x_1, \ldots, x_i, \ldots, x_n)\)</span>, where <span class="math notranslate nohighlight">\(x_k\)</span> are independent of one another.
<code class="docutils literal notranslate"><span class="pre">diff()</span></code> will automatically apply the chain rule using the result of
<code class="docutils literal notranslate"><span class="pre">fdiff()</span></code>. User code should use <code class="docutils literal notranslate"><span class="pre">diff()</span></code> and not call <code class="docutils literal notranslate"><span class="pre">fdiff()</span></code> directly.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">Function</span></code> subclasses should define differentiation using <code class="docutils literal notranslate"><span class="pre">fdiff()</span></code>. Subclasses
of <a class="reference internal" href="../modules/core.html#sympy.core.expr.Expr" title="sympy.core.expr.Expr"><code class="xref py py-class docutils literal notranslate"><span class="pre">Expr</span></code></a> that aren’t <code class="docutils literal notranslate"><span class="pre">Function</span></code> subclasses will need to define
<code class="docutils literal notranslate"><span class="pre">_eval_derivative()</span></code> instead. It is not recommended to redefine
<code class="docutils literal notranslate"><span class="pre">_eval_derivative()</span></code> on a <code class="docutils literal notranslate"><span class="pre">Function</span></code> subclass.</p>
</div>
<p>For our <a class="reference internal" href="#custom-functions-versine-definition"><span class="std std-ref"><span class="math notranslate nohighlight">\(\operatorname{versin}\)</span> example
function</span></a>, the derivative is <span class="math notranslate nohighlight">\(\sin(x)\)</span>.</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">versin</span><span class="p">(</span><span class="n">Function</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">fdiff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">argindex</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="gp">... </span>        <span class="c1"># argindex indexes the args, starting at 1</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="n">sin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
<div class="highlight-py notranslate" id="custom-functions-differentiation-examples"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">versin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="go">sin(x)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">versin</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="go">2*x*sin(x**2)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">versin</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="go">sin(x + y)</span>
</pre></div>
</div>
<p>As an example of a function that has multiple arguments, consider the <a class="reference internal" href="#custom-functions-fma-definition"><span class="std std-ref">fused
multiply-add (FMA) example</span></a> defined above
(<span class="math notranslate nohighlight">\(\operatorname{FMA}(x, y, z) = xy + z\)</span>).</p>
<p>We have</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\frac{d}{dx} \operatorname{FMA}(x, y, z) = y,\]</div>
</div>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\frac{d}{dy} \operatorname{FMA}(x, y, z) = x,\]</div>
</div>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\frac{d}{dz} \operatorname{FMA}(x, y, z) = 1.\]</div>
</div>
<p>So the <code class="docutils literal notranslate"><span class="pre">fdiff()</span></code> method for <code class="docutils literal notranslate"><span class="pre">FMA</span></code> would look like this:</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sympy</span> <span class="kn">import</span> <span class="n">Number</span><span class="p">,</span> <span class="n">symbols</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;x y z&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">FMA</span><span class="p">(</span><span class="n">Function</span><span class="p">):</span>
<span class="gp">... </span><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="gp">... </span><span class="sd">    FMA(x, y, z) = x*y + z</span>
<span class="gp">... </span><span class="sd">    &quot;&quot;&quot;</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">fdiff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">argindex</span><span class="p">):</span>
<span class="gp">... </span>        <span class="c1"># argindex indexes the args, starting at 1</span>
<span class="gp">... </span>        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span>
<span class="gp">... </span>        <span class="k">if</span> <span class="n">argindex</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<span class="gp">... </span>            <span class="k">return</span> <span class="n">y</span>
<span class="gp">... </span>        <span class="k">elif</span> <span class="n">argindex</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
<span class="gp">... </span>            <span class="k">return</span> <span class="n">x</span>
<span class="gp">... </span>        <span class="k">elif</span> <span class="n">argindex</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
<span class="gp">... </span>            <span class="k">return</span> <span class="mi">1</span>
</pre></div>
</div>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">FMA</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="go">y</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">FMA</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
<span class="go">x</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">FMA</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">FMA</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="go">x**2 + 2*x*(x + 1)</span>
</pre></div>
</div>
<p>To leave a derivative unevaluated, raise
<code class="docutils literal notranslate"><span class="pre">sympy.core.function.ArgumentIndexError(self,</span> <span class="pre">argindex)</span></code>. This is the default
behavior if <code class="docutils literal notranslate"><span class="pre">fdiff()</span></code> is not defined. Here is an example function <span class="math notranslate nohighlight">\(f(x, y)\)</span> that
is linear in the first argument and has an unevaluated derivative on the
second argument.</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sympy.core.function</span> <span class="kn">import</span> <span class="n">ArgumentIndexError</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">f</span><span class="p">(</span><span class="n">Function</span><span class="p">):</span>
<span class="gp">... </span>   <span class="nd">@classmethod</span>
<span class="gp">... </span>   <span class="k">def</span> <span class="nf">eval</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
<span class="gp">... </span>       <span class="k">pass</span>
<span class="gp">...</span>
<span class="gp">... </span>   <span class="k">def</span> <span class="nf">fdiff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">argindex</span><span class="p">):</span>
<span class="gp">... </span>       <span class="k">if</span> <span class="n">argindex</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<span class="gp">... </span>          <span class="k">return</span> <span class="mi">1</span>
<span class="gp">... </span>       <span class="k">raise</span> <span class="n">ArgumentIndexError</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">argindex</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
<span class="go">Derivative(f(x, y), y)</span>
</pre></div>
</div>
<!-- TODO: series expansion will need its own guide. See
     https://github.com/sympy/sympy/issues/23625. -->
<!-- TODO: integration will need its own guide. See
     https://github.com/sympy/sympy/issues/23624. -->
</section>
<section id="printing">
<h3>Printing<a class="headerlink" href="#printing" title="Permalink to this heading">#</a></h3>
<p>You can define how a function prints itself with the varions
<a class="reference internal" href="../modules/printing.html#module-printing"><span class="std std-ref">printers</span></a> such as the <a class="reference internal" href="../modules/printing.html#sympy.printing.str.StrPrinter" title="sympy.printing.str.StrPrinter"><code class="xref py py-class docutils literal notranslate"><span class="pre">string</span> <span class="pre">printer</span></code></a>, <a class="reference internal" href="../modules/printing.html#sympy.printing.pretty.pretty.PrettyPrinter" title="sympy.printing.pretty.pretty.PrettyPrinter"><code class="xref py py-func docutils literal notranslate"><span class="pre">pretty</span> <span class="pre">printers</span></code></a>, and <a class="reference internal" href="../modules/printing.html#sympy.printing.latex.LatexPrinter" title="sympy.printing.latex.LatexPrinter"><code class="xref py py-func docutils literal notranslate"><span class="pre">LaTeX</span> <span class="pre">printer</span></code></a>, as well as code printers for various
languages like <a class="reference internal" href="../modules/printing.html#sympy.printing.c.C99CodePrinter" title="sympy.printing.c.C99CodePrinter"><code class="xref py py-class docutils literal notranslate"><span class="pre">C</span></code></a> and
<a class="reference internal" href="../modules/printing.html#sympy.printing.fortran.FCodePrinter" title="sympy.printing.fortran.FCodePrinter"><code class="xref py py-class docutils literal notranslate"><span class="pre">Fortran</span></code></a>.</p>
<p>In most cases, you will not need to define any printing methods. The default
behavior is to print functions using their name. However, in some cases we may
want to define special printing for a function.</p>
<p>For example, for our <a class="reference internal" href="#custom-functions-divides-definition"><span class="std std-ref">divides example
above</span></a>, we may want the LaTeX printer to
print a more mathematical expression. Let’s make the LaTeX printer represent
<code class="docutils literal notranslate"><span class="pre">divides(m,</span> <span class="pre">n)</span></code> as <code class="docutils literal notranslate"><span class="pre">\left</span> <span class="pre">[</span> <span class="pre">m</span> <span class="pre">\middle</span> <span class="pre">|</span> <span class="pre">n</span> <span class="pre">\right</span> <span class="pre">]</span></code>, which looks like <span class="math notranslate nohighlight">\(\left [
m \middle | n \right ]\)</span> (here <span class="math notranslate nohighlight">\([P]\)</span> is the <a class="reference external" href="https://en.wikipedia.org/wiki/Iverson_bracket">Iverson
bracket</a>, which is <span class="math notranslate nohighlight">\(1\)</span> if <span class="math notranslate nohighlight">\(P\)</span>
is true and <span class="math notranslate nohighlight">\(0\)</span> if <span class="math notranslate nohighlight">\(P\)</span> is false).</p>
<p>There are two primary ways to define printing for SymPy objects. One is to
define a printer on the printer class. Most classes that are part of the SymPy
library should use this method, by defining the printers on the respective
classes in <code class="docutils literal notranslate"><span class="pre">sympy.printing</span></code>. For user code, this may be preferable if you are
defining a custom printer, or if you have many custom functions that you want
to define printing for. See <a class="reference internal" href="../modules/printing.html#printer-example"><span class="std std-ref">Example of Custom Printer</span></a> for an example of how to
define a printer in this way.</p>
<p>The other way is to define the printing as a method on the function class. To
do this, first look up the <code class="docutils literal notranslate"><span class="pre">printmethod</span></code> attribute on the printer you want to
define the printing for. This is the name of the method you should define for
that printer. For the LaTeX printer, <a class="reference internal" href="../modules/printing.html#sympy.printing.latex.LatexPrinter.printmethod" title="sympy.printing.latex.LatexPrinter.printmethod"><code class="xref py py-attr docutils literal notranslate"><span class="pre">LatexPrinter.printmethod</span></code></a> is
<code class="docutils literal notranslate"><span class="pre">'_latex'</span></code>. The print method always takes one argument, <code class="docutils literal notranslate"><span class="pre">printer</span></code>.
<code class="docutils literal notranslate"><span class="pre">printer._print</span></code> should be used to recursively print any other expressions,
including the arguments of the function.</p>
<p>So to define our <code class="docutils literal notranslate"><span class="pre">divides</span></code> LaTeX printer, we will define the function
<code class="docutils literal notranslate"><span class="pre">_latex(self,</span> <span class="pre">printer)</span></code> on the class, like this:</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sympy</span> <span class="kn">import</span> <span class="n">latex</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">divides</span><span class="p">(</span><span class="n">Function</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">_latex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">printer</span><span class="p">):</span>
<span class="gp">... </span>        <span class="n">m</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span>
<span class="gp">... </span>        <span class="n">_m</span><span class="p">,</span> <span class="n">_n</span> <span class="o">=</span> <span class="n">printer</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">m</span><span class="p">),</span> <span class="n">printer</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="sa">r</span><span class="s1">&#39;\left [ </span><span class="si">%s</span><span class="s1"> \middle | </span><span class="si">%s</span><span class="s1"> \right ]&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">_m</span><span class="p">,</span> <span class="n">_n</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">latex</span><span class="p">(</span><span class="n">divides</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">)))</span>
<span class="go">\left [ m \middle | n \right ]</span>
</pre></div>
</div>
<p>See <a class="reference internal" href="../modules/printing.html#printer-method-example"><span class="std std-ref">Example of Custom Printing Method</span></a> for more details on how to define printer
methods and some pitfalls to avoid. Most importantly, you should always use
<code class="docutils literal notranslate"><span class="pre">printer._print()</span></code> to recursively print the arguments of the function inside
of a custom printer.</p>
</section>
<section id="other-methods">
<h3>Other Methods<a class="headerlink" href="#other-methods" title="Permalink to this heading">#</a></h3>
<p>Several other methods can be defined on custom functions to specify various behaviors.</p>
<section id="inverse">
<h4><code class="docutils literal notranslate"><span class="pre">inverse()</span></code><a class="headerlink" href="#inverse" title="Permalink to this heading">#</a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">inverse(self,</span> <span class="pre">argindex=1)</span></code> method can be defined to specify the inverse
of the function. This is used by <a class="reference internal" href="../modules/solvers/solvers.html#sympy.solvers.solvers.solve" title="sympy.solvers.solvers.solve"><code class="xref py py-func docutils literal notranslate"><span class="pre">solve()</span></code></a> and <a class="reference internal" href="../modules/solvers/solveset.html#sympy.solvers.solveset.solveset" title="sympy.solvers.solveset.solveset"><code class="xref py py-func docutils literal notranslate"><span class="pre">solveset()</span></code></a>. The
<code class="docutils literal notranslate"><span class="pre">argindex</span></code> argument is the argument of the function, starting at 1 (similar to
the same argument name for the <a class="reference internal" href="#custom-functions-differentiation"><span class="std std-ref"><code class="docutils literal notranslate"><span class="pre">fdiff()</span></code>
method</span></a>).</p>
<p><code class="docutils literal notranslate"><span class="pre">inverse()</span></code> should return a function (not an expression) for the inverse. If the
inverse is a larger expression than a single function, it can return a
<code class="docutils literal notranslate"><span class="pre">lambda</span></code> function.</p>
<p><code class="docutils literal notranslate"><span class="pre">inverse()</span></code> should only be defined for functions that are one-to-one. In other
words, <code class="docutils literal notranslate"><span class="pre">f(x).inverse()</span></code> is the <a class="reference external" href="https://en.wikipedia.org/wiki/Inverse_function#Left_and_right_inverses">left
inverse</a>
of <code class="docutils literal notranslate"><span class="pre">f(x)</span></code>. Defining <code class="docutils literal notranslate"><span class="pre">inverse()</span></code> on a function that is not one-to-one may
result in <code class="docutils literal notranslate"><span class="pre">solve()</span></code> not giving all possible solutions to an expression
containing the function.</p>
<p>Our <a class="reference internal" href="#custom-functions-versine-definition"><span class="std std-ref">example versine function</span></a> is not
one-to-one (because cosine is not), but its inverse <span class="math notranslate nohighlight">\(\operatorname{arcversin}\)</span>
is. We may define it as follows (using the same naming convention as other
inverse trig functions in SymPy):</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">aversin</span><span class="p">(</span><span class="n">Function</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">inverse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">argindex</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="n">versin</span>
</pre></div>
</div>
<p>This makes <code class="docutils literal notranslate"><span class="pre">solve()</span></code> work on <code class="docutils literal notranslate"><span class="pre">aversin(x)</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sympy</span> <span class="kn">import</span> <span class="n">solve</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">solve</span><span class="p">(</span><span class="n">aversin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<span class="go">[versin(y)]</span>
</pre></div>
</div>
</section>
<section id="as-real-imag">
<h4><code class="docutils literal notranslate"><span class="pre">as_real_imag()</span></code><a class="headerlink" href="#as-real-imag" title="Permalink to this heading">#</a></h4>
<p>The method <a class="reference internal" href="../modules/core.html#sympy.core.expr.Expr.as_real_imag" title="sympy.core.expr.Expr.as_real_imag"><code class="xref py py-meth docutils literal notranslate"><span class="pre">as_real_imag()</span></code></a> method
defines how to split a function into its real and imaginary parts. It is used
by various SymPy functions that operate on the real and imaginary parts of an
expression separately.</p>
<p><code class="docutils literal notranslate"><span class="pre">as_real_imag(self,</span> <span class="pre">deep=True,</span> <span class="pre">**hints)</span></code> should return a 2-tuple containing
the real part and imaginary part of the function. That is
<code class="docutils literal notranslate"><span class="pre">expr.as_real_imag()</span></code> returns <code class="docutils literal notranslate"><span class="pre">(re(expr),</span> <span class="pre">im(expr))</span></code>, where
<code class="docutils literal notranslate"><span class="pre">expr</span> <span class="pre">==</span> <span class="pre">re(expr)</span> <span class="pre">+</span> <span class="pre">im(expr)*I</span></code>, and <code class="docutils literal notranslate"><span class="pre">re(expr)</span></code> and <code class="docutils literal notranslate"><span class="pre">im(expr)</span></code> are real.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">deep=True</span></code>, it should recursively call <code class="docutils literal notranslate"><span class="pre">as_real_imag(deep=True,</span> <span class="pre">**hints)</span></code>
on its arguments. As with <a class="reference internal" href="#custom-functions-doit"><span class="std std-ref"><code class="docutils literal notranslate"><span class="pre">doit()</span></code></span></a> and <a class="reference internal" href="#custom-functions-expand"><span class="std std-ref">the
<code class="docutils literal notranslate"><span class="pre">_eval_expand_*()</span></code> methods</span></a>, <code class="docutils literal notranslate"><span class="pre">**hints</span></code> may be any
hints to allow the user to specify the behavior of the method. Unknown hints
should be ignored and passed through on any recursive calls in case they are
meant for other <code class="docutils literal notranslate"><span class="pre">as_real_imag()</span></code> methods.</p>
<p>For our <a class="reference internal" href="#custom-functions-versine-definition"><span class="std std-ref"><code class="docutils literal notranslate"><span class="pre">versin</span></code> example</span></a>, we can
recursively use the <code class="docutils literal notranslate"><span class="pre">as_real_imag()</span></code> that is already defined for <code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">-</span> <span class="pre">cos(x)</span></code>.</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">versin</span><span class="p">(</span><span class="n">Function</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">as_real_imag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">hints</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">cos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span><span class="o">.</span><span class="n">as_real_imag</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="n">deep</span><span class="p">,</span> <span class="o">**</span><span class="n">hints</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">versin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">as_real_imag</span><span class="p">()</span>
<span class="go">(-cos(re(x))*cosh(im(x)) + 1, sin(re(x))*sinh(im(x)))</span>
</pre></div>
</div>
<p>Defining <code class="docutils literal notranslate"><span class="pre">as_real_imag()</span></code> also automatically makes <a class="reference internal" href="../modules/core.html#sympy.core.function.expand_complex" title="sympy.core.function.expand_complex"><code class="xref py py-func docutils literal notranslate"><span class="pre">expand_complex()</span></code></a>
work.</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">versin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="nb">complex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="go">I*sin(re(x))*sinh(im(x)) - cos(re(x))*cosh(im(x)) + 1</span>
</pre></div>
</div>
</section>
<section id="miscellaneous-eval-methods">
<h4>Miscellaneous <code class="docutils literal notranslate"><span class="pre">_eval_*</span></code> methods<a class="headerlink" href="#miscellaneous-eval-methods" title="Permalink to this heading">#</a></h4>
<p>There are many other functions in SymPy whose behavior can be defined on
custom functions via a custom <code class="docutils literal notranslate"><span class="pre">_eval_*</span></code> method, analogous to the ones
described above. See the documentation of the specific function for details on
how to define each method.</p>
</section>
</section>
</section>
<section id="complete-examples">
<span id="custom-functions-complete-examples"></span><h2>Complete Examples<a class="headerlink" href="#complete-examples" title="Permalink to this heading">#</a></h2>
<p>Here are complete examples for the example functions defined in this guide.
See the above sections for details on each method.</p>
<section id="versine">
<span id="custom-functions-versine-full-example"></span><h3>Versine<a class="headerlink" href="#versine" title="Permalink to this heading">#</a></h3>
<p>The versine (versed sine) function is defined as</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\operatorname{versin}(x) = 1 - \cos(x).\]</div>
</div>
<p>Versine is an example of a simple function defined for all complex numbers.
The mathematical definition is simple, which makes it straightforward to
define all the above methods on it (in most cases we can just reuse the
existing SymPy logic defined on <code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">-</span> <span class="pre">cos(x)</span></code>).</p>
<section id="definition">
<h4>Definition<a class="headerlink" href="#definition" title="Permalink to this heading">#</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sympy</span> <span class="kn">import</span> <span class="n">Function</span><span class="p">,</span> <span class="n">cos</span><span class="p">,</span> <span class="n">expand_trig</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">pi</span><span class="p">,</span> <span class="n">sin</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sympy.core.logic</span> <span class="kn">import</span> <span class="n">fuzzy_and</span><span class="p">,</span> <span class="n">fuzzy_not</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">versin</span><span class="p">(</span><span class="n">Function</span><span class="p">):</span>
<span class="gp">... </span><span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="gp">... </span><span class="sd">    The versine function.</span>
<span class="gp">...</span>
<span class="gp">... </span><span class="sd">    $\operatorname{versin}(x) = 1 - \cos(x) = 2\sin(x/2)^2.$</span>
<span class="gp">...</span>
<span class="gp">... </span><span class="sd">    Geometrically, given a standard right triangle with angle x in the</span>
<span class="gp">... </span><span class="sd">    unit circle, the versine of x is the positive horizontal distance from</span>
<span class="gp">... </span><span class="sd">    the right angle of the triangle to the rightmost point on the unit</span>
<span class="gp">... </span><span class="sd">    circle. It was historically used as a more numerically accurate way to</span>
<span class="gp">... </span><span class="sd">    compute 1 - cos(x), but it is rarely used today.</span>
<span class="gp">...</span>
<span class="gp">... </span><span class="sd">    References</span>
<span class="gp">... </span><span class="sd">    ==========</span>
<span class="gp">...</span>
<span class="gp">... </span><span class="sd">    .. [1] https://en.wikipedia.org/wiki/Versine</span>
<span class="gp">... </span><span class="sd">    .. [2] https://blogs.scientificamerican.com/roots-of-unity/10-secret-trig-functions-your-math-teachers-never-taught-you/</span>
<span class="gp">... </span><span class="sd">    &quot;&quot;&quot;</span>
<span class="gp">... </span>    <span class="c1"># Define evaluation on basic inputs.</span>
<span class="gp">... </span>    <span class="nd">@classmethod</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">eval</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<span class="gp">... </span>        <span class="c1"># If x is an explicit integer multiple of pi, x/pi will cancel and</span>
<span class="gp">... </span>        <span class="c1"># be an Integer.</span>
<span class="gp">... </span>        <span class="n">n</span> <span class="o">=</span> <span class="n">x</span><span class="o">/</span><span class="n">pi</span>
<span class="gp">... </span>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">Integer</span><span class="p">):</span>
<span class="gp">... </span>            <span class="k">return</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="n">n</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="c1"># Define numerical evaluation with evalf().</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">_eval_evalf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prec</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">_eval_evalf</span><span class="p">(</span><span class="n">prec</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="c1"># Define basic assumptions.</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">_eval_is_nonnegative</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">... </span>        <span class="c1"># versin(x) is nonnegative if x is real</span>
<span class="gp">... </span>        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">... </span>        <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">is_real</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
<span class="gp">... </span>            <span class="k">return</span> <span class="kc">True</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">_eval_is_positive</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">... </span>        <span class="c1"># versin(x) is positive if x is real and not an even multiple of pi</span>
<span class="gp">... </span>        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">...</span>
<span class="gp">... </span>        <span class="c1"># x.as_independent(pi, as_Add=False) will split x as a Mul of the</span>
<span class="gp">... </span>        <span class="c1"># form n*pi</span>
<span class="gp">... </span>        <span class="n">coeff</span><span class="p">,</span> <span class="n">pi_</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">as_independent</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">as_Add</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">... </span>        <span class="c1"># If pi_ = pi, x = coeff*pi. Otherwise pi_ = 1 and x is not</span>
<span class="gp">... </span>        <span class="c1"># (structurally) of the form n*pi.</span>
<span class="gp">... </span>        <span class="k">if</span> <span class="n">pi_</span> <span class="o">==</span> <span class="n">pi</span><span class="p">:</span>
<span class="gp">... </span>            <span class="k">return</span> <span class="n">fuzzy_and</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">is_real</span><span class="p">,</span> <span class="n">fuzzy_not</span><span class="p">(</span><span class="n">coeff</span><span class="o">.</span><span class="n">is_even</span><span class="p">)])</span>
<span class="gp">... </span>        <span class="k">elif</span> <span class="n">x</span><span class="o">.</span><span class="n">is_real</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
<span class="gp">... </span>            <span class="k">return</span> <span class="kc">False</span>
<span class="gp">... </span>        <span class="c1"># else: return None. We do not know for sure whether x is an even</span>
<span class="gp">... </span>        <span class="c1"># multiple of pi</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="c1"># Define the behavior for various simplification and rewriting</span>
<span class="gp">... </span>    <span class="c1"># functions.</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">_eval_rewrite</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rule</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">hints</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">if</span> <span class="n">rule</span> <span class="o">==</span> <span class="n">cos</span><span class="p">:</span>
<span class="gp">... </span>            <span class="k">return</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">cos</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
<span class="gp">... </span>        <span class="k">elif</span> <span class="n">rule</span> <span class="o">==</span> <span class="n">sin</span><span class="p">:</span>
<span class="gp">... </span>            <span class="k">return</span> <span class="mi">2</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">_eval_expand_trig</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">hints</span><span class="p">):</span>
<span class="gp">... </span>        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="n">expand_trig</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">cos</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">as_real_imag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">hints</span><span class="p">):</span>
<span class="gp">... </span>        <span class="c1"># reuse _eval_rewrite(cos) defined above</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rewrite</span><span class="p">(</span><span class="n">cos</span><span class="p">)</span><span class="o">.</span><span class="n">as_real_imag</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="n">deep</span><span class="p">,</span> <span class="o">**</span><span class="n">hints</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="c1"># Define differentiation.</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">fdiff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">argindex</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="n">sin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</section>
<section id="examples">
<h4>Examples<a class="headerlink" href="#examples" title="Permalink to this heading">#</a></h4>
<p><strong>Evaluation:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;x y&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">versin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="go">versin(x)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">versin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="p">)</span>
<span class="go">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">versin</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
<span class="go">0.459697694131860</span>
</pre></div>
</div>
<p><strong>Assumptions:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">n</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="n">integer</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">versin</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">.</span><span class="n">is_real</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">versin</span><span class="p">((</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">pi</span><span class="p">)</span><span class="o">.</span><span class="n">is_positive</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">versin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">*</span><span class="n">pi</span><span class="p">)</span><span class="o">.</span><span class="n">is_zero</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">versin</span><span class="p">(</span><span class="n">n</span><span class="o">*</span><span class="n">pi</span><span class="p">)</span><span class="o">.</span><span class="n">is_positive</span><span class="p">)</span>
<span class="go">None</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">r</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">real</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">versin</span><span class="p">(</span><span class="n">r</span><span class="p">)</span><span class="o">.</span><span class="n">is_positive</span><span class="p">)</span>
<span class="go">None</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nr</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;nr&#39;</span><span class="p">,</span> <span class="n">real</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">versin</span><span class="p">(</span><span class="n">nr</span><span class="p">)</span><span class="o">.</span><span class="n">is_nonnegative</span><span class="p">)</span>
<span class="go">None</span>
</pre></div>
</div>
<p><strong>Simplification:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;a b&#39;</span><span class="p">,</span> <span class="n">real</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sympy</span> <span class="kn">import</span> <span class="n">I</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">versin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">rewrite</span><span class="p">(</span><span class="n">cos</span><span class="p">)</span>
<span class="go">1 - cos(x)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">versin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">rewrite</span><span class="p">(</span><span class="n">sin</span><span class="p">)</span>
<span class="go">2*sin(x/2)**2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">versin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="n">trig</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="go">2 - 2*cos(x)**2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">versin</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="o">*</span><span class="n">I</span><span class="p">)</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="nb">complex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="go">I*sin(a)*sinh(b) - cos(a)*cosh(b) + 1</span>
</pre></div>
</div>
<p><strong>Differentiation:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">versin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="go">sin(x)</span>
</pre></div>
</div>
<p><strong>Solving:</strong></p>
<!-- Note: doit() is commented out in the example above because it makes the
     below return 1 - cos(x) instead of versin(x). Most people shouldn't
     implement doit() like that anyway, though. -->
<p>(a more general version of <code class="docutils literal notranslate"><span class="pre">aversin</span></code> would have all the above methods defined
as well)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">aversin</span><span class="p">(</span><span class="n">Function</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">inverse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">argindex</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="n">versin</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sympy</span> <span class="kn">import</span> <span class="n">solve</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">solve</span><span class="p">(</span><span class="n">aversin</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<span class="go">[-sqrt(versin(y)), sqrt(versin(y))]</span>
</pre></div>
</div>
</section>
</section>
<section id="divides">
<span id="custom-functions-divides-full-example"></span><h3>divides<a class="headerlink" href="#divides" title="Permalink to this heading">#</a></h3>
<p>divides is a function defined by</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\begin{split}\operatorname{divides}(m, n) = \begin{cases} 1 &amp; \text{for}\: m \mid n \\
  0 &amp; \text{for}\: m\not\mid n  \end{cases},\end{split}\]</div>
</div>
<p>that is, <code class="docutils literal notranslate"><span class="pre">divides(m,</span> <span class="pre">n)</span></code> is 1 if <code class="docutils literal notranslate"><span class="pre">m</span></code> divides <code class="docutils literal notranslate"><span class="pre">n</span></code> and <code class="docutils literal notranslate"><span class="pre">0</span></code> if <code class="docutils literal notranslate"><span class="pre">m</span></code> does not
divide <code class="docutils literal notranslate"><span class="pre">m</span></code>. It is only defined for integer <code class="docutils literal notranslate"><span class="pre">m</span></code> and <code class="docutils literal notranslate"><span class="pre">n</span></code>. For the sake of
simplicity, we use the convention that <span class="math notranslate nohighlight">\(m \mid 0\)</span> for all integer <span class="math notranslate nohighlight">\(m\)</span>.</p>
<p><code class="docutils literal notranslate"><span class="pre">divides</span></code> is an example of a function that is only defined for certain input
values (integers). <code class="docutils literal notranslate"><span class="pre">divides</span></code> also gives an example of defining a custom
printer (<code class="docutils literal notranslate"><span class="pre">_latex()</span></code>).</p>
<section id="id2">
<h4>Definition<a class="headerlink" href="#id2" title="Permalink to this heading">#</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sympy</span> <span class="kn">import</span> <span class="n">Function</span><span class="p">,</span> <span class="n">Integer</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sympy.core.logic</span> <span class="kn">import</span> <span class="n">fuzzy_not</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">divides</span><span class="p">(</span><span class="n">Function</span><span class="p">):</span>
<span class="gp">... </span><span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="gp">... </span><span class="sd">    $$\operatorname{divides}(m, n) = \begin{cases} 1 &amp; \text{for}\: m \mid n \\ 0 &amp; \text{for}\: m\not\mid n  \end{cases}.$$</span>
<span class="gp">...</span>
<span class="gp">... </span><span class="sd">    That is, ``divides(m, n)`` is ``1`` if ``m`` divides ``n`` and ``0``</span>
<span class="gp">... </span><span class="sd">    if ``m`` does not divide ``n`. It is undefined if ``m`` or ``n`` are</span>
<span class="gp">... </span><span class="sd">    not integers. For simplicity, the convention is used that</span>
<span class="gp">... </span><span class="sd">    ``divides(m, 0) = 1`` for all integers ``m``.</span>
<span class="gp">...</span>
<span class="gp">... </span><span class="sd">    References</span>
<span class="gp">... </span><span class="sd">    ==========</span>
<span class="gp">...</span>
<span class="gp">... </span><span class="sd">    .. [1] https://en.wikipedia.org/wiki/Divisor#Definition</span>
<span class="gp">... </span><span class="sd">    &quot;&quot;&quot;</span>
<span class="gp">... </span>    <span class="c1"># Define evaluation on basic inputs, as well as type checking that the</span>
<span class="gp">... </span>    <span class="c1"># inputs are not nonintegral.</span>
<span class="gp">... </span>    <span class="nd">@classmethod</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">eval</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
<span class="gp">... </span>        <span class="c1"># Evaluate for explicit integer m and n.</span>
<span class="gp">... </span>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">Integer</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">Integer</span><span class="p">):</span>
<span class="gp">... </span>            <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">n</span> <span class="o">%</span> <span class="n">m</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">... </span>        <span class="c1"># For symbolic arguments, require m and n to be integer.</span>
<span class="gp">... </span>        <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">is_integer</span> <span class="ow">is</span> <span class="kc">False</span> <span class="ow">or</span> <span class="n">n</span><span class="o">.</span><span class="n">is_integer</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
<span class="gp">... </span>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;m and n should be integers&quot;</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="c1"># Define basic assumptions.</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="c1"># divides is always either 0 or 1.</span>
<span class="gp">... </span>    <span class="n">is_integer</span> <span class="o">=</span> <span class="kc">True</span>
<span class="gp">... </span>    <span class="n">is_negative</span> <span class="o">=</span> <span class="kc">False</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="c1"># Whether divides(m, n) is 0 or 1 depends on m and n. Note that this</span>
<span class="gp">... </span>    <span class="c1"># method only makes sense because we don&#39;t automatically evaluate on</span>
<span class="gp">... </span>    <span class="c1"># such cases, but instead simplify these cases in doit() below.</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">_eval_is_zero</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">... </span>        <span class="n">m</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span>
<span class="gp">... </span>        <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">is_integer</span> <span class="ow">and</span> <span class="n">n</span><span class="o">.</span><span class="n">is_integer</span><span class="p">:</span>
<span class="gp">... </span>             <span class="k">return</span> <span class="n">fuzzy_not</span><span class="p">((</span><span class="n">n</span><span class="o">/</span><span class="n">m</span><span class="p">)</span><span class="o">.</span><span class="n">is_integer</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="c1"># Define doit() as further evaluation on symbolic arguments using</span>
<span class="gp">... </span>    <span class="c1"># assumptions.</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">doit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deep</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">hints</span><span class="p">):</span>
<span class="gp">... </span>        <span class="n">m</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span>
<span class="gp">... </span>        <span class="c1"># Recursively call doit() on the args whenever deep=True.</span>
<span class="gp">... </span>        <span class="c1"># Be sure to pass deep=True and **hints through here.</span>
<span class="gp">... </span>        <span class="k">if</span> <span class="n">deep</span><span class="p">:</span>
<span class="gp">... </span>           <span class="n">m</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">doit</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="n">deep</span><span class="p">,</span> <span class="o">**</span><span class="n">hints</span><span class="p">),</span> <span class="n">n</span><span class="o">.</span><span class="n">doit</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="n">deep</span><span class="p">,</span> <span class="o">**</span><span class="n">hints</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">... </span>        <span class="c1"># divides(m, n) is 1 iff n/m is an integer. Note that m and n are</span>
<span class="gp">... </span>        <span class="c1"># already assumed to be integers because of the logic in eval().</span>
<span class="gp">... </span>        <span class="n">isint</span> <span class="o">=</span> <span class="p">(</span><span class="n">n</span><span class="o">/</span><span class="n">m</span><span class="p">)</span><span class="o">.</span><span class="n">is_integer</span>
<span class="gp">... </span>        <span class="k">if</span> <span class="n">isint</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
<span class="gp">... </span>            <span class="k">return</span> <span class="n">Integer</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">... </span>        <span class="k">elif</span> <span class="n">isint</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
<span class="gp">... </span>            <span class="k">return</span> <span class="n">Integer</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="gp">... </span>        <span class="k">else</span><span class="p">:</span>
<span class="gp">... </span>            <span class="k">return</span> <span class="n">divides</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="c1"># Define LaTeX printing for use with the latex() function and the</span>
<span class="gp">... </span>    <span class="c1"># Jupyter notebook.</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">_latex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">printer</span><span class="p">):</span>
<span class="gp">... </span>        <span class="n">m</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span>
<span class="gp">... </span>        <span class="n">_m</span><span class="p">,</span> <span class="n">_n</span> <span class="o">=</span> <span class="n">printer</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">m</span><span class="p">),</span> <span class="n">printer</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="sa">r</span><span class="s1">&#39;\left [ </span><span class="si">%s</span><span class="s1"> \middle | </span><span class="si">%s</span><span class="s1"> \right ]&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">_m</span><span class="p">,</span> <span class="n">_n</span><span class="p">)</span>
<span class="gp">...</span>
</pre></div>
</div>
</section>
<section id="id3">
<h4>Examples<a class="headerlink" href="#id3" title="Permalink to this heading">#</a></h4>
<p><strong>Evaluation</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sympy</span> <span class="kn">import</span> <span class="n">symbols</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;n m k&#39;</span><span class="p">,</span> <span class="n">integer</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">divides</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="go">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">divides</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">divides</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span><span class="o">.</span><span class="n">is_integer</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">divides</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">k</span><span class="p">)</span>
<span class="go">divides(k, 2*k)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">divides</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">k</span><span class="p">)</span><span class="o">.</span><span class="n">is_zero</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">divides</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">k</span><span class="p">)</span><span class="o">.</span><span class="n">doit</span><span class="p">()</span>
<span class="go">1</span>
</pre></div>
</div>
<p><strong>Printing:</strong></p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">str</span><span class="p">(</span><span class="n">divides</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span> <span class="c1"># This is using the default str printer</span>
<span class="go">&#39;divides(m, n)&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">latex</span><span class="p">(</span><span class="n">divides</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">)))</span>
<span class="go">\left [ m \middle | n \right ]</span>
</pre></div>
</div>
</section>
</section>
<section id="fused-multiply-add-fma">
<span id="custom-functions-fma-full-example"></span><h3>Fused Multiply-Add (FMA)<a class="headerlink" href="#fused-multiply-add-fma" title="Permalink to this heading">#</a></h3>
<p><a class="reference external" href="https://en.wikipedia.org/wiki/Multiply%E2%80%93accumulate_operation#Fused_multiply%E2%80%93add">Fused Multiply-Add
(FMA)</a>
is a multiplication followed by an addition:</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\operatorname{FMA}(x, y, z) = xy + z.\]</div>
</div>
<p>It is often implemented in hardware as a single floating-point operation that
has better rounding and performance than the equivalent combination of
multiplication and addition operations.</p>
<p>FMA is an example of a custom function that is defined as an unevaluated
“shorthand” to another function. This is because the
<a class="reference internal" href="#custom-functions-doit"><span class="std std-ref"><code class="docutils literal notranslate"><span class="pre">doit()</span></code></span></a> method is defined to return <code class="docutils literal notranslate"><span class="pre">x*y</span> <span class="pre">+</span> <span class="pre">z</span></code>,
meaning the <code class="docutils literal notranslate"><span class="pre">FMA</span></code> function can easily be evaluated to the expression is
represents, but the <a class="reference internal" href="#custom-functions-eval"><span class="std std-ref"><code class="docutils literal notranslate"><span class="pre">eval()</span></code></span></a> method does <em>not</em> return
anything (except when <code class="docutils literal notranslate"><span class="pre">x</span></code>, <code class="docutils literal notranslate"><span class="pre">y</span></code>, and <code class="docutils literal notranslate"><span class="pre">z</span></code> are all explicit numeric values),
meaning that it stays unevaluated by default.</p>
<p>Contrast this with the
<a class="reference internal" href="#custom-functions-versine-full-example"><span class="std std-ref">versine</span></a> example, which treats
<code class="docutils literal notranslate"><span class="pre">versin</span></code> as a first-class function in its own regard. Even though <code class="docutils literal notranslate"><span class="pre">versin(x)</span></code>
can be expressed in terms of other functions (<code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">-</span> <span class="pre">cos(x)</span></code>) it does not
evaluate on general symbolic inputs in <code class="docutils literal notranslate"><span class="pre">versin.eval()</span></code>, and <code class="docutils literal notranslate"><span class="pre">versin.doit()</span></code> is
not defined at all.</p>
<p><code class="docutils literal notranslate"><span class="pre">FMA</span></code> also represents an example of a continuous function defined on multiple
variables, which demonstrates how <code class="docutils literal notranslate"><span class="pre">argindex</span></code> works in the
<a class="reference internal" href="#custom-functions-differentiation"><span class="std std-ref"><code class="docutils literal notranslate"><span class="pre">fdiff</span></code></span></a> example.</p>
<p>Finally, <code class="docutils literal notranslate"><span class="pre">FMA</span></code> shows an example of defining some code printers for <code class="docutils literal notranslate"><span class="pre">C</span></code> and
<code class="docutils literal notranslate"><span class="pre">C++</span></code> (using the method names from <a class="reference internal" href="../modules/printing.html#sympy.printing.c.C99CodePrinter.printmethod" title="sympy.printing.c.C99CodePrinter.printmethod"><code class="xref py py-attr docutils literal notranslate"><span class="pre">C99CodePrinter.printmethod</span></code></a> and
<a class="reference internal" href="../modules/printing.html#sympy.printing.cxx.CXX11CodePrinter.printmethod" title="sympy.printing.cxx.CXX11CodePrinter.printmethod"><code class="xref py py-attr docutils literal notranslate"><span class="pre">CXX11CodePrinter.printmethod</span></code></a>), since that is a typical use-case for
this function.</p>
<p>The mathematical definition of FMA is very simple and it would be easy to
define every method on it, but only a handful are shown here. The
<a class="reference internal" href="#custom-functions-versine-full-example"><span class="std std-ref">versine</span></a> and
<a class="reference internal" href="#custom-functions-divides-full-example"><span class="std std-ref">divides</span></a> examples show how to define
the other important methods discussed in this guide.</p>
<p>Note that if you want to actually use fused-multiply add for code generation,
there is already a version in SymPy <code class="docutils literal notranslate"><span class="pre">sympy.codegen.cfunctions.fma()</span></code> which is
supported by the existing code printers. The version here is only designed to
serve as an example.</p>
<section id="id4">
<h4>Definition<a class="headerlink" href="#id4" title="Permalink to this heading">#</a></h4>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sympy</span> <span class="kn">import</span> <span class="n">Number</span><span class="p">,</span> <span class="n">symbols</span><span class="p">,</span> <span class="n">Add</span><span class="p">,</span> <span class="n">Mul</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;x y z&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">FMA</span><span class="p">(</span><span class="n">Function</span><span class="p">):</span>
<span class="gp">... </span><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="gp">... </span><span class="sd">    FMA(x, y, z) = x*y + z</span>
<span class="gp">...</span>
<span class="gp">... </span><span class="sd">    FMA is often defined as a single operation in hardware for better</span>
<span class="gp">... </span><span class="sd">    rounding and performance.</span>
<span class="gp">...</span>
<span class="gp">... </span><span class="sd">    FMA can be evaluated by using the doit() method.</span>
<span class="gp">...</span>
<span class="gp">... </span><span class="sd">    References</span>
<span class="gp">... </span><span class="sd">    ==========</span>
<span class="gp">...</span>
<span class="gp">... </span><span class="sd">    .. [1] https://en.wikipedia.org/wiki/Multiply%E2%80%93accumulate_operation#Fused_multiply%E2%80%93add</span>
<span class="gp">... </span><span class="sd">    &quot;&quot;&quot;</span>
<span class="gp">... </span>    <span class="c1"># Define automatic evaluation on explicit numbers</span>
<span class="gp">... </span>    <span class="nd">@classmethod</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">eval</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">):</span>
<span class="gp">... </span>        <span class="c1"># Number is the base class of Integer, Rational, and Float</span>
<span class="gp">... </span>        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">Number</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">]):</span>
<span class="gp">... </span>           <span class="k">return</span> <span class="n">x</span><span class="o">*</span><span class="n">y</span> <span class="o">+</span> <span class="n">z</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="c1"># Define numerical evaluation with evalf().</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">_eval_evalf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prec</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">doit</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">_eval_evalf</span><span class="p">(</span><span class="n">prec</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="c1"># Define full evaluation to Add and Mul in doit(). This effectively</span>
<span class="gp">... </span>    <span class="c1"># treats FMA(x, y, z) as just a shorthand for x*y + z that is useful</span>
<span class="gp">... </span>    <span class="c1"># to have as a separate expression in some contexts and which can be</span>
<span class="gp">... </span>    <span class="c1"># evaluated to its expanded form in other contexts.</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">doit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">hints</span><span class="p">):</span>
<span class="gp">... </span>        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span>
<span class="gp">... </span>        <span class="c1"># Recursively call doit() on the args whenever deep=True.</span>
<span class="gp">... </span>        <span class="c1"># Be sure to pass deep=True and **hints through here.</span>
<span class="gp">... </span>        <span class="k">if</span> <span class="n">deep</span><span class="p">:</span>
<span class="gp">... </span>            <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">doit</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="n">deep</span><span class="p">,</span> <span class="o">**</span><span class="n">hints</span><span class="p">)</span>
<span class="gp">... </span>            <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">doit</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="n">deep</span><span class="p">,</span> <span class="o">**</span><span class="n">hints</span><span class="p">)</span>
<span class="gp">... </span>            <span class="n">z</span> <span class="o">=</span> <span class="n">z</span><span class="o">.</span><span class="n">doit</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="n">deep</span><span class="p">,</span> <span class="o">**</span><span class="n">hints</span><span class="p">)</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="n">x</span><span class="o">*</span><span class="n">y</span> <span class="o">+</span> <span class="n">z</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="c1"># Define FMA.rewrite(Add) and FMA.rewrite(Mul).</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">_eval_rewrite</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rule</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">hints</span><span class="p">):</span>
<span class="gp">... </span>        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span>
<span class="gp">... </span>        <span class="k">if</span> <span class="n">rule</span> <span class="ow">in</span> <span class="p">[</span><span class="n">Add</span><span class="p">,</span> <span class="n">Mul</span><span class="p">]:</span>
<span class="gp">... </span>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">doit</span><span class="p">()</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="c1"># Define differentiation.</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">fdiff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">argindex</span><span class="p">):</span>
<span class="gp">... </span>        <span class="c1"># argindex indexes the args, starting at 1</span>
<span class="gp">... </span>        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span>
<span class="gp">... </span>        <span class="k">if</span> <span class="n">argindex</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<span class="gp">... </span>            <span class="k">return</span> <span class="n">y</span>
<span class="gp">... </span>        <span class="k">elif</span> <span class="n">argindex</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
<span class="gp">... </span>            <span class="k">return</span> <span class="n">x</span>
<span class="gp">... </span>        <span class="k">elif</span> <span class="n">argindex</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
<span class="gp">... </span>            <span class="k">return</span> <span class="mi">1</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="c1"># Define code printers for ccode() and cxxcode()</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">_ccode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">printer</span><span class="p">):</span>
<span class="gp">... </span>        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span>
<span class="gp">... </span>        <span class="n">_x</span><span class="p">,</span> <span class="n">_y</span><span class="p">,</span> <span class="n">_z</span> <span class="o">=</span> <span class="n">printer</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">printer</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="n">printer</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="s2">&quot;fma(</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">_x</span><span class="p">,</span> <span class="n">_y</span><span class="p">,</span> <span class="n">_z</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">_cxxcode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">printer</span><span class="p">):</span>
<span class="gp">... </span>        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span>
<span class="gp">... </span>        <span class="n">_x</span><span class="p">,</span> <span class="n">_y</span><span class="p">,</span> <span class="n">_z</span> <span class="o">=</span> <span class="n">printer</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">printer</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="n">printer</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="s2">&quot;std::fma(</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">_x</span><span class="p">,</span> <span class="n">_y</span><span class="p">,</span> <span class="n">_z</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id5">
<h4>Examples<a class="headerlink" href="#id5" title="Permalink to this heading">#</a></h4>
<p><strong>Evaluation:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;x y z&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">FMA</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="go">10</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">FMA</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>
<span class="go">FMA(x, y, z)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">FMA</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span><span class="o">.</span><span class="n">doit</span><span class="p">()</span>
<span class="go">x*y + z</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">FMA</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span><span class="o">.</span><span class="n">rewrite</span><span class="p">(</span><span class="n">Add</span><span class="p">)</span>
<span class="go">x*y + z</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">FMA</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">pi</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">evalf</span><span class="p">()</span>
<span class="go">7.28318530717959</span>
</pre></div>
</div>
<p><strong>Differentiation</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">FMA</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="go">2*x</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">FMA</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="go">y + 1</span>
</pre></div>
</div>
<p><strong>Code Printers</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sympy</span> <span class="kn">import</span> <span class="n">ccode</span><span class="p">,</span> <span class="n">cxxcode</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ccode</span><span class="p">(</span><span class="n">FMA</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">))</span>
<span class="go">&#39;fma(x, y, z)&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cxxcode</span><span class="p">(</span><span class="n">FMA</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">))</span>
<span class="go">&#39;std::fma(x, y, z)&#39;</span>
</pre></div>
</div>
</section>
</section>
</section>
<section id="additional-tips">
<h2>Additional Tips<a class="headerlink" href="#additional-tips" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>SymPy includes dozens of functions. These can serve as useful examples for
how to write a custom function, especially if the function is similar to one
that is already implemented. Remember that everything in this guide applies
equally well to functions that are included with SymPy and user-defined
functions. Indeed, this guide is designed to serve as both a developer guide
for contributors to SymPy and a guide for end-users of SymPy.</p></li>
<li><p>If you have many custom functions that share common logic, you can use a
common base class to contain this shared logic. For an example of this, see
the <a class="reference external" href="https://github.com/sympy/sympy/blob/master/sympy/functions/elementary/trigonometric.py">source code for the trigonometric functions in
SymPy</a>,
which use <code class="docutils literal notranslate"><span class="pre">TrigonometricFunction</span></code>, <code class="docutils literal notranslate"><span class="pre">InverseTrigonometricFunction</span></code>, and
<code class="docutils literal notranslate"><span class="pre">ReciprocalTrigonometricFunction</span></code> base classes with some shared logic.</p></li>
<li><p>As with any code, it is a good idea to write extensive tests for your
function. The <a class="reference external" href="https://github.com/sympy/sympy/tree/master/sympy/functions/elementary/tests">SymPy test
suite</a>
is a good resource for examples of how to write tests for such functions.
All code included in SymPy itself is required to be tested. Functions
included in SymPy should also always contain a docstring with references, a
mathematical definition, and doctest examples.</p></li>
</ul>
<hr class="footnotes docutils" />
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="evaluate-footnote" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id1">1</a><span class="fn-bracket">]</span></span>
<p>While it is technically possible to bypass automatic
evaluation by using <code class="docutils literal notranslate"><span class="pre">evaluate=False</span></code>, this is recommended against for
two reasons. Firstly, <code class="docutils literal notranslate"><span class="pre">evaluate=False</span></code> is fragile because any function
that rebuilds the expression from its <code class="docutils literal notranslate"><span class="pre">.args</span></code> will not keep the
<code class="docutils literal notranslate"><span class="pre">evaluate=False</span></code> flag, causing it to evaluate. Secondly,
<code class="docutils literal notranslate"><span class="pre">evaluate=False</span></code> tends to be bug prone, because other code may be
written expecting the invariants from the automatic evaluation to hold.
It is much better to not evaluate such cases at all in <code class="docutils literal notranslate"><span class="pre">eval()</span></code>, and
move such simplifications to <a class="reference internal" href="#custom-functions-doit"><span class="std std-ref"><code class="docutils literal notranslate"><span class="pre">doit()</span></code></span></a> instead.</p>
</aside>
</aside>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="solving/index.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Solve Equations</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="booleans.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Symbolic and fuzzy booleans</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2023 SymPy Development Team
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            <div class="last-updated">
              Last updated on Apr 23, 2023</div>
          </div>
          <div class="right-details">
            <div class="icons">
              <a class="muted-link " href="https://github.com/sympy/sympy" aria-label="GitHub">
                <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z"></path>
                </svg>
            </a>
              
            </div>
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Writing Custom Functions</a><ul>
<li><a class="reference internal" href="#easy-cases-fully-symbolic-or-fully-evaluated">Easy Cases: Fully Symbolic or Fully Evaluated</a><ul>
<li><a class="reference internal" href="#the-fully-symbolic-case">The Fully Symbolic Case</a></li>
<li><a class="reference internal" href="#the-fully-evaluated-case">The Fully Evaluated Case</a></li>
</ul>
</li>
<li><a class="reference internal" href="#creating-a-custom-function">Creating a Custom Function</a><ul>
<li><a class="reference internal" href="#defining-automatic-evaluation-with-eval">Defining Automatic Evaluation with <code class="docutils literal notranslate"><span class="pre">eval()</span></code></a><ul>
<li><a class="reference internal" href="#best-practices-for-eval">Best Practices for <code class="docutils literal notranslate"><span class="pre">eval()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#assumptions">Assumptions</a></li>
<li><a class="reference internal" href="#numerical-evaluation-with-evalf">Numerical Evaluation with <code class="docutils literal notranslate"><span class="pre">evalf()</span></code></a></li>
<li><a class="reference internal" href="#rewriting-and-simplification">Rewriting and Simplification</a><ul>
<li><a class="reference internal" href="#rewrite"><code class="docutils literal notranslate"><span class="pre">rewrite()</span></code></a></li>
<li><a class="reference internal" href="#doit"><code class="docutils literal notranslate"><span class="pre">doit()</span></code></a></li>
<li><a class="reference internal" href="#expand"><code class="docutils literal notranslate"><span class="pre">expand()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#differentiation">Differentiation</a></li>
<li><a class="reference internal" href="#printing">Printing</a></li>
<li><a class="reference internal" href="#other-methods">Other Methods</a><ul>
<li><a class="reference internal" href="#inverse"><code class="docutils literal notranslate"><span class="pre">inverse()</span></code></a></li>
<li><a class="reference internal" href="#as-real-imag"><code class="docutils literal notranslate"><span class="pre">as_real_imag()</span></code></a></li>
<li><a class="reference internal" href="#miscellaneous-eval-methods">Miscellaneous <code class="docutils literal notranslate"><span class="pre">_eval_*</span></code> methods</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#complete-examples">Complete Examples</a><ul>
<li><a class="reference internal" href="#versine">Versine</a><ul>
<li><a class="reference internal" href="#definition">Definition</a></li>
<li><a class="reference internal" href="#examples">Examples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#divides">divides</a><ul>
<li><a class="reference internal" href="#id2">Definition</a></li>
<li><a class="reference internal" href="#id3">Examples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#fused-multiply-add-fma">Fused Multiply-Add (FMA)</a><ul>
<li><a class="reference internal" href="#id4">Definition</a></li>
<li><a class="reference internal" href="#id5">Examples</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#additional-tips">Additional Tips</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../_static/jquery.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/scripts/furo.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]]}, "options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    </body>
</html>